cscope 15 $HOME/git/coevol/mini-coevol               0000852270
	@AbstractTree.h

2 #iâdeà
ABSTRACTTREE_H


3 
	#ABSTRACTTREE_H


	)

5 
	~"T»e.h
"

7 şas 
	cAb¡¿ùT»e
 {

9 
	mpublic
:

10 
vœtu®
 ~
	$Ab¡¿ùT»e
() {}

12 
vœtu®
 
T»e
* 
	`G‘T»e
() = 0;

13 
Lšk
* 
	$G‘RoÙ
(è{ 
	`G‘T»e
()->
	`G‘RoÙ
();
	}
}

16 
	g‹m¶©e
 <
şass
 
	gV
> cÏs 
	cB¿nchV¬T»e
 : 
public
 
vœtu®
 
Ab¡¿ùT»e
 {

18 
public
:

19 
vœtu®
 
V¬
<
V
>* 
G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) = 0;

21 
	$S‘Name
(
¡ršg
 
šÇme
) {

22 
	`RecursiveS‘Name
(
this
->
	`G‘RoÙ
(),
šÇme
);

25 
	$PrštL’gths
() {

26 
	`RecursivePrštL’gths
(
this
->
	`G‘RoÙ
());

27 
	}
}

45 
	g´Ùeùed
:

76 
	$RecursiveS‘Name
(
Lšk
* 
äom
, 
¡ršg
 
šÇme
) {

77 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

78 
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())->
	`S‘Name
(
šÇme
);

79 
	`RecursiveS‘Name
(
lšk
->
	`Out
(),
šÇme
);

81 
	}
}

83 
	$Regi¡”B¿nchT»e
(
Lšk
* 
äom
, 
DAGnode
* 
š
) {

84 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

85 
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())->
	`Regi¡”
(
š
);

86 
	`Regi¡”B¿nchT»e
(
lšk
->
	`Out
(),
š
);

88 
	}
}

90 
	$RecursivePrštL’gths
(
Lšk
* 
äom
) {

91 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

92 
o¡ršg¡»am
 
s
;

93 
s
 << 
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())->
	`v®
();

94 
lšk
->
	`G‘B¿nch
()->
	`S‘Name
(
s
.
	`¡r
());

95 
	`RecursivePrštL’gths
(
lšk
->
	`Out
());

97 
	}
}

100 
	g‹m¶©e
 <
şass
 
	gV
> cÏs 
	cNodeV¬T»e
 : 
public
 
vœtu®
 
Ab¡¿ùT»e
 {

102 
public
:

103 
vœtu®
 
V¬
<
V
>* 
G‘NodeV®
(cÚ¡ 
Node
* 
node
) = 0;

105 
	mV¬
<
	mV
>* 
	$G‘RoÙV®
(è{ 
	`G‘NodeV®
(
	`G‘RoÙ
()->
	`G‘Node
());}

107 
vœtu®
 
	$Regi¡”NodeT»e
(
DAGnode
* 
š
) {

108 
	`Regi¡”NodeT»e
(
	`G‘RoÙ
(),
š
);

109 
	}
}

127 
	g´Ùeùed
:

152 
	$Regi¡”NodeT»e
(
Lšk
* 
äom
, 
DAGnode
* 
š
) {

153 
	`G‘NodeV®
(
äom
->
	`G‘Node
())->
	`Regi¡”
(
š
);

154 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

155 
	`Regi¡”NodeT»e
(
lšk
->
	`Out
(),
š
);

157 
	}
}

163 
şass
 
	gL’gthT»e
 : 
public
 
vœtu®
 
B¿nchV¬T»e
<
PosR—l
> {

165 
public
:

167 ~
L’gthT»e
() {}

169 
vœtu®
 
V¬
<
PosR—l
>* 
G‘B¿nchL’gth
(cÚ¡ 
B¿nch
* 
b¿nch
) {

170  
G‘B¿nchV®
(
b¿nch
);

173 
S‘B¿nchL’gths
() {

174 
S‘B¿nchL’gths
(
G‘RoÙ
());

177 
G‘TÙ®L’gth
() {

178  
G‘TÙ®L’gth
(
G‘RoÙ
());

181 
	g´Ùeùed
:

183 
G‘TÙ®L’gth
(cÚ¡ 
Lšk
* 
äom
) {

184 
tÙ
 = 0;

185 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

186 
tÙ
 +ğ
G‘B¿nchL’gth
(
lšk
->
G‘B¿nch
())->
v®
();

187 
	gtÙ
 +ğ
G‘TÙ®L’gth
(
lšk
->
Out
());

189  
	gtÙ
;

192 
S‘B¿nchL’gths
(
Lšk
* 
äom
) {

193 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

194 
G‘B¿nchL’gth
(
lšk
->
G‘B¿nch
())->
£tv®
(
©of
(Öšk->G‘B¿nch()->
G‘Name
()).
c_¡r
()));

195 
S‘B¿nchL’gths
(
lšk
->
Out
());

199 
	gpublic
:

201 
G‘M—nAndV¬
(& 
m—n
, & 
v¬
) {

202 
	gm—n
 = 0;

203 
	gv¬
 = 0;

204 
	gcouÁ
 = 0;

205 
RecursiveG‘M—nAndV¬
(
G‘RoÙ
(),
m—n
,
v¬
,
couÁ
);

206 
	gm—n
/=
couÁ
;

207 
	gv¬
/=
couÁ
;

208 
	gv¬
-=
m—n
*mean;

211 
G‘Mš
() {

212  
RecursiveG‘Mš
(
G‘RoÙ
());

215 
G‘Max
() {

216  
RecursiveG‘Max
(
G‘RoÙ
());

219 
G‘F¿ùiÚAbove
(
cutoff
, & 
n
, & 
tÙjošt
) {

221 
	gm—n
 = 0;

222 
	gv¬
 = 0;

223 
G‘M—nAndV¬
(
m—n
,
v¬
);

224 
	gn
 = 0;

225 
	gtÙjošt
 = 0;

226 
RecursiveG‘F¿ùiÚAbove
(
G‘RoÙ
(), G‘RoÙ(), 
cutoff
*
m—n
, 
n
, 
tÙjošt
);

229 
	g´Ùeùed
:

231 
RecursiveG‘Mš
(cÚ¡ 
Lšk
* 
äom
) {

233 
mš
 = -1;

234 ià(! 
	gäom
->
isRoÙ
()) {

235 
	gmš
 = 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
v®
();

237 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

238 
tmp
 = 
RecursiveG‘Mš
(
lšk
->
Out
());

239 ià((
	gmš
 =ğ-1è|| (
mš
 > 
tmp
)) {

240 
mš
 = 
tmp
;

243  
	gmš
;

246 
RecursiveG‘Max
(cÚ¡ 
Lšk
* 
äom
) {

248 
	gmax
 = 0;

249 ià(! 
	gäom
->
isRoÙ
()) {

250 
	gmax
 = 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
v®
();

252 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

253 
tmp
 = 
RecursiveG‘Max
(
lšk
->
Out
());

254 ià(
	gmax
 < 
	gtmp
) {

255 
	gmax
 = 
tmp
;

258  
	gmax
;

261 
RecursiveG‘M—nAndV¬
(cÚ¡ 
Lšk
* 
äom
, & 
m—n
, & 
v¬
, & 
couÁ
) {

262 ià(! 
	gäom
->
isRoÙ
()) {

263 
	gtmp
 = 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
v®
();

264 
	gm—n
 +ğ
tmp
;

265 
	gv¬
 +ğ
tmp
*tmp;

266 
	gcouÁ
++;

268 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

269 
RecursiveG‘M—nAndV¬
(
lšk
->
Out
(),
m—n
,
v¬
,
couÁ
);

273 
RecursiveG‘F¿ùiÚAbove
(cÚ¡ 
Lšk
* 
äomup
, cÚ¡ Lšk* 
äom
, 
v®ue
, & 
n
, & 
tÙjošt
) {

274 ià(! 
	gäom
->
isRoÙ
()) {

275 
	gtmp
 = 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
v®
();

276 ià(
	gtmp
 > 
	gv®ue
) {

277 
	gn
++;

278 ià(! 
	gäomup
->
isRoÙ
()) {

279 
	gtmpup
 = 
G‘B¿nchV®
(
äomup
->
G‘B¿nch
())->
v®
();

280 ià(
	gtmpup
 > 
	gv®ue
) {

281 
	gtÙjošt
 ++;

287 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

288 
RecursiveG‘F¿ùiÚAbove
(
äom
,
lšk
->
Out
(),
v®ue
,
n
,
tÙjošt
);

292 
	gpublic
:

294 
CheckRoÙToT
(cÚ¡ 
Lšk
* 
äom
, 
p
 = 0) {

295 ià(
äom
->
isL—f
()) {

296 
û¼
 << 
p
 << '\t';

299 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

300 
CheckRoÙToT
(
lšk
->
Out
(), 
p
 + 
G‘B¿nchL’gth
Öšk->
G‘B¿nch
())->
v®
());

306 
şass
 
	gRªdomL’gthT»e
 : 
public
 
vœtu®
 
L’gthT»e
 ,…ubliøvœtu® 
	gMuÉliÿtive
 {

308 
	gpublic
:

310 
vœtu®
 
Regi¡”
(
DAGnode
* 
š
) {

311 
Regi¡”B¿nchT»e
(
G‘RoÙ
(),
š
);

314 
SÿÏrMuÉliÿtiÚ
(
d
) {

315  
SÿÏrMuÉliÿtiÚ
(
G‘RoÙ
(),
d
);

318 
	g´Ùeùed
:

320 
SÿÏrMuÉliÿtiÚ
(cÚ¡ 
Lšk
* 
äom
, 
d
) {

321 
	gtÙ
 = 0;

322 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

323 
tÙ
 +ğ
G‘B¿nchL’gth
(
lšk
->
G‘B¿nch
())->
SÿÏrMuÉliÿtiÚ
(
d
);

324 
	gtÙ
 +ğ
SÿÏrMuÉliÿtiÚ
(
lšk
->
Out
(),
d
);

326  
	gtÙ
;

331 
	g‹m¶©e
 <
şass
 
	gU
, cÏs 
	gV
> cÏs 
	gNodeB¿nchV¬T»e
 : 
public
 
vœtu®
 
NodeV¬T»e
<
U
>,…ubliøvœtu® 
	gB¿nchV¬T»e
<V> {};

333 
	g‹m¶©e
 <> 
şass
 
	gNodeB¿nchV¬T»e
<
	gPosR—l
,PosR—l> : 
public
 
vœtu®
 
NodeV¬T»e
<
PosR—l
>,…ubliøvœtu® 
	gL’gthT»e
 {};

334 
	g‹m¶©e
 <
şass
 
	gU
> cÏs 
	gNodeB¿nchV¬T»e
<U,
	gPosR—l
> : 
public
 
vœtu®
 
NodeV¬T»e
<
U
>,…ubliøvœtu® 
	gL’gthT»e
 {};

	@AminoAcidOmegaSubMatrix.cpp

1 
	~"AmšoAcidOmegaSubM©rix.h
"

6 
	gAAOmegaSubM©rix
 :: 
	$Compu‹A¼ay
(
n
){

7 
tÙ®
 = 0;

8 
i
=0; i< 
N¯
; i++){

9 if(
n
!=
i
){

10 
Q
[
n
][
i
] = 
	`R–©iveR©e
Ò,iè* 
mStiÚ¬y
[i];

11 if(
mSim¬™yM©rix
->
	`isRadiÿl
(
n
,
i
))

12 
Q
[
n
][
i
] *ğ
	`G‘Omega
();

13 
tÙ®
 +ğ
Q
[
n
][
i
];

16 
Q
[
n
][n] = -
tÙ®
;

17 
	}
}

19 
	gRªdomAAOmegaSubM©rix
 :: 
	$S‘P¬am‘”s
(){

20 
i
=0; i<
»Ì©e
->
	`G‘Dim
(); i++) {

21 
»sÿËd»Ì©e
[
i
] = (*
»Ì©e
)[i] *„–¿‹->
	`G‘Dim
();

23 
	`S‘R–©iveR©e
(
»sÿËd»Ì©e
);

24 
	`CİyStiÚ¬y
(
¡©
->
	`v®
().
	`G‘A¼ay
());

25 
	`£tOmega
(
¿ndomOmega
->
	`v®
());

26 
	}
}

28 
	gS¶™AAOmegaSubM©rix
 :: 
	$Compu‹A¼ay
(
n
){

29 
tÙ®
 = 0;

30 
i
=0; i< 
N¯
; i++){

31 if(
n
!=
i
){

32 
Q
[
n
][
i
] = 
	`R–©iveR©e
Ò,iè* 
mStiÚ¬y
[i];

33 ià(
mS¶™M©
->
	`IsNÚCTN—»¡
(
n
,
i
) == 1) {

34 if(
mSim¬™yM©rix
->
	`isRadiÿl
(
n
,
i
)) {

35 
Q
[
n
][
i
] *ğ
	`G‘OmegaTv
();

39 ià(
¥l™ty³
 && (
mS¶™M©
->
	`IsNÚCTN—»¡
(
n
,
i
) == -1)) {

40 
Q
[
n
][
i
] = 0;

43 
Q
[
n
][
i
] *ğ
	`G‘TsTv
();

44 if(
mSim¬™yM©rix
->
	`isRadiÿl
(
n
,
i
)) {

45 
Q
[
n
][
i
] *ğ
	`G‘OmegaTs
();

49 
tÙ®
 +ğ
Q
[
n
][
i
];

52 
Q
[
n
][n] = -
tÙ®
;

53 
	}
}

56 
	gRªdomS¶™AAOmegaSubM©rix
 :: 
	$S‘P¬am‘”s
(){

57 
i
=0; i<
»Ì©e
->
	`G‘Dim
(); i++) {

58 
»sÿËd»Ì©e
[
i
] = (*
»Ì©e
)[i] *„–¿‹->
	`G‘Dim
();

60 
	`S‘R–©iveR©e
(
»sÿËd»Ì©e
);

61 
	`CİyStiÚ¬y
(
¡©
->
	`v®
().
	`G‘A¼ay
());

62 
	`£tTsTv
(
¿ndomTsTv
->
	`v®
());

63 ià(
¿ndomOmegaTs
) {

64 
	`£tOmegaTs
(
¿ndomOmegaTs
->
	`v®
());

67 
	`£tOmegaTs
(1);

69 
	`£tOmegaTv
(
¿ndomOmegaTv
->
	`v®
());

70 
	}
}

74 
	gAADoubËOmegaSubM©rix
::
	$Compu‹A¼ay
(
n
) {

76 
tÙ®
 = 0;

77 
i
=0; i<
	`G‘N¡©e
(); i++) {

78 ià(
i
!ğ
n
){

79 
pos
 = 
	`G‘DifãršgPos™iÚ
(
n
,
i
);

80 ià((
pos
 != -1) && (pos != 3)) {

81 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
n
);

82 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

83 ià(
a
 =ğ
b
) {

84 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
n
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
i
) << '\n';

85 
û¼
 << 
pos
 << '\n';

86 
	`ex™
(1);

88 
Q
[
n
][
i
] = (*
NucM©rix
)(
a
,
b
);

89 ià(! 
	`SynÚymous
(
n
,
i
)) {

90 
Q
[
n
][
i
] *ğ
	`G‘OmegadNdS
();

92 if(
mSim¬™yM©rix
->
	`isRadiÿl
(
¡©e¥aû
->
	`T¿n¦©iÚ
(
n
),¡©e¥aû->T¿n¦©iÚ(
i
))) {

93 
Q
[
n
][
i
] *ğ
	`G‘OmegaKrKc
();

97 
Q
[
n
][
i
] = 0;

99 
tÙ®
 +ğ
Q
[
n
][
i
];

102 
Q
[
n
][n] = -
tÙ®
;

103 ià(
tÙ®
 <0) {

104 
û¼
 << "negative„ate‡way\n";

105 
	`ex™
(1);

107 
	}
}

109 
	gAADoubËOmegaSubM©rix
::
	$S‘Omega
(
šomegadNdS
, 
šomegaKrKc
){

110 
omegadNdS
 = 
šomegadNdS
;

111 
omegaKrKc
 = 
šomegaKrKc
;

112 
	}
}

114 
	gRªdomAADoubËOmegaSubM©rix
::
	$S‘P¬am‘”s
(){

115 
	`S‘NucM©rix
(
m©rix
);

116 
	`S‘Omega
(
RªdomOmegadNdS
->
	`v®
(), 
RªdomOmegaKrKc
->val());

117 
	}
}

121 
	gAA»gSubM©rix
 :: 
	$Compu‹A¼ay
(
n
){

122 
tÙ®
 = 0;

123 
i
=0; i<
N¯
; i++){

124 if(
n
!=
i
){

125 
Q
[
n
][
i
] = 
	`exp
(
	`G‘Slİe
Ò,iè* 
	`log
(
	`G‘Omega
()è+ 
	`G‘IÁ”û±
Ò,i)è* 
mStiÚ¬y
[i];

126 
tÙ®
 +ğ
Q
[
n
][
i
];

129 
Q
[
n
][n] = -
tÙ®
;

130 
	}
}

133 
	gAA»gSubM©rix
 :: 
	$CİyStiÚ¬y
(cÚ¡ * 
š¡©
) {

134 
i
=0; i< 
N¯
 ; i++){

135 
mStiÚ¬y
[
i
] = 
š¡©
[i];

137 
	}
}

139 
	gAA»gSubM©rix
 :: 
	$CİySlİeIÁ”û±
(* 
š¦İe
, * 
šš‹rû±
, 
dim’siÚ
){

140 
i
=0; i< 
dim’siÚ
; i++){

141 
mSlİe
 [
i
] = 
š¦İe
[i];

142 
mIÁ”û±
 [
i
] = 
šš‹rû±
[i];

144 
	}
}

146 
	gAA»gSubM©rix
 :: 
	$£tOmega
(
šomega
) {

147 
omega
 = 
šomega
;

148 
	}
}

151 
	gRªdomAA»gSubM©rix
 :: 
	$S‘P¬am‘”s
(){

152 
	`£tOmega
(
¿ndomOmega
->
	`v®
());

153 
	`CİyStiÚ¬y
(
¡©
->
	`v®
().
	`G‘A¼ay
());

154 
	`CİySlİeIÁ”û±
(
¦İe
->
	`v®
().
	`G‘A¼ay
(), 
š‹rû±
->v®().G‘A¼ay(), slİe->
	`G‘Dim
());

155 
	}
}

	@AminoAcidOmegaSubMatrix.h

1 #iâdeà
AMINOACIDOMEGASUBMATRIX_H


2 
	#AMINOACIDOMEGASUBMATRIX_H


	)

4 
	~"RªdomSubM©rix.h
"

5 
	~"GTRSubM©rix.h
"

6 
	~"Sim¬™yM©rix.h
"

7 
	~"CodÚSubM©rix.h
"

8 
	~"S¶™AAM©rix.h
"

10 şas 
	cAAOmegaSubM©rix
 : 
public
 
GTRSubM©rix
 {

11 
public
:

13 
	$AAOmegaSubM©rix
 (
Sim¬™yM©rix
* 
šm©rix
,cÚ¡ * 
š»Ì©e
, cÚ¡ * 
š¡©
, 
šomega
, 
boŞ
 
šnÜm®i£
):

14 
	`SubM©rix
 (
N¯
, 
šnÜm®i£
),

15 
	$GTRSubM©rix
(
N¯
,
š»Ì©e
,
š¡©
,
šnÜm®i£
){

16 
mSim¬™yM©rix
 = 
šm©rix
;

17 
omega
 = 
šomega
;

20 
	$G‘Omega
(){ 
omega
;
	}
}

22 
	g´Ùeùed
:

24 
	$£tOmega
(
šomega
) {

25 
omega
 = 
šomega
;

26 
	}
}

27 
Compu‹A¼ay
(
¡©e
);

29 
	gomega
;

30 
Sim¬™yM©rix
* 
	gmSim¬™yM©rix
;

34 
şass
 
	gRªdomAAOmegaSubM©rix
 : 
public
 
RªdomSubM©rix
,…ubliø
	gAAOmegaSubM©rix
 {

36 
	gpublic
:

38 
RªdomAAOmegaSubM©rix
(
Sim¬™yM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
š»Ì©e
, V¬<Profe>* 
š¡©
 ,V¬<
PosR—l
>* 
šomega
, 
boŞ
 
šnÜm®i£
 = 
çl£
):

39 
SubM©rix
 (
N¯
, 
šnÜm®i£
),

40 
RªdomSubM©rix
 (
N¯
,
šnÜm®i£
),

41 
AAOmegaSubM©rix
(
šm©rix
,
š»Ì©e
->
v®
().
G‘A¼ay
(), 
š¡©
->v®().G‘A¼ay(), 
šomega
->v®(), 
šnÜm®i£
){

43 
	g¡©
 = 
š¡©
;

44 
	g»Ì©e
 = 
š»Ì©e
;

45 
	g¿ndomOmega
 = 
šomega
;

46 
	g»sÿËd»Ì©e
 = 
Ãw
 [
»Ì©e
->
G‘Dim
()];

47 
Regi¡”
(
»Ì©e
);

48 
Regi¡”
(
¡©
);

49 
Regi¡”
(
¿ndomOmega
);

50 
¥ecŸlUpd©e
();

53 
	g´Ùeùed
 :

55 
S‘P¬am‘”s
();

57 
	g´iv©e
:

58 
V¬
<
Profe
>* 
¡©
;

59 
	gV¬
<
	gPosR—l
>* 
	g¿ndomOmega
;

60 
	gV¬
<
	gProfe
>* 
	g»Ì©e
;

61 * 
	g»sÿËd»Ì©e
;

64 şas 
	cAADoubËOmegaSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

66 
public
:

68 
	$AADoubËOmegaSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
Sim¬™yM©rix
* 
šm©rix
, 
šomegadNdS
, 
šomegaKrKc
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

69 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

70 
	`CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

71 
	$MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
){

72 
	`S‘Omega
(
šomegadNdS
, 
šomegaKrKc
);

73 
mSim¬™yM©rix
 = 
šm©rix
;

74 
¡©e¥aû
 = 
š¡©e¥aû
;

77 
	$G‘OmegadNdS
(è{ 
omegadNdS
;
	}
}

78 
	$G‘OmegaKrKc
(è{ 
omegaKrKc
;
	}
}

80 
	g´Ùeùed
:

83 
Compu‹A¼ay
(
¡©e
);

84 
S‘Omega
(
šomegadNdS
, 
šomegaKrKc
);

87 
	gomegadNdS
;

88 
	gomegaKrKc
;

89 
Sim¬™yM©rix
* 
	gmSim¬™yM©rix
;

90 
CodÚS‹S·û
* 
	g¡©e¥aû
;

93 
şass
 
	gRªdomAADoubËOmegaSubM©rix
 : 
public
 
AADoubËOmegaSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

95 
	gpublic
:

97 
RªdomAADoubËOmegaSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šNucM©rix
, 
V¬
<
PosR—l
>* 
šRªdomOmegadNdS
, V¬<PosR—l>* 
šRªdomOmegaKrKc
, 
Sim¬™yM©rix
* 
šM©rix
, 
boŞ
 
šnÜm®i£
 = 
çl£
):

98 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

99 
CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

100 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

101 
AADoubËOmegaSubM©rix
(
š¡©e¥aû
,
šNucM©rix
,
šM©rix
, 
šRªdomOmegadNdS
->
v®
(), 
šRªdomOmegaKrKc
->v®(), 
šnÜm®i£
) ,

102 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
){

103 
	gm©rix
 = 
šNucM©rix
;

104 
	gRªdomOmegadNdS
 = 
šRªdomOmegadNdS
;

105 
	gRªdomOmegaKrKc
 = 
šRªdomOmegaKrKc
;

106 
Regi¡”
(
m©rix
);

107 
Regi¡”
(
RªdomOmegadNdS
);

108 
Regi¡”
(
RªdomOmegaKrKc
);

109 
¥ecŸlUpd©e
();

112 
	g´Ùeùed
:

114 
S‘P¬am‘”s
();

116 
	g´Ùeùed
:

118 
RªdomSubM©rix
* 
m©rix
;

119 
	gV¬
<
	gPosR—l
>* 
	gRªdomOmegadNdS
;

120 
	gV¬
<
	gPosR—l
>* 
	gRªdomOmegaKrKc
;

123 şas 
	cAA»gSubM©rix
 : 
public
 
vœtu®
 
SubM©rix
 {

125 
public
 :

127 
	$AA»gSubM©rix
(cÚ¡ * 
š¡©
, 
šomega
, * 
¦İe
, * 
š‹rû±
, 
boŞ
 
šnÜm®i£
 = 
çl£
 ) : 
	$SubM©rix
(
N¯
, 
šnÜm®i£
){

128 
omega
 = 
šomega
;

129 
mSlİe
 = 
¦İe
;

130 
mIÁ”û±
 = 
š‹rû±
;

131 
	`CİyStiÚ¬y
(
š¡©
);

134 
	$G‘Omega
(){ 
omega
;
	}
}

136 
	$G‘Slİe
(
i
, 
j
è{ 
mSlİe
[
	`šdex
(i,j,
	`G‘N¡©e
())];
	}
}

137 
	$G‘IÁ”û±
(
i
, 
j
){ 
mIÁ”û±
[
	`šdex
(i,j,
	`G‘N¡©e
())];
	}
}

139 
	$šdex
(
i
, 
j
, 
n¡©e
) {

140  (
i
<
j
è? (2 * 
n¡©e
 - i - 1) * i / 2 + j - i - 1 : (2 *‚state - j - 1) * j / 2 + i - j - 1 ;

141 
	}
}

143 
	g´Ùeùed
:

145 
£tOmega
(
šomega
);

146 
Compu‹A¼ay
(
¡©e
);

147 
	$Compu‹StiÚ¬y
(){
	}
};

148 
CİyStiÚ¬y
 (cÚ¡ * 
š¡©
);

149 
CİySlİeIÁ”û±
(* 
š¦İe
, * 
šš‹rû±
, 
dim’siÚ
);

151 
	g´iv©e
:

152 
omega
;

153 * 
	gmIÁ”û±
;

154 * 
	gmSlİe
;

157 
şass
 
	gRªdomAA»gSubM©rix
 : 
public
 
RªdomSubM©rix
,…ubliø
	gAA»gSubM©rix
 {

159 
	gpublic
 :

161 
RªdomAA»gSubM©rix
 (
V¬
<
Profe
>* 
š¡©
, V¬<
PosR—l
>* 
šomega
, V¬<
R—lVeùÜ
>* 
š¦İe
, V¬<R—lVeùÜ>* 
šš‹rû±
, 
boŞ
 
šnÜm®i£
 = 
çl£
 ):

162 
SubM©rix
 (
N¯
, 
šnÜm®i£
),

163 
RªdomSubM©rix
 (
N¯
, 
šnÜm®i£
),

164 
AA»gSubM©rix
(
š¡©
->
v®
().
G‘A¼ay
(), 
šomega
->v®(), 
š¦İe
->v®().G‘A¼ay(), 
šš‹rû±
->v®().G‘A¼ay(), 
šnÜm®i£
){

165 
	g¡©
 = 
š¡©
;

166 
	g¿ndomOmega
 = 
šomega
;

167 
	g¦İe
 = 
š¦İe
;

168 
	gš‹rû±
 = 
šš‹rû±
;

169 
Regi¡”
(
¡©
);

170 
Regi¡”
(
¦İe
);

171 
Regi¡”
(
š‹rû±
);

172 
Regi¡”
(
¿ndomOmega
);

175 
	g´Ùeùed
:

176 
S‘P¬am‘”s
();

178 
	g´iv©e
:

179 
V¬
<
Profe
>* 
¡©
;

180 
	gV¬
<
	gPosR—l
>* 
	g¿ndomOmega
;

181 
	gV¬
<
	gR—lVeùÜ
>* 
	g¦İe
;

182 
	gV¬
<
	gR—lVeùÜ
>* 
	gš‹rû±
;

189 şas 
	cS¶™AAOmegaSubM©rix
 : 
public
 
GTRSubM©rix
 {

190 
public
:

192 
	$S¶™AAOmegaSubM©rix
 (
Sim¬™yM©rix
* 
šm©rix
,cÚ¡ * 
š»Ì©e
, cÚ¡ * 
š¡©
, 
št¡v
, 
šomeg©s
, 
šomeg©v
, 
S¶™AAM©rix
* 
š¥l™m©
, 
š¥l™ty³
, 
boŞ
 
šnÜm®i£
):

193 
	`SubM©rix
 (
N¯
, 
šnÜm®i£
),

194 
	$GTRSubM©rix
(
N¯
,
š»Ì©e
,
š¡©
,
šnÜm®i£
){

195 
mSim¬™yM©rix
 = 
šm©rix
;

196 
t¡v
 = 
št¡v
;

197 
omeg©s
 = 
šomeg©s
;

198 
omeg©v
 = 
šomeg©v
;

199 
mS¶™M©
 = 
š¥l™m©
;

200 
¥l™ty³
 = 
š¥l™ty³
;

203 
	$G‘TsTv
(è{ 
t¡v
;
	}
}

204 
	$G‘OmegaTs
(){ 
omeg©s
;
	}
}

205 
	$G‘OmegaTv
(){ 
omeg©v
;
	}
}

207 
	g´Ùeùed
:

209 
	$£tTsTv
(
št¡v
) {

210 
t¡v
 = 
št¡v
;

211 
	}
}

212 
	$£tOmegaTs
(
šomeg©s
) {

213 
omeg©s
 = 
šomeg©s
;

214 
	}
}

215 
	$£tOmegaTv
(
šomeg©v
) {

216 
omeg©v
 = 
šomeg©v
;

217 
	}
}

218 
Compu‹A¼ay
(
¡©e
);

220 
	gt¡v
;

221 
	gomeg©s
;

222 
	gomeg©v
;

223 
Sim¬™yM©rix
* 
	gmSim¬™yM©rix
;

224 
S¶™AAM©rix
* 
	gmS¶™M©
;

225 
	g¥l™ty³
;

229 
şass
 
	gRªdomS¶™AAOmegaSubM©rix
 : 
public
 
RªdomSubM©rix
,…ubliø
	gS¶™AAOmegaSubM©rix
 {

231 
	gpublic
:

233 
RªdomS¶™AAOmegaSubM©rix
(
Sim¬™yM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
š»Ì©e
, V¬<Profe>* 
š¡©
 , V¬<
PosR—l
>* 
št¡v
, V¬<PosR—l>* 
šomeg©s
, V¬<PosR—l>* 
šomeg©v
, 
S¶™AAM©rix
* 
š¥l™¯M©rix
, 
š¥l™ty³
, 
boŞ
 
šnÜm®i£
 = 
çl£
):

234 
SubM©rix
 (
N¯
, 
šnÜm®i£
),

235 
RªdomSubM©rix
 (
N¯
,
šnÜm®i£
),

236 
S¶™AAOmegaSubM©rix
(
šm©rix
,
š»Ì©e
->
v®
().
G‘A¼ay
(), 
š¡©
->v®().G‘A¼ay(), 
št¡v
->v®(), 1 , 
šomeg©v
->v®(), 
š¥l™¯M©rix
, 
š¥l™ty³
, 
šnÜm®i£
){

238 
	g¡©
 = 
š¡©
;

239 
	g»Ì©e
 = 
š»Ì©e
;

240 
	g¿ndomTsTv
 = 
št¡v
;

241 
	g¿ndomOmegaTs
 = 
šomeg©s
;

242 
	g¿ndomOmegaTv
 = 
šomeg©v
;

243 
	g»sÿËd»Ì©e
 = 
Ãw
 [
»Ì©e
->
G‘Dim
()];

244 
Regi¡”
(
»Ì©e
);

245 
Regi¡”
(
¡©
);

246 
Regi¡”
(
¿ndomTsTv
);

247 
Regi¡”
(
¿ndomOmegaTs
);

248 
Regi¡”
(
¿ndomOmegaTv
);

249 
¥ecŸlUpd©e
();

252 
	g´Ùeùed
 :

254 
S‘P¬am‘”s
();

256 
	g´iv©e
:

257 
V¬
<
Profe
>* 
¡©
;

258 
	gV¬
<
	gPosR—l
>* 
	g¿ndomTsTv
;

259 
	gV¬
<
	gPosR—l
>* 
	g¿ndomOmegaTs
;

260 
	gV¬
<
	gPosR—l
>* 
	g¿ndomOmegaTv
;

261 
	gV¬
<
	gProfe
>* 
	g»Ì©e
;

262 * 
	g»sÿËd»Ì©e
;

	@AncestralData.h

1 #iâdeà
ANCESTRALDATA_H


2 
	#ANCESTRALDATA_H


	)

4 
	~"T»e.h
"

5 
	~"TaxÚS‘.h
"

6 
	~<f¡»am
>

7 
	~<cm©h
>

8 
	~<m­
>

9 
	~"SumCÚ¡¿šed.h
"

11 şas 
	cAnû¡¿lD©a
 {

13 
	mpublic
:

15 
	$Anû¡¿lD©a
(
T»e
* 
šŒ“
è: 
	$Œ“
(
šŒ“
) {}

18 
TaxÚS‘
* 
	$G‘TaxÚS‘
() {

19  
x£t
;

20 
	}
}

22 
	$G‘Ns™e
() {

23  
Ns™e
;

24 
	}
}

26 
T»e
* 
	$G‘T»e
() {

27  
Œ“
;

28 
	}
}

30 
	$G‘N’Œy
() {

31  
d©a
.
	`size
();

32 
	}
}

34 
boŞ
 
	$Exi¡s
(cÚ¡ 
Lšk
* 
lšk
) {

35  (
d©a
.
	`fšd
(
lšk
è!ğd©a.
	`’d
());

36 
	}
}

38 
	$S‘S‹
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
, 
¡©e
) {

39 ià(
d©a
.
	`fšd
(
lšk
è=ğd©a.
	`’d
()) {

40 
û¼
 << "error in‡ncestral data: did‚ot find†ink in hash\n";

41 
Œ“
->
	`ToSŒ—m
(
û¼
,
lšk
);

42 
û¼
 << '\n';

43 
	`ex™
(1);

45 
d©a
[
lšk
][
s™e
] = 
¡©e
;

46 
	}
}

48 
	$G‘S‹
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

49 ià(
d©a
.
	`fšd
(
lšk
è=ğd©a.
	`’d
()) {

50 
û¼
 << "error in‡ncestral data: did‚ot find†ink in hash\n";

51 
Œ“
->
	`ToSŒ—m
(
û¼
,
lšk
);

52 
û¼
 << '\n';

53 
	`ex™
(1);

55  
d©a
[
lšk
][
s™e
];

56 
	}
}

58 
	$S‘S‹
(
¡ršg
 
xÚ1
, sŒšg 
xÚ2
, 
s™e
, 
¡©e
) {

59 cÚ¡ 
Lšk
* 
lšk
 = 
Œ“
->
	`G‘LCA
(
xÚ1
,
xÚ2
);

60 ià(
d©a
.
	`fšd
(
lšk
è=ğd©a.
	`’d
()) {

61 
û¼
 << "error in‡ncestral data: did‚ot find†ink in hash\n";

62 
û¼
 << 
xÚ1
 << '\t' << 
xÚ2
 << '\n';

63 
	`ex™
(1);

65 
d©a
[
lšk
][
s™e
] = 
¡©e
;

66 
	}
}

68 
	$G‘S‹
(
¡ršg
 
xÚ1
, sŒšg 
xÚ2
, 
s™e
) {

69 cÚ¡ 
Lšk
* 
lšk
 = 
Œ“
->
	`G‘LCA
(
xÚ1
,
xÚ2
);

70 ià(
d©a
.
	`fšd
(
lšk
è=ğd©a.
	`’d
()) {

71 
û¼
 << "error in‡ncestral data: did‚ot find†ink in hash\n";

72 
û¼
 << 
xÚ1
 << '\t' << 
xÚ2
 << '\n';

73 
	`ex™
(1);

75  
d©a
[
lšk
][
s™e
];

76 
	}
}

78 
boŞ
 
	$isMissšg
(
¡ršg
 
xÚ1
, sŒšg 
xÚ2
, 
s™e
) {

79  (
	`G‘S‹
(
xÚ1
,
xÚ2
,
s™e
) == -1);

80 
	}
}

82 
	$ToSŒ—m
(
o¡»am
& 
os
) {

83 
couÁ
 = 0;

84 
m­
<cÚ¡ 
Lšk
*, *>::
™”©Ü
 
i
 = 
d©a
.
	`begš
(); i!ğd©a.
	`’d
(); i++) {

85 
couÁ
++;

87 
os
 << 
couÁ
 << '\t' << 
Ns™e
 << '\n';

88 
	`RecursiveToSŒ—m
(
Œ“
->
	`G‘RoÙ
(),
os
);

89 
	}
}

91 
	$RecursiveToSŒ—m
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
) {

93 
os
 << 
x1
[
äom
] << '\t' << 
x2
[from];

94 * 
tmp
 = 
d©a
[
äom
];

95 
i
=0; i<
Ns™e
; i++) {

96 
os
 << '\t' << 
tmp
[
i
];

98 
os
 << '\n';

99 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

100 
	`RecursiveToSŒ—m
(
lšk
->
	`Out
(),
os
);

102 
	}
}

104 
	gNs™e
;

105 
TaxÚS‘
* 
	gx£t
;

106 
T»e
* 
	gŒ“
;

107 
	gm­
<cÚ¡ 
	gLšk
*, *> 
	gd©a
;

108 
	gm­
<cÚ¡ 
	gLšk
*, 
	g¡ršg
> 
	gx1
;

109 
	gm­
<cÚ¡ 
	gLšk
*, 
	g¡ršg
> 
	gx2
;

113 şas 
	cFeAnû¡¿lD©a
 : 
public
 
Anû¡¿lD©a
 {

115 
public
:

116 
	$FeAnû¡¿lD©a
(
T»e
* 
šŒ“
, 
i¡»am
& 
is
è: 
	$Anû¡¿lD©a
(
šŒ“
) {

117 
	`R—dD©aFromFe
(
is
);

120 
	$FeAnû¡¿lD©a
(
T»e
* 
šŒ“
, 
¡ršg
 
f’ame
è: 
	$Anû¡¿lD©a
(
šŒ“
) {

121 
if¡»am
 
	`is
(
f’ame
.
	`c_¡r
());

122 
	`R—dD©aFromFe
(
is
);

123 
	}
}

125 
	$FeAnû¡¿lD©a
(
T»e
* 
šŒ“
, 
¡ršg
 
f’ame
, 
šNs™e
è: 
	$Anû¡¿lD©a
(
šŒ“
) {

126 
Ns™e
 = 
šNs™e
;

127 
if¡»am
 
	`is
(
f’ame
.
	`c_¡r
());

128 
	`R—dTem¶©eFromFe
(
is
);

129 
	}
}

131 
	g´iv©e
:

133 
	$R—dD©aFromFe
(
i¡»am
& 
is
) {

135 
m­
<
¡ršg
,> 
Çmem­
;

136 
ÃÁry
;

137 
is
 >> 
ÃÁry
 >> 
Ns™e
;

138 
¡ršg
 
xÚ1
, 
xÚ2
;

139 
i
=0; i<
ÃÁry
; i++) {

140 
is
 >> 
xÚ1
 >> 
xÚ2
;

141 
Çmem­
[
xÚ1
] = 1;

142 
Çmem­
[
xÚ2
] = 1;

143 cÚ¡ 
Lšk
* 
lšk
 = 
Œ“
->
	`G‘LCA
(
xÚ1
, 
xÚ2
);

144 ià(
d©a
.
	`fšd
(
lšk
è!ğd©a.
	`’d
()) {

145 
û¼
 << "error in‡ncestral data: found‚odewice in hashable\n";

146 
û¼
 << 
xÚ1
 << '\t' << 
xÚ2
 << '\n';

147 
û¼
 << 
x1
[
lšk
] << '\t' << 
x2
[link] << '\n';

148 
û¼
 << 
lšk
 << '\n';

156 
	`ex™
(1);

158 ià(
lšk
) {

159 * 
tmp
 = 
Ãw
 [
Ns™e
];

160 
j
=0; j<
Ns™e
; j++) {

161 
is
 >> 
tmp
[
j
];

163 
d©a
[
lšk
] = 
tmp
;

164 
x1
[
lšk
] = 
xÚ1
;

165 
x2
[
lšk
] = 
xÚ2
;

168 
û¼
 << "did‚Ù fšd‡nû¡Ü of: " << 
xÚ1
 << '\t' << 
xÚ2
 << '\n';

169 
tmp
;

170 
j
=0; j<
Ns™e
; j++) {

171 
is
 >> 
tmp
;

175 
Áaxa
 = 
Çmem­
.
	`size
();

176 
¡ršg
* 
Çme
 = 
Ãw
 sŒšg[
Áaxa
];

177 
couÁ
 = 0;

178 
m­
<
¡ršg
,>::
™”©Ü
 
i
 = 
Çmem­
.
	`begš
(); i!ğÇmem­.
	`’d
(); i++) {

179 
Çme
[
couÁ
++] = 
i
->
fœ¡
;

181 ià(
couÁ
 !ğ
Áaxa
) {

182 
û¼
 << "error in file‡ncestral data:‚on matchingax size\n";

183 
	`ex™
(1);

185 
x£t
 = 
Ãw
 
	`TaxÚS‘
(
Çme
,
Áaxa
);

186 
d–‘e
[] 
Çme
;

188 
	}
}

190 
	$R—dTem¶©eFromFe
(
i¡»am
& 
is
) {

192 
m­
<
¡ršg
,> 
Çmem­
;

193 
ÃÁry
;

194 
is
 >> 
ÃÁry
;

195 
¡ršg
 
xÚ1
, 
xÚ2
;

196 
i
=0; i<
ÃÁry
; i++) {

197 
is
 >> 
xÚ1
 >> 
xÚ2
;

198 
Çmem­
[
xÚ1
] = 1;

199 
Çmem­
[
xÚ2
] = 1;

200 cÚ¡ 
Lšk
* 
lšk
 = 
Œ“
->
	`G‘LCA
(
xÚ1
, 
xÚ2
);

201 ià(
d©a
.
	`fšd
(
lšk
è!ğd©a.
	`’d
()) {

202 
û¼
 << "error in‡ncestral data: found‚odewice in hashable\n";

203 
û¼
 << 
xÚ1
 << '\t' << 
xÚ2
 << '\n';

204 
û¼
 << 
x1
[
lšk
] << '\t' << 
x2
[link] << '\n';

205 
û¼
 << 
lšk
 << '\n';

213 
	`ex™
(1);

215 ià(
lšk
) {

216 * 
tmp
 = 
Ãw
 [
Ns™e
];

217 
j
=0; j<
Ns™e
; j++) {

218 
tmp
[
j
] = 0;

220 
d©a
[
lšk
] = 
tmp
;

221 
x1
[
lšk
] = 
xÚ1
;

222 
x2
[
lšk
] = 
xÚ2
;

225 
û¼
 << "did‚Ù fšd‡nû¡Ü oà: " << 
xÚ1
 << '\t' << 
xÚ2
 << '\n';

226 
	`ex™
(1);

229 
Áaxa
 = 
Çmem­
.
	`size
();

230 
¡ršg
* 
Çme
 = 
Ãw
 sŒšg[
Áaxa
];

231 
couÁ
 = 0;

232 
m­
<
¡ršg
,>::
™”©Ü
 
i
 = 
Çmem­
.
	`begš
(); i!ğÇmem­.
	`’d
(); i++) {

233 
Çme
[
couÁ
++] = 
i
->
fœ¡
;

235 ià(
couÁ
 !ğ
Áaxa
) {

236 
û¼
 << "error in file‡ncestral data:‚on matchingax size\n";

237 
	`ex™
(1);

239 
x£t
 = 
Ãw
 
	`TaxÚS‘
(
Çme
,
Áaxa
);

240 
d–‘e
[] 
Çme
;

242 
	}
}

245 şas 
	cSumCÚ¡¿šedAnû¡¿lD©a
 : 
public
 
Anû¡¿lD©a
 {

247 
SumCÚ¡¿šedM­pšg
* 
basis
;

249 
	mpublic
:

251 
SumCÚ¡¿šedM­pšg
* 
	$G‘Basis
(è{ 
basis
;}

253 
	$SumCÚ¡¿šedAnû¡¿lD©a
(
Anû¡¿lD©a
* 
äom
è: 
	`Anû¡¿lD©a
(äom->
	$G‘T»e
()) {

255 
Ns™e
 = 
äom
->
	`G‘Ns™e
() - 1;

256 
äomns™e
 = 
äom
->
	`G‘Ns™e
();

257 
x£t
 = 
äom
->
	`G‘TaxÚS‘
();

259 
basis
 = 
Ãw
 
	`SumCÚ¡¿šedM­pšg
(
äomns™e
);

261 ** 
b
 = 
basis
->
ba£
;

262 * 
x
 = 
Ãw
 [
äomns™e
];

263 * 
y
 = 
Ãw
 [
äomns™e
];

264 
m­
<cÚ¡ 
Lšk
*, *>& 
äomd©a
 = 
äom
->
d©a
;

265 
m­
<cÚ¡ 
Lšk
*,*>::
™”©Ü
 
lški
=
äomd©a
.
	`begš
();†ški!=äomd©a.
	`’d
();†inki++) {

267 
tÙ®
 = 0;

268 * 
äomd
 = 
äomd©a
[
lški
->
fœ¡
];

269 
i
=0; i<
äomns™e
; i++) {

270 
x
[
i
] = 
	`log
(
äomd
[i]);

271 
tÙ®
 +ğ
x
[
i
];

273 
tÙ®
 /ğ
äomns™e
;

274 
i
=0; i<
äomns™e
; i++) {

275 
x
[
i
] -ğ
tÙ®
;

277 
i
=0; i<
äomns™e
; i++) {

278 
tmp
 = 0;

279 
j
=0; j<
äomns™e
; j++) {

280 
tmp
 +ğ
b
[
i
][
j
] * 
x
[j];

282 
y
[
i
] = 
tmp
;

283 ià(!
i
) {

284 ià(
	`çbs
(
y
[
i
]) > 1e-6) {

285 
û¼
 << "”rÜ : " << 
y
[
i
] << '\n';

290 * 
d
 = 
Ãw
 [
Ns™e
];

292 
i
=1; i<
äomns™e
; i++) {

293 
d
[
i
-1] = 
y
[i];

296 
x1
[
lški
->
fœ¡
] = 
äom
->tax1[linki->first];

297 
x2
[
lški
->
fœ¡
] = 
äom
->tax2[linki->first];

298 
d©a
[
lški
->
fœ¡
] = 
d
;

300 
d–‘e
[] 
x
;

301 
d–‘e
[] 
y
;

302 
	}
}

	@AutoRegressiveMultiVariateTreeProcess.h

1 #iâdeà
ARMULTIVARIATETREEPROCESS


2 
	#ARMULTIVARIATETREEPROCESS


	)

4 
	~"MuÉiV¬Ÿ‹T»eProûss.h
"

5 
	~"ChrÚog¿m.h
"

6 
	~"CÚtšuousD©a.h
"

10 şas 
	cAutoReg»ssiveMuÉiNÜm®
 : 
public
 
MuÉiNÜm®
 {

12 
public
:

14 
AutoReg»ssiveMuÉiNÜm®
(
V¬
<
CovM©rix
>* 
šsigma
, V¬<
R—lVeùÜ
>* 
šm—n
, V¬<
PosR—l
>* 
šphi
, V¬<R—lVeùÜ>* 
šup
 = 0, V¬<PosR—l>* 
štime
 = 0è: 
	$MuÉiNÜm®
(
šsigma
,
šup
,
štime
) {

15 
phi
 = 
šphi
;

16 
m—n
 = 
šm—n
;

17 
	`Regi¡”
(
phi
);

18 
	`Regi¡”
(
m—n
);

19 
	`Sam¶e
();

23 ~
	$AutoReg»ssiveMuÉiNÜm®
(){

24 
	}
}

26 
	$d¿wSam¶e
(){

27 if(
	`isRoÙ
()){

28 
mu
 = 1.0 / 
	`sq¹
(2 * 
phi
->
	`v®
());

29 * 
t
 = 
Ãw
 [
	`G‘Dim
()];

30 
sigma
->
	`d¿wV®
(
t
);

31  
i
=0; i <
	`G‘Dim
(); i++){

32 if(!
CÏmpVeùÜ
[
i
]){

33 
	`v®
()[
i
] = (*
m—n
)[i] + 
t
[i] * 
mu
;

38 * 
t
 = 
Ãw
 [
	`G‘Dim
()];

39 
sigma
->
	`d¿wV®
(
t
);

40 
expo
 = 
	`exp
(-
phi
->
	`v®
(è* 
time
->val());

41 
mu
 = 
	`sq¹
 ((1 - 
	`exp
(-2 * 
phi
->
	`v®
(è* 
time
->val())) / 2 /…hi->val());

42  
i
=0; i <
	`G‘Dim
(); i++){

43 if(!
CÏmpVeùÜ
[
i
]){

44 
	`v®
()[
i
] = 
t
[i] * 
mu
 + 
up
->v®()[i] * 
expo
 + (*
m—n
)[i] * (1 -ƒxpo);

47 
d–‘e
[] 
t
;

49 
	}
}

51 
	$logProb
() {

52 if(
	`isRoÙ
()){

54 
tXSX
 = 0;

55 * 
dv®
 = 
Ãw
 [
	`G‘Dim
()];

56 
mu
 = 1.0 / 
	`sq¹
(2 * 
phi
->
	`v®
());

57 
i
=0; i<
	`G‘Dim
() ; i++) {

58 
dv®
[
i
] = (
	`v®
()[i] - (*
m—n
)[i]è/ 
mu
;

60 
i
=0; i<
	`G‘Dim
() ; i++) {

61 
tXSX
 +ğ
sigma
->
	`G‘InvM©rix
()[
i
][i] * 
dv®
[i] * dval[i];

62 
j
=0; j<
i
 ; j++) {

63 
tXSX
 +ğ2 * 
sigma
->
	`G‘InvM©rix
()[
i
][
j
] * 
dv®
[j] * dval[i];

66 
d
 = -0.5 * (
sigma
->
	`G‘LogD‘”mšªt
(è+ 
tXSX
è- 
	`G‘Dim
(è* 
	`log
(
mu
);

67  
d
;

71 
tXSX
 = 0;

72 * 
dv®
 = 
Ãw
 [
	`G‘Dim
()];

73 
expo
 = 
	`exp
(-
phi
->
	`v®
(è* 
time
->val());

74 
mu
 = 
	`sq¹
 ((1 - 
	`exp
(-2 * 
phi
->
	`v®
(è* 
time
->val())) / 2 /…hi->val());

75 
i
=0; i<
	`G‘Dim
() ; i++) {

76 
dv®
[
i
] = (
	`v®
()[i] - 
up
->v®()[i] * 
expo
 - (*
m—n
)[i] * (1 -ƒxpo))/
mu
;

78 
i
=0; i<
	`G‘Dim
() ; i++) {

79 
tXSX
 +ğ
sigma
->
	`G‘InvM©rix
()[
i
][i] * 
dv®
[i] * dval[i];

80 
j
=0; j<
i
 ; j++) {

81 
tXSX
 +ğ2 * 
sigma
->
	`G‘InvM©rix
()[
i
][
j
] * 
dv®
[j] * dval[i];

84 
d
 = -0.5 * (
sigma
->
	`G‘LogD‘”mšªt
(è+ 
tXSX
è- 
	`G‘Dim
(è* 
	`log
(
mu
);

85 
d–‘e
[] 
dv®
;

86  
d
;

88 
	}
}

90 
	g´Ùeùed
:

92 
V¬
<
PosR—l
>* 
phi
;

93 
	gV¬
<
	gR—lVeùÜ
>* 
	gm—n
;

97 şas 
	cAutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
 : 
public
 
vœtu®
 
MuÉiV¬Ÿ‹T»eProûss
 {

99 
´Ùeùed
:

101 
V¬
<
PosR—l
>* 
phi
;

102 
	mV¬
<
	mR—lVeùÜ
>* 
	mm—n
;

104 
	mpublic
:

107 
	$AutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
() {}

110 
	`AutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
(
V¬
<
CovM©rix
>* 
šsigma
, V¬<
R—lVeùÜ
>* 
šm—n
, V¬<
PosR—l
>* 
šphi
, 
L’gthT»e
* 
šŒ“
è: 
	$MuÉiV¬Ÿ‹T»eProûss
() {

111 
sigma
 = 
šsigma
;

112 
phi
 = 
šphi
;

113 
m—n
 = 
šm—n
;

114 
Œ“
 = 
šŒ“
;

115 
	`RecursiveC»©e
(
	`G‘RoÙ
());

116 
	}
}

118 ~
	$AutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
(){

119 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

120 
	}
}

123 
AutoReg»ssiveMuÉiNÜm®
* 
	$G‘AutoReg»ssiveMuÉiNÜm®
(cÚ¡ 
Lšk
* 
lšk
) {

124 
AutoReg»ssiveMuÉiNÜm®
* 
m
 = 
dyÇmic_ÿ¡
<AutoReg»ssiveMuÉiNÜm®*> (
	`G‘NodeV®
(
lšk
->
	`G‘Node
()));

125  
m
;

126 
	}
}

128 
	g´Ùeùed
 :

130 
Rv¬
<
R—lVeùÜ
>* 
	$C»©eNodeV®
(cÚ¡ 
Lšk
* 
lšk
){

131 if(!
lšk
->
	`isRoÙ
()){

132  
Ãw
 
	`AutoReg»ssiveMuÉiNÜm®
(
sigma
, 
m—n
, 
phi
, 
	`G‘AutoReg»ssiveMuÉiNÜm®
(
lšk
->
	`Out
()), 
Œ“
->
	`G‘B¿nchV®
Öšk->
	`G‘B¿nch
()));

135  
Ãw
 
	`AutoReg»ssiveMuÉiNÜm®
(
sigma
, 
m—n
, 
phi
);

137 
	}
}

	@BaseType.cpp

1 
	~"Ba£Ty³.h
"

3 cÚ¡ 
	gProfe
::
MIN
 = 1e-20;

5 
	gProfe
::
	$Prİo£Move
(
tunšg
, 
n
) {

6 
»t
 = 0;

7 ià(!
n
) {

8 * 
Şd´ofe
 = 
Ãw
 [
dim
];

9 
i
=0; i<
dim
; i++) {

10 
Şd´ofe
[
i
] = 
´ofe
[i];

12 
tÙ®
 = 0;

13 
i
=0; i<
dim
; i++) {

14 
´ofe
[
i
] = 
Rªdom
::
	`sGamma
(
tunšg
*
Şd´ofe
[i]);

15 ià(
´ofe
[
i
] == 0) {

16 
û¼
 << "error in dirichlet„esampling : 0 \n";

17 
	`ex™
(1);

19 
tÙ®
 +ğ
´ofe
[
i
];

22 
logHa¡šgs
 = 0;

23 
i
=0; i<
dim
; i++) {

24 
´ofe
[
i
] /ğ
tÙ®
;

26 
logHa¡šgs
 +ğ- 
Rªdom
::
	`logGamma
(
tunšg
*
Şd´ofe
[
i
]è+ Rªdom::logGammaÑunšg*
´ofe
[i])

27 - (
tunšg
*
´ofe
[
i
] -1.0è* 
	`log
(
Şd´ofe
[i]) + (tuning * oldprofile[i] -1.0) *†og(profile[i]);

30 
d–‘e
[] 
Şd´ofe
;

31  
logHa¡šgs
;

34 ià(2*
n
 > 
dim
) {

35 
n
 = 
dim
 / 2;

37 * 
šdiûs
 = 
Ãw
 [2*
n
];

38 
Rªdom
::
	`D¿wFromUº
(
šdiûs
,2*
n
,
dim
);

39 
i
=0; i<
n
; i++) {

40 
i1
 = 
šdiûs
[2*
i
];

41 
i2
 = 
šdiûs
[2*
i
+1];

42 
tÙ
 = 
´ofe
[
i1
] +…rofe[
i2
];

43 
x
 = 
´ofe
[
i1
];

46 
h
 = 
tÙ
 * 
tunšg
 * (
Rªdom
::
	`UnifÜm
() - 0.5);

51 
x
 +ğ
h
;

52 (
x
<0è|| (x>
tÙ
)) {

53 ià(
x
<0) {

54 
x
 = -x;

56 ià(
x
>
tÙ
) {

57 
x
 = 2*
tÙ
 - x;

60 
´ofe
[
i1
] = 
x
;

61 
´ofe
[
i2
] = 
tÙ
 - 
x
;

63 
d–‘e
[] 
šdiûs
;

65  
»t
;

66 
	}
}

	@BaseType.h

2 #iâdeà
BASETYPE_H


3 
	#BASETYPE_H


	)

6 
	~"Rªdom.h
"

8 
şass
 
	gDAGnode
;

16 şas 
	cBa£Ty³
 {

18 
	mpublic
:

20 
vœtu®
 ~
	$Ba£Ty³
() {};

25 
vœtu®
 
	`Prİo£Move
(
tunšg
) = 0;

28 
	}
};

30 şas 
	cAdd™ive
 {

32 
	mpublic
:

34 
vœtu®
 ~
	$Add™ive
() {}

37 
vœtu®
 
	`SÿÏrAdd™iÚ
(
d
) = 0;

39 
vœtu®
 
	$Regi¡”
(
DAGnode
* 
š
è{
û¼
 << "”rÜ iÀAdd™ive::Regi¡”\n"; 
throw
;
	}
}

42 şas 
	cMuÉliÿtive
 {

44 
	mpublic
:

46 
vœtu®
 ~
	$MuÉliÿtive
() {}

49 
vœtu®
 
	`SÿÏrMuÉliÿtiÚ
(
d
) = 0;

51 
vœtu®
 
	$Regi¡”
(
DAGnode
* 
š
è{
û¼
 << "”rÜ iÀMuÉliÿtive::Regi¡”\n"; 
throw
;
	}
}

57 
şass
 
	gR—l
 : 
public
 
Ba£Ty³
 ,…ubliø
	gAdd™ive
 {

60 
	gpublic
:

61 
R—l
(
d
=0è: 
v®ue
(d) {}

62 
R—l
(cÚ¡ R—l& 
äom
è: 
v®ue
(from.value) {}

64 
vœtu®
 ~
R—l
() {}

66 
R—l
& 
İ”©Ü
=(cÚ¡ R—l& 
äom
) {

67 
v®ue
 = 
äom
.value;

68  *
	gthis
;

71 
	gR—l
& 
	gİ”©Ü
=(
äom
) {

72 
v®ue
 = 
äom
;

73  *
	gthis
;

76 
İ”©Ü
 (è{ 
	gv®ue
;}

77 
İ”©Ü
 (ècÚ¡ { 
	gv®ue
;}

79 
	gR—l
& 
	gİ”©Ü
+=(cÚ¡ 
R—l
& 
äom
) {

80 
v®ue
 +ğ
äom
.value;

81  *
	gthis
;

84 
	gR—l
& 
	gİ”©Ü
/=(
äom
) {

85 
v®ue
 /ğ
äom
;

86  *
	gthis
;

89 
SÿÏrAdd™iÚ
(
d
) {

90 
	gv®ue
 +ğ
d
;

94 
vœtu®
 
Prİo£Move
(
tunšg
) {

96 
	gm
 = 
tunšg
*(
Rªdom
::
UnifÜm
() - 0.5);

97 
	gv®ue
 +ğ
m
;

101 
Check
() { 1;}

103 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gR—l
& 
	gr
) {

104 
	gis
 >> 
	gr
.
	gv®ue
;

105  
	gis
;

108 
	g´Ùeùed
:

109 
v®ue
;

112 şas 
	cUn™R—l
 : 
public
 
Ba£Ty³
 {

115 
public
:

116 
	$Un™R—l
(
d
=0è: 
	$v®ue
(
d
) {}

117 
	$Un™R—l
(cÚ¡ 
Un™R—l
& 
äom
è: 
	$v®ue
(
äom
.
v®ue
è{
	}
}

119 
vœtu®
 ~
	$Un™R—l
(è{
	}
}

121 
Un™R—l
& 
İ”©Ü
=(cÚ¡ Un™R—l& 
äom
) {

122 
v®ue
 = 
äom
.value;

123  *
	gthis
;

126 
	gUn™R—l
& 
	gİ”©Ü
=(
äom
) {

127 
v®ue
 = 
äom
;

128  *
	gthis
;

131 
İ”©Ü
 (è{ 
v®ue
;
	}
}

132 
İ”©Ü
 (ècÚ¡ { 
v®ue
;
	}
}

134 
	gUn™R—l
& 
	gİ”©Ü
+=(cÚ¡ 
Un™R—l
 
äom
) {

135 
v®ue
 +ğ
äom
.value;

136  *
	gthis
;

140 
vœtu®
 
	$Prİo£Move
(
tunšg
) {

142 
m
 = 
tunšg
*(
Rªdom
::
	`UnifÜm
() - 0.5);

143 
v®ue
 +ğ
m
;

144 (
v®ue
<0) || (value>1)) {

145 ià(
v®ue
<0) {

146 
v®ue
 = -value;

148 ià(
v®ue
>1) {

149 
v®ue
 = 2 - value;

153 
	}
}

155 
	$Check
(è{ 1;
	}
}

157 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gUn™R—l
& 
	gr
) {

158 
	gis
 >> 
	gr
.
	gv®ue
;

159  
	gis
;

162 
	g´Ùeùed
:

163 
v®ue
;

170 
şass
 
	gPosR—l
 : 
public
 
Ba£Ty³
 ,…ubliø
	gMuÉliÿtive
 {

173 
	gpublic
:

174 
PosR—l
(
d
=0è: 
v®ue
(d) {}

175 
PosR—l
(cÚ¡ PosR—l& 
äom
è: 
v®ue
(from.value) {}

177 
vœtu®
 ~
PosR—l
() {}

179 
PosR—l
& 
İ”©Ü
=(cÚ¡ PosR—l& 
äom
) {

180 
v®ue
 = 
äom
.value;

181  *
	gthis
;

184 
	gPosR—l
& 
	gİ”©Ü
=(cÚ¡ & 
äom
) {

185 
v®ue
 = 
äom
;

186  *
	gthis
;

189 
İ”©Ü
 (è{ 
	gv®ue
;}

190 
İ”©Ü
 (ècÚ¡ { 
	gv®ue
;}

192 
	gPosR—l
& 
	gİ”©Ü
+=(cÚ¡ 
PosR—l
 
äom
) {

193 
v®ue
 +ğ
äom
.value;

194  *
	gthis
;

197 
	gPosR—l
& 
	gİ”©Ü
/=(
äom
) {

198 
v®ue
 /ğ
äom
;

199  *
	gthis
;

202 
SÿÏrMuÉliÿtiÚ
(
d
) {

203 
	gv®ue
 *ğ
d
;

208 
İ”©Ü
 
R—l
(è{ R—l(
v®ue
);}

209 
İ”©Ü
 
R—l
(ècÚ¡ { R—l(
v®ue
);}

211 
vœtu®
 
Prİo£Move
(
tunšg
) {

213 
	gm
 = 
tunšg
*(
Rªdom
::
UnifÜm
() - 0.5);

214 
	gv®ue
 *ğ
exp
(
m
);

215  
	gm
;

218 
Check
() {

219 ià(
	gv®ue
<=0) {

220 
û¼
 << "”rÜ :…os™ivdoubË i nÙ…os™iv: " << 
v®ue
 << '\n';

226 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gPosR—l
& 
	gr
) {

227 
	gis
 >> 
	gr
.
	gv®ue
;

228  
	gis
;

238 
	g´Ùeùed
:

239 
v®ue
;

246 şas 
	cIÁ
 : 
public
 
Ba£Ty³
 {

249 
public
:

250 
	$IÁ
(
d
=0è: 
	$v®ue
(
d
) {}

251 
	$IÁ
(cÚ¡ 
IÁ
& 
äom
è: 
	$v®ue
(
äom
.
v®ue
è{
	}
}

253 
vœtu®
 ~
	$IÁ
(è{
	}
}

255 
IÁ
& 
İ”©Ü
=(cÚ¡ IÁ& 
äom
) {

256 
v®ue
 = 
äom
.value;

257  *
	gthis
;

260 
	gIÁ
& 
	gİ”©Ü
=(cÚ¡ & 
äom
) {

261 
v®ue
 = 
äom
;

262  *
	gthis
;

265 
İ”©Ü
 (è{ 
v®ue
;
	}
}

266 
İ”©Ü
 (ècÚ¡ { 
v®ue
;
	}
}

268 
İ”©Ü
 
	$R—l
(è{ 
	`R—l
((
v®ue
));
	}
}

269 
İ”©Ü
 
	$R—l
(ècÚ¡ { 
	`R—l
((
v®ue
));
	}
}

271 
vœtu®
 
	$Prİo£Move
(
tunšg
) {

279 ià(
Rªdom
::
	`UnifÜm
() < 0.5) {

280 
v®ue
++;

283 
v®ue
 --;

286 
	}
}

288 
	$Check
(è{ 1;
	}
}

290 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gIÁ
& 
	gr
) {

291 
	gis
 >> 
	gr
.
	gv®ue
;

292  
	gis
;

295 
	g´Ùeùed
:

296 
v®ue
;

353 şas 
	cProfe
 : 
public
 
Ba£Ty³
 {

355 
public
:

356 cÚ¡ 
MIN
;

358 
	m´Ùeùed
:

359 
dim
;

360 * 
	m´ofe
;

362 
	mpublic
:

364 
	$Profe
(è: 
	`dim
(0è, 
	$´ofe
(0) {}

366 
	$Profe
(
šdim
, * 
v
=0) {

367 
dim
 = 
šdim
;

368 
´ofe
 = 
Ãw
 [
dim
];

369 ià(
v
) {

370 
tÙ®
 = 0;

371 
k
=0; k<
dim
; k++) {

372 ià(!
v
[
k
]>0) {

373 
û¼
 << "error :…rofiles should be strictly…ositive\n";

374 
	`ex™
(1);

376 
´ofe
[
k
] = 
v
[k];

377 
tÙ®
 +ğ
´ofe
[
k
];

379 
k
=0; k<
dim
; k++) {

380 
´ofe
[
k
] /ğ
tÙ®
;

383 
	}
}

385 
	$Profe
(cÚ¡ 
Profe
& 
äom
) {

386 
dim
 = 
äom
.dim;

387 
´ofe
 = 
Ãw
 [
dim
];

388 
k
=0; k<
dim
; k++) {

389 
´ofe
[
k
] = 
äom
.profile[k];

391 
	}
}

393 
	gvœtu®
 ~
	$Profe
() {

394 
d–‘e
[] 
´ofe
;

395 
	}
}

397 
	gProfe
& 
	gİ”©Ü
=(cÚ¡ 
Profe
& 
äom
) {

399 ià(!
dim
) {

400 
dim
 = 
äom
.dim;

401 
	g´ofe
 = 
Ãw
 [
dim
];

403 ià(
	gdim
 !ğ
äom
.
dim
) {

404 
û¼
 << "error :‚on matching dimenstion for…rofiles\n";

405 
	gû¼
 << 
	gdim
 << '\t' << 
	gäom
.dim << '\n';

406 
ex™
(1);

407 
	gdim
 = 
äom
.
dim
;

408 
	gd–‘e
[] 
	g´ofe
;

409 
	g´ofe
 = 
Ãw
 [
dim
];

411 
	gk
=0; k<
	gdim
; k++) {

412 
	g´ofe
[
k
] = 
äom
.
´ofe
[k];

414  *
	gthis
;

417 
	$£tunifÜm
() {

418 
i
=0; i<
dim
; i++) {

419 
´ofe
[
i
] = 1.0 / 
dim
;

421 
	}
}

423 
	$£¼ay
(* 
š
) {

424 
i
=0; i<
dim
; i++) {

425 
´ofe
[
i
] = 
š
[i];

427 
	}
}

430 cÚ¡ * 
	$G‘A¼ay
(ècÚ¡ { 
´ofe
;
	}
}

431 * 
	$G‘A¼ay
(è{ 
´ofe
;
	}
}

433 & 
	gİ”©Ü
[](
	gi
) {

434  
	g´ofe
[
i
];

437 & 
	gİ”©Ü
[](
	gi
) const {

438  
	g´ofe
[
i
];

441 
	$G‘Dim
(ècÚ¡ { 
dim
;
	}
}

443 
	$S‘AtZ”o
() {

444 
i
=0; i<
dim
; i++) {

445 
´ofe
[
i
] = 0;

447 
	}
}

449 
	$SÿÏrMuÉliÿtiÚ
(
d
) {

450 
i
=0; i<
dim
; i++) {

451 
´ofe
[
i
] *ğ
d
;

453 
	}
}

455 
	$Add
(cÚ¡ 
Profe
& 
š
) {

456 
i
=0; i<
dim
; i++) {

457 
´ofe
[
i
] +ğ
š
[i];

459 
	}
}

461 
	$Check
(è{ 1;
	}
}

463 
	$G‘EÁrİy
() const {

464 
tÙ®
 = 0;

465 
i
=0; i<
dim
; i++) {

466 
tÙ®
 +ğ(
´ofe
[
i
]>1e-8è? -´ofe[i]*
	`log
(profile[i]) : 0;

468  
tÙ®
;

469 
	}
}

471 
Prİo£Move
(
tunšg
, 
dim
);

473 
	$Prİo£Move
(
tunšg
) {

474  
	`Prİo£Move
(
tunšg
,
dim
);

475 
	}
}

477 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, cÚ¡ 
	gProfe
& 
	gr
) {

478 
	gos
 << 
	gr
.
	gdim
;

479 
	gi
=0; i<
	gr
.
	gdim
; i++) {

480 
	gos
 << '\t' << 
	gr
.
	g´ofe
[
i
];

482  
	gos
;

485 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gProfe
& 
	gr
) {

486 
	gšdim
;

487 
	gis
 >> 
	gšdim
;

488 ià(
	gr
.
	gdim
 !ğ
šdim
) {

489 
r
.
dim
 = 
šdim
;

490 
	gd–‘e
[] 
	gr
.
	g´ofe
;

491 
	gr
.
	g´ofe
 = 
Ãw
 [
r
.
dim
];

493 
	gi
=0; i<
	gr
.
	gdim
; i++) {

494 
	gis
 >> 
	gr
.
	g´ofe
[
i
];

496  
	gis
;

500 
şass
 
	gR—lVeùÜ
 : 
public
 
Ba£Ty³
,…ubliø
	gAdd™ive
 {

502 
	g´Ùeùed
:

504 
dim
;

505 * 
	gvec
;

507 
	gpublic
:

508 
R—lVeùÜ
(è: 
dim
(0), 
vec
(0) {}

510 
R—lVeùÜ
(
šdim
) {

511 
	gdim
 = 
šdim
;

512 
	gvec
 = 
Ãw
 [
dim
];

515 
R—lVeùÜ
(cÚ¡ R—lVeùÜ& 
äom
) {

516 
	gdim
 = 
äom
.
dim
;

517 
	gvec
 = 
Ãw
 [
dim
];

518 
	gi
=0; i<
	gdim
; i++) {

519 
	gvec
[
i
] = 
äom
.
vec
[i];

523 
R—lVeùÜ
(cÚ¡ * 
äom
, 
šdim
) {

524 
	gdim
 = 
šdim
;

525 
	gvec
 = 
Ãw
 [
dim
];

526 
	gi
=0; i<
	gdim
; i++) {

527 
	gvec
[
i
] = 
äom
[i];

531 
	gvœtu®
 ~
R—lVeùÜ
() {

532 
	gd–‘e
[] 
	gvec
;

535 
	gR—lVeùÜ
& 
	gİ”©Ü
=(cÚ¡ 
R—lVeùÜ
& 
äom
) {

536 ià(!
dim
) {

537 
dim
 = 
äom
.dim;

538 
	gvec
 = 
Ãw
 [
dim
];

540 ià(
	gdim
 !ğ
äom
.
dim
) {

541 
û¼
 << "error :‚on matching dimenstion for vectors\n";

542 
	gû¼
 << 
	gdim
 << '\t' << 
	gäom
.dim << '\n';

543 
ex™
(1);

544 
	gd–‘e
[] 
	gvec
;

545 
	gdim
 = 
äom
.
dim
;

546 
	gvec
 = 
Ãw
 [
dim
];

548 
	gi
=0; i<
	gdim
; i++) {

549 
	gvec
[
i
] = 
äom
.
vec
[i];

551  *
	gthis
;

554 * 
G‘A¼ay
(ècÚ¡ { 
	gvec
;}

556 & 
	gİ”©Ü
[](
	gi
) {

557  
	gvec
[
i
];

560 & 
	gİ”©Ü
[](
	gi
) const {

561  
	gvec
[
i
];

564 
G‘Dim
(è{ 
	gdim
;}

565 
Check
() { 1;}

567 
G‘M—n
() const {

568 
	gtÙ®
 = 0;

569 
	gi
=0; i<
	gdim
; i++) {

570 
	gtÙ®
 +ğ
vec
[
i
];

572  
	gtÙ®
 / 
	gdim
;

575 
G‘V¬
() const {

576 
	gm—n
 = 0;

577 
	gv¬
 = 0;

578 
	gi
=0; i<
	gdim
; i++) {

579 
	gv¬
 +ğ
vec
[
i
] * vec[i];

580 
	gm—n
 +ğ
vec
[
i
];

582 
	gm—n
 /ğ
dim
;

583 
	gv¬
 /ğ
dim
;

584 
	gv¬
 -ğ
m—n
 * mean;

585  
	gv¬
;

588 
SÿÏrAdd™iÚ
(
d
) {

589 
	gi
=0; i<
	gdim
; i++) {

590 
	gvec
[
i
] +ğ
d
;

592  
	gdim
;

595 
SÿÏrMuÉliÿtiÚ
(
d
) {

596 
	gi
=0; i<
	gdim
; i++) {

597 
	gvec
[
i
] *ğ
d
;

601 
Add
(cÚ¡ 
R—lVeùÜ
& 
š
) {

602 
	gi
=0; i<
	gdim
; i++) {

603 
	gvec
[
i
] +ğ
š
[i];

607 
Add
(cÚ¡ * 
š
, 
f
 = 1) {

608 
i
=0; 
	gi
<
	gdim
; i++) {

609 
	gvec
[
i
] +ğ
f
 * 
š
[i];

616 
Prİo£Move
(
tunšg
, 
n
) {

617 ià((
	gn
<=0è|| (
n
 > 
dim
)) {

618 
n
 = 
dim
;

620 * 
	gšdiûs
 = 
Ãw
 [
n
];

621 
	gRªdom
::
D¿wFromUº
(
šdiûs
,
n
,
dim
);

622 
	gi
=0; i<
	gn
; i++) {

623 
	gvec
[
šdiûs
[
i
]] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

625 
	gd–‘e
[] 
	gšdiûs
;

629 
Prİo£Move
(
tunšg
) {

630  
Prİo£Move
(
tunšg
,
dim
);

633 
S‘AtZ”o
() {

634 
	gi
=0; i<
	gdim
; i++) {

635 
	gvec
[
i
] = 0;

639 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, cÚ¡ 
	gR—lVeùÜ
& 
	gr
) {

640 
	gos
 << 
	gr
.
	gdim
;

641 
	gi
=0; i<
	gr
.
	gdim
; i++) {

642 
	gos
 << '\t' << 
	gr
.
	gvec
[
i
];

644  
	gos
;

647 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gR—lVeùÜ
& 
	gr
) {

648 
	gšdim
;

649 
	gis
 >> 
	gšdim
;

650 ià(
	gr
.
	gdim
 !ğ
šdim
) {

651 
r
.
dim
 = 
šdim
;

652 
	gd–‘e
[] 
	gr
.
	gvec
;

653 
	gr
.
	gvec
 = 
Ãw
 [
r
.
dim
];

655 
	gi
=0; i<
	gr
.
	gdim
; i++) {

656 
	gis
 >> 
	gr
.
	gvec
[
i
];

658  
	gis
;

662 
şass
 
	gPosR—lVeùÜ
 : 
public
 
R—lVeùÜ
,…ubliø
	gMuÉliÿtive
 {

664 
	gpublic
:

665 
PosR—lVeùÜ
(è: 
R—lVeùÜ
() {}

667 
PosR—lVeùÜ
(
šdim
) {

668 
dim
 = 
šdim
;

669 
	gvec
 = 
Ãw
 [
dim
];

672 
PosR—lVeùÜ
(cÚ¡ PosR—lVeùÜ& 
äom
) {

673 
	gdim
 = 
äom
.
dim
;

674 
	gvec
 = 
Ãw
 [
dim
];

675 
	gi
=0; i<
	gdim
; i++) {

676 
	gvec
[
i
] = 
äom
.
vec
[i];

680 
PosR—lVeùÜ
(cÚ¡ * 
äom
, 
šdim
) {

681 
	gdim
 = 
šdim
;

682 
	gvec
 = 
Ãw
 [
dim
];

683 
	gi
=0; i<
	gdim
; i++) {

684 
	gvec
[
i
] = 
äom
[i];

688 
	gvœtu®
 ~
PosR—lVeùÜ
() {}

690 
	gPosR—lVeùÜ
& 
	gİ”©Ü
=(cÚ¡ 
PosR—lVeùÜ
& 
äom
) {

691 ià(!
dim
) {

692 
dim
 = 
äom
.dim;

693 
	gvec
 = 
Ãw
 [
dim
];

695 ià(
	gdim
 !ğ
äom
.
dim
) {

696 
û¼
 << "error :‚on matching dimenstion for…os vectors\n";

697 
	gû¼
 << 
	gdim
 << '\t' << 
	gäom
.dim << '\n';

698 
ex™
(1);

699 
	gd–‘e
[] 
	gvec
;

700 
	gdim
 = 
äom
.
dim
;

701 
	gvec
 = 
Ãw
 [
dim
];

703 
	gi
=0; i<
	gdim
; i++) {

704 
	gvec
[
i
] = 
äom
.
vec
[i];

706  *
	gthis
;

709 
G‘M—n
() const {

710 
	gtÙ®
 = 0;

711 
	gi
=0; i<
	gdim
; i++) {

712 
	gtÙ®
 +ğ
vec
[
i
];

714  
	gtÙ®
 / 
	gdim
;

717 
S‘AtOÃ
() {

718 
	gi
=0; i<
	gdim
; i++) {

719 
	gvec
[
i
] = 1;

723 
G‘V¬
() const {

724 
	gm—n
 = 0;

725 
	gv¬
 = 0;

726 
	gi
=0; i<
	gdim
; i++) {

727 
	gv¬
 +ğ
vec
[
i
] * vec[i];

728 
	gm—n
 +ğ
vec
[
i
];

730 
	gm—n
 /ğ
dim
;

731 
	gv¬
 /ğ
dim
;

732 
	gv¬
 -ğ
m—n
 * mean;

733  
	gv¬
;

736 
G‘EÁrİy
() const {

737 
	gtÙ®
 = 0;

738 
	gi
=0; i<
	gdim
; i++) {

739 
	gtÙ®
 +ğ
vec
[
i
];

741 
	g’t
 = 0;

742 
	gi
=0; i<
	gdim
; i++) {

743 
	gtmp
 = 
vec
[
i
]/
tÙ®
;

744 
	g’t
 +ğ(
tmp
>1e-8è? -tmp*
log
(tmp) : 0;

746  
	g’t
;

750 
Prİo£Move
(
tunšg
, 
n
) {

751 ià((
	gn
<=0è|| (
n
 > 
dim
)) {

752 
n
 = 
dim
;

754 * 
	gšdiûs
 = 
Ãw
 [
n
];

755 
	gRªdom
::
D¿wFromUº
(
šdiûs
,
n
,
dim
);

756 
	g»t
 = 0;

757 
	gi
=0; i<
	gn
; i++) {

758 
	gm
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

759 
	gvec
[
šdiûs
[
i
]] *ğ
exp
(
m
);

760 
	g»t
 +ğ
m
;

762 
	gd–‘e
[] 
	gšdiûs
;

763  
	g»t
;

766 
Prİo£Move
(
tunšg
) {

767  
Prİo£Move
(
tunšg
,
dim
);

770 
SÿÏrMuÉliÿtiÚ
(
d
) {

771 
	gi
=0; i<
	gdim
; i++) {

772 
	gvec
[
i
] *ğ
d
;

774  
	gdim
;

779 şas 
	cIÁVeùÜ
 : 
public
 
Ba£Ty³
 {

781 
´Ùeùed
:

783 
dim
;

784 * 
	mvec
;

786 
	mpublic
:

787 
	$IÁVeùÜ
(è: 
	`dim
(0), 
	$vec
(0) {}

789 
	$IÁVeùÜ
(
šdim
) {

790 
dim
 = 
šdim
;

791 
vec
 = 
Ãw
 [
dim
];

792 
	}
}

794 
	$IÁVeùÜ
(cÚ¡ 
IÁVeùÜ
& 
äom
) {

795 
dim
 = 
äom
.dim;

796 
vec
 = 
Ãw
 [
dim
];

797 
i
=0; i<
dim
; i++) {

798 
vec
[
i
] = 
äom
.vec[i];

800 
	}
}

802 
	$IÁVeùÜ
(cÚ¡ * 
äom
, 
šdim
) {

803 
dim
 = 
šdim
;

804 
vec
 = 
Ãw
 [
dim
];

805 
i
=0; i<
dim
; i++) {

806 
vec
[
i
] = 
äom
[i];

808 
	}
}

810 
	gvœtu®
 ~
	$IÁVeùÜ
() {

811 
d–‘e
[] 
vec
;

812 
	}
}

814 
	gIÁVeùÜ
& 
	gİ”©Ü
=(cÚ¡ 
IÁVeùÜ
& 
äom
) {

815 ià(!
dim
) {

816 
dim
 = 
äom
.dim;

817 
	gvec
 = 
Ãw
 [
dim
];

819 ià(
	gdim
 !ğ
äom
.
dim
) {

820 
û¼
 << "error :‚on matching dimenstion for vectors\n";

821 
	gû¼
 << 
	gdim
 << '\t' << 
	gäom
.dim << '\n';

822 
ex™
(1);

823 
	gd–‘e
[] 
	gvec
;

824 
	gdim
 = 
äom
.
dim
;

825 
	gvec
 = 
Ãw
 [
dim
];

827 
	gi
=0; i<
	gdim
; i++) {

828 
	gvec
[
i
] = 
äom
.
vec
[i];

830  *
	gthis
;

833 
	gIÁVeùÜ
& 
	gİ”©Ü
=(cÚ¡ * 
äom
) {

834 ià(!
dim
) {

835 
û¼
 << "error in IntVector::operator=(const int*)\n";

836 
ex™
(1);

838 
	gi
=0; i<
	gdim
; i++) {

839 
	gvec
[
i
] = 
äom
[i];

841  *
	gthis
;

844 cÚ¡ * 
	$G‘A¼ay
(ècÚ¡ { 
vec
;
	}
}

846 & 
	gİ”©Ü
[](
	gi
) {

847  
	gvec
[
i
];

850 & 
	gİ”©Ü
[](
	gi
) const {

851  
	gvec
[
i
];

854 
	$G‘Dim
(è{ 
dim
;
	}
}

855 
	$Check
(è{ 1;
	}
}

857 
	$G‘M—n
() const {

858 
tÙ®
 = 0;

859 
i
=0; i<
dim
; i++) {

860 
tÙ®
 +ğ
vec
[
i
];

862  
tÙ®
 / 
dim
;

863 
	}
}

865 
	$G‘V¬
() const {

866 
m—n
 = 0;

867 
v¬
 = 0;

868 
i
=0; i<
dim
; i++) {

869 
v¬
 +ğ
vec
[
i
] * vec[i];

870 
m—n
 +ğ
vec
[
i
];

872 
m—n
 /ğ
dim
;

873 
v¬
 /ğ
dim
;

874 
v¬
 -ğ
m—n
 * mean;

875  
v¬
;

876 
	}
}

878 
	$Prİo£Move
(
tunšg
, 
n
) {

879 ià((
n
<=0è|| (À> 
dim
)) {

880 
n
 = 
dim
;

882 * 
šdiûs
 = 
Ãw
 [
n
];

883 
Rªdom
::
	`D¿wFromUº
(
šdiûs
,
n
,
dim
);

884 
i
=0; i<
n
; i++) {

885 
vec
[
šdiûs
[
i
]] +ğ(è(
tunšg
 * (
Rªdom
::
	`UnifÜm
() - 0.5));

887 
d–‘e
[] 
šdiûs
;

889 
	}
}

891 
	$Prİo£Move
(
tunšg
) {

892  
	`Prİo£Move
(
tunšg
,
dim
);

893 
	}
}

895 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, cÚ¡ 
	gIÁVeùÜ
& 
	gr
) {

896 
	gos
 << 
	gr
.
	gdim
;

897 
	gi
=0; i<
	gr
.
	gdim
; i++) {

898 
	gos
 << '\t' << 
	gr
.
	gvec
[
i
];

900  
	gos
;

903 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gIÁVeùÜ
& 
	gr
) {

904 
	gšdim
;

905 
	gis
 >> 
	gšdim
;

906 ià(
	gr
.
	gdim
 !ğ
šdim
) {

907 
r
.
dim
 = 
šdim
;

908 
	gd–‘e
[] 
	gr
.
	gvec
;

909 
	gr
.
	gvec
 = 
Ãw
 [
r
.
dim
];

911 
	gi
=0; i<
	gr
.
	gdim
; i++) {

912 
	gis
 >> 
	gr
.
	gvec
[
i
];

914  
	gis
;

	@BiologicalSequences.h

1 #iâdeà
BIOLOGICALSEQUENCES_H


2 
	#BIOLOGICALSEQUENCES_H


	)

4 
	~<c¡dlib
>

5 
	~<io¡»am
>

6 
	~<¡ršg
>

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 cÚ¡ 
¡ršg
 
	gP©h
 = "";

11 
	eD©aTy³
 {
	mDNA
=0,
	mRNA
=1,
	mPrÙeš
=2,
	mOth”
=3};

13 cÚ¡ 
	gRYN
 = 2;

14 cÚ¡ 
	gRY£t
[] = {'R','Y'};

16 cÚ¡ 
	gAA£t
[] = {'A','C','D','E','F','G','H','I','K','L','M','N','P','Q','R','S','T','V','W','Y','a','c','d','e','f','g','h','i','k','l','m','n','p','q','r','s','t','v','w','y','-','?','$','.','B','Z','*','X','x'};

17 cÚ¡ 
	gAAN
 = 49;

18 cÚ¡ 
	gDNAN
 = 38;

19 cÚ¡ 
	gRNAN
 = 38;

20 cÚ¡ 
	gDNA£t
[] = {'A','C','G','T','a','c','g','t','B','D','H','K','M','N','R','S','V','W','Y','b','d','h','k','m','n','r','s','v','w','y','-','?','$','.','*','X','x'};

21 cÚ¡ 
	gRNA£t
[] = {'A','C','G','U','a','c','g','u','B','D','H','K','M','N','R','S','V','W','Y','b','d','h','k','m','n','r','s','v','w','y','-','?','$','.','*','X','x'};

26 cÚ¡ 
	g´ecisiÚ
 = 10000;

27 cÚ¡ 
¡ršg
 
	gAÍhab‘
 = "Amino_Acids";

28 cÚ¡ 
	gAmšoAcids
[] = {'A','C','D','E','F','G','H','I','K','L','M','N','P','Q','R','S','T','V','W','Y','-'};

29 cÚ¡ 
	gamšßcids
[] = {'a','c','d','e','f','g','h','i','k','l','m','n','p','q','r','s','t','v','w','y','-'};

30 cÚ¡ 
	gRYË‰”s
[] = {'R','Y'};

31 cÚ¡ 
	gDNAË‰”s
[] = {'A','C','G','T'};

32 cÚ¡ 
	gdÇË‰”s
[] = {'a','c','g','t'};

33 cÚ¡ 
	gRNAË‰”s
[] = {'A','C','G','U'};

34 cÚ¡ 
	gº®‘‹rs
[] = {'a','c','g','u'};

36 cÚ¡ 
	gDayhoff6TabË
[] = {3,5,2,2,4,3,1,0,1,0,0,2,3,2,1,3,3,0,4,4};

37 cÚ¡ 
	gDayhoff4TabË
[] = {3,-1,2,2,0,3,1,0,1,0,0,2,3,2,1,3,3,0,2,2};

39 cÚ¡ 
	gunknown
 = -1;

41 cÚ¡ 
	gN¯
 = 20;

42 cÚ¡ 
	gNnuc
 = 4;

43 cÚ¡ 
	gNcodÚ
 = 64;

44 cÚ¡ 
¡ršg
 
	gCodÚs
[] = {"TTT","TTC","TTA","TTG","TCT","TCC","TCA","TCG","TAT","TAC","TAA","TAG","TGT","TGC","TGA","TGG","CTT","CTC","CTA","CTG","CCT","CCC","CCA","CCG","CAT","CAC","CAA","CAG","CGT","CGC","CGA","CGG","ATT","ATC","ATA","ATG","ACT","ACC","ACA","ACG","AAT","AAC","AAA","AAG","AGT","AGC","AGA","AGG","GTT","GTC","GTA","GTG","GCT","GCC","GCA","GCG","GAT","GAC","GAA","GAG","GGT","GGC","GGA","GGG"};

45 cÚ¡ 
	gcodÚpos
[][64] = {

51 
	eG’‘icCodeTy³
 {
	mUniv”§l
 = 0, 
	mMtMam
 = 1, 
	mMtInv
 = 2, 
	mMtPrÙ
 = 3, 
	mMtEch
 = 4};

54 cÚ¡ 
	gUniNStİCodÚs
 = 3;

55 cÚ¡ 
	gUniStİCodÚs
[] = {10,11,14};

56 cÚ¡ 
	gUniCodÚCode
[] = {4,4,9,9,15,15,15,15,19,19,-1,-1,1,1,-1,18,9,9,9,9,12,12,12,12,6,6,13,13,14,14,14,14,7,7,7,10,16,16,16,16,11,11,8,8,15,15,14,14,17,17,17,17,0,0,0,0,2,2,3,3,5,5,5,5};

57 cÚ¡ 
	gUniStİPos1
[] = {3,3,3};

58 cÚ¡ 
	gUniStİPos2
[] = {0,0,2};

59 cÚ¡ 
	gUniStİPos3
[] = {0,2,0};

61 cÚ¡ 
	gMtInvNStİCodÚs
 = 2;

62 cÚ¡ 
	gMtInvStİCodÚs
[] = {10,11};

63 cÚ¡ 
	gMtInvCodÚCode
[] = {4,4,9,9,15,15,15,15,19,19,-1,-1,1,1,18,18,9,9,9,9,12,12,12,12,6,6,13,13,14,14,14,14,7,7,10,10,16,16,16,16,11,11,8,8,15,15,15,15,17,17,17,17,0,0,0,0,2,2,3,3,5,5,5,5};

64 cÚ¡ 
	gMtInvStİPos1
[] = {3,3};

65 cÚ¡ 
	gMtInvStİPos2
[] = {0,0};

66 cÚ¡ 
	gMtInvStİPos3
[] = {0,2};

69 cÚ¡ 
	gMtMamNStİCodÚs
 = 4;

70 cÚ¡ 
	gMtMamStİCodÚs
[] = {10,11,46,47};

71 cÚ¡ 
	gMtMamCodÚCode
[] = {4,4,9,9,15,15,15,15,19,19,-1,-1,1,1,18,18,9,9,9,9,12,12,12,12,6,6,13,13,14,14,14,14,7,7,10,10,16,16,16,16,11,11,8,8,15,15,-1,-1,17,17,17,17,0,0,0,0,2,2,3,3,5,5,5,5};

72 cÚ¡ 
	gMtMamStİPos1
[] = {3,3,0,0};

73 cÚ¡ 
	gMtMamStİPos2
[] = {0,0,2,2};

74 cÚ¡ 
	gMtMamStİPos3
[] = {0,2,0,2};

88 
šlše
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gG’‘icCodeTy³
& 
	gty³
) {

89 
¡ršg
 
	gt
;

90 
	gis
 >> 
	gt
;

91 ià(
	gt
 == "Universal") {

92 
ty³
 = 
Univ”§l
;

94 ià(
	gt
 == "MtMam") {

95 
ty³
 = 
MtMam
;

97 ià(
	gt
 == "MtInv") {

98 
ty³
 = 
MtInv
;

100 ià(
	gt
 == "MtProt") {

101 
ty³
 = 
MtPrÙ
;

103 ià(
	gt
 == "MtEch") {

104 
ty³
 = 
MtEch
;

107 
	gû¼
 << "error in istream genetic codeype\n";

108 
	gû¼
 << 
	gty³
 << '\n';

109 
ex™
(1);

111  
	gis
;

114 
šlše
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
G’‘icCodeTy³
 
	gty³
) {

115 ià(
	gty³
 =ğ
Univ”§l
) {

116 
os
 << "Universal\n";

118 ià(
	gty³
 =ğ
MtMam
) {

119 
os
 << "MtMam\n";

121 ià(
	gty³
 =ğ
MtInv
) {

122 
os
 << "MtInv\n";

124 ià(
	gty³
 =ğ
MtPrÙ
) {

125 
os
 << "MtProt\n";

127 ià(
	gty³
 =ğ
MtEch
) {

128 
os
 << "MtEch\n";

131 
	gû¼
 << "error in ostream genetic codeype\n";

132 
	gû¼
 << (è
	gty³
 << '\n';

133 
ex™
(1);

135  
	gos
;

	@BranchProcess.h

2 #iâdeà
BRANCHPROCESS_H


3 
	#BRANCHPROCESS_H


	)

5 
	~<s¡»am
>

7 
	~"V®T»e.h
"

8 
	~"RªdomTy³s.h
"

13 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gB¿nchProûss
 : 
public
 
MCMC
 ,…ubliø
vœtu®
 
	gB¿nchV®PŒT»e
< 
	gRv¬
<V> > {

15 
	gpublic
:

17 
B¿nchProûss
(
T»e
* 
šŒ“
, 
boŞ
 
šw™hroÙ
 = 
çl£
è: 
Œ“
(intree) {

18 
this
->
S‘W™hRoÙ
(
šw™hroÙ
);

21 
T»e
* 
G‘T»e
(è{ 
	gŒ“
;}

23 
V
 
v®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

24  
	gthis
->
G‘B¿nchV®
(
b¿nch
)->
v®
();

27 
£tv®
(cÚ¡ 
B¿nch
* 
b¿nch
, 
V
 
šv®
) {

28 
	gthis
->
G‘B¿nchV®
(
b¿nch
)->
£tv®
(
šv®
);

31 
vœtu®
 
d¿wSam¶e
() {

32 
d¿wSam¶e
(
this
->
G‘RoÙ
());

35 
vœtu®
 
Move
(
tunšg
) {

36 
	gn
 = 0;

37 
	gtÙ
 = 
Move
(
this
->
G‘RoÙ
(),
tunšg
,
n
);

38  
	gtÙ
 / 
	gn
;

41 
vœtu®
 
G‘LogProb
() {

42  
G‘LogProb
(
this
->
G‘RoÙ
());

45 
RecursiveRegi¡”
(
DAGnode
* 
node
, cÚ¡ 
Lšk
* 
äom
) {

46 ià(
	gthis
->
W™hRoÙ
(è|| (! 
	gäom
->
isRoÙ
())) {

47 
	gthis
->
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
Regi¡”
(
node
);

49 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

50 
RecursiveRegi¡”
(
node
,
lšk
->
Out
());

54 
	g´Ùeùed
:

56 
vœtu®
 
d¿wSam¶e
(cÚ¡ 
Lšk
* 
äom
) {

57 ià(
this
->
W™hRoÙ
(è&& (
äom
->
isRoÙ
())) {

58 
this
->
G‘B¿nchV®
(0)->
Sam¶e
();

60 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

61 
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
Sam¶e
();

62 
d¿wSam¶e
(
lšk
->
Out
());

67 
vœtu®
 
Move
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
, & 
couÁ
) {

68 
	gtÙ®
 = 0;

69 ià(
	gthis
->
W™hRoÙ
(è&& (
	gäom
->
isRoÙ
())) {

70 
	gtÙ®
 +ğ
this
->
G‘B¿nchV®
(0)->
Move
(
tunšg
);

71 
	gcouÁ
++;

73 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

74 
tÙ®
 +ğ
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
Move
(
tunšg
);

75 
	gcouÁ
++;

76 
	gtÙ®
 +ğ
Move
(
lšk
->
Out
(),
tunšg
,
couÁ
);

78  
	gtÙ®
;

81 
vœtu®
 
G‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

82 
	gtÙ®
 = 0;

83 ià(
	gthis
->
W™hRoÙ
(è&& (
	gäom
->
isRoÙ
())) {

84 
	gtÙ®
 +ğ
this
->
G‘B¿nchV®
(0)->
G‘LogProb
();

86 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

87 
tÙ®
 +ğ
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
G‘LogProb
();

88 
	gtÙ®
 +ğ
G‘LogProb
(
lšk
->
Out
());

90  
	gtÙ®
;

93 
T»e
* 
	gŒ“
;

97 
şass
 
	gGammaT»e
 : 
public
 
B¿nchProûss
<
PosR—l
> {

99 
public
:

101 
GammaT»e
(
T»e
* 
šŒ“
è: 
B¿nchProûss
<
PosR—l
>(intree) {}

103 
GammaT»e
(
T»e
* 
šŒ“
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
, 
boŞ
 
šw™hroÙ
 = 
çl£
, boŞ 
šm—nv¬
 = f®£è: 
B¿nchProûss
<PosReal>(intree) {

104 
S‘W™hRoÙ
(
šw™hroÙ
);

105 
	gm—nv¬
 = 
šm—nv¬
;

106 
	g®pha
 = 
š®pha
;

107 
	gb‘a
 = 
šb‘a
;

108 
RecursiveC»©e
(
G‘RoÙ
());

111 ~
GammaT»e
() {

112 
RecursiveD–‘e
(
G‘RoÙ
());

115 
	gV¬
<
	gPosR—l
>* 
G‘AÍha
() {

116  
	g®pha
;

119 
	gV¬
<
	gPosR—l
>* 
G‘B‘a
() {

120  
	gb‘a
;

123 
G‘TÙ®
() {

124 
	gn
 = 0;

125 
	gtÙ®
 = 
G‘M—n
(
G‘RoÙ
(),
n
);

126  
	gtÙ®
;

130 
G‘M—n
() {

131 
	gn
 = 0;

132 
	gtÙ®
 = 
G‘M—n
(
G‘RoÙ
(),
n
);

133  
	gtÙ®
 / 
	gn
;

137 
G‘V¬
() {

138 
	gn
 = 0;

139 
	gm—n
 = 
G‘M—n
(
G‘RoÙ
(),
n
);

140 
	gn
 = 0;

141 
	gm—nsqu¬e
 = 
G‘M—nSqu¬e
(
G‘RoÙ
(),
n
);

142 
	gm—n
 /ğ
n
;

143 
	gm—nsqu¬e
 /ğ
n
;

144  
	gm—nsqu¬e
 - 
m—n
 * 
	gm—n
;

147 
	g´Ùeùed
:

149 
G‘M—n
(cÚ¡ 
Lšk
* 
äom
, & 
n
) {

150 
	gtÙ®
 = 0;

151 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

152 
tÙ®
 +ğ
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
v®
();

153 
	gn
++;

154 
	gtÙ®
 +ğ
G‘M—n
(
lšk
->
Out
(),
n
);

156  
	gtÙ®
;

159 
G‘M—nSqu¬e
(cÚ¡ 
Lšk
* 
äom
, & 
n
) {

160 
	gtÙ®
 = 0;

161 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

162 
tmp
 = 
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
v®
();

163 
	gtÙ®
 +ğ
tmp
 *mp;

164 
	gn
++;

165 
	gtÙ®
 +ğ
G‘M—nSqu¬e
(
lšk
->
Out
(),
n
);

167  
	gtÙ®
;

170 
	gRv¬
<
	gPosR—l
>* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

171  
Ãw
 
Gamma
(
®pha
,
b‘a
,
m—nv¬
);

174 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

175 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

176 
boŞ
 
	gm—nv¬
;

180 
şass
 
	gB‘aT»e
 : 
public
 
B¿nchProûss
<
Un™R—l
> {

182 
public
:

184 
B‘aT»e
(
T»e
* 
šŒ“
è: 
B¿nchProûss
<
Un™R—l
>(intree) {}

186 
B‘aT»e
(
T»e
* 
šŒ“
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
, 
boŞ
 
šw™hroÙ
 = 
çl£
è: 
B¿nchProûss
<
Un™R—l
>(intree) {

187 
S‘W™hRoÙ
(
šw™hroÙ
);

188 
	g®pha
 = 
š®pha
;

189 
	gb‘a
 = 
šb‘a
;

190 
RecursiveC»©e
(
G‘RoÙ
());

193 ~
B‘aT»e
() {

194 
RecursiveD–‘e
(
G‘RoÙ
());

197 
G‘M—n
() {

198 
	gn
 = 0;

199 
	gtÙ®
 = 
G‘M—n
(
G‘RoÙ
(),
n
);

200  
	gtÙ®
 / 
	gn
;

204 
G‘V¬
() {

205 
	gn
 = 0;

206 
	gm—n
 = 
G‘M—n
(
G‘RoÙ
(),
n
);

207 
	gn
 = 0;

208 
	gm—nsqu¬e
 = 
G‘M—nSqu¬e
(
G‘RoÙ
(),
n
);

209 
	gm—n
 /ğ
n
;

210 
	gm—nsqu¬e
 /ğ
n
;

211  
	gm—nsqu¬e
 - 
m—n
 * 
	gm—n
;

214 
	g´Ùeùed
:

216 
G‘M—n
(cÚ¡ 
Lšk
* 
äom
, & 
n
) {

217 
	gtÙ®
 = 0;

218 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

219 
tÙ®
 +ğ
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
v®
();

220 
	gn
++;

221 
	gtÙ®
 +ğ
G‘M—n
(
lšk
->
Out
(),
n
);

223  
	gtÙ®
;

226 
G‘M—nSqu¬e
(cÚ¡ 
Lšk
* 
äom
, & 
n
) {

227 
	gtÙ®
 = 0;

228 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

229 
tmp
 = 
this
->
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
v®
();

230 
	gtÙ®
 +ğ
tmp
 *mp;

231 
	gn
++;

232 
	gtÙ®
 +ğ
G‘M—nSqu¬e
(
lšk
->
Out
(),
n
);

234  
	gtÙ®
;

237 
	gRv¬
<
	gUn™R—l
>* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

238  
Ãw
 
B‘a
(
®pha
,
b‘a
);

241 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

242 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

246 
şass
 
	gExpÚ’tŸlT»e
 : 
public
 
B¿nchProûss
<
PosR—l
> {

248 
public
:

250 
ExpÚ’tŸlT»e
(
T»e
* 
šŒ“
, 
V¬
<
PosR—l
>* 
šm—Æ’gth
è: 
B¿nchProûss
<PosReal>(intree) {

251 
m—Æ’gth
 = 
šm—Æ’gth
;

252 
RecursiveC»©e
(
G‘RoÙ
());

255 ~
ExpÚ’tŸlT»e
() {

256 
RecursiveD–‘e
(
G‘RoÙ
());

259 
	g´Ùeùed
:

261 
Rv¬
<
PosR—l
>* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

262 
ExpÚ’tŸl
* 
expo
 = 
Ãw
 ExpÚ’tŸl(
m—Æ’gth
,ExpÚ’tŸl::
MEAN
);

263  
	gexpo
;

266 
	g´iv©e
:

268 
V¬
<
PosR—l
>* 
m—Æ’gth
;

	@BranchSitePath.cpp

2 
	~<s¡»am
>

3 
	~"B¿nchS™eP©h.h
"

5 
	~<cm©h
>

11 
	gB¿nchS™eP©h
::
	$B¿nchS™eP©h
() {

12 
š™
 = 
Ï¡
 = 
Ãw
 
Plšk
;

13 
bkš™
 = 
bkÏ¡
 = 
Ãw
 
Plšk
;

14 
nsub
 = 0;

15 
	}
}

17 
	gB¿nchS™eP©h
::
	$B¿nchS™eP©h
(
S‹S·û
* 
š¡©e¥aû
) {

18 
¡©e¥aû
 = 
š¡©e¥aû
;

19 
š™
 = 
Ï¡
 = 
Ãw
 
Plšk
;

20 
nsub
 = 0;

21 
	}
}

23 
	gB¿nchS™eP©h
::~
	$B¿nchS™eP©h
() {

24 
	`Re£t
(0);

25 
d–‘e
 
š™
;

26 
	}
}

28 
	gB¿nchS™eP©h
::
	$Re£t
(
¡©e
) {

29 
Plšk
* 
lšk
=
Ï¡
;

30 
lšk
!=
š™
) {

31 
Plšk
* 
´ev
 = 
lšk
->
	`P»v
();

32 
d–‘e
 
lšk
;

33 
lšk
 = 
´ev
;

35 
nsub
 = 0;

36 
š™
->
	`S‘S‹
(
¡©e
);

37 
š™
->
	`S‘R–©iveTime
(0);

38 
Ï¡
 = 
š™
;

39 
	}
}

41 
	gB¿nchS™eP©h
::
	$BKRe£t
(
¡©e
) {

42 
Plšk
* 
lšk
=
bkÏ¡
;

43 
lšk
!=
bkš™
) {

44 
Plšk
* 
´ev
 = 
lšk
->
	`P»v
();

45 
d–‘e
 
lšk
;

46 
lšk
 = 
´ev
;

48 
bknsub
 = 0;

49 
bkš™
->
	`S‘S‹
(
¡©e
);

50 
bkš™
->
	`S‘R–©iveTime
(0);

51 
bkÏ¡
 = 
bkš™
;

52 
	}
}

54 
	gB¿nchS™eP©h
::
	$BackupP©h
() {

56 
	`BKRe£t
(
š™
->
	`G‘S‹
());

57 
Plšk
* 
lšk
 = 
š™
;

58 
lšk
 !ğ
Ï¡
) {

59 
	`BKAµ’d
(
lšk
->
	`Next
()->
	`G‘S‹
(),lšk->
	`G‘R–©iveTime
());

60 
lšk
 =†šk->
	`Next
();

62 
bkÏ¡
->
	`S‘R–©iveTime
(
Ï¡
->
	`G‘R–©iveTime
());

63 
bknsub
 = 
nsub
;

64 
	}
}

66 
	gB¿nchS™eP©h
::
	$Re¡ÜeP©h
() {

68 
	`Re£t
(
bkš™
->
	`G‘S‹
());

69 
Plšk
* 
lšk
 = 
bkš™
;

70 
lšk
 !ğ
bkÏ¡
) {

71 
	`Aµ’d
(
lšk
->
	`Next
()->
	`G‘S‹
(),lšk->
	`G‘R–©iveTime
());

72 
lšk
 =†šk->
	`Next
();

74 
Ï¡
->
	`S‘R–©iveTime
(
bkÏ¡
->
	`G‘R–©iveTime
());

75 
nsub
 = 
bknsub
;

76 
	}
}

78 
¡ršg
 
	gB¿nchS™eP©h
::
	$ToSŒšg
(
boŞ
 
»dundªt
) {

80 
o¡ršg¡»am
 
s
;

81 ià(
»dundªt
) {

82 
s
 << 
	`G‘Ch¬Fš®S‹
() << ':';

84 
Plšk
* 
lšk
 = 
Ï¡
;

85 
lšk
) {

86 ià(
lšk
 !ğ
Ï¡
) {

87 
s
 << ':' << 
	`G‘S‹
(
lšk
->
	`Next
()è<< ':' << 
	`G‘AbsŞu‹Time
(link);

90 
s
 << 
	`G‘AbsŞu‹Time
(
lšk
);

98 
lšk
 =†šk->
´ev
;

100 ià(
»dundªt
) {

101 
s
 << ':' << 
	`G‘Ch¬In™S‹
();

103  
s
.
	`¡r
();

104 
	}
}

106 
	gB¿nchS™eP©h
::
	$AddCouÁs
(** 
·œcouÁs
, * 
¡©ecouÁs
) {

108 ià(
Ï¡
->
	`G‘R–©iveTime
()) {

109 
Plšk
* 
lšk
 = 
š™
;

110 
lšk
 !ğ
Ï¡
) {

111 
·œcouÁs
[
lšk
->
	`G‘S‹
(),lšk->
	`Next
()->GetState()]++;

112 
¡©ecouÁs
[
lšk
->
	`Next
()->
	`G‘S‹
()]++;

113 
lšk
 =†šk->
	`Next
();

117 
¡©ecouÁs
[
š™
->
	`G‘S‹
()]++;

119 
	}
}

122 
	gB¿nchS™eP©h
::
	$P»fix
(
B¿nchS™eP©h
* 
p
, B¿nchS™eP©h* 
roÙ
, 
ab¡ime
) {

124 ià((
š™
->
	`G‘S‹
(è!ğ
roÙ
->š™->G‘S‹()è|| (
p
->init->GetState() !=„oot->init->GetState())) {

125 
û¼
 << "error in…refix:‚o matching states‡t„oot\n";

128 ià(
ab¡ime
 > 
p
->
	`G‘TÙ®Time
()) {

129 
û¼
 << "error :imeo be„emoved isoo†arge\n";

130 
û¼
 << 
ab¡ime
 << '\t' << 
p
->
	`G‘TÙ®Time
() << '\n';

131 
	`ex™
(1);

134 
	`S‘TimesR–©iveToAbsŞu‹
();

135 
p
->
	`S‘TimesR–©iveToAbsŞu‹
();

137 
t
 = 
ab¡ime
;

138 
t
>0) {

139 
dt
 = 
p
->
š™
->
	`G‘R–©iveTime
();

140 ià(
dt
 > 
t
) {

142 
p
->
š™
->
	`S‘R–©iveTime
Õ->š™->
	`G‘R–©iveTime
(è- 
t
);

143 
š™
->
	`S‘R–©iveTime
(š™->
	`G‘R–©iveTime
(è+ 
t
);

144 
t
 = 0;

147 ià(
p
->
š™
->
	`IsLa¡
()) {

148 
û¼
 << "error : is†ast\n";

149 
	`ex™
(1);

152 
š™
->
	`S‘R–©iveTime
(š™->
	`G‘R–©iveTime
(è+ 
dt
);

155 
Plšk
* 
tmp
 = 
p
->
š™
->
Ãxt
;

156 ià(! 
tmp
) {

157 
û¼
 << "error :‚ext is 0\n";

158 
	`ex™
(1);

160 
tmp
->
´ev
 = 0;

163 
š™
->
´ev
 = 
p
->init;

164 
p
->
š™
->
Ãxt
 = init;

165 
š™
 = 
p
->init;

166 
p
->
š™
 = 
tmp
;

169 
š™
->
	`S‘R–©iveTime
(0);

170 
š™
->
	`S‘S‹
(
p
->š™->
	`G‘S‹
());

171 
t
 -ğ
dt
;

174 ià(
p
->
š™
->
	`G‘S‹
() != init->GetState()) {

175 
û¼
 << "error in Prefix\n";

176 
	`ex™
(1);

178 
roÙ
->
š™
->
	`S‘S‹
(š™->
	`G‘S‹
());

180 
	`S‘TimesAbsŞu‹ToR–©ive
();

181 
p
->
	`S‘TimesAbsŞu‹ToR–©ive
();

182 
	}
}

184 
	gB¿nchS™eP©h
::
	$S‘TimesR–©iveToAbsŞu‹
() {

186 ià(
	`çbs
(
	`CheckTÙ®Time
() - 1) > 1e-6) {

187 
û¼
 << "”rÜ iÀB¿nchS™eP©h:„–©ivtimdÛ nÙ sumØ1 : " << 
	`CheckTÙ®Time
() << '\n';

188 
û¼
 << 
	`G‘TÙ®Time
() << '\n';

189 
	`ex™
(1);

191 
Plšk
* 
lšk
 = 
š™
;

192 
tÙ®time
 = 
	`G‘TÙ®Time
();

193 
lšk
 !ğ
Ï¡
) {

194 
lšk
->
	`S‘R–©iveTime
Öšk->
	`G‘R–©iveTime
(è* 
tÙ®time
);

195 
lšk
 =†šk->
Ãxt
;

197 
lšk
->
	`S‘R–©iveTime
Öšk->
	`G‘R–©iveTime
(è* 
tÙ®time
);

198 
	}
}

201 
	gB¿nchS™eP©h
::
	$S‘TimesAbsŞu‹ToR–©ive
() {

209 
Plšk
* 
lšk
 = 
š™
;

210 
tÙ®time
 = 
	`CheckTÙ®Time
();

211 
lšk
 !ğ
Ï¡
) {

212 
lšk
->
	`S‘R–©iveTime
Öšk->
	`G‘R–©iveTime
(è/ 
tÙ®time
);

213 
lšk
 =†šk->
Ãxt
;

215 
lšk
->
	`S‘R–©iveTime
Öšk->
	`G‘R–©iveTime
(è/ 
tÙ®time
);

216 
	}
}

218 
	gB¿nchS™eP©h
::
	$CheckTÙ®Time
() {

220 
tÙ
 = 0;

221 
Plšk
* 
lšk
 = 
š™
;

222 
lšk
 !ğ
Ï¡
) {

223 ià(! 
lšk
) {

224 
û¼
 << "error :‚ull†ink\n";

225 
	`ex™
(1);

227 
tÙ
 +ğ
lšk
->
	`G‘R–©iveTime
();

228 
lšk
 =†šk->
Ãxt
;

230 ià(! 
lšk
) {

231 
û¼
 << "error :‚ull†ink\n";

232 
	`ex™
(1);

234 
tÙ
 +ğ
lšk
->
	`G‘R–©iveTime
();

235  
tÙ
;

236 
	}
}

	@BranchSitePath.h

2 #iâdeà
SITEPATH_H


3 
	#SITEPATH_H


	)

5 
	~<¡ršg
>

6 
	~"T»e.h
"

7 
	~"S‹S·û.h
"

9 şas 
	cPlšk
 {

11 
ä›nd
 
şass
 
	mB¿nchS™eP©h
;

12 
ä›nd
 
şass
 
	mRªdomB¿nchS™eP©h
;

14 
	mpublic
:

16 
Plšk
();

17 
Plšk
(
š¡©e
, 
š»l_time
);

18 ~
Plšk
();

19 
Plšk
* 
P»v
();

20 
Plšk
* 
Next
();

22 
boŞ
 
IsFœ¡
();

23 
boŞ
 
IsLa¡
();

25 
S¶iû
();

26 
In£¹
(
Plšk
* 
lšk
);

28 
S‘S‹
(
š¡©e
);

29 
G‘S‹
();

31 
S‘R–©iveTime
(
š»l_time
);

32 
G‘R–©iveTime
();

34 
	m´iv©e
:

36 
Plšk
* 
Ãxt
;

37 
Plšk
* 
	m´ev
;

39 
	m¡©e
;

40 
	m»l_time
;

44 şas 
	cB¿nchS™eP©h
 {

46 
ä›nd
 
şass
 
	mRªdomB¿nchS™eP©h
;

48 
	mpublic
:

50 
B¿nchS™eP©h
();

51 
B¿nchS™eP©h
(
S‹S·û
* 
š¡©e¥aû
);

52 
	mvœtu®
 ~
B¿nchS™eP©h
();

54 
vœtu®
 
G‘TÙ®Time
() = 0;

55 
vœtu®
 
S‘TÙ®Time
(
štime
) = 0;

57 
Plšk
* 
In™
();

58 
Plšk
* 
La¡
();

59 
S‹S·û
* 
G‘S‹S·û
();

60 
	$S‘S‹S·û
(
S‹S·û
* 
š¡©e¥aû
è{
¡©e¥aû
 = instatespace;}

61 
	`G‘Nsub
();

62 
¡ršg
 
	`G‘S‹
(
Plšk
* 
lšk
);

63 
¡ršg
 
	`G‘Ch¬In™S‹
();

64 
¡ršg
 
	`G‘Ch¬Fš®S‹
();

65 
	`G‘In™S‹
();

66 
	`G‘Fš®S‹
();

67 
	`G‘AbsŞu‹Time
(
Plšk
* 
lšk
);

68 
	$G‘R–©iveTime
(
Plšk
* 
lšk
è{†šk->
	`G‘R–©iveTime
();
	}
}

70 
AddCouÁs
(** 
·œcouÁ
, * 
¡©ecouÁ
);

72 
S‘TimesR–©iveToAbsŞu‹
();

73 
S‘TimesAbsŞu‹ToR–©ive
();

74 
CheckTÙ®Time
();

76 
Re£t
(
¡©e
);

77 
Aµ’d
(
š¡©e
, 
»Éim–’gth
);

79 
BKRe£t
(
¡©e
);

80 
BKAµ’d
(
š¡©e
, 
»Éim–’gth
);

81 
BackupP©h
();

82 
Re¡ÜeP©h
();

87 
P»fix
(
B¿nchS™eP©h
* 
p
, B¿nchS™eP©h* 
roÙ
, 
ab¡ime
);

89 
¡ršg
 
ToSŒšg
(
boŞ
 
»dundªt
 = 
çl£
);

91 
	g´Ùeùed
 :

93 
Plšk
* 
š™
;

94 
Plšk
* 
	gÏ¡
;

95 
	gnsub
;

96 
S‹S·û
* 
	g¡©e¥aû
;

98 
Plšk
* 
	gbkš™
;

99 
Plšk
* 
	gbkÏ¡
;

100 
	gbknsub
;

117 
šlše
 
	gPlšk
::
	$Plšk
(è: 
	`Ãxt
(0), 
	`´ev
(0), 
	`¡©e
(0), 
	$»l_time
(0è{
	}
}

118 
šlše
 
	gPlšk
::
	$Plšk
(
š¡©e
, 
š»l_time
è: 
	`Ãxt
(0), 
	`´ev
(0), 
	`¡©e
(š¡©e), 
	$»l_time
(
š»l_time
){
	}
}

119 
šlše
 
	gPlšk
::~
	$Plšk
(è{
	`S¶iû
();
	}
}

121 
šlše
 
Plšk
* 
	gPlšk
::
	$P»v
(è{ 
´ev
;
	}
}

122 
šlše
 
Plšk
* 
	gPlšk
::
	$Next
(è{ 
Ãxt
;
	}
}

124 
šlše
 
boŞ
 
	gPlšk
::
	$IsFœ¡
(è{ 
´ev
 =ğ0;
	}
}

125 
šlše
 
boŞ
 
	gPlšk
::
	$IsLa¡
(è{ 
Ãxt
 =ğ0;
	}
}

127 
šlše
 
	gPlšk
::
	$In£¹
(
Plšk
* 
lšk
) {

128 
lšk
->
Ãxt
 =‚ext;

129 ià(
Ãxt
) {

130 
Ãxt
->
´ev
 = 
lšk
;

132 
lšk
->
´ev
 = 
this
;

133 
Ãxt
 = 
lšk
;

134 
	}
}

136 
šlše
 
	gPlšk
::
	$S¶iû
() {

137 ià(
´ev
) {

138 
´ev
->
Ãxt
 =‚ext;

140 ià(
Ãxt
) {

141 
Ãxt
->
´ev
 =…rev;

143 
´ev
 = 
Ãxt
 = 0;

144 
	}
}

146 
šlše
 
	gPlšk
::
	$S‘S‹
(
š¡©e
è{
¡©e
 = in¡©e;
	}
}

147 
šlše
 
	gPlšk
::
	$S‘R–©iveTime
(
š»l_time
è{
»l_time
 = iÄ–_time;
	}
}

148 
šlše
 
	gPlšk
::
	$G‘R–©iveTime
(è{ 
»l_time
;
	}
}

149 
šlše
 
	gPlšk
::
	$G‘S‹
(è{ 
¡©e
;
	}
}

151 
šlše
 
Plšk
* 
	gB¿nchS™eP©h
::
	$In™
(è{ 
š™
;
	}
}

152 
šlše
 
Plšk
* 
	gB¿nchS™eP©h
::
	$La¡
(è{ 
Ï¡
;
	}
}

158 
šlše
 
S‹S·û
* 
	gB¿nchS™eP©h
::
	$G‘S‹S·û
(è{ià(!
¡©e¥aû
è{
û¼
 << "nuÎ…oš‹¸: B¿nchS™eP©h::¡©e¥aû\n"; 
	`throw
(0); }  s‹¥aû;
	}
}

160 
šlše
 
	gB¿nchS™eP©h
::
	$Aµ’d
(
š¡©e
, 
»Éim–’gth
) {

161 
Ï¡
->
	`S‘R–©iveTime
(
»Éim–’gth
);

162 
Plšk
* 
lšk
 = 
Ãw
 
	`Plšk
(
š¡©e
,0);

163 
Ï¡
->
	`In£¹
(
lšk
);

164 
Ï¡
 = 
lšk
;

165 
nsub
++;

166 
	}
}

168 
šlše
 
	gB¿nchS™eP©h
::
	$BKAµ’d
(
š¡©e
, 
»Éim–’gth
) {

169 
bkÏ¡
->
	`S‘R–©iveTime
(
»Éim–’gth
);

170 
Plšk
* 
lšk
 = 
Ãw
 
	`Plšk
(
š¡©e
,0);

171 
bkÏ¡
->
	`In£¹
(
lšk
);

172 
bkÏ¡
 = 
lšk
;

173 
bknsub
++;

174 
	}
}

176 
šlše
 
	gB¿nchS™eP©h
::
	$G‘Nsub
() {

177  
nsub
;

178 
	}
}

180 
šlše
 
¡ršg
 
	gB¿nchS™eP©h
::
	$G‘S‹
(
Plšk
* 
lšk
è{ 
	`G‘S‹S·û
()->
	`G‘S‹
Öšk->G‘S‹());
	}
}

181 
šlše
 
¡ršg
 
	gB¿nchS™eP©h
::
	$G‘Ch¬In™S‹
(è{ 
	`G‘S‹
(
š™
);
	}
}

182 
šlše
 
¡ršg
 
	gB¿nchS™eP©h
::
	$G‘Ch¬Fš®S‹
(è{ 
	`G‘S‹
(
Ï¡
);
	}
}

183 
šlše
 
	gB¿nchS™eP©h
::
	$G‘In™S‹
(è{ 
š™
->
	`G‘S‹
();
	}
}

184 
šlše
 
	gB¿nchS™eP©h
::
	$G‘Fš®S‹
(è{ 
Ï¡
->
	`G‘S‹
();
	}
}

186 
šlše
 
	gB¿nchS™eP©h
::
	$G‘AbsŞu‹Time
(
Plšk
* 
lšk
è{†šk->
	`G‘R–©iveTime
(è* 
	`G‘TÙ®Time
();
	}
}

	@BranchSiteSubstitutionProcess.h

1 #iâdeà
SUBPROCESS_H


2 
	#SUBPROCESS_H


	)

4 
	~"Rªdom.h
"

5 
	~"SubM©rix.h
"

6 
	~"V¬.h
"

8 şas 
	cB¿nchS™eSub¡™utiÚProûss
 {

15 
	mpublic
:

17 
vœtu®
 ~
	$B¿nchS™eSub¡™utiÚProûss
() {}

19 
vœtu®
 
	`G‘Time
() = 0;

20 
vœtu®
 
	`G‘R©e
() = 0;

21 
vœtu®
 cÚ¡ * 
	`G‘StiÚ¬y
() = 0;

22 
vœtu®
 
SubM©rix
* 
	`G‘SubM©rix
() = 0;

24 
vœtu®
 
	$G‘N¡©e
(è{ 
	`G‘SubM©rix
()->
	`G‘N¡©e
();
	}
}

26 
	$Backw¬dPrİag©e
(cÚ¡ * 
down
, * 
up
) {

27 
	`G‘SubM©rix
()->
	`Backw¬dPrİag©e
(
down
,
up
,
	`G‘Time
()*
	`G‘R©e
());

28 
	}
}

29 
	$FÜw¬dPrİag©e
(cÚ¡ * 
up
, * 
down
) {

30 
	`G‘SubM©rix
()->
	`FÜw¬dPrİag©e
(
up
,
down
,
	`G‘Time
()*
	`G‘R©e
());

31 
	}
}

33 
D¿wFš™eTime
(
¡©e
);

34 
D¿wStiÚ¬y
();

36 
G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
, * 
down
);

38 
G‘Fš™eTimeT¿ns™iÚProb
(
¡©eup
, 
¡©edown
);

40 
D¿wWa™šgTime
(
¡©e
);

41 
D¿wWa™šgTimeGiv’AtL—¡OÃ
(
¡©e
, 
time
);

42 
D¿wOÃS‹p
(
¡©e
);

44 
Wa™šgTimeLogProb
(
¡©e
, 
time
);

45 
ReduûdWa™šgTimeLogProb
(
¡©e
, 
time
);

46 
OÃS‹pLogProb
(
¡©eup
, 
¡©edown
);

47 
StiÚ¬yLogProb
(
¡©e
);

48 
ReduûdOÃS‹pLogProb
(
¡©eup
, 
¡©edown
);

50 
D¿wUnifÜmizedT¿ns™iÚ
(
¡©e
, 
¡©edown
, 
n
);

51 
D¿wUnifÜmizedSub¡™utiÚNumb”
(
¡©e
, 
¡©edown
);

52 
boŞ
 
CheckUnifÜmizedSub¡™utiÚNumb”
(
¡©e
, 
¡©edown
);

64 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$Wa™šgTimeLogProb
(
¡©e
, 
time
) {

66 
q
 = -(*
	`G‘SubM©rix
())(
¡©e
,¡©eè* 
	`G‘R©e
();

67  
	`log
(
q
è- q*
time
;

68 
	}
}

70 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$ReduûdWa™šgTimeLogProb
(
¡©e
, 
time
) {

72 
q
 = -(*
	`G‘SubM©rix
())(
¡©e
,¡©eè* 
	`G‘R©e
();

73  - 
q
*
time
;

74 
	}
}

76 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$OÃS‹pLogProb
(
¡©eup
, 
¡©edown
) {

78 cÚ¡ * 
row
 = 
	`G‘SubM©rix
()->
	`G‘Row
(
¡©eup
);

79 
û¼
 << "in BranchSiteSubstitutionProcess::OneStepLogProb : check code\n";

80 
	`ex™
(1);

81  
	`log
(
row
[
¡©edown
]è-†ogÔow[
¡©eup
]);

82 
	}
}

84 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$ReduûdOÃS‹pLogProb
(
¡©eup
, 
¡©edown
) {

86 cÚ¡ * 
row
 = 
	`G‘SubM©rix
()->
	`G‘Row
(
¡©eup
);

87  
	`log
(
row
[
¡©edown
]);

88 
	}
}

90 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wWa™šgTime
(
¡©e
) {

92 
q
 = -(*
	`G‘SubM©rix
())(
¡©e
,¡©eè* 
	`G‘R©e
();

93  -
	`log
 (1 - 
Rªdom
::
	`UnifÜm
()è/ 
q
;

94 
	}
}

96 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wWa™šgTimeGiv’AtL—¡OÃ
(
¡©e
, 
tÙ®time
) {

98 
q
 = -(*
	`G‘SubM©rix
())(
¡©e
,¡©eè* 
	`G‘R©e
();

99  -
	`log
(1 - 
Rªdom
::
	`UnifÜm
(è* (1 - 
	`exp
(-
q
 * 
tÙ®time
))) / q;

101 
	}
}

103 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wOÃS‹p
(
¡©e
) {

105 cÚ¡ * 
row
 = 
	`G‘SubM©rix
()->
	`G‘Row
(
¡©e
);

106 
p
 = -
row
[
¡©e
] * 
Rªdom
::
	`UnifÜm
();

107 
k
 = -1;

108 
tÙ
 = 0;

110 
k
++;

111 ià(
k
 !ğ
¡©e
) {

112 
tÙ
 +ğ
row
[
k
];

115 (
k
<
	`G‘N¡©e
()è&& (
tÙ
 < 
p
));

116 ià(
k
 =ğ
	`G‘N¡©e
()) {

117 
û¼
 << "error in BranchSiteSubstitutionProcess::DrawOneStep\n";

118 
	`ex™
(1);

120  
k
;

121 
	}
}

123 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
, * 
p
) {

125 * 
p1
 = 
Ãw
 [
	`G‘N¡©e
()];

126 
k
=0; k<
	`G‘N¡©e
(); k++) {

127 
p1
[
k
] = 0;

129 
p1
[
¡©e
] = 1;

131 
	`G‘SubM©rix
()->
	`FÜw¬dPrİag©e
(
p1
,
p
,
	`G‘Time
()*
	`G‘R©e
());

132 
tÙ
 = 0;

133 
k
=0; k<
	`G‘N¡©e
(); k++) {

134 
tÙ
 +ğ
p
[
k
];

136 ià(
	`çbs
(1 - 
tÙ
) > 1e-5) {

137 
û¼
 << "”rÜ iÀfÜw¬d…rİag©e:‚Üm®iz©iÚ : " << 
tÙ
 << '\t' << 
	`çbs
(1 -ot) << '\n';

138 
û¼
 << 
	`G‘Time
(è<< '\t' << 
	`G‘R©e
() << '\n';

139 
	`G‘SubM©rix
()->
	`ToSŒ—m
(
û¼
);

140 
	`ex™
(1);

142 
d–‘e
[] 
p1
;

143 
	}
}

145 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$G‘Fš™eTimeT¿ns™iÚProb
(
¡©eup
, 
¡©edown
) {

147 * 
p
 = 
Ãw
 [
	`G‘N¡©e
()];

148 * 
p1
 = 
Ãw
 [
	`G‘N¡©e
()];

149 
k
=0; k<
	`G‘N¡©e
(); k++) {

150 
p1
[
k
] = 0;

152 
p1
[
¡©eup
] = 1;

154 
	`G‘SubM©rix
()->
	`FÜw¬dPrİag©e
(
p1
,
p
,
	`G‘Time
()*
	`G‘R©e
());

156 
tÙ
 = 0;

157 
k
=0; k<
	`G‘N¡©e
(); k++) {

158 
tÙ
 +ğ
p
[
k
];

160 ià(
	`çbs
(1 - 
tÙ
) > 1e-5) {

161 
û¼
 << "”rÜ iÀfÜw¬d…rİag©e:‚Üm®iz©iÚ : " << 
tÙ
 << '\t' << 
	`çbs
(1 -ot) << '\n';

162 
	`G‘SubM©rix
()->
	`ToSŒ—m
(
û¼
);

163 
	`ex™
(1);

165 
»t
 = 
p
[
¡©edown
];

166 
d–‘e
[] 
p1
;

167 
d–‘e
[] 
p
;

168  
»t
;

169 
	}
}

171 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$StiÚ¬yLogProb
(
¡©e
) {

173  
	`log
(
	`G‘StiÚ¬y
()[
¡©e
]);

174 
	}
}

176 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wStiÚ¬y
() {

178 cÚ¡ * 
¡©
 = 
	`G‘StiÚ¬y
();

179 
p
 = 
Rªdom
::
	`UnifÜm
();

180 
k
 = -1;

181 
tÙ
 = 0;

183 
k
++;

184 
tÙ
 +ğ
¡©
[
k
];

186 (
k
<
	`G‘N¡©e
()è&& (
tÙ
 < 
p
));

187 ià(
k
 =ğ
	`G‘N¡©e
()) {

188 
û¼
 << "erroro in BranchSiteSubstitutionProcess::DrawOneStep\n";

189 
	`ex™
(1);

191  
k
;

192 
	}
}

195 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wFš™eTime
(
¡©e
) {

197 * 
p
 = 
Ãw
 [
	`G‘N¡©e
()];

198 
	`G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
,
p
);

199 
Ãw¡©e
 = 
Rªdom
::
	`D¿wFromDisü‘eDi¡ributiÚ
(
p
,
	`G‘N¡©e
());

200 
d–‘e
[] 
p
;

201  
Ãw¡©e
;

202 
	}
}

205 
šlše
 
boŞ
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$CheckUnifÜmizedSub¡™utiÚNumb”
(
¡©eup
, 
¡©edown
) {

207 
Z
 = 
	`G‘Fš™eTimeT¿ns™iÚProb
(
¡©eup
,
¡©edown
);

208 
efæ’gth
 = 
	`G‘R©e
(è* 
	`G‘Time
();

209 
mu
 = 
	`G‘SubM©rix
()->
	`G‘UnifÜmiz©iÚMu
();

210 
çù
 = 
	`exp
(- 
efæ’gth
 * 
mu
);

211 
m
 = 0;

212 
tÙ®
 = (
¡©eup
==
¡©edown
è* 
çù
;

213 (
m
<
SubM©rix
::
UniSubNmax
)) {

214 
m
++;

215 
çù
 *ğ
mu
 * 
efæ’gth
 / 
m
;

216 
tÙ®
 +ğ
	`G‘SubM©rix
()->
	`Pow”
(
m
,
¡©eup
,
¡©edown
è* 
çù
;

218 ià(
	`çbs
(
tÙ®
-
Z
)>1e-12) {

219 
û¼
 << "error in BranchSiteSubstitutionProcess::DrawUniformizedSubstitutionNumber:‚ormalising constant\n";

220 
û¼
 << 
tÙ®
 << '\t' << 
Z
 << '\n';

221 
û¼
 << 
mu
 << '\n';

222 
û¼
 << 
m
 << '\n';

223 
û¼
 << 
¡©eup
 << '\t' << 
¡©edown
 << '\n';

224 
throw
;

226  
Œue
;

227 
	}
}

229 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wUnifÜmizedSub¡™utiÚNumb”
(
¡©eup
, 
¡©edown
) {

231 
Z
 = 
	`G‘Fš™eTimeT¿ns™iÚProb
(
¡©eup
,
¡©edown
);

232 
efæ’gth
 = 
	`G‘R©e
(è* 
	`G‘Time
();

233 
mu
 = 
	`G‘SubM©rix
()->
	`G‘UnifÜmiz©iÚMu
();

234 
çù
 = 
	`exp
(- 
efæ’gth
 * 
mu
);

235 
m
 = 0;

236 
tÙ®
 = (
¡©eup
==
¡©edown
è* 
çù
;

237 
q
 = 
Rªdom
::
	`UnifÜm
(è* 
Z
;

239 (
m
<
SubM©rix
::
UniSubNmax
è&& (
tÙ®
 < 
q
)) {

240 
m
++;

241 
çù
 *ğ
mu
 * 
efæ’gth
 / 
m
;

242 
tÙ®
 +ğ
	`G‘SubM©rix
()->
	`Pow”
(
m
,
¡©eup
,
¡©edown
è* 
çù
;

243 ià((
tÙ®
-
Z
)>1e-12) {

244 
û¼
 << "error in BranchSiteSubstitutionProcess::DrawUniformizedSubstitutionNumber:‚ormalising constant\n";

245 
û¼
 << 
tÙ®
 << '\t' << 
Z
 << '\t' <<otal - Z << '\n';

267  
m
;

268 
	}
}

271 
šlše
 
	gB¿nchS™eSub¡™utiÚProûss
::
	$D¿wUnifÜmizedT¿ns™iÚ
(
¡©e
, 
¡©edown
, 
n
) {

273 * 
p
 = 
Ãw
 [
	`G‘N¡©e
()];

274 
tÙ
 = 0;

275 
l
=0;†<
	`G‘N¡©e
();†++) {

276 
tÙ
 +ğ
	`G‘SubM©rix
()->
	`Pow”
(1,
¡©e
,
l
è* G‘SubM©rix()->Pow”(
n
,l,
¡©edown
);

277 
p
[
l
] = 
tÙ
;

280 
s
 = 
tÙ
 * 
Rªdom
::
	`UnifÜm
();

281 
k
 = 0;

282 (
k
<
	`G‘N¡©e
()è&& (
s
 > 
p
[k])) {

283 
k
++;

285 ià(
k
 =ğ
	`G‘N¡©e
()) {

286 
û¼
 << "error in BranchSiteSubstitutionProcess::DrawUniformizedTransition: overflow\n";

287 
throw
;

289 
d–‘e
[] 
p
;

290  
k
;

291 
	}
}

	@BrownianBridge.cpp

1 
	~"BrownŸnBridge.h
"

4 
	gBrownŸnBridge
::
nT»eSegm’ts
 = 0;

5 
Segm’tiÚ
 
	gBrownŸnBridge
::
£gm’tiÚ
 = 
SEGM_ABSOLUTE
;

7 
	gBrownŸnBridge
::
	$BrownŸnBridge
() {

8 
bridge
 = 0;

9 
£gm’tL’gth
 = 0;

10 
	}
}

13 
	gBrownŸnBridge
::
	$BrownŸnBridge
(
šš™Age
, 
šfš®Age
, 
CovM©rix
 
šun™V¬Ÿnû
, 
šnSegm’ts
, * 
š£gm’tL’gth
) {

14 
bridge
 = 0;

15 
£gm’tL’gth
 = 0;

17 if(
nT»eSegm’ts
==0) {

18 
û¼
 << "E¼Ü : BrownŸnBridge::nT»eSegm’t ha nÙ b“Àš™Ÿlized" << 
’dl
;

19 
	`ex™
(0);

22 
š™Age
 = 
šš™Age
;

23 
fš®Age
 = 
šfš®Age
;

24 
Ëngth
 = 
š™Age
-
fš®Age
;

26 
nSegm’ts
 = 
šnSegm’ts
;

27 
£gm’tL’gth
 = 
Ãw
 [
nSegm’ts
];

28 
i
=0; i<
nSegm’ts
; i++)

29 
£gm’tL’gth
[
i
] = 
š£gm’tL’gth
[i];

30 
un™V¬Ÿnû
 = 
šun™V¬Ÿnû
;

31 
dim
 = 
un™V¬Ÿnû
.
	`G‘Dim
();

32 
bridge
 = 0;

34 
	}
}

36 
	gBrownŸnBridge
::
	$BrownŸnBridge
(cÚ¡ 
BrownŸnBridge
& 
äom
) {

37 
nSegm’ts
 = 
äom
.nSegments;

38 
š™Age
 = 
äom
.initAge;

39 
fš®Age
 = 
äom
.finalAge;

40 
Ëngth
 = 
äom
.length;

41 
un™V¬Ÿnû
 = 
äom
.unitVariance;

42 
dim
 = 
äom
.dim;

43 
bridge
 = 
	`ü—‹Bridge
();

44 
i
=0; i<
nSegm’ts
+1; i++) {

45 
j
=0; j<
dim
; j++)

46 
bridge
[
i
][
j
] = 
äom
.bridge[i][j];

48 
£gm’tL’gth
 = 
Ãw
 [
nSegm’ts
];

49 
i
=0; i<
nSegm’ts
; i++)

50 
£gm’tL’gth
[
i
] = 
äom
.segmentLength[i];

52 
	}
}

54 
	gBrownŸnBridge
::
İ”©Ü
=(cÚ¡ 
BrownŸnBridge
& 
äom
) {

56 
»moveBridge
(
bridge
);

57 if(
	g£gm’tL’gth
)

58 
	gd–‘e
[] 
	g£gm’tL’gth
;

60 
	gnSegm’ts
 = 
äom
.
nSegm’ts
;

61 
	gš™Age
 = 
äom
.
š™Age
;

62 
	gfš®Age
 = 
äom
.
fš®Age
;

63 
	gËngth
 = 
äom
.
Ëngth
;

64 
	gun™V¬Ÿnû
 = 
äom
.
un™V¬Ÿnû
;

65 
	gdim
 = 
äom
.
dim
;

66 
	gbridge
 = 
ü—‹Bridge
();

67 
	gi
=0; i<
	gnSegm’ts
+1; i++) {

68 
	gj
=0; j<
	gdim
; j++)

69 
	gbridge
[
i
][
j
] = 
äom
.
bridge
[i][j];

71 
	g£gm’tL’gth
 = 
Ãw
 [
nSegm’ts
];

72 
	gi
=0; i<
	gnSegm’ts
; i++)

73 
	g£gm’tL’gth
[
i
] = 
äom
.
£gm’tL’gth
[i];

79 
	gBrownŸnBridge
::~
	$BrownŸnBridge
()

81 
	`»moveBridge
(
bridge
);

82 if(
£gm’tL’gth
) {

83 
d–‘e
[] 
£gm’tL’gth
;

85 
	}
}

88 
	gBrownŸnBridge
::
	$budSegm’ts
() {

90 
Ëngth
 = 
š™Age
-
fš®Age
;

92 if(
£gm’tiÚ
 =ğ
SEGM_REGULAR
)

93 
	`budReguÏrSegm’ts
();

95 
	`budAbsŞu‹Segm’ts
();

97 
	}
}

99 
	gBrownŸnBridge
::
	$budReguÏrSegm’ts
() {

101 
nSegm’ts
 = (è(
nT»eSegm’ts
*
Ëngth
);

103 if(
£gm’tL’gth
)

104 
d–‘e
[] 
£gm’tL’gth
;

105 if(
nSegm’ts
<3) {

106 
nSegm’ts
=3;

108 
£gm’tL’gth
 = 
Ãw
 [
nSegm’ts
];

109 
i
=0; i<
nSegm’ts
; i++) {

110 
£gm’tL’gth
[
i
] = 
Ëngth
/
nSegm’ts
;

113 
	}
}

114 
	gBrownŸnBridge
::
	$budAbsŞu‹Segm’ts
() {

116 
fœ¡Pošt
 = ((è
	`æoÜ
(
nT»eSegm’ts
 * 
š™Age
)) /‚TreeSegments;

117 
Ï¡Pošt
 = ((è
	`û
(
nT»eSegm’ts
 * 
fš®Age
)) /‚TreeSegments;

120 
d
 = (
fœ¡Pošt
-
Ï¡Pošt
)*
nT»eSegm’ts
;

121 
nSegm’ts
 = (è(
d
-
	`æoÜ
(d)<0.1 ? floÜ(dè: 
	`û
(d));

123 if(
š™Age
-
fœ¡Pošt
 > 10e-10)

124 
nSegm’ts
++;

125 if(
Ï¡Pošt
-
fš®Age
 > 10e-10)

126 
nSegm’ts
++;

128 ià(! 
nSegm’ts
) {

129 
nSegm’ts
++;

132 if(
£gm’tL’gth
)

133 
d–‘e
[] 
£gm’tL’gth
;

143 
£gm’tL’gth
 = 
Ãw
 [
nSegm’ts
];

145 if(
nSegm’ts
>1) {

147 
i
=0; i<
nSegm’ts
; i++) {

148 
£gm’tL’gth
[
i
] = 1.0/
nT»eSegm’ts
;

150 if(
š™Age
-
fœ¡Pošt
 > 10e-10)

151 
£gm’tL’gth
[0] = 
š™Age
 - 
fœ¡Pošt
;

152 if(
Ï¡Pošt
-
fš®Age
 > 10e-10)

153 
£gm’tL’gth
[
nSegm’ts
-1] = 
Ï¡Pošt
 - 
fš®Age
;

156 
£gm’tL’gth
[0] = 
Ëngth
;

160 
	}
}

162 
	gBrownŸnBridge
::
	$£tUn™V¬Ÿnû
(
CovM©rix
 
šun™V¬Ÿnû
) {

163 
un™V¬Ÿnû
 = 
šun™V¬Ÿnû
;

164 
dim
 = 
un™V¬Ÿnû
.
	`G‘Dim
();

165 
	}
}

168 
	gBrownŸnBridge
::
	$£tAges
(
šš™Age
, 
šfš®Age
, 
boŞ
 
»compu‹NSegm’ts
) {

169 
š™Age
 = 
šš™Age
;

170 
fš®Age
 = 
šfš®Age
;

171 if(
»compu‹NSegm’ts
) {

172 if(
nT»eSegm’ts
==0) {

173 
û¼
 << "E¼Ü : BrownŸnBridge::nT»eSegm’t ha nÙ b“Àš™Ÿlized" << 
’dl
;

174 
	`ex™
(0);

176 
	`»moveBridge
(
bridge
);

177 
	`budSegm’ts
();

180 
´İ
 = (
š™Age
-
fš®Age
)/
Ëngth
;

181 
Ëngth
*=
´İ
;

182 
i
=0; i<
nSegm’ts
; i++) {

183 
£gm’tL’gth
[
i
]*=
´İ
;

188 if(
Ëngth
 <1e-12) {

189 
Ëngth
 = 1e-8;

196 
	}
}

198 
	gBrownŸnBridge
::
	$g‘MaxV®ue
() {

199 
v®ue
 = 0;

200 
i
=0; i<
nSegm’ts
; i++) {

201 
m—n
 = 0;

202 
j
=0; j<
dim
; j++)

203 
m—n
+=
bridge
[
i
][
j
];

204 
m—n
/=
dim
;

205 
v®ue
 = v®u< 
m—n
 ? mean : value;

207  
v®ue
;

208 
	}
}

210 
	gBrownŸnBridge
::
	$g‘LogProb
() {

212 ** 
´ec
 = 
un™V¬Ÿnû
.
	`G‘InvM©rix
();

213 
logD‘
 = -
un™V¬Ÿnû
.
	`G‘LogD‘”mšªt
();

215 
log´ob
 = 0;

217 
i
=0; i<
nSegm’ts
; i++) {

218 
log´ob
 +ğ
	`logProbNÜm®
(
bridge
[
i
+1], bridge[i], 
£gm’tL’gth
[i], 
´ec
, 
logD‘
);

221 
log´ob
 -ğ
	`logProbNÜm®
(
bridge
[
nSegm’ts
], bridge[0], 
Ëngth
, 
´ec
, 
logD‘
);

222  
log´ob
;

224 
	}
}

226 
	gBrownŸnBridge
::
	$g‘LogProb
(
CovM©rix
& 
cov¬
) {

228 ** 
´ec
 = 
cov¬
.
	`G‘InvM©rix
();

229 
logD‘
 = -
cov¬
.
	`G‘LogD‘”mšªt
();

231 
log´ob
 = 0;

233 
i
=0; i<
nSegm’ts
; i++) {

234 
log´ob
 +ğ
	`logProbNÜm®
(
bridge
[
i
+1], bridge[i], 
£gm’tL’gth
[i], 
´ec
, 
logD‘
);

237 
log´ob
 -ğ
	`logProbNÜm®
(
bridge
[
nSegm’ts
], bridge[0], 
Ëngth
, 
´ec
, 
logD‘
);

238  
log´ob
;

240 
	}
}

242 
	gBrownŸnBridge
::
	$Shiá
(
BrownŸnBridge
* 
Ùh”
, 
tunšg
) {

244 
i
=0; i<
nSegm’ts
+1; i++) {

245 
j
=0; j<
dim
; j++)

246 
bridge
[
i
][
j
] +ğ
tunšg
 * 
Ùh”
->bridge[i][j];

248 
	}
}

250 
	gBrownŸnBridge
::
	$g‘LogProbSubBridge
(
beg
, 
’d
) {

251 ** 
´ec
 = 
un™V¬Ÿnû
.
	`G‘InvM©rix
();

252 
logD‘
 = -
un™V¬Ÿnû
.
	`G‘LogD‘”mšªt
();

254 
log´ob
 = 0;

255 
subËngth
 = 0;

256 
i
=
beg
; i<
’d
; i++) {

257 
log´ob
 +ğ
	`logProbNÜm®
(
bridge
[
i
+1], bridge[i], 
£gm’tL’gth
[i], 
´ec
, 
logD‘
);

258 
subËngth
+=
£gm’tL’gth
[
i
];

262 
log´ob
 -ğ
	`logProbNÜm®
(
bridge
[
’d
], bridge[
beg
], 
subËngth
, 
´ec
, 
logD‘
);

263  
log´ob
;

264 
	}
}

267 
	gBrownŸnBridge
::
	$logProbNÜm®
(* 
x
, * 
m—n
, 
¦’gth
, ** 
´ec
, 
logP»cD‘
) {

269 if(
¦’gth
==0) {

270 
û¼
 << "E¼Ü :‚uÎ segm’ˆÜ bridgËngth" << 
’dl
;

271 
throw
 0;

274 
v®ue
 = -0.5*
dim
*
	`log
(2*
Pi
);

275 
v®ue
+ğ0.5*(
logP»cD‘
-
dim
*
	`log
(
¦’gth
));

276 
i
=0; i<
dim
; i++)

277 
j
=0; j<
dim
; j++) {

278 
v®ue
-ğ0.5*
´ec
[
i
][
j
]*(
x
[i]-
m—n
[i])*(x[j]-m—n[j])/
¦’gth
;

281  
v®ue
;

282 
	}
}

286 
	gBrownŸnBridge
::
	$g’”©eBridge
() {

289 
	`»moveBridge
(
bridge
);

291 
bridge
 = 
	`ü—‹Bridge
();

293 
j
=0; j<
dim
; j++) {

294 
bridge
[0][
j
]= 0;

295 
bridge
[
nSegm’ts
][
j
]= 0;

297 
ËngthRight
 = 
Ëngth
;

298 if(
Ëngth
 <1e-10) {

299 
ËngthRight
 = 1e-8;

305 
i
=0; i<
nSegm’ts
-1; i++) {

307 
R—lVeùÜ
 
	`veùÜM—n
(
bridge
[
i
], 
dim
);

308 
veùÜM—n
.
	`SÿÏrMuÉliÿtiÚ
((
ËngthRight
-
£gm’tL’gth
[
i
])/lengthRight);

310 
poštV¬Ÿnû
 = 
£gm’tL’gth
[
i
]*(
ËngthRight
-segmentLength[i])/lengthRight;

312 
un™V¬Ÿnû
.
	`d¿wV®
(
bridge
[
i
+1]);

314 
j
=0; j<
dim
; j++)

315 
bridge
[
i
+1][
j
] = bridge[i+1][j]*
	`sq¹
(
poštV¬Ÿnû
)+
veùÜM—n
[j];

317 
ËngthRight
-=
£gm’tL’gth
[
i
];

322 
	}
}

324 
	gBrownŸnBridge
::
	$g’”©eSubBridge
(
beg
, 
’d
) {

326 if(
beg
 <0 || beg > 
’d
 ||ƒnd>
nSegm’ts
) {

327 
û¼
 << "E¼Ü iÀg’”©eSubBridg: " << 
’dl
;

328 
û¼
 << "beg = " << 
beg
 << " ;ƒnd = " << 
’d
 << " ;‚Segm’t ğ" << 
nSegm’ts
 << 
’dl
;

329 
	`ex™
(1);

332 
ËngthRight
 = 0;

333 
i
=
beg
; i<
’d
; i++)

334 
ËngthRight
 +ğ
£gm’tL’gth
[
i
];

336 
i
=
beg
; i<
’d
-1; i++) {

338 * 
veùÜM—n
 = 
Ãw
 [
dim
];

339 
j
=0; j<
dim
; j++) {

340 
veùÜM—n
[
j
] = ((
ËngthRight
-
£gm’tL’gth
[
i
])*
bridge
[i][j] + segm’tL’gth[i]*bridge[
’d
][j]) /†engthRight;

343 
poštV¬Ÿnû
 = 
£gm’tL’gth
[
i
]*(
ËngthRight
-segmentLength[i])/lengthRight;

345 
un™V¬Ÿnû
.
	`d¿wV®
(
bridge
[
i
+1]);

347 
j
=0; j<
dim
; j++)

348 
bridge
[
i
+1][
j
] = bridge[i+1][j]*
	`sq¹
(
poštV¬Ÿnû
)+
veùÜM—n
[j];

350 
ËngthRight
-=
£gm’tL’gth
[
i
];

351 
d–‘e
[] 
veùÜM—n
;

355 
	}
}

357 
	gBrownŸnBridge
::
	$showBridge
() {

358 
i
=0; i<
nSegm’ts
+1; i++) {

359 
j
=0; j<
dim
; j++) {

360 
cout
 << 
bridge
[
i
][
j
] << ";";

362 
cout
 << 
’dl
;

364 
	}
}

367 
	gBrownŸnBridge
::
	$Prİo£Move
(
tunšg
) {

369 
CovM©rix
 
Ùh”V¬
 = 
un™V¬Ÿnû
;

371 
Ùh”V¬
*=
tunšg
;

372 
BrownŸnBridge
 *
Ùh”
 = 
Ãw
 
	`BrownŸnBridge
(
š™Age
, 
fš®Age
, 
Ùh”V¬
, 
nSegm’ts
, 
£gm’tL’gth
);

373 
Ùh”
->
	`g’”©eBridge
();

374 
i
=0; i<
nSegm’ts
+1; i++) {

375 
j
=0; j<
dim
; j++)

376 
bridge
[
i
][
j
]+=
Ùh”
->bridge[i][j];

378 
d–‘e
 
Ùh”
;

380 
	}
}

382 
	gBrownŸnBridge
::
	$Prİo£Move
(
tunšg
, 
CovM©rix
& 
Ùh”V¬
) {

384 
Ùh”V¬
*=
tunšg
;

385 
BrownŸnBridge
 *
Ùh”
 = 
Ãw
 
	`BrownŸnBridge
(
š™Age
, 
fš®Age
, 
Ùh”V¬
, 
nSegm’ts
, 
£gm’tL’gth
);

386 
Ùh”
->
	`g’”©eBridge
();

387 
i
=0; i<
nSegm’ts
+1; i++) {

388 
j
=0; j<
dim
; j++)

389 
bridge
[
i
][
j
]+=
Ùh”
->bridge[i][j];

391 
d–‘e
 
Ùh”
;

392 
Ùh”V¬
*ğ1.0 / 
tunšg
;

394 
	}
}

396 
	gBrownŸnBridge
::
	$Sim¶ePrİo£Move
(
tunšg
) {

398 
CovM©rix
 
Ùh”V¬
 = 
un™V¬Ÿnû
;

399 
Ùh”V¬
.
	`S‘Id’t™y
();

400 
Ùh”V¬
*=
tunšg
;

401 
BrownŸnBridge
 *
Ùh”
 = 
Ãw
 
	`BrownŸnBridge
(
š™Age
, 
fš®Age
, 
Ùh”V¬
, 
nSegm’ts
, 
£gm’tL’gth
);

402 
Ùh”
->
	`g’”©eBridge
();

403 
i
=0; i<
nSegm’ts
+1; i++) {

404 
j
=0; j<
dim
; j++)

405 
bridge
[
i
][
j
]+=
Ùh”
->bridge[i][j];

407 
d–‘e
 
Ùh”
;

409 
	}
}

411 
	gBrownŸnBridge
::
	$g‘IÁeg¿l
(
·¿m
, 
š™V®ue
, 
fš®V®ue
) {

413 
d–V®ue
 = 
fš®V®ue
-
š™V®ue
;

414 
š‹g¿l
 = 0.5*(
£gm’tL’gth
[0] + segm’tL’gth[
nSegm’ts
-1]*
	`exp
(
d–V®ue
));

415 
cumuÏ‹L’gth
 = 
£gm’tL’gth
[0];

416 
i
=1; i<
nSegm’ts
; i++) {

417 
š‹g¿l
 +ğ0.5*(
£gm’tL’gth
[
i
-1]+£gm’tL’gth[i]è* 
	`exp
(
bridge
[i][
·¿m
]è*ƒxp(
d–V®ue
*
cumuÏ‹L’gth
/
Ëngth
);

418 
cumuÏ‹L’gth
+=
£gm’tL’gth
[
i
];

420 
š‹g¿l
 *ğ
	`exp
(
š™V®ue
);

422  
š‹g¿l
;

423 
	}
}

425 
	gBrownŸnBridge
::
	$LeáMuÉly
(** 
P
) {

427 * 
aux
 = 
Ãw
 [
dim
];

428 
t
=0;<=
nSegm’ts
;++) {

429 
i
=0; i<
dim
; i++) {

430 
tmp
 = 0;

431 
j
=0; j<
dim
; j++) {

432 
tmp
 +ğ
P
[
i
][
j
] * 
bridge
[
t
][j];

434 
aux
[
i
] = 
tmp
;

436 
i
=0; i<
dim
; i++) {

437 
bridge
[
t
][
i
] = 
aux
[i];

440 
d–‘e
[] 
aux
;

441 
	}
}

443 ** 
	gBrownŸnBridge
::
	$ü—‹Bridge
(
N
) {

444 
N
 = (N==-1 ? 
nSegm’ts
 : N);

446 ** 
b
 = 
Ãw
 *[
N
+1];

447 
i
=0; i<
N
+1; i++)

448 
b
[
i
] = 
Ãw
 [
dim
];

449  
b
;

450 
	}
}

452 
	gBrownŸnBridge
::
	$»moveBridge
(** 
b
, 
N
) {

453 
N
 = (N==-1 ? 
nSegm’ts
 : N);

454 if(
b
) {

455 
i
=0; i<
N
+1; i++)

456 
d–‘e
[] 
b
[
i
];

457 
d–‘e
[] 
b
;

458 
b
 = 0;

460 
	}
}

463 
	gBrownŸnBridge
::
	$fšdPoštBefÜe
(
time
, &
timeBefÜe
, * &
v®ueBefÜe
) {

464 if(
time
 > 
š™Age
) {

465 
û¼
 << "E¼Ü :ryšgØfšd‡imbefÜthbegšnšg oà¨b¿nch" << 
’dl
;

466 
	`ex™
(0);

469 
n
=0;

470 
t
 = 
š™Age
;

472 
n
<
nSegm’ts
 && 
t
-
£gm’tL’gth
[n]-10e-8 > 
time
) {

473 
t
-=
£gm’tL’gth
[
n
];

474 
n
++;

478 
timeBefÜe
 = 
t
;

479 
v®ueBefÜe
 = 
bridge
[
n
];

483 
	}
}

486 
	gBrownŸnBridge
::
	$fšdPoštAá”
(
time
, &
timeAá”
, * &
v®ueAá”
) {

487 if(
time
 < 
fš®Age
) {

488 
û¼
 << "E¼Ü :ryšgØfšd‡imaá”h’d oà¨b¿nch" << 
’dl
;

489 
	`ex™
(0);

493 
n
=
nSegm’ts
;

494 
t
 = 
fš®Age
;

495 
n
>0 && 
t
+
£gm’tL’gth
[n-1] < 
time
-10e-8) {

496 
t
+=
£gm’tL’gth
[
n
-1];

497 
n
--;

500 
timeAá”
 = 
t
;

501 
v®ueAá”
 = 
bridge
[
n
];

502 
	}
}

505 
	gBrownŸnBridge
::
	$fšdPoštBefÜe
(
time
) {

506 if(
time
 > 
š™Age
) {

507 
û¼
 << "E¼Ü :ryšgØfšd‡imbefÜthbegšnšg oà¨b¿nch" << 
’dl
;

508 
	`ex™
(0);

511 
n
=0;

512 
t
 = 
š™Age
;

514 
n
<
nSegm’ts
 && 
t
-
£gm’tL’gth
[n]-10e-8 > 
time
) {

515 
t
-=
£gm’tL’gth
[
n
];

516 
n
++;

521  
n
;

522 
	}
}

525 
	gBrownŸnBridge
::
	$fšdPoštAá”
(
time
) {

526 if(
time
 < 
fš®Age
) {

527 
û¼
 << "E¼Ü :ryšgØfšd‡imaá”h’d oà¨b¿nch" << 
’dl
;

528 
	`ex™
(0);

532 
n
=
nSegm’ts
;

533 
t
 = 
fš®Age
;

534 
n
>0 && 
t
+
£gm’tL’gth
[n-1] < 
time
-10e-8) {

535 
t
+=
£gm’tL’gth
[
n
-1];

536 
n
--;

540  
n
;

541 
	}
}

544 
	gBrownŸnBridge
::
	$addSlİe
(* 
š™V®ue
, * 
fš®V®ue
) {

546 if(
	`abs
(
bridge
[0][0])>10e-10 ||‡bs(bridge[
nSegm’ts
][0])>10e-10) {

547 
û¼
 << "Bridg¦İ”rÜ (addšg)" << 
’dl
;

548 
û¼
 << 
bridge
[0][0] << " " << bridge[
nSegm’ts
][0] << 
’dl
;

549 
	`ex™
(0);

552 
ËngthLeá
 = 0;

553 
i
=0; i<
nSegm’ts
; i++) {

554 
j
=0; j<
dim
; j++)

555 
bridge
[
i
][
j
] +ğ
š™V®ue
[j] + 
ËngthLeá
*(
fš®V®ue
[j]-š™V®ue[j])/
Ëngth
;

556 
ËngthLeá
+=
£gm’tL’gth
[
i
];

558 
j
=0; j<
dim
; j++)

559 
bridge
[
nSegm’ts
][
j
] = 
fš®V®ue
[j];

560 
	}
}

563 
	gBrownŸnBridge
::
	$»moveSlİe
() {

565 
ËngthLeá
 = 0;

566 *
š™V®ue
 = 
Ãw
 [
dim
];

567 
j
=0; j<
dim
; j++)

568 
š™V®ue
[
j
] = 
bridge
[0][j];

570 
i
=0; i<
nSegm’ts
; i++) {

571 
j
=0; j<
dim
; j++)

572 
bridge
[
i
][
j
] = bridge[i][j] - 
š™V®ue
[j] - 
ËngthLeá
*(bridge[
nSegm’ts
][j]-š™V®ue[j])/
Ëngth
;

573 
ËngthLeá
+=
£gm’tL’gth
[
i
];

575 
j
=0; j<
dim
; j++)

576 
bridge
[
nSegm’ts
][
j
] = 0;

578 if(
	`abs
(
bridge
[0][0])>10e-10 ||‡bs(bridge[
nSegm’ts
][0])>10e-10) {

579 
û¼
 << "Bridg¦İ”rÜ (»movšg)" << 
’dl
;

580 
û¼
 << 
bridge
[0][0] << " " << bridge[
nSegm’ts
][0] << " " <<‚Segm’t << 
’dl
;

581 
	`ex™
(0);

584 
d–‘e
[] 
š™V®ue
;

585 
	}
}

590 
	gBrownŸnBridge
::
	$š™AgeMove
(
ÃwAge
, *
š™V®
) {

591 if(
£gm’tiÚ
!=
SEGM_ABSOLUTE
) {

592 
û¼
 << "E¼Ü : hÜizÚÈmovw™h‚Ú‡bsŞu‹ segm’tiÚ" << 
’dl
;

593 
	`ex™
(0);

595 
ha¡šgs
 = 0;

597 
Œy
 {

598 
ha¡šgs
+=
	`g‘LogProbSubBridge
(0, 
	`fšdPoštAá”
(
š™Age
<
ÃwAge
 ? initAge :‚ewAge));

600 
	`ÿtch
(
i
) {

601 
û¼
 << "š™‡gmov- fœ¡" << 
’dl
;

602 
û¼
 << 0 << " " << 
	`fšdPoštAá”
(
š™Age
<
ÃwAge
 ? in™Ag:‚ewAgeè<< 
’dl
;

603 
	`ex™
(0);

605 
ŞdNSegm’ts
 = 
nSegm’ts
;

606 
ŞdAge
 = 
š™Age
;

607 
š™Age
 = 
ÃwAge
;

608 
	`budSegm’ts
();

610 ** 
ŞdBridge
 = 
bridge
;

611 
bridge
 = 
	`ü—‹Bridge
();

613 
j
=0; j<
dim
; j++)

614 
bridge
[0][
j
] = 
š™V®
[j];

616 if(
ÃwAge
 > 
ŞdAge
) {

617 
i
=1; i<
ŞdNSegm’ts
+1; i++) {

618 
j
=0; j<
dim
; j++)

619 
bridge
[
i
+
nSegm’ts
-
ŞdNSegm’ts
][
j
] = 
ŞdBridge
[i][j];

622 
	`g’”©eSubBridge
(0, 
nSegm’ts
-
ŞdNSegm’ts
+1);

623 
Œy
 {

624 
ha¡šgs
-=
	`g‘LogProbSubBridge
(0, 
nSegm’ts
-
ŞdNSegm’ts
+1);

626 
	`ÿtch
(
i
) {

627 
û¼
 << "š™‡gmov- secÚd" << 
’dl
;

628 
û¼
 << 0 << " " << 
nSegm’ts
-
ŞdNSegm’ts
+1 << 
’dl
;

629 
	`ex™
(0);

636 
i
=1; i<
nSegm’ts
+1; i++) {

637 
j
=0; j<
dim
; j++)

638 
bridge
[
i
][
j
] = 
ŞdBridge
[i+
ŞdNSegm’ts
-
nSegm’ts
][j];

642 
	`»moveBridge
(
ŞdBridge
, 
ŞdNSegm’ts
);

644  
ha¡šgs
;

646 
	}
}

647 
	gBrownŸnBridge
::
	$fš®AgeMove
(
ÃwAge
, *
fš®V®
) {

648 if(
£gm’tiÚ
!=
SEGM_ABSOLUTE
) {

649 
û¼
 << "E¼Ü : hÜizÚÈmovw™h‚Ú‡bsŞu‹ segm’tiÚ" << 
’dl
;

650 
	`ex™
(0);

652 
ha¡šgs
 = 0;

653 
Œy
 {

654 
ha¡šgs
+=
	`g‘LogProbSubBridge
(
	`fšdPoštBefÜe
(
fš®Age
>
ÃwAge
 ? fš®Ag:‚ewAge), 
nSegm’ts
);

656 
	`ÿtch
(
i
) {

657 
û¼
 << "fš®‡gmov- fœ¡" << 
’dl
;

658 
û¼
 << 
	`fšdPoštBefÜe
(
fš®Age
>
ÃwAge
 ? fš®Ag:‚ewAgeè<< " " << 
nSegm’ts
 << 
’dl
;

659 
	`ex™
(0);

662 
ŞdNSegm’ts
 = 
nSegm’ts
;

663 
ŞdAge
 = 
fš®Age
;

664 
fš®Age
 = 
ÃwAge
;

665 
	`budSegm’ts
();

667 ** 
ŞdBridge
 = 
bridge
;

668 
bridge
 = 
	`ü—‹Bridge
();

670 
j
=0; j<
dim
; j++)

671 
bridge
[
nSegm’ts
][
j
] = 
fš®V®
[j];

672 if(
ÃwAge
 < 
ŞdAge
) {

675 
i
=0; i<
ŞdNSegm’ts
; i++) {

676 
j
=0; j<
dim
; j++)

677 
bridge
[
i
][
j
] = 
ŞdBridge
[i][j];

681 
	`g’”©eSubBridge
(
ŞdNSegm’ts
-1, 
nSegm’ts
);

682 
Œy
 {

683 
ha¡šgs
-=
	`g‘LogProbSubBridge
(
ŞdNSegm’ts
-1, 
nSegm’ts
);

685 
	`ÿtch
(
i
) {

686 
û¼
 << "fš®‡gmov- secÚd" << 
’dl
;

687 
û¼
 << 
ŞdNSegm’ts
-1 << " " << 
nSegm’ts
 << 
’dl
;

688 
	`ex™
(0);

694 
i
=0; i<
nSegm’ts
; i++) {

695 
j
=0; j<
dim
; j++)

696 
bridge
[
i
][
j
] = 
ŞdBridge
[i][j];

700 
	`»moveBridge
(
ŞdBridge
, 
ŞdNSegm’ts
);

702  
ha¡šgs
;

703 
	}
}

	@BrownianBridge.h

2 #iâdeà
BROWNIANBRIDGE_H


3 
	#BROWNIANBRIDGE_H


	)

5 
	~"Rªdom.h
"

6 
	~"CovM©rix.h
"

8 
	eSegm’tiÚ
 {
	mSEGM_REGULAR
, 
	mSEGM_ABSOLUTE
};

10 şas 
	cBrownŸnBridge
 {

12 
	mpublic
:

13 
BrownŸnBridge
();

14 
BrownŸnBridge
(
šš™Age
, 
šfš®Age
, 
CovM©rix
 
v¬Ÿnû
, 
šnSegm’ts
, * 
š£gm’tL’gth
);

15 
BrownŸnBridge
(cÚ¡ BrownŸnBridge& 
äom
);

16 
	mvœtu®
 ~
BrownŸnBridge
();

18 
	mİ”©Ü
=(cÚ¡ 
BrownŸnBridge
& 
äom
);

19 * 
	mİ”©Ü
[](
	mi
){ 
	mbridge
[
i
];}

21 
vœtu®
 
budSegm’ts
();

22 
vœtu®
 
budReguÏrSegm’ts
();

23 
vœtu®
 
budAbsŞu‹Segm’ts
();

25 
£tAges
(
šš™Age
, 
šfš®Age
, 
boŞ
 
»compu‹NSegm’ts
);

26 
	$g‘L’gth
(è{ 
Ëngth
;
	}
}

27 
	$g‘Segm’tL’gth
(
i
è{ 
£gm’tL’gth
[i];
	}
}

28 * 
	$g‘Segm’tL’gth
(è{ 
£gm’tL’gth
;
	}
}

30 
£tUn™V¬Ÿnû
(
CovM©rix
 
un™V¬Ÿnû
);

31 
	gCovM©rix
& 
	$g‘Un™V¬Ÿnû
(è{ 
un™V¬Ÿnû
;
	}
};

32 ** 
	$g‘Bridge
(è{ 
bridge
;
	}
}

33 
	$g‘NSegm’ts
(è{ 
nSegm’ts
;
	}
}

34 
	$g‘Dim
(è{ 
dim
;
	}
}

35 
	$g‘In™Age
(è{ 
š™Age
;
	}
}

36 
	$g‘Fš®Age
(è{ 
fš®Age
;
	}
}

38 
	$g‘V®ue
(
node
, 
·¿m
è{ 
bridge
[node][·¿m];
	}
}

39 
	$İ”©Ü
()(
node
, 
·¿m
è{ 
	`g‘V®ue
Òode,·¿m);
	}
}

41 
g‘MaxV®ue
();

42 
logProbNÜm®
(* 
x
, * 
m—n
, 
¦’gth
, ** 
´ec
, 
logP»cD‘
);

43 
g‘LogProb
();

44 
g‘LogProb
(
CovM©rix
& 
cov¬
);

45 
g‘LogProbSubBridge
(
beg
, 
’d
);

47 
g’”©eBridge
();

48 
g’”©eSubBridge
(
beg
, 
’d
);

49 
	$£tBridge
(** 
šBridge
è{
bridge
 = inBridge;
	}
}

50 
showBridge
();

52 
vœtu®
 
Prİo£Move
(
tunšg
);

53 
vœtu®
 
Prİo£Move
(
tunšg
, 
CovM©rix
& 
Ùh”v¬
);

54 
vœtu®
 
Sim¶ePrİo£Move
(
tunšg
);

55 
š™AgeMove
(
ÃwAge
, * 
š™V®
);

56 
fš®AgeMove
(
ÃwAge
, * 
fš®V®
);

58 
vœtu®
 
g‘IÁeg¿l
(
·¿m
, 
š™V®ue
, 
fš®V®ue
);

60 
Shiá
(
BrownŸnBridge
* 
bridge
, 
tunšg
);

62 
LeáMuÉly
(** 
P
);

64 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, cÚ¡ 
	gBrownŸnBridge
& 
	gr
) {

68 
	gos
 << 
	gr
.
	gnSegm’ts
 << '\t' <<„.
	gš™Age
 << '\t' <<„.
	gfš®Age
 << '\t' <<„.
	gdim
;

70 
	gi
=0; i<
	gr
.
	gnSegm’ts
; i++) {

71 
	gos
 << '\t' << 
	gr
.
	g£gm’tL’gth
[
i
];

74 
	gi
=0; i<
	gr
.
	gnSegm’ts
+1; i++)

75 
	gj
=0; j<
	gr
.
	gdim
; j++)

76 
	gos
 << '\t' << 
	gr
.
	gbridge
[
i
][
j
];

78  
	gos
;

80 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gBrownŸnBridge
& 
	gr
) {

83 ià(
	gr
.
	gbridge
) {

84 
	gr
.
»moveBridge
(
r
.
bridge
);

86 if(
	gr
.
	g£gm’tL’gth
)

87 
	gd–‘e
[] 
	gr
.
	g£gm’tL’gth
;

89 
	gis
 >> 
	gr
.
	gnSegm’ts
;

90 
	gis
 >> 
	gr
.
	gš™Age
;

91 
	gis
 >> 
	gr
.
	gfš®Age
;

92 
	gis
 >> 
	gr
.
	gdim
;

94 
	gr
.
	gËngth
 = 
r
.
š™Age
-r.
fš®Age
;

96 
	gr
.
	g£gm’tL’gth
 = 
Ãw
 [
r
.
nSegm’ts
];

98 
	gs
=0;

100 
	gi
=0; i<
	gr
.
	gnSegm’ts
; i++) {

101 
	gis
 >> 
	gr
.
	g£gm’tL’gth
[
i
];

102 
	gs
+=
r
.
£gm’tL’gth
[
i
];

105 
	gr
.
	gbridge
 = 
Ãw
 *[
r
.
nSegm’ts
+1];

107 
	gi
=0; i<
	gr
.
	gnSegm’ts
+1; i++) {

108 
	gr
.
	gbridge
[
i
] = 
Ãw
 [
r
.
dim
];

109 
	gj
=0; j<
	gr
.
	gdim
; j++)

110 
	gis
 >> 
	gr
.
	gbridge
[
i
][
j
];

113  
	gis
;

117 
	$£tNT»eSegm’ts
(
šnT»eSegm’ts
è{
nT»eSegm’ts
 = iÂT»eSegm’ts;
	}
}

118 
	$£tSegm’tiÚ
(
Segm’tiÚ
 
š£gm’tiÚ
è{
£gm’tiÚ
 = in£gm’tiÚ;
	}
}

119 
Segm’tiÚ
 
	$g‘Segm’tiÚ
(è{ 
£gm’tiÚ
;
	}
}

122 
fšdPoštBefÜe
(
time
, &
timeBefÜe
, * &
v®ueBefÜe
);

123 
fšdPoštAá”
(
time
, &
timeAá”
, * &
v®ueAá”
);

124 
fšdPoštBefÜe
(
time
);

125 
fšdPoštAá”
(
time
);

127 
addSlİe
(* 
š™V®ue
, * 
fš®V®ue
);

128 
»moveSlİe
();

130 
	$checkL’gth
(cÚ¡ 
_š™Age
, cÚ¡ 
_fš®Age
, cÚ¡ 
_Ëngth
) {

132 if(
	`abs
(
š™Age
-
_š™Age
)>1e-5) {

133 
û¼
 << "E¼Ü iÀbrownŸÀbridg: in™Agdifã»Á fromhchrÚog¿m v®ue" << 
’dl
;

134 
û¼
 << 
š™Age
 << " " << 
_š™Age
 << 
’dl
;

138 if(
	`abs
(
fš®Age
-
_fš®Age
)>1e-5) {

139 
û¼
 << "E¼Ü iÀbrownŸÀbridg: fš®Agdifã»Á fromhchrÚog¿m v®ue" << 
’dl
;

140 
û¼
 << 
fš®Age
 << " " << 
_fš®Age
 << 
’dl
;

144 if(
	`abs
(
š™Age
-
_š™Age
)>1e-5) {

145 
û¼
 << "E¼Ü iÀbrownŸÀbridg:†’gth difã»Á fromhdifã»nû b‘w“ÀthexŒem™› ages" << 
’dl
;

146 
	`ex™
(0);

149 if(
	`abs
(
Ëngth
-(
š™Age
-
fš®Age
))>1e-5) {

150 
û¼
 << "E¼Ü iÀbrownŸÀbridg:†’gth difã»Á fromhdifã»nû b‘w“ÀthexŒem™› ages" << 
’dl
;

151 
	`ex™
(0);

153 if(
	`abs
(
Ëngth
 - 
_Ëngth
) > 1e-5) {

154 
û¼
 << "E¼Ü iÀbrownŸÀbridg:†’gth difã»Á fromhchrÚog¿m v®ue" << 
’dl
;

155 
û¼
 << 
Ëngth
 << " " << 
_Ëngth
 << 
’dl
;

156 
	`ex™
(0);

158 
s
 = 0;

159 
i
=0; i<
nSegm’ts
; i++) {

160 
s
+=
£gm’tL’gth
[
i
];

162 if(
	`abs
(
s
-
Ëngth
)>1e-5) {

163 
û¼
 << "E¼Ü iÀbrownŸÀbridg: b¿nch†’gth difã»Á fromh£gm’ˆËngth sum" << 
’dl
;

164 
û¼
 << 
s
 << " " << 
Ëngth
;

165 
	`ex™
(0);

167 
	}
}

169 
	g´Ùeùed
:

171 ** 
ü—‹Bridge
(
N
 = -1);

172 
»moveBridge
(**
b
, 
N
 = -1);

175 
	gnT»eSegm’ts
;

176 
Segm’tiÚ
 
	g£gm’tiÚ
;

177 
	gnSegm’ts
;

178 
	gdim
;

179 
	gËngth
, 
	gš™Age
, 
	gfš®Age
;

180 
CovM©rix
 
	gun™V¬Ÿnû
;

181 ** 
	gbridge
;

182 * 
	g£gm’tL’gth
;

	@BrownianModel.cpp

1 
	~"BrownŸnMod–.h
"

3 
	gBrownŸnMod–
::~
	$BrownŸnMod–
()

6 
	}
}

8 
BrownŸnMod–
::
	$G‘LogPriÜ
() {

9 
tÙ®
 = 0;

10 
tÙ®
 +ğ
chrÚog¿m
->
	`G‘LogProb
();

11 
tÙ®
 +ğ
sigma
->
	`G‘LogProb
();

12 
tÙ®
 +ğ
brownŸnProûss
->
	`G‘LogProb
();

13 
tÙ®
 +ğ
»Ì©e
->
	`G‘LogProb
();

14 
tÙ®
 +ğ
¡©iÚ¬y
->
	`G‘LogProb
();

15  
tÙ®
;

16 
	}
}

18 
	gBrownŸnMod–
::
	$G‘LogLik–ihood
() {

19 
»t
 = 
phylİroûss
->
	`G‘LogProb
();

20  
»t
;

21 
	}
}

23 
	gBrownŸnMod–
::
	$d¿wSam¶e
() {

24 
chrÚog¿m
->
	`Sam¶e
();

25 
sigma
->
	`Sam¶e
();

26 
brownŸnProûss
->
	`Sam¶e
();

27 
¡©iÚ¬y
->
	`Sam¶e
();

28 
»Ì©e
->
	`Sam¶e
();

29 
phylİroûss
->
	`Sam¶e
();

30 
û¼
 << "ok\n";

31 
	}
}

33 
	gBrownŸnMod–
::
	$MakeScheduËr
() {

35 ià(
·thcÚjug©e
) {

36 if(
commut
)

37 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`DSemiCÚjug©eM­pšgMove
(
phylİroûss
,
commutP©hcÚjŒ“
),1,"mapping + sufficient stat");

38 if(
m­Segm’t
)

39 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`DSemiCÚjug©eM­pšgMove
(
phylİroûss
,
£gm’‹dP©hcÚjŒ“
),1,"mapping + sufficient stat");

41 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`DSemiCÚjug©eM­pšgMove
(
phylİroûss
,
·thcÚjŒ“
),1,"mapping + sufficient stat");

44 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
phylİroûss
,1),1,"mapping");

47 
scheduËr
.
	`O³nLoİ
(100);

49 if(!
fixtimes
) {

50 if(
£gm
 =ğ
SEGM_ABSOLUTE
) {

51 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`BrownŸnHÜizÚlMove
(
chrÚog¿m
, 
brownŸnProûss
, 1), 10, "horizontal move");

52 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`BrownŸnHÜizÚlMove
(
chrÚog¿m
, 
brownŸnProûss
, 0.1), 10, "horizontal move");

53 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`BrownŸnHÜizÚlMove
(
chrÚog¿m
, 
brownŸnProûss
, 0.01), 10, "horizontal move");

56 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
chrÚog¿m
, 1), 10, "chronogram");

57 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
chrÚog¿m
, 0.1), 10, "chronogram");

58 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
chrÚog¿m
, 0.01), 10, "chronogram");

63 ià(
cÚjsigma
 == 2) {

65 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`CÚjug©eBrownŸnEx‹º®Move
(
cÚjug©esigma
, 
cÚjug©eBrownŸnProûss
, 0.1,10) ,1,"External Conjugate Brownian sigma");

66 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`CÚjug©eBrownŸnEx‹º®Move
(
cÚjug©esigma
, 
cÚjug©eBrownŸnProûss
, 0.01,10) ,1,"External Conjugate Brownian sigma");

67 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`CÚjug©eBrownŸnEx‹º®AÎB¿nchMove
(
cÚjug©esigma
, 
cÚjug©eBrownŸnProûss
, 0.1,10) ,1,"External Conjugate Brownian‡ll branch sigma");

68 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`CÚjug©eBrownŸnEx‹º®AÎB¿nchMove
(
cÚjug©esigma
, 
cÚjug©eBrownŸnProûss
, 0.01,10) ,1,"External Conjugate Brownian‡ll branch sigma");

69 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`CÚjug©eBrownŸnEx‹º®AÎB¿nchMove
(
cÚjug©esigma
, 
cÚjug©eBrownŸnProûss
, 0.001,10) ,1,"External Conjugate Brownian‡ll branch sigma");

77 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
brownŸnProûss
->
	`G‘Pu»BrownŸnProûss
(),0.1),10,"PureBrownian");

78 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
brownŸnProûss
->
	`G‘Pu»BrownŸnProûss
(),0.01),10,"PureBrownian");

79 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
brownŸnProûss
->
	`G‘In¡ªtProûss
(),1),10,"InstantValues");

80 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
brownŸnProûss
->
	`G‘In¡ªtProûss
(),0.1),10,"InstantValues");

82 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`BrownŸnSigmaMove
(
sigma
, 
brownŸnProûss
, 0.1), 10, "linear sigma brownian");

83 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`BrownŸnSigmaMove
(
sigma
, 
brownŸnProûss
, 0.01), 10, "linear sigma brownian");

84 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`BrownŸnSigmaMove
(
sigma
, 
brownŸnProûss
, 0.001), 10, "linear sigma brownian");

86 if(
cÚjsigma
) {

87 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`CÚjug©eBrownŸnSigmaMove
(
dyÇmic_ÿ¡
<
CÚjug©eInv”£Wish¬t
*>(
sigma
), 
brownŸnProûss
), 1, "sigma(Gibbs)");

90 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
sigma
,1),100,"sigma");

91 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
sigma
,0.1),100,"sigma");

92 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
sigma
,0.01),100,"sigma");

96 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`ProfeMove
(
»Ì©e
,0.1,1),10,"relrates");

97 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`ProfeMove
(
»Ì©e
,0.03,2),10,"relrates");

98 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
»Ì©e
,0.01),10,"relrates");

100 if(
gc
) {

101 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
roÙGC¿‹
,0.1),10,"rootstat");

102 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
roÙGC¿‹
,0.01),10,"rootstat");

103 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
roÙGC¿‹
,0.001),10,"rootstat");

106 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`ProfeMove
(
¡©iÚ¬y
,0.01,2),10,"stat4");

107 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`ProfeMove
(
¡©iÚ¬y
,0.03,2),10,"stat4");

108 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`ProfeMove
(
¡©iÚ¬y
,0.01,5),10,"stat10");

109 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
¡©iÚ¬y
,0.001),10,"stat");

111 
scheduËr
.
	`Clo£Loİ
();

113 
	}
}

115 
	gBrownŸnMod–
::
	$G‘M—nRho
() {

116  
brownŸnProûss
->
	`G‘M—nR©e
(0);

117 
	}
}

119 
	gBrownŸnMod–
::
	$G‘IÁeg¿lRho
() {

120  
brownŸnProûss
->
	`G‘IÁeg¿lR©e
(0);

121 
	}
}

124 
	gBrownŸnMod–
::
	$G‘V¬Rho
() {

125  
brownŸnProûss
->
	`G‘V¬R©e
(0);

126 
	}
}

129 
	gBrownŸnMod–
::
	$G‘M—nOmega
() {

130  
brownŸnProûss
->
	`G‘M—nR©e
(1);

131 
	}
}

133 
	gBrownŸnMod–
::
	$G‘V¬Omega
() {

134  
brownŸnProûss
->
	`G‘V¬R©e
(1);

135 
	}
}

137 
	gBrownŸnMod–
::
	$G‘M—nGC
() {

138  
brownŸnProûss
->
	`G‘M—nGC
(1);

139 
	}
}

141 
	gBrownŸnMod–
::
	$G‘V¬GC
() {

142  
brownŸnProûss
->
	`G‘V¬GC
(1);

143 
	}
}

145 
	gBrownŸnMod–
::
	$G‘RoÙGC
() {

146  
roÙGC¿‹
->
	`v®
();

147 
	}
}

150 
	gBrownŸnMod–
::
	$T¿ûH—d”
(
o¡»am
& 
os
) {

151 
os
 << "#logprior\tlnL\ttime\tdS";

152 
k
=0; k<
NcÚt
+
L
; k++) {

153 
l
=
k
+1;†<
NcÚt
+
L
;†++) {

154 
os
 << '\t' << "sigma_" << 
k
 << '_' << 
l
;

157 
k
=0; k<
NcÚt
+
L
; k++) {

158 
os
 << '\t' << "sigma_" << 
k
 << '_' << k;

160 
os
 << "\tmeannsub\tminnsub\tmaxnsub\tnonesub\tstatent\trrent\tmeanrho\tvarrho";

162 if(
gc
)

163 
os
 <<"\tmeangc\tvargc\trootgamma";

164 if(
omega
)

165 
os
 <<"\tmeanomega\tvaromega";

167 ià(
gc
 || 
omega
) {

168 
os
 << "\tmeanz\tmaxz";

171 
os
 << '\n';

173 
	}
}

175 
	gBrownŸnMod–
::
	$T¿û
(
o¡»am
& 
os
) {

176 
os
 << 
	`G‘LogPriÜ
(è<< '\t' << 
	`G‘LogLik–ihood
(è<< '\t' << 
chrÚog¿m
->
	`G‘TÙ®Time
(è<< '\t' << 
	`G‘IÁeg¿lRho
();

177 
k
=0; k<
NcÚt
+
L
; k++) {

178 
l
=
k
+1;†<
NcÚt
+
L
;†++) {

179 
os
 << '\t' << (*
sigma
)[
k
][
l
];

182 
k
=0; k<
NcÚt
+
L
; k++) {

183 
os
 << '\t' << (*
sigma
)[
k
][k];

185 
os
 << '\t' << 
brownŸnProûss
->
	`G‘M—nNSubB¿nch
(è<< '\t' << brownŸnProûss->
	`G‘MšNSubB¿nch
(è<< '\t' << brownŸnProûss->
	`G‘MaxNSubB¿nch
(è<< '\t' << brownŸnProûss->
	`G‘NOÃSubB¿nch
(è<< '\t' << 
¡©iÚ¬y
->
	`v®
().
	`G‘EÁrİy
(è<< '\t' << 
»Ì©e
->v®().G‘EÁrİy(è<< '\t' << 
	`G‘M—nRho
(è<< '\t' << 
	`G‘V¬Rho
() ;

186 if(
gc
)

187 
os
 << '\t' << 
	`G‘M—nGC
(è<< '\t' << 
	`G‘V¬GC
(è<< '\t' << 
	`G‘RoÙGC
();

188 if(
omega
)

189 
os
 << '\t' << 
	`G‘M—nOmega
(è<< '\t' << 
	`G‘V¬Omega
() ;

191 ià(
gc
 || 
omega
) {

192 
os
 << '\t' << 
SubM©rix
::
m—nz
 / SubM©rix::
nz
 << '\t' << SubM©rix::
maxz
;

194 
SubM©rix
::
nz
 = 0;

195 
SubM©rix
::
m—nz
 = 0;

196 
SubM©rix
::
maxz
 = 0;

198 
os
 << '\n';

199 
os
.
	`æush
();

201 
	}
}

203 
	gBrownŸnMod–
::
	$D‘as
(
o¡»am
& 
os
) {

205 if(
m­Segm’t
) {

206 * 
x
 = 
evŞutiÚSegm’‹dProûss
->
	`G‘NbOrd”s
();

207 
tÙ
 = 0;

208 
i
=0; i< 11; i++)

209 
tÙ
 +ğ
x
[
i
];

210 
i
=0; i<11; i++) {

211 
os
 << "Ord” " << (
i
+1è<< " : " << 
x
[i] << " (" << 100*x[i]/
tÙ
 << "%)" << 
’dl
;

213 
os
 << "TÙ® : " << 
tÙ
 << 
’dl
 <<ƒndl;

215 
	}
}

217 
	gBrownŸnMod–
::
	$ToSŒ—m
(
o¡»am
& 
os
) {

218 
os
 << *
chrÚog¿m
 << '\n';

219 
os
 << *
DŸgA¼ay
 << '\n';

220 
os
 << *
sigma
 << '\n';

221 ià(
gc
) {

222 
os
 << *
roÙGC¿‹
 << '\n';

224 
os
 << *
brownŸnProûss
->
	`G‘Pu»BrownŸnProûss
() << '\n';

225 
os
 << *
brownŸnProûss
->
	`G‘In¡ªtProûss
() << '\n';

226 
os
 << *
»Ì©e
 << '\n';

227 
os
 << *
¡©iÚ¬y
 << '\n';

228 
	}
}

230 
	gBrownŸnMod–
::
	$FromSŒ—m
(
i¡»am
& 
is
) {

231 
is
 >> *
chrÚog¿m
;

232 
is
 >> *
DŸgA¼ay
;

233 
is
 >> *
sigma
;

234 ià(
gc
) {

235 
is
 >> *
roÙGC¿‹
;

237 
is
 >> *
brownŸnProûss
->
	`G‘Pu»BrownŸnProûss
();

238 
is
 >> *
brownŸnProûss
->
	`G‘In¡ªtProûss
();

239 
is
 >> *
»Ì©e
;

240 
is
 >> *
¡©iÚ¬y
;

241 
	}
}

243 
	gBrownŸnMod–
::
	$ToSŒ—mShÜt
(
o¡»am
& 
os
) {

244 
os
 << *
chrÚog¿m
 << '\n';

245 
os
 << *
DŸgA¼ay
 << '\n';

246 
os
 << *
sigma
 << '\n';

247 ià(
gc
) {

248 
os
 << *
roÙGC¿‹
 << '\n';

250 
os
 << *
»Ì©e
 << '\n';

251 
os
 << *
¡©iÚ¬y
 << '\n';

252 
	}
}

254 
	gBrownŸnMod–
::
	$FromSŒ—mShÜt
(
i¡»am
& 
is
) {

255 
is
 >> *
chrÚog¿m
;

256 
is
 >> *
DŸgA¼ay
;

257 
is
 >> *
sigma
;

258 ià(
gc
) {

259 
is
 >> *
roÙGC¿‹
;

261 
is
 >> *
»Ì©e
;

262 
is
 >> *
¡©iÚ¬y
;

263 
	}
}

266 
	gBrownŸnMod–
::
	$PrštEÁr›s
(
o¡»am
& 
os
) {

268 
os
 << "dS\n";

270 
k
=0; k<
NcÚt
; k++) {

271 
os
 << 
cÚtd©a
->
	`G‘Ch¬aù”Name
(
k
) << '\n';

275 
	}
}

277 
	gBrownŸnMod–
::
	$Lßd
(
¡ršg
 
simufe
) {

279 
if¡»am
 
	`is
(
simufe
.
	`c_¡r
());

280 
	`FromSŒ—mShÜt
(
is
);

281 
	`Upd©e
();

282 
	}
}

284 
	gBrownŸnMod–
::
	$Po¡P»dSimu
(
¡ršg
 
Çme
, 
boŞ
 
»§m¶ecov
, boŞ 
»§m¶•roûss
, 
n£gm’t
) {

286 
cÚt
 = 1;

287 
cÚt
) {

288 ià(
»§m¶ecov
) {

289 
sigma
->
	`Sam¶e
();

292 ià(
»§m¶•roûss
) {

293 
MuÉiV¬Ÿ‹T»eProûss
* 
´oûss
 = 
brownŸnProûss
->
	`G‘In¡ªtProûss
();

294 
i
=0; i<
sigma
->
	`G‘Dim
(); i++) {

295 
´oûss
->
	`Unşamp
(
i
);

297 
´oûss
->
	`G‘NodeV®
Õroûss->
	`G‘RoÙ
()->
	`G‘Node
())->
	`CÏmp
();

304 
brownŸnProûss
->
	`Sam¶e
();

306 
cÚt
 = 0;

307 
i
=0; i<
L
; i++) {

308 ià((
´oûss
->
	`G‘Mš
(
i
è< -5è|| (´oûss->
	`G‘Max
(i) > 5)) {

309 
cÚt
 = 1;

312 
û¼
 << 
cÚt
 << '\t';

315 
û¼
 << '\n';

317 
û¼
 << "update\n";

319 
	`Upd©e
();

321 
û¼
 << "grep‡lignment\n";

322 
Sequ’ûAlignm’t
* 
d©acİy
 = 0;

323 ià(
codÚd©a
) {

324 
d©acİy
 = 
Ãw
 
	`CodÚSequ’ûAlignm’t
(
codÚd©a
);

327 
d©acİy
 = 
Ãw
 
	`Sequ’ûAlignm’t
(
d©a
);

330 
û¼
 << "phyloprocess\n";

331 
phylİroûss
->
	`Po¡P»dSam¶e
();

332 
phylİroûss
->
	`G‘L—fD©a
(
d©acİy
);

334 
û¼
 << "print out\n";

335 
o¡ršg¡»am
 
s
;

336 
of¡»am
 
	`os
((
Çme
 + ".®i").
	`c_¡r
());

337 
d©acİy
->
	`ToSŒ—m
(
os
);

339 
of¡»am
 
	`cos
((
Çme
 + ".cov").
	`c_¡r
());

340 
cos
 << *
sigma
 << '\n';

346 ià(
cÚtd©a
) {

347 
û¼
 << "get cont data\n";

348 
CÚtšuousD©a
* 
cÚtd©acİy
 = 
Ãw
 
	`CÚtšuousD©a
(
cÚtd©a
);

349 
û¼
 << 
L
 << '\n';

350 
brownŸnProûss
->
	`G‘In¡ªtProûss
()->
	`G‘L—fD©a
(
cÚtd©acİy
,
L
);

351 
of¡»am
 
	`cos
((
Çme
 + ".cÚt").
	`c_¡r
());

352 
û¼
 << "to stream\n";

353 
cÚtd©acİy
->
	`ToSŒ—m
(
cos
);

354 
û¼
 << "delete cont data copy\n";

355 
d–‘e
 
cÚtd©acİy
;

356 
û¼
 << "ok\n";

360 
of¡»am
 
	`tos
((
Çme
 + ".d©es").
	`c_¡r
());

361 
	`G‘ChrÚog¿m
()->
	`PrštAges
(
tos
);

364 
of¡»am
 
	`los
((
Çme
 + ".Ëngths").
	`c_¡r
());

365 
brownŸnProûss
->
	`PrštL’gths
(
los
);

368 
of¡»am
 
	`vos
((
Çme
 + ".nodev®s").
	`c_¡r
());

369 
brownŸnProûss
->
	`PrštNodeV®s
(
vos
);

371 
of¡»am
 
	`´os
((
Çme
 + ".·¿m").
	`c_¡r
());

372 
	`ToSŒ—m
(
´os
);

373 
û¼
 << "delete\n";

374 
d–‘e
 
d©acİy
;

375 
û¼
 << "ok\n";

376 
	}
}

	@BrownianModel.h

1 #iâdeà
BROWNIANMODEL_H


2 
	#BROWNIANMODEL_H


	)

5 
	~"Ba£Ty³.h
"

6 
	~"RªdomTy³s.h
"

7 
	~"ProbMod–.h
"

8 
	~"GTRMod–.h
"

9 
	~"BrownŸnProûss.h
"

10 
	~"CommutiveBrownŸnProûss.h
"

11 
	~"EvŞutiÚNucBrownŸnProûss.h
"

12 
	~"EvŞutiÚGCBrownŸnProûss.h
"

13 
	~"BrownŸnMove.h
"

14 
	~"CÚtšuousD©a.h
"

15 
	~"CodÚSequ’ûAlignm’t.h
"

16 
	~"MGCodÚT¿ns™iÚM©rix.h
"

17 
	~"ChrÚog¿m.h
"

18 
	~"G’”®CÚjug©eP©h.h
"

19 
	~"CÚjug©eInv”£Wish¬t.h
"

20 
	~"Jefäeys.h
"

21 
	~"CÚjug©eMuÉiV¬Ÿ‹T»eProûss.h
"

22 
	~"G’”®T¿ns™iÚCÚjug©eP©h.h
"

24 
	~"EvŞutiÚSegm’‹dNucProûss.h
"

25 
	~"EvŞutiÚSegm’‹dGCProûss.h
"

26 
	~"EvŞutiÚSegm’‹dCompoProûss.h
"

27 
	~"RªdomSegm’‹dB¿nchS™eP©h.h
"

28 
	~"G’”®Segm’‹dCÚjug©eP©h.h
"

29 
	~"EvŞutiÚSegm’‹dOmegaProûss.h
"

30 
	~"EvŞutiÚOmegaBrownŸnProûss.h
"

32 şas 
	cBrownŸnMod–
 : 
public
 
ProbMod–


34 
public
:

35 
	$BrownŸnMod–
(
¡ršg
 
d©afe
, sŒšg 
Œ“fe
, sŒšg 
cÚtd©afe
, 
boŞ
 
š·thcÚjug©e
, boŞ 
šm­Segm’t
, 
šnSegm’ts
, 
Segm’tiÚ
 
š£gm
, boŞ 
šcommut
, 
šgc
, boŞ 
šomega
, 
šcÚjsigma
, boŞ 
šfixtimes
, boŞ 
š·¿l
, boŞ 
§m¶e
 = 
Œue
, 
G’‘icCodeTy³
 
ty³
=
Univ”§l
) {

37 
·thcÚjug©e
 = 
š·thcÚjug©e
;

38 
m­Segm’t
 = 
šm­Segm’t
;

39 
cÚjsigma
 = 
šcÚjsigma
;

40 
nSegm’ts
 = 
šnSegm’ts
;

41 
£gm
 = 
š£gm
;

42 
commut
 = 
šcommut
;

43 
compo
 = 
çl£
;

44 
gc
 = 
çl£
;

45 ià(
šgc
 == 2) {

46 
compo
 = 
Œue
;

47 
û¼
 << "compo model\n";

49 ià(
šgc
 == 1) {

50 
gc
 = 
Œue
;

53 
omega
 = 
šomega
;

54 
fixtimes
 = 
šfixtimes
;

55 
·¿l
 = 
š·¿l
;

58 if(
·¿l
) {

59 #ifdeà
_OPENMP


60 #´agm¨
omp
 
·¿Î–
 

61 
i
=0; i<
	`omp_g‘_num_th»ads
(); i++) {

62 
û¼
 << "P¬®ËÈcomputšgƒÇbËd" << 
’dl
;

63 
û¼
 << "´oc: " << 
	`omp_g‘_th»ad_num
(è<< '\t' << 
	`omp_g‘_num_th»ads
() << '\n';

66 
û¼
 << "P¬®ËÈcomputšg‚ÙƒÇbËd. PËa£ check O³nMP i š you¸makefİtiÚs" << 
’dl
;

67 
·¿l
 = 
çl£
;

71 
û¼
 << "n£g : " << 
nSegm’ts
 << '\n';

72 
BrownŸnBridge
::
	`£tNT»eSegm’ts
(
nSegm’ts
);

73 
BrownŸnBridge
::
	`£tSegm’tiÚ
(
£gm
);

76 
d©a
 = 
Ãw
 
	`FeSequ’ûAlignm’t
(
d©afe
);

77 
N¡©e
 = 
d©a
->
	`G‘N¡©e
();

79 ià(
omega
) {

80 ià(
N¡©e
 !ğ
Nnuc
) {

81 
û¼
 << "error : omega model only on‚ucleotide codon sequence‡lignments\n";

82 
	`ex™
(1);

84 
codÚd©a
 = 
Ãw
 
	`CodÚSequ’ûAlignm’t
(
d©a
, 
Œue
, 
ty³
);

87 
codÚd©a
 = 0;

89 
Ns™e
 = 
d©a
->
	`G‘Ns™e
();

90 
codÚS‹S·û
 = 
Ãw
 
	`CodÚS‹S·û
(
ty³
);

92 
L
 = 1;

93 if(
gc
) {

94 
L
++;

96 ià(
compo
) {

97 
L
+ğ
N¡©e
 -1;

99 if(
omega
) {

100 
L
++;

103 
xÚ£t
 = 
d©a
->
	`G‘TaxÚS‘
();

106 
Œ“
 = 
Ãw
 
	`T»e
(
Œ“fe
);

109 
Œ“
->
	`Regi¡”W™h
(
xÚ£t
);

112 ià(
cÚtd©afe
 != "None") {

113 
cÚtd©a
 = 
Ãw
 
	`FeCÚtšuousD©a
(
cÚtd©afe
);

114 
NcÚt
 = 
cÚtd©a
->
	`G‘Ns™e
();

117 
cÚtd©a
 = 0;

118 
NcÚt
 = 0;

121 
û¼
 << "tree‡nd data ok\n";

127 
Z”o
 = 
Ãw
 
CÚ¡
<
R—l
>(0);

128 
OÃ
 = 
Ãw
 
CÚ¡
<
PosR—l
>(1);

130 
chrÚog¿m
 = 
Ãw
 
	`ChrÚog¿m
(
Œ“
,
OÃ
);

135 
mšdŸg
 = 0.001;

136 
maxdŸg
 = 1000;

137 
DŸgA¼ay
 = 
Ãw
 
	`JefäeysIIDA¼ay
(
NcÚt
+
L
,
mšdŸg
,
maxdŸg
,
Z”o
);

138 
DŸgA¼ay
->
	`£tv®
(1.0);

140 
sigmaZ”o
 = 
Ãw
 
	`SigmaZ”o
(
DŸgA¼ay
);

144 
û¼
 << "sigma\n";

145 if(
cÚjsigma
) {

146 
cÚjug©esigma
 = 
Ãw
 
	`CÚjug©eInv”£Wish¬t
(
sigmaZ”o
, 
NcÚt
 + 
L
);

147 
sigma
 = 
cÚjug©esigma
;

150 
sigma
 = 
Ãw
 
	`Inv”£Wish¬tM©rix
(
sigmaZ”o
, 
NcÚt
 + 
L
);

153 
sigma
->
	`S‘AtSigmaZ”o
();

163 
û¼
 << "process\n";

164 ià(
cÚjsigma
 == 2) {

165 
cÚjug©eBrownŸnProûss
 = 
Ãw
 
	`CÚjug©eBrownŸnProûss
(
chrÚog¿m
,
cÚjug©esigma
);

166 
brownŸnProûss
 = 
cÚjug©eBrownŸnProûss
;

169 
brownŸnProûss
 = 
Ãw
 
	`BrownŸnProûss
(
chrÚog¿m
,
sigma
);

175 
i
=0; i<
NcÚt
; i++) {

176 
brownŸnProûss
->
	`G‘In¡ªtProûss
()->
	`S‘AndCÏmp
(
cÚtd©a
,
L
+
i
,i);

180 
l
=0;†<
L
;†++) {

181 
brownŸnProûss
->
	`G‘In¡ªtProûss
()->
	`CutOff
(1,
l
);

186 
û¼
 << "SUBS PROCESS\n";

187 
»Ì©e
 = 
Ãw
 
	`DœichËt
(
N¡©e
*(Nstate-1)/2);

189 ià(
N¡©e
 =ğ
N¯
) {

190 
tÙ®
 = 0;

191 
i
=0; i<
N¡©e
*(Nstate-1)/2; i++) {

192 (*
»Ì©e
)[
i
] = 
LG_RR
[i];

193 
tÙ®
 +ğ(*
»Ì©e
)[
i
];

195 
i
=0; i<
N¡©e
*(Nstate-1)/2; i++) {

196 (*
»Ì©e
)[
i
] /ğ
tÙ®
;

198 
»Ì©e
->
	`CÏmp
();

201 
»Ì©e
->
	`£tunifÜm
();

204 
¡©iÚ¬y
 = 
Ãw
 
	`DœichËt
(
N¡©e
);

205 
¡©iÚ¬y
->
	`£tunifÜm
();

207 if(
commut
) {

208 
m©rix
 = 
Ãw
 
	`GTRRªdomSubM©rixW™hNÜmR©es
(
»Ì©e
,
¡©iÚ¬y
, 
Œue
);

209 
commutiveProûss
 = 
Ãw
 
	`CommutiveBrownŸnProûss
(
brownŸnProûss
);

211 ià(
compo
) {

212 
û¼
 << "change of basis\n";

213 
chªgeofbasis
 = 
Ãw
 
	`SumCÚ¡¿šedM­pšg
(
N¡©e
);

214 if(
m­Segm’t
) {

215 
û¼
 << "evolution segmented…rocess\n";

216 
evŞutiÚSegm’‹dProûss
 = 
Ãw
 
	`EvŞutiÚSegm’‹dCompoProûss
(
brownŸnProûss
, 
»Ì©e
, 
¡©iÚ¬y
, 
chªgeofbasis
, 1, 
·¿l
);

217 
û¼
 << "esp ok\n";

221 
û¼
 << "compo: only under mapSegment option\n";

222 
	`ex™
(1);

226 if(
gc
) {

227 
roÙGC¿‹
 = 
Ãw
 
	`B‘a
(
OÃ
, One);

228 if(
m­Segm’t
) {

229 
evŞutiÚSegm’‹dProûss
 = 
Ãw
 
	`EvŞutiÚSegm’‹dGCProûss
(
brownŸnProûss
, 
»Ì©e
, 
roÙGC¿‹
, 
·¿l
);

232 
evŞutiÚProûss
 = 
Ãw
 
	`EvŞutiÚGCBrownŸnProûss
(
brownŸnProûss
, 
»Ì©e
, 
roÙGC¿‹
, 1);

236 
m©rix
 = 
Ãw
 
	`GTRRªdomSubM©rixW™hNÜmR©es
(
»Ì©e
,
¡©iÚ¬y
, 
Œue
);

237 if(
omega
) {

238 if(
·¿l
) {

239 #´agm¨
omp
 
·¿Î–


242 
nTh»ad
 = 1;

243 
codÚM©rix
 = 
Ãw
 
	`MGOmegaCodÚT¿ns™iÚM©rix_OMP
(
m©rix
, 
codÚS‹S·û
, 
nTh»ad
);

249 
codÚM©rix
 = 
Ãw
 
	`MGOmegaCodÚT¿ns™iÚM©rix
(
m©rix
, 
codÚS‹S·û
);

251 if(
m­Segm’t
) {

252 
evŞutiÚSegm’‹dProûss
 = 
Ãw
 
	`EvŞutiÚSegm’‹dOmegaProûss
(
brownŸnProûss
, 
codÚM©rix
, 
·¿l
);

255 
evŞutiÚProûss
 = 
Ãw
 
	`EvŞutiÚOmegaBrownŸnProûss
(
brownŸnProûss
, 
m©rix
, 
codÚS‹S·û
, 1);

259 if(
m­Segm’t
) {

260 
evŞutiÚSegm’‹dProûss
 = 
Ãw
 
	`EvŞutiÚSegm’‹dNucProûss
(
brownŸnProûss
, 
m©rix
, 
·¿l
);

263 
û¼
 << "simple model\n";

264 
û¼
 << "non commut\n";

265 
evŞutiÚProûss
 = 
Ãw
 
	`EvŞutiÚNucBrownŸnProûss
(
brownŸnProûss
, 
m©rix
, -1, -1);

270 
û¼
 << "PHYLO…rocess\n";

273 if(
commut
) {

274 ià(
·thcÚjug©e
) {

275 
commutP©hcÚjŒ“
 = 
Ãw
 
	`OÃM©rixP©hCÚjug©eT»e
(
commutiveProûss
,
m©rix
,
d©a
);

276 
phylİroûss
 = 
Ãw
 
	`P©hCÚjug©ePhyloProûss
(
commutP©hcÚjŒ“
);

279 
phylİroûss
 = 
Ãw
 
	`OÃM©rixPhyloProûss
(
commutiveProûss
,
m©rix
,
d©a
);

282 if(
m­Segm’t
) {

283 if(
·thcÚjug©e
) {

284 
£gm’‹dP©hcÚjŒ“
 = 
Ãw
 
	`B¿nchM©rixSegm’‹dP©hCÚjug©eT»e
(
chrÚog¿m
, 
evŞutiÚSegm’‹dProûss
, 
d©a
);

285 
phylİroûss
 = 
Ãw
 
	`Segm’‹dP©hCÚjug©ePhyloProûss
(
£gm’‹dP©hcÚjŒ“
);

288 
phylİroûss
 = 
Ãw
 
	`BrownŸnPhyloProûss
(
chrÚog¿m
, 
d©a
, 
evŞutiÚSegm’‹dProûss
);

292 
·thcÚjŒ“
 = 
Ãw
 
	`B¿nchM©rixT¿ns™iÚP©hCÚjug©eT»e
(
chrÚog¿m
, 
evŞutiÚProûss
, 
d©a
);

293 
phylİroûss
 = 
Ãw
 
	`T¿ns™iÚP©hCÚjug©ePhyloProûss
(
·thcÚjŒ“
);

296 
û¼
 << "M—ÀoàbrownŸÀ´oûs :" << 
	`G‘M—nRho
(è<< " - V¬ :" << 
	`G‘V¬Rho
(è<< 
’dl
;

297 
û¼
 << "unfold\n";

298 
phylİroûss
->
	`UnfŞd
();

300 ià(
§m¶e
) {

301 
phylİroûss
->
	`Sam¶e
();

304 
û¼
 << "register\n";

305 
	`RoÙRegi¡”
(
Z”o
);

306 
	`RoÙRegi¡”
(
OÃ
);

307 
	`RoÙRegi¡”
(
»Ì©e
);

308 
	`RoÙRegi¡”
(
¡©iÚ¬y
);

310 
	`Regi¡”
();

313 
	`MakeScheduËr
();

314 if(
§m¶e
)

315 
	`Upd©e
();

317 
	`T¿ûH—d”
(
û¼
);

318 
	`T¿û
(
û¼
);

320 
û¼
 << "model created\n";

322 
vœtu®
 ~
	`BrownŸnMod–
();

326 
BrownŸnProûss
* 
	$G‘BrownŸnProûss
() {

327  
brownŸnProûss
;

328 
	}
}

330 
T»e
* 
	$G‘T»e
() {

331  
Œ“
;

332 
	}
}

333 
	$G‘NcÚt
() {

334  
NcÚt
;

335 
	}
}

337 
Sequ’ûAlignm’t
* 
	$G‘D©a
() {

338 ià(
codÚd©a
) {

339  
codÚd©a
;

341  
d©a
;

342 
	}
}

344 
CovM©rix
* 
	$G‘Sigma
() {

345  
sigma
;

346 
	}
}

348 
	$G‘LogProb
() {

349  
	`G‘LogPriÜ
(è+ 
	`G‘LogLik–ihood
();

350 
	}
}

352 
ChrÚog¿m
* 
	$G‘ChrÚog¿m
() {

353  
chrÚog¿m
;

354 
	}
}

356 
G‘LogPriÜ
();

357 
G‘LogLik–ihood
();

359 
d¿wSam¶e
();

361 
MakeScheduËr
();

371 
G‘M—nRho
();

372 
G‘IÁeg¿lRho
();

373 
G‘V¬Rho
();

374 
G‘M—nOmega
();

375 
G‘V¬Omega
();

376 
G‘M—nGC
();

377 
G‘V¬GC
();

378 
G‘RoÙGC
();

382 
T¿ûH—d”
(
o¡»am
& 
os
);

386 
T¿û
(
o¡»am
& 
os
);

387 
D‘as
(
o¡»am
& 
os
);

389 
ToSŒ—m
(
o¡»am
& 
os
);

390 
FromSŒ—m
(
i¡»am
& 
is
);

392 
ToSŒ—mShÜt
(
o¡»am
& 
os
);

393 
FromSŒ—mShÜt
(
i¡»am
& 
is
);

395 
PrštEÁr›s
(
o¡»am
& 
os
);

397 
	$‹¡
() {

398 
brownŸnProûss
->
	`G‘Pu»BrownŸnProûss
()->
	`CheckL’gth
();

399 
	}
}

401 
Po¡P»dSimu
(
¡ršg
 
Çme
, 
boŞ
 
»§m¶ecov
, boŞ 
»§m¶•roûss
, 
n£gm’t
);

403 
Lßd
(
¡ršg
 
simufe
);

405 
	g´Ùeùed
:

406 
´iv©e
:

415 
T»e
* 
Œ“
;

416 
Sequ’ûAlignm’t
* 
	gd©a
;

417 
CodÚSequ’ûAlignm’t
* 
	gcodÚd©a
;

418 
CodÚS‹S·û
 *
	gcodÚS‹S·û
;

419 
TaxÚS‘
* 
	gxÚ£t
;

420 
CÚtšuousD©a
* 
	gcÚtd©a
;

423 
	gNs™e
;

425 
	gN¡©e
;

427 
	gNcÚt
;

429 
	gL
;

433 
	gCÚ¡
<
	gR—l
>* 
	gZ”o
;

434 
	gCÚ¡
<
	gPosR—l
>* 
	gOÃ
;

437 
ChrÚog¿m
* 
	gchrÚog¿m
;

440 
JefäeysIIDA¼ay
* 
	gDŸgA¼ay
;

441 
SigmaZ”o
* 
	gsigmaZ”o
;

442 
Inv”£Wish¬tM©rix
* 
	gsigma
;

443 
CÚjug©eInv”£Wish¬t
* 
	gcÚjug©esigma
;

445 
BrownŸnProûss
* 
	gbrownŸnProûss
;

446 
CÚjug©eBrownŸnProûss
* 
	gcÚjug©eBrownŸnProûss
;

447 
	gnSegm’ts
;

448 
Segm’tiÚ
 
	g£gm
;

449 
boŞ
 
	gcommut
;

450 
	ggc
;

451 
boŞ
 
	gomega
;

452 
CommutiveBrownŸnProûss
 *
	gcommutiveProûss
;

453 
	gB¿nchV®PŒT»e
<
	gRªdomT¿ns™iÚM©rix
>* 
	gevŞutiÚProûss
;

454 
EvŞutiÚSegm’‹dProûss
* 
	gevŞutiÚSegm’‹dProûss
;

457 
boŞ
 
	gcompo
;

458 
SumCÚ¡¿šedM­pšg
* 
	gchªgeofbasis
;

461 
DœichËt
* 
	g»Ì©e
;

462 
DœichËt
* 
	g¡©iÚ¬y
;

463 
	gRv¬
<
	gUn™R—l
> *
	groÙGC¿‹
;

464 
GTRRªdomSubM©rixW™hNÜmR©es
* 
	gm©rix
;

465 
MGOmegaCodÚT¿ns™iÚM©rix
* 
	gcodÚM©rix
;

468 
P©hCÚjug©eT»e
* 
	gcommutP©hcÚjŒ“
;

469 
T¿ns™iÚP©hCÚjug©eT»e
* 
	g·thcÚjŒ“
;

470 
Segm’‹dP©hCÚjug©eT»e
* 
	g£gm’‹dP©hcÚjŒ“
;

471 
PhyloProûss
* 
	gphylİroûss
;

475 
boŞ
 
	g·thcÚjug©e
;

476 
boŞ
 
	gm­Segm’t
;

477 
	gcÚjsigma
;

478 
boŞ
 
	gfixtimes
;

479 
boŞ
 
	g·¿l
;

	@BrownianMove.h

1 #iâdeà
BROWNIANMOVE_H


2 
	#BROWNIANMOVE_H


	)

4 
	~"Move.h
"

5 
	~"BrownŸnProûss.h
"

6 
	~"ChrÚo.h
"

8 şas 
	cBrownŸnHÜizÚlMove
 : 
public
 
MCUpd©e
 {

10 
´iv©e
 :

11 
ChrÚog¿m
 *
chrÚo
;

12 
BrownŸnProûss
 *
	m´oûss
;

13 
	mhÜizÚlTunšg
;

17 
	mpublic
:

18 
	$BrownŸnHÜizÚlMove
(
ChrÚog¿m
 *
šchrÚo
, 
BrownŸnProûss
 *
š´oûss
, 
šhÜizÚlTunšg
) {

19 
chrÚo
 = 
šchrÚo
;

20 
´oûss
 = 
š´oûss
;

21 
hÜizÚlTunšg
 = 
šhÜizÚlTunšg
;

24 ~
	$BrownŸnHÜizÚlMove
() {

25 
	}
}

28 
	$Move
(
tunšg_moduÏtÜ
) {

29 
n
 = 0;

30 
tÙ®
 = 
	`RecursiveMove
(
tunšg_moduÏtÜ
, 
chrÚo
->
	`G‘RoÙ
(), 
n
);

31  
tÙ®
/
n
;

32 
	}
}

34 
	$RecursiveMove
(
tunšg_moduÏtÜ
, cÚ¡ 
Lšk
* 
äom
, & 
n
) {

36 
tÙ®
 = 0;

37 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink != from;†ink =†ink->Next())

38 
tÙ®
 +ğ
	`RecursiveMove
(
tunšg_moduÏtÜ
, 
lšk
->
	`Out
(), 
n
);

40 if(!(
äom
->
	`isL—f
(è|| from->
	`isRoÙ
())) {

41 
tÙ®
 +ğ
	`LoÿlMove
(
tunšg_moduÏtÜ
, 
äom
);

42 
n
++;

45  
tÙ®
;

46 
	}
}

49 
	$LoÿlMove
(
tunšg_moduÏtÜ
, cÚ¡ 
Lšk
* 
äom
) {

51 
Mnode
* 
mnode
 = 
Ãw
 
	`Mnode
(
çl£
);

52 
Rv¬
<
PosR—l
>* 
nodeAge
 = 
chrÚo
->
	`G‘NodeV®
(
äom
->
	`G‘Node
());

54 
RªdomBrownŸnP©h
* 
up
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
);

55 
RªdomBrownŸnP©h
* 
Ëá
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
->
	`Next
());

56 
RªdomBrownŸnP©h
* 
right
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
->
	`Next
()->Next());

57 
MuÉiNÜm®
 *
nodeV®
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
);

58 
dim
 = 
nodeV®
->
	`G‘Dim
();

61 
nodeAge
->
	`Regi¡”
(
mnode
);

62 
up
->
	`Regi¡”
(
mnode
);

63 
Ëá
->
	`Regi¡”
(
mnode
);

64 
right
->
	`Regi¡”
(
mnode
);

65 
nodeV®
->
	`Regi¡”
(
mnode
);

67 
v”if
 = 0;

68 
v”if
-=
up
->
	`G‘LogProb
();

69 
v”if
-=
Ëá
->
	`G‘LogProb
();

70 
v”if
-=
right
->
	`G‘LogProb
();

71 
v”if
-=
nodeV®
->
	`G‘LogProb
();

72 
v”if
-=
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Next
()->
	`Out
())->
	`G‘LogProb
();

73 
v”if
-=
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Next
()->Next()->
	`Out
())->
	`G‘LogProb
();

77 
mnode
->
	`CÜru±
(
Œue
);

78 
up
->
	`addSlİe
(
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘NodeV®
(
äom
->
	`Out
()->
	`G‘Node
())->
	`G‘A¼ay
(), 
nodeV®
->GetArray());

79 
Ëá
->
	`addSlİe
(
nodeV®
->
	`G‘A¼ay
(), 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘NodeV®
(
äom
->
	`Next
()->
	`Out
()->
	`G‘Node
())->GetArray());

80 
right
->
	`addSlİe
(
nodeV®
->
	`G‘A¼ay
(), 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘NodeV®
(
äom
->
	`Next
()->Next()->
	`Out
()->
	`G‘Node
())->GetArray());

83 
ŞdAge
 = 
nodeAge
->
	`v®
();

84 
chrÚo
->
	`S‘MšMax
(
äom
);

85 
logHa¡šgs
 = 
nodeAge
->
	`Prİo£Move
(
hÜizÚlTunšg
*
tunšg_moduÏtÜ
);

86 
ÃwAge
 = 
nodeAge
->
	`v®
();

90 
t0
, 
t1
, 
t2
;

91 *
x0
,*
x1
,*
x2
;

93 
up
->
	`fšdPoštBefÜe
(
ŞdAge
>
ÃwAge
 ? oldAg:‚ewAge, 
t0
, 
x0
);

94 
Ëá
->
	`fšdPoštAá”
(
ŞdAge
<
ÃwAge
 ? oldAg:‚ewAge, 
t1
, 
x1
);

95 
right
->
	`fšdPoštAá”
(
ŞdAge
<
ÃwAge
 ? oldAg:‚ewAge, 
t2
, 
x2
);

97 
r0
 = 1.0/(
t0
-
ŞdAge
), 
r1
 = 1.0/(ŞdAge-
t1
), 
r2
 = 1.0/(ŞdAge-
t2
);

98 
r
 = 
r0
+
r1
+
r2
;

99 * 
m—n
 = 
Ãw
 [
dim
];

100 
i
=0; i<
dim
; i++)

101 
m—n
[
i
] = (
r0
*
x0
[i]+
r1
*
x1
[i]+
r2
*
x2
[i])/
r
;

104 
logHa¡šgs
+=
up
->
	`logProbNÜm®
(
nodeV®
->
	`G‘A¼ay
(), 
m—n
, 1.0/
r
, up->
	`g‘Un™V¬Ÿnû
().
	`G‘InvM©rix
(), 1.0/up->g‘Un™V¬Ÿnû().
	`G‘D‘”mšªt
());

106 
r0
 = 1.0/(
t0
-
ÃwAge
); 
r1
 = 1.0/ÒewAge-
t1
); 
r2
 = 1.0/ÒewAge-
t2
);

108 
r
 = 
r0
+
r1
+
r2
;

109 
i
=0; i<
dim
; i++)

110 
m—n
[
i
] = (
r0
*
x0
[i]+
r1
*
x1
[i]+
r2
*
x2
[i])/
r
;

112 
up
->
	`g‘Un™V¬Ÿnû
().
	`d¿wV®
(
nodeV®
->
	`G‘A¼ay
());

114 
nodeV®
->
	`SÿÏrMuÉliÿtiÚ
(
	`sq¹
(1.0/
r
));

115 
i
=0; i<
up
->
	`g‘Dim
(); i++) {

116 
nodeV®
->
	`G‘A¼ay
()[
i
] +ğ(
r0
*
x0
[i]+
r1
*
x1
[i]+
r2
*
x2
[i])/
r
;

119 
logHa¡šgs
-=
up
->
	`logProbNÜm®
(
nodeV®
->
	`G‘A¼ay
(), 
m—n
, 1.0/
r
, up->
	`g‘Un™V¬Ÿnû
().
	`G‘InvM©rix
(), 1.0/up->g‘Un™V¬Ÿnû().
	`G‘D‘”mšªt
());

121 
d–‘e
[] 
m—n
;

127 
s
 = 
up
->
	`fš®AgeMove
(
ÃwAge
, 
nodeV®
->
	`G‘A¼ay
());

128 
logHa¡šgs
 +=
s
;

129 
up
->
	`»moveSlİe
();

131 
s
 = 
Ëá
->
	`š™AgeMove
(
ÃwAge
, 
nodeV®
->
	`G‘A¼ay
());

132 
logHa¡šgs
 +=
s
;

133 
Ëá
->
	`»moveSlİe
();

135 
s
 = 
right
->
	`š™AgeMove
(
ÃwAge
, 
nodeV®
->
	`G‘A¼ay
());

136 
logHa¡šgs
 +=
s
;

137 
right
->
	`»moveSlİe
();

140 
v”if
+=
up
->
	`G‘LogProb
();

141 
v”if
+=
Ëá
->
	`G‘LogProb
();

142 
v”if
+=
right
->
	`G‘LogProb
();

143 
v”if
+=
nodeV®
->
	`G‘LogProb
();

144 
v”if
+=
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Next
()->
	`Out
())->
	`G‘LogProb
();

145 
v”if
+=
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Next
()->Next()->
	`Out
())->
	`G‘LogProb
();

149 
log¿tio
 = 
mnode
->
	`Upd©e
();

150 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
+
logHa¡šgs
);

151 ià(! 
acû±ed
) {

152 
mnode
->
	`CÜru±
(
çl£
);

153 
mnode
->
	`Re¡Üe
();

156 
d–‘e
 
mnode
;

159  (è
acû±ed
;

161 
	}
}

163 
	$ToSŒ—m
(
o¡»am
& 
os
) {

165 
	}
}

	@BrownianProcess.cpp

1 
	~"BrownŸnProûss.h
"

3 
	gBrownŸnProûss
::
BrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
V¬
<
CovM©rix
>* 
šsigma
, V¬<
PosR—l
>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
) {

5 
	gŒ“
 = 
šŒ“
;

6 
	gsigma
 = 
šsigma
;

7 
	gagesÿË
 = 
šagesÿË
;

8 
	gsÿËfunùiÚ
 = 
šsÿËfunùiÚ
;

10 
	gpu»BrownŸnProûss
 = 
Ãw
 
Pu»BrownŸnProûss
(
Œ“
, 
sigma
,
agesÿË
,
sÿËfunùiÚ
);

11 
	gš¡ªtProûss
 = 
Ãw
 
MuÉiV¬Ÿ‹T»eProûss
(
sigma
,
Œ“
,
agesÿË
,
sÿËfunùiÚ
);

12 
	gš¡ªtProûss
->
Re£t
();

17 
	gBrownŸnProûss
::~
	$BrownŸnProûss
() {

18 
d–‘e
 
pu»BrownŸnProûss
;

19 
d–‘e
 
š¡ªtProûss
;

20 
	}
}

22 
	gBrownŸnProûss
::
	$d¿wSam¶e
() {

23 
pu»BrownŸnProûss
->
	`Sam¶e
();

24 
š¡ªtProûss
->
	`Sam¶e
();

25 
	}
}

27 
	gBrownŸnProûss
::
	$G‘LogProb
() {

28  
pu»BrownŸnProûss
->
	`G‘LogProb
(è+ 
š¡ªtProûss
->GetLogProb();

29 
	}
}

31 
	gBrownŸnProûss
::
	$Move
(
tunšg
) {

32 
t1
 = 
pu»BrownŸnProûss
->
	`Move
(
tunšg
);

33 
t2
 = 
š¡ªtProûss
->
	`Move
(
tunšg
);

34  
t1
+
t2
/2;

35 
	}
}

37 
	gBrownŸnProûss
::
	$g‘TÙ®L’gth
() {

38  
	`g‘TÙ®L’gth
(
	`G‘T»e
()->
	`G‘RoÙ
());

39 
	}
}

41 
	gBrownŸnProûss
::
	$g‘TÙ®L’gth
(cÚ¡ 
Lšk
* 
äom
) {

42 
r
 = 0;

43 if(!
äom
->
	`isRoÙ
()) {

44 
r
 = 
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
äom
)->
	`g‘L’gth
();

47 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next())

48 
r
+=
	`g‘TÙ®L’gth
(
lšk
->
	`Out
());

50  
r
;

51 
	}
}

53 
	gBrownŸnProûss
::
	$PrštL’gths
(
o¡»am
& 
os
) {

54 
	`PrštL’gths
(
os
,
	`G‘T»e
()->
	`G‘RoÙ
());

55 
	}
}

57 
	gBrownŸnProûss
::
	$PrštL’gths
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

59 
os
 << 
	`G‘T»e
()->
	`G‘LeáMo¡
(
äom
è<< '\t' << G‘T»e()->
	`G‘RightMo¡
(from) << '\t';

60 
os
 << 
š¡ªtProûss
->
	`G‘NodeV®
(
äom
->
	`G‘Node
())->
	`v®
() << '\t';

61 ià(! 
äom
->
	`isRoÙ
()) {

62 
os
 << 
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
äom
)->
	`g‘L’gth
() << '\n';

65 
os
 << 0 << '\n';

67 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

68 
	`PrštL’gths
(
os
,
lšk
->
	`Out
());

70 
	}
}

72 
	gBrownŸnProûss
::
	$PrštNodeV®s
(
o¡»am
& 
os
) {

73 
	`PrštNodeV®s
(
os
,
	`G‘T»e
()->
	`G‘RoÙ
());

74 
	}
}

76 
	gBrownŸnProûss
::
	$PrštNodeV®s
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

78 
os
 << 
	`G‘T»e
()->
	`G‘LeáMo¡
(
äom
è<< '\t' << G‘T»e()->
	`G‘RightMo¡
(from);

79 
Rv¬
<
R—lVeùÜ
>* 
tmp
 = 
š¡ªtProûss
->
	`G‘NodeV®
(
äom
->
	`G‘Node
());

80 
i
=0; i<
tmp
->
	`G‘Dim
(); i++) {

81 
os
 << '\t' << (*
tmp
)[
i
];

83 
os
 << '\n';

84 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

85 
	`PrštNodeV®s
(
os
,
lšk
->
	`Out
());

87 
	}
}

89 ** 
	gBrownŸnProûss
::
	$G‘Inüem’tSum
() {

90 
dim
 = 
sigma
->
	`G‘Dim
();

92 ** 
A
 = 
Ãw
 *[
dim
];

93 
i
=0; i<
dim
;i++) {

94 
A
[
i
] = 
Ãw
 [
dim
];

95 
j
=0; j<
sigma
->
	`G‘Dim
(); j++)

96 
A
[
i
][
j
] = 0;

99 
	`G‘Inüem’tSum
(
A
, 
	`G‘T»e
()->
	`G‘RoÙ
());

101  
A
;

103 
	}
}

105 
	gBrownŸnProûss
::
	$G‘Inüem’tSum
(** 
A
, cÚ¡ 
Lšk
* 
äom
) {

106 
dim
 = 
sigma
->
	`G‘Dim
();

108 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink =†ink->Next()) {

109 
	`G‘Inüem’tSum
(
A
, 
lšk
->
	`Out
());

111 cÚ¡ 
R—lVeùÜ
 
š™V®ue
 = 
š¡ªtProûss
->
	`G‘NodeV®
(
lšk
->
	`G‘Node
())->
	`v®
();

112 cÚ¡ 
R—lVeùÜ
 
fš®V®ue
 = 
š¡ªtProûss
->
	`G‘NodeV®
(
lšk
->
	`Out
()->
	`G‘Node
())->
	`v®
();

113 
BrownŸnBridge
* 
bb
 = 
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
lšk
);

115 
N
 = 
bb
->
	`g‘NSegm’ts
();

116 * 
dV®ue
 = 
Ãw
 [
dim
];

117 
i
=0; i<
dim
; i++)

119 
dV®ue
[
i
] = (
fš®V®ue
[i]-
š™V®ue
[i])/
bb
->
	`g‘L’gth
();

121 
k
=0; k<
N
; k++) {

122 * 
y
 = 
Ãw
 [
dim
];

123 
£gm’tL’gth
 = 
bb
->
	`g‘Segm’tL’gth
(
k
);

124 
i
=0; i<
dim
; i++)

125 
y
[
i
] = 
dV®ue
[i]*
£gm’tL’gth
 + 
bb
->
	`g‘V®ue
(
k
+1, i) - bb->getValue(k, i);

126 
i
=0; i<
dim
; i++)

127 
j
=0; j<
dim
; j++)

128 
A
[
i
][
j
] +ğ
y
[i]*y[j]/
£gm’tL’gth
;

129 
d–‘e
[] 
y
;

131 
d–‘e
[] 
dV®ue
;

134 
	}
}

136 
	gBrownŸnProûss
::
	$G‘M—nNSubB¿nch
() {

137  ((è
	`G‘NSubB¿nch
(
	`G‘T»e
()->
	`G‘RoÙ
())è/ 
	`G‘NB¿nch
(GetTree()->GetRoot()) ;

138 
	}
}

140 
	gBrownŸnProûss
::
	$G‘NB¿nch
() {

141  
	`G‘NB¿nch
(
	`G‘T»e
()->
	`G‘RoÙ
());

142 
	}
}

144 
	gBrownŸnProûss
::
	$G‘NB¿nch
(cÚ¡ 
Lšk
* 
äom
) {

145 
i
=0;

146 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink =†ink->Next()) {

147 
i
++;

148 
i
+=
	`G‘NB¿nch
(
lšk
->
	`Out
());

150  
i
;

151 
	}
}

153 
	gBrownŸnProûss
::
	$G‘MšNSubB¿nch
() {

154  
	`G‘MšNSubB¿nch
(
	`G‘T»e
()->
	`G‘RoÙ
());

155 
	}
}

157 
	gBrownŸnProûss
::
	$G‘MšNSubB¿nch
(cÚ¡ 
Lšk
* 
äom
) {

158 
mš
 = -1;

159 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink =†ink->Next()) {

160 
tmp
 = 
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
lšk
)->
	`g‘NSegm’ts
();

161 ià((
mš
 =ğ-1è|| (mš > 
tmp
)) {

162 
mš
 = 
tmp
;

164 
tmp
 = 
	`G‘MšNSubB¿nch
(
lšk
->
	`Out
());

165 ià((
mš
 =ğ-1è|| (mš > 
tmp
)) {

166 ià(
tmp
 != -1) {

167 
mš
 = 
tmp
;

171  
mš
;

172 
	}
}

174 
	gBrownŸnProûss
::
	$G‘NOÃSubB¿nch
() {

175  
	`G‘NOÃSubB¿nch
(
	`G‘T»e
()->
	`G‘RoÙ
());

176 
	}
}

178 
	gBrownŸnProûss
::
	$G‘NOÃSubB¿nch
(cÚ¡ 
Lšk
* 
äom
) {

179 
tÙ
 = 0;

180 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink =†ink->Next()) {

181 
tmp
 = 
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
lšk
)->
	`g‘NSegm’ts
();

182 ià(
tmp
 == 1) {

183 
tÙ
++;

185 
tÙ
 +ğ
	`G‘MšNSubB¿nch
(
lšk
->
	`Out
());

187  
tÙ
;

188 
	}
}

190 
	gBrownŸnProûss
::
	$G‘MaxNSubB¿nch
() {

191  
	`G‘MaxNSubB¿nch
(
	`G‘T»e
()->
	`G‘RoÙ
());

192 
	}
}

194 
	gBrownŸnProûss
::
	$G‘MaxNSubB¿nch
(cÚ¡ 
Lšk
* 
äom
) {

195 
max
 = 0;

196 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink =†ink->Next()) {

197 
tmp
 = 
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
lšk
)->
	`g‘NSegm’ts
();

198 ià(
max
 < 
tmp
) {

199 
max
 = 
tmp
;

201 
tmp
 = 
	`G‘MaxNSubB¿nch
(
lšk
->
	`Out
());

202 ià(
max
 < 
tmp
) {

203 
max
 = 
tmp
;

206  
max
;

207 
	}
}

209 
	gBrownŸnProûss
::
	$G‘NSubB¿nch
() {

211  
	`G‘NSubB¿nch
(
	`G‘T»e
()->
	`G‘RoÙ
());

212 
	}
}

214 
	gBrownŸnProûss
::
	$G‘NSubB¿nch
(cÚ¡ 
Lšk
* 
äom
) {

215 
i
=0;

216 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink =†ink->Next()) {

217 
i
+ğ
pu»BrownŸnProûss
->
	`G‘RªdomBrownŸnP©h
(
lšk
)->
	`g‘NSegm’ts
();

218 
i
+=
	`G‘NSubB¿nch
(
lšk
->
	`Out
());

220  
i
;

221 
	}
}

223 
	gBrownŸnProûss
::
	$G‘M—nR©e
(
v
){

224 
n
 = 0;

225 
tÙ®
 = 
	`G‘TÙ®R©e
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
(),
n
);

226  
tÙ®
 / 
n
;

227 
	}
}

229 
	gBrownŸnProûss
::
	$G‘IÁeg¿lR©e
(
v
){

231  
	`G‘IÁeg¿lR©e
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
());

232 
	}
}

234 
	gBrownŸnProûss
::
	$G‘V¬R©e
(
v
){

235 
n
 = 0;

236 
tÙ®1
 = 
	`G‘TÙ®R©e
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
(),
n
);

237 
n
 = 0;

238 
tÙ®2
 = 
	`G‘TÙ®Squ¬eR©e
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
(),
n
);

239 
tÙ®1
 /ğ
n
;

240 
tÙ®2
 /ğ
n
;

241 
tÙ®2
 -ğ
tÙ®1
 *otal1;

242  
tÙ®2
;

243 
	}
}

245 
	gBrownŸnProûss
::
	$G‘TÙ®R©e
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
) {

246 
tÙ®
 = 
	`exp
(
š¡ªtProûss
->
	`G‘NodeV®
(
äom
->
	`G‘Node
())->
	`v®
().
	`G‘A¼ay
()[
v
]);

247 
n
++;

248 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

249 
tÙ®
 +ğ
	`G‘TÙ®R©e
(
v
, 
lšk
->
	`Out
(),
n
);

251  
tÙ®
;

252 
	}
}

254 
	gBrownŸnProûss
::
	$G‘TÙ®Squ¬eR©e
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
) {

255 
‹mp
 = 
	`exp
(
š¡ªtProûss
->
	`G‘NodeV®
(
äom
->
	`G‘Node
())->
	`v®
().
	`G‘A¼ay
()[
v
]);

256 
tÙ®
 = 
‹mp
 *emp;

257 
n
++;

258 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

259 
tÙ®
 +ğ
	`G‘TÙ®Squ¬eR©e
(
v
, 
lšk
->
	`Out
(),
n
);

261  
tÙ®
;

262 
	}
}

264 
	gBrownŸnProûss
::
	$G‘IÁeg¿lR©e
(
v
, cÚ¡ 
Lšk
* 
äom
) {

265 
tÙ®
 = 0;

266 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

267 
tÙ®
 +ğ
	`G‘IÁeg¿lR©e
(
v
, 
lšk
->
	`Out
());

268 
š™
 = 
š¡ªtProûss
->
	`G‘NodeV®
(
lšk
->
	`G‘Node
())->
	`v®
().
	`G‘A¼ay
()[
v
];

269 
fš®
 = 
š¡ªtProûss
->
	`G‘NodeV®
(
lšk
->
	`Out
()->
	`G‘Node
())->
	`v®
().
	`G‘A¼ay
()[
v
];

270 
tÙ®
 +ğ
pu»BrownŸnProûss
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())->
	`g‘IÁeg¿l
(
v
, 
š™
, 
fš®
);

272  
tÙ®
;

273 
	}
}

277 
	gBrownŸnProûss
::
	$G‘M—nGC
(
v
){

278 
n
 = 0;

279 
tÙ®
 = 
	`G‘TÙ®GC
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
(),
n
);

280  
tÙ®
 / 
n
;

281 
	}
}

283 
	gBrownŸnProûss
::
	$G‘V¬GC
(
v
){

284 
n
 = 0;

285 
tÙ®1
 = 
	`G‘TÙ®GC
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
(),
n
);

286 
n
 = 0;

287 
tÙ®2
 = 
	`G‘TÙ®Squ¬eGC
(
v
, 
	`G‘T»e
()->
	`G‘RoÙ
(),
n
);

288 
tÙ®1
 /ğ
n
;

289 
tÙ®2
 /ğ
n
;

290 
tÙ®2
 -ğ
tÙ®1
 *otal1;

291  
tÙ®2
;

292 
	}
}

294 
	gBrownŸnProûss
::
	$G‘TÙ®GC
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
) {

295 
tÙ®
 = 1.0/(1.0+
	`exp
(-
š¡ªtProûss
->
	`G‘NodeV®
(
äom
->
	`G‘Node
())->
	`v®
().
	`G‘A¼ay
()[
v
]));

296 
n
++;

297 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

298 
tÙ®
 +ğ
	`G‘TÙ®GC
(
v
, 
lšk
->
	`Out
(),
n
);

300  
tÙ®
;

301 
	}
}

303 
	gBrownŸnProûss
::
	$G‘TÙ®Squ¬eGC
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
) {

304 
‹mp
 = 1.0/(1.0+
	`exp
(-
š¡ªtProûss
->
	`G‘NodeV®
(
äom
->
	`G‘Node
())->
	`v®
().
	`G‘A¼ay
()[
v
]));

305 
tÙ®
 = 
‹mp
 *emp;

306 
n
++;

307 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

308 
tÙ®
 +ğ
	`G‘TÙ®Squ¬eGC
(
v
, 
lšk
->
	`Out
(),
n
);

310  
tÙ®
;

311 
	}
}

314 
	gCÚjug©eBrownŸnProûss
::
	$CÚjug©eBrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
CÚjug©eInv”£Wish¬t
* 
šsigma
) {

316 
Œ“
 = 
šŒ“
;

317 
sigma
 = 
šsigma
;

318 
cÚjug©esigma
 = 
šsigma
;

320 
cÚjug©ePu»BrownŸnProûss
 = 
Ãw
 
	`CÚjug©ePu»BrownŸnProûss
(
Œ“
, 
cÚjug©esigma
);

321 
pu»BrownŸnProûss
 = 
cÚjug©ePu»BrownŸnProûss
;

323 
cÚjug©eIn¡ªtProûss
 = 
Ãw
 
	`CÚjug©eMuÉiV¬Ÿ‹T»eProûss
(
cÚjug©esigma
,
Œ“
);

324 
š¡ªtProûss
 = 
cÚjug©eIn¡ªtProûss
;

325 
š¡ªtProûss
->
	`Re£t
();

327 
	}
}

	@BrownianProcess.h

1 #iâdeà
BROWNIANPROCESS_H


2 
	#BROWNIANPROCESS_H


	)

4 
	~"MuÉiV¬Ÿ‹T»eProûss.h
"

5 
	~"Pu»BrownŸnProûss.h
"

6 
	~"CÚjug©eInv”£Wish¬t.h
"

7 
	~"CÚjug©eMuÉiV¬Ÿ‹T»eProûss.h
"

8 
	~"Move.h
"

10 şas 
	cBrownŸnProûss
 : 
public
 
MCMC
 {

12 
public
 :

13 
	$BrownŸnProûss
() {}

14 
	`BrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
V¬
<
CovM©rix
>* 
šsigma
, V¬<
PosR—l
>* 
šagesÿË
 = 0, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
 = 0);

15 
vœtu®
 ~
	`BrownŸnProûss
();

17 
vœtu®
 
	`d¿wSam¶e
();

18 
vœtu®
 
	`G‘LogProb
();

20 
vœtu®
 
	`Move
(
tunšg
);

23 
vœtu®
 
T»e
* 
	$G‘T»e
(è{  
	`G‘L’gthT»e
()->
	`G‘T»e
();
	}
}

24 
vœtu®
 
ChrÚog¿m
* 
	$G‘L’gthT»e
(è{  
Œ“
; 
	}
}

26 
Pu»BrownŸnProûss
* 
	$G‘Pu»BrownŸnProûss
(è{ 
pu»BrownŸnProûss
;
	}
}

27 
MuÉiV¬Ÿ‹T»eProûss
* 
	$G‘In¡ªtProûss
(è{ 
š¡ªtProûss
; 
	}
}

31 
PrštL’gths
(
o¡»am
& 
os
);

32 
PrštL’gths
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
);

34 
PrštNodeV®s
(
o¡»am
& 
os
);

35 
PrštNodeV®s
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
);

37 
g‘TÙ®L’gth
();

38 
g‘TÙ®L’gth
(cÚ¡ 
Lšk
* 
äom
);

39 
G‘M—nR©e
(
v
);

40 
G‘IÁeg¿lR©e
(
v
);

41 
G‘V¬R©e
(
v
);

42 
G‘TÙ®R©e
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
);

43 
G‘TÙ®Squ¬eR©e
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
);

44 
G‘IÁeg¿lR©e
(
v
, cÚ¡ 
Lšk
* 
äom
);

45 
G‘M—nGC
(
v
);

46 
G‘V¬GC
(
v
);

47 
G‘TÙ®GC
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
);

48 
G‘TÙ®Squ¬eGC
(
v
, cÚ¡ 
Lšk
* 
äom
, & 
n
);

50 ** 
G‘Inüem’tSum
();

51 
G‘Inüem’tSum
(** 
A
, cÚ¡ 
Lšk
* 
äom
);

52 
G‘NB¿nch
();

53 
G‘NSubB¿nch
();

54 
G‘NOÃSubB¿nch
();

55 
G‘MšNSubB¿nch
();

56 
G‘MaxNSubB¿nch
();

57 
G‘M—nNSubB¿nch
();

58 
G‘NB¿nch
(cÚ¡ 
Lšk
* 
äom
);

59 
G‘NSubB¿nch
(cÚ¡ 
Lšk
* 
äom
);

60 
G‘NOÃSubB¿nch
(cÚ¡ 
Lšk
* 
äom
);

61 
G‘MšNSubB¿nch
(cÚ¡ 
Lšk
* 
äom
);

62 
G‘MaxNSubB¿nch
(cÚ¡ 
Lšk
* 
äom
);

64 
	g´Ùeùed
:

66 
ChrÚog¿m
 *
Œ“
;

67 
	gV¬
<
	gCovM©rix
> *
	gsigma
;

68 
	gV¬
<
	gPosR—l
>* 
	gagesÿË
;

69 
Glob®SÿlšgFunùiÚ
* 
	gsÿËfunùiÚ
;

71 
Pu»BrownŸnProûss
 *
	gpu»BrownŸnProûss
;

72 
MuÉiV¬Ÿ‹T»eProûss
 *
	gš¡ªtProûss
;

75 
şass
 
	gBrownŸnSigmaMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

77 
	gpublic
 :

79 
BrownŸnSigmaMove
(
Inv”£Wish¬tM©rix
* 
šsigma
, 
BrownŸnProûss
* 
š´oûss
, 
štunšg
) {

80 
	gsigma
 = 
šsigma
;

81 
	g´oûss
 = 
š´oûss
;

82 
	gbrownŸÅroûss
 = 
š´oûss
->
G‘Pu»BrownŸnProûss
();

83 
	gš¡ªroûss
 = 
š´oûss
->
G‘In¡ªtProûss
();

84 
	gtunšg
 = 
štunšg
;

85 
RecursiveRegi¡”
(
G‘RoÙ
());

86 
	gsigma
->
Regi¡”
(
this
);

89 cÚ¡ 
Lšk
* 
G‘RoÙ
() {

90  
	gš¡ªroûss
->
G‘RoÙ
();

93 
G‘Dim
() {

94  
	gsigma
->
G‘Dim
();

97 
RecursiveRegi¡”
(cÚ¡ 
Lšk
* 
äom
) {

100 ià(! 
	gäom
->
isRoÙ
()) {

101 
	gbrownŸÅroûss
->
G‘RªdomBrownŸnP©h
(
äom
)->
Regi¡”
(
this
);

104 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

105 
RecursiveRegi¡”
(
lšk
->
Out
());

109 
RecursiveMuÉly
(cÚ¡ 
Lšk
* 
äom
, ** 
Q
) {

112 ià(! 
	gäom
->
isRoÙ
()) {

113 
	gbrownŸÅroûss
->
G‘RªdomBrownŸnP©h
(
äom
)->
LeáMuÉly
(
Q
);

116 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

117 
RecursiveMuÉly
(
lšk
->
Out
(),
Q
);

121 
Compu‹ExpÚ’tŸl
(** 
S
) {

123 
	gn¡•
 = 5;

125 ** 
	gQ
 = 
Ãw
 *[
G‘Dim
()];

126 
	gi
=0; i<
G‘Dim
(); i++) {

127 
	gQ
[
i
] = 
Ãw
 [
G‘Dim
()];

130 
	gz
 = 
exp
(
log
(2.0è* 2 * 
n¡•
);

131 
	gi
=0; i<
G‘Dim
(); i++) {

132 
	gj
=0; j<
G‘Dim
(); j++) {

133 
	gS
[
i
][
j
] /ğ
z
;

136 
	gi
=0; i<
G‘Dim
(); i++) {

137 
	gS
[
i
][i] += 1.0;

140 
	gn
=0;‚<
	gn¡•
;‚++) {

142 
	gi
=0; i<
G‘Dim
(); i++) {

143 
	gj
=0; j<
G‘Dim
(); j++) {

144 
	gtmp
 = 0;

145 
	gk
=0; k<
G‘Dim
(); k++) {

146 
	gtmp
 +ğ
S
[
i
][
k
] * S[k][
j
];

148 
	gQ
[
i
][
j
] = 
tmp
;

152 
	gi
=0; i<
G‘Dim
(); i++) {

153 
	gj
=0; j<
G‘Dim
(); j++) {

154 
	gtmp
 = 0;

155 
	gk
=0; k<
G‘Dim
(); k++) {

156 
	gtmp
 +ğ
Q
[
i
][
k
] * Q[k][
j
];

158 
	gS
[
i
][
j
] = 
tmp
;

163 
	gi
=0; i<
G‘Dim
(); i++) {

164 
	gd–‘e
[] 
	gQ
[
i
];

166 
	gd–‘e
[] 
	gQ
;

169 
Move
(
tunšg_mod
) {

171 
	glogd1
 = 
sigma
->
G‘LogD‘”mšªt
();

176 
CÜru±
(
Œue
);

179 ** 
	gS
 = 
Ãw
 *[
G‘Dim
()];

180 
	gi
=0; i<
G‘Dim
(); i++) {

181 
	gS
[
i
] = 
Ãw
 [
G‘Dim
()];

184 
	gi
=0; i<
G‘Dim
(); i++) {

185 
	gj
=0; j<
G‘Dim
(); j++) {

186 
	gS
[
i
][
j
] = 
tunšg
 * 
tunšg_mod
 * 
Rªdom
::
sNÜm®
();

191 
Compu‹ExpÚ’tŸl
(
S
);

194 
RecursiveMuÉly
(
G‘RoÙ
(),
S
);

197 
	gsigma
->
LeáRightMuÉly
(
S
);

199 
	gd–logp
 = 
Upd©e
();

201 
	glogd2
 = 
sigma
->
G‘LogD‘”mšªt
();

206 
	glogd‘p
 = 0.5 * (
logd2
 - 
logd1
);

208 
	glogh
 = (
´oûss
->
G‘NSubB¿nch
(è-…roûss->
G‘NB¿nch
(è+ 2è* 
logd‘p
;

213 
	gd–logp
 +ğ
logh
;

215 
	gacû±
 = (
log
(
Rªdom
::
UnifÜm
()è< 
d–logp
);

217 ià(! 
	gacû±
) {

218 
CÜru±
(
çl£
);

219 
Re¡Üe
();

222 
	gi
=0; i<
G‘Dim
(); i++) {

223 
	gd–‘e
[] 
	gS
[
i
];

225 
	gd–‘e
[] 
	gS
;

227  
	gacû±
;

231 
	g´iv©e
:

234 
Pu»BrownŸnProûss
* 
brownŸÅroûss
;

235 
MuÉiV¬Ÿ‹T»eProûss
* 
	gš¡ªroûss
;

236 
Inv”£Wish¬tM©rix
 *
	gsigma
;

237 
BrownŸnProûss
 *
	g´oûss
;

238 
	gtunšg
;

319 şas 
	cCÚjug©eBrownŸnSigmaMove
 : 
public
 
MCUpd©e
 {

321 
public
:

322 
	$CÚjug©eBrownŸnSigmaMove
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
BrownŸnProûss
 *
š´oûss
) {

323 
sigma
 = 
šsigma
;

324 
´oûss
 = 
š´oûss
;

327 
	$Move
(
tunšg
) {

328 **
A
 = 
´oûss
->
	`G‘Inüem’tSum
();

329 
N
 = 
´oûss
->
	`G‘NSubB¿nch
();

330 
sigma
->
	`IÁeg¿‹
();

331 
sigma
->
	`AddToSÿË
(
A
);

332 
sigma
->
	`AddToSh­e
(
N
);

333 
sigma
->
	`Re§m¶e
();

334 
i
=0; i<
sigma
->
	`G‘Dim
(); i++)

335 
d–‘e
[] 
A
[
i
];

336 
d–‘e
[] 
A
;

338 
	}
}

340 
	g´iv©e
:

341 
CÚjug©eInv”£Wish¬t
 *
sigma
;

342 
BrownŸnProûss
 *
	g´oûss
;

346 şas 
	cCÚjug©eBrownŸnProûss
 : 
public
 
BrownŸnProûss
 {

348 
public
:

350 
CÚjug©eBrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
CÚjug©eInv”£Wish¬t
* 
šsigma
);

352 
CÚjug©ePu»BrownŸnProûss
* 
	$G‘CÚjug©ePu»BrownŸnProûss
(è{ 
cÚjug©ePu»BrownŸnProûss
;}

353 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
	$G‘CÚjug©eIn¡ªtProûss
(è{ 
cÚjug©eIn¡ªtProûss
; 
	}
}

354 
CÚjug©eInv”£Wish¬t
* 
	$G‘CÚjug©eInv”£Wish¬t
(è{ 
cÚjug©esigma
;
	}
}

356 
	g´Ùeùed
:

358 
CÚjug©eInv”£Wish¬t
* 
cÚjug©esigma
;

359 
CÚjug©ePu»BrownŸnProûss
 *
	gcÚjug©ePu»BrownŸnProûss
;

360 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
 *
	gcÚjug©eIn¡ªtProûss
;

364 şas 
	cFuÎCÚjug©eBrownŸnSigmaMove
 : 
public
 
MCUpd©e
 {

366 
public
:

368 
	$FuÎCÚjug©eBrownŸnSigmaMove
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
CÚjug©eBrownŸnProûss
 *
š´oûss
, 
štunšg
, 
šÄ•
) {

369 
sigma
 = 
šsigma
;

370 
´oûss
 = 
š´oûss
;

371 
tunšg
 = 
štunšg
;

372 
Ä•
 = 
šÄ•
;

375 
	$Move
(
tunšg_moduÏtÜ
) {

377 
sigma
->
	`IÁeg¿‹
();

379 
r
 = 0;

380 
i
=0; i<
Ä•
; i++){

381 
r
 +ğ
´oûss
->
	`Move
(
tunšg
 * 
tunšg_moduÏtÜ
);

384 
sigma
->
	`Re§m¶e
();

385  
Ä•
 ? 
r
 /‚rep : 1.0;

386 
	}
}

388 
	g´iv©e
:

390 
CÚjug©eInv”£Wish¬t
 *
sigma
;

391 
CÚjug©eBrownŸnProûss
 *
	g´oûss
;

392 
	gtunšg
;

393 
	gÄ•
;

695 şas 
	cCÚjug©eBrownŸnEx‹º®Move
 : 
public
 
MCUpd©e
 {

697 
CÚjug©eBrownŸnProûss
 *
´oûss
;

698 
CÚjug©eInv”£Wish¬t
* 
	mŒuem©
;

699 
Inv”£Wish¬tM©rix
* 
	mm©
;

700 
CÚjug©ePu»BrownŸnProûss
* 
	mbrownŸÅroûss
;

701 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
	mš¡ªroûss
;

703 
	mtunšg
;

704 
	mÄ•
;

705 
	mdim
;

707 
	msh­e¡©
;

708 
CovM©rix
 
	msÿË¡©
;

709 
	mbksh­e¡©
;

710 
CovM©rix
 
	mbksÿË¡©
;

712 
	mpublic
:

714 
	$CÚjug©eBrownŸnEx‹º®Move
(
CÚjug©eInv”£Wish¬t
* 
šm©
, 
CÚjug©eBrownŸnProûss
* 
š´oûss
, 
štunšg
, 
šÄ•
è: 
	`sÿË¡©
(šm©->
	`G‘Dim
()), 
	`bksÿË¡©
(šm©->
	$G‘Dim
()) {

715 
´oûss
 = 
š´oûss
;

716 
brownŸÅroûss
 = 
š´oûss
->
	`G‘CÚjug©ePu»BrownŸnProûss
();

717 
š¡ªroûss
 = 
š´oûss
->
	`G‘CÚjug©eIn¡ªtProûss
();

718 
Œuem©
 = 
šm©
;

719 
tunšg
 = 
štunšg
;

720 
Ä•
 = 
šÄ•
;

721 
dim
 = 
Œuem©
->
	`G‘Dim
();

724 cÚ¡ 
Lšk
* 
	$G‘RoÙ
() {

725  
š¡ªroûss
->
	`G‘RoÙ
();

726 
	}
}

728 
	$Move
(
tunšg_moduÏtÜ
){

730 
Çcû±
 = 0;

731 
ÁÙ
 = 0;

733 
m©
 = 
Ãw
 
	`Inv”£Wish¬tM©rix
(
Œuem©
->
	`G‘DŸgÚ®M©rix
(),Œuem©->
	`G‘P
());

734 
m©
->
	`£tv®
(
Œuem©
->
	`v®
());

735 
m©
->
	`CÜru±
(
çl£
);

736 
m©
->
	`Upd©e
();

738 
	`P»·»Suffic›ÁSti¡ic
();

739 
»p
=0;„•<
Ä•
;„ep++) {

740 
	`RecursiveNodeCÚjug©eMove
(
	`G‘RoÙ
(),
Çcû±
,
ÁÙ
,
tunšg
*
tunšg_moduÏtÜ
);

741 
	`RecursiveB¿nchCÚjug©eMove
(
	`G‘RoÙ
(),
Çcû±
,
ÁÙ
,
tunšg
*
tunšg_moduÏtÜ
);

744 
Œuem©
->
	`£tv®
(
m©
->
	`v®
());

745 
Œuem©
->
	`CÜru±
(
çl£
);

746 
Œuem©
->
	`Upd©e
();

747 
d–‘e
 
m©
;

749  
Çcû±
 / 
ÁÙ
;

750 
	}
}

752 
	$Re£tSuffic›ÁSti¡ic
() {

753 
sh­e¡©
 = 0;

754  
i
=0; i<
dim
; i++){

755  
j
=0; j<
dim
; j++){

756 
sÿË¡©
[
i
][
j
] = 0;

759 
	}
}

761 
	$SaveSuffic›ÁSti¡ic
() {

762 
bksh­e¡©
 = 
sh­e¡©
;

763  
i
=0; i<
dim
; i++){

764 
bksÿË¡©
[
i
][i] = 
sÿË¡©
[i][i];

765  
j
=0; j<
i
; j++){

766 
bksÿË¡©
[
i
][
j
] = 
sÿË¡©
[i][j];

769 
	}
}

771 
	$Re¡ÜeSuffic›ÁSti¡ic
() {

772 
bksh­e¡©
 = 
sh­e¡©
;

773  
i
=0; i<
dim
; i++){

774 
sÿË¡©
[
i
][i] = 
bksÿË¡©
[i][i];

775  
j
=0; j<
i
; j++){

776 
sÿË¡©
[
i
][
j
] = 
bksÿË¡©
[i][j];

777 
sÿË¡©
[
j
][
i
] = 
bksÿË¡©
[i][j];

780 
	}
}

782 
	$AddToSÿË
(cÚ¡ * 
š
, 
boŞ
 
pos
 = 
Œue
) {

783 
•sÚ
 = 
pos
 ? 1.0 : -1.0;

784  
i
=0; i<
dim
; i++){

785 
sÿË¡©
[
i
][i] +ğ
•sÚ
 * 
š
[i] * in[i];

786  
j
=0; j<
i
; j++){

787 
sÿË¡©
[
i
][
j
] +ğ
•sÚ
 * 
š
[i] * in[j];

788 
sÿË¡©
[
j
][
i
] = scalestat[i][j];

791 
	}
}

793 
	$AddToSÿË
(** 
š
, 
boŞ
 
pos
 = 
Œue
) {

794 
•sÚ
 = 
pos
 ? 1.0 : -1.0;

795  
i
=0; i<
dim
; i++){

796 
j
=0; j<
dim
; j++) {

797 
sÿË¡©
[
i
][
j
] +ğ
•sÚ
 * 
š
[i][j];

800 
	}
}

802 
	$P»·»Suffic›ÁSti¡ic
() {

803 
	`Re£tSuffic›ÁSti¡ic
();

804 
	`RecursiveAddSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

805 
	}
}

807 
	$RecursiveAddSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

809 ià(! 
äom
->
	`isRoÙ
()) {

811 
CÚjug©eMuÉiNÜm®
* 
rg‘
 = 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
);

812 
rg‘
->
	`Compu‹CÚŒa¡
();

813 
	`AddToSÿË
(
rg‘
->
	`G‘CÚŒa¡
(),
Œue
);

815 
CÚjug©eRªdomBrownŸnP©h
* 
·th
 = 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
->
	`Out
());

816 
·th
->
	`Compu‹CÚŒa¡
();

817 
	`AddToSÿË
(
·th
->
	`G‘CÚŒa¡
(),
Œue
);

819 
sh­e¡©
 +ğ
·th
->
	`g‘NSegm’ts
();

821 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

822 
	`RecursiveAddSuffic›ÁSti¡ic
(
lšk
->
	`Out
());

824 
	}
}

826 
	$RecursiveNodeCÚjug©eMove
(cÚ¡ 
Lšk
* 
äom
, & 
Çcû±
, & 
ÁÙ
, 
tunšg
) {

828 
Çcû±
 +ğ
	`LoÿlNodeCÚjug©eMove
(
äom
,
tunšg
);

829 
ÁÙ
++;

830 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

831 
	`RecursiveNodeCÚjug©eMove
(
lšk
->
	`Out
(),
Çcû±
,
ÁÙ
,
tunšg
);

833 
	}
}

835 
	$RecursiveB¿nchCÚjug©eMove
(cÚ¡ 
Lšk
* 
äom
, & 
Çcû±
, & 
ÁÙ
, 
tunšg
) {

837 ià(! 
äom
->
	`isRoÙ
()) {

838 
Çcû±
 +ğ
	`LoÿlB¿nchCÚjug©eMove
(
äom
,
tunšg
);

839 
ÁÙ
++;

841 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

842 
	`RecursiveB¿nchCÚjug©eMove
(
lšk
->
	`Out
(),
Çcû±
,
ÁÙ
,
tunšg
);

844 
	}
}

846 
	$LoÿlNodeCÚjug©eMove
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
) {

848 
CÚjug©eMuÉiNÜm®
* 
rg‘
 = 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
);

851 
logp1
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

854 
logq1
 = 0;

856 
logq1
 +ğ
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘LogProb
();

857 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

858 
logq1
 +ğ
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘LogProb
();

861 
	`SaveSuffic›ÁSti¡ic
();

863 ià(! 
äom
->
	`isRoÙ
()) {

864 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`Compu‹CÚŒa¡
();

865 
	`AddToSÿË
(
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘CÚŒa¡
(),
çl£
);

867 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

868 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`Compu‹CÚŒa¡
();

869 
	`AddToSÿË
(
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘CÚŒa¡
(),
çl£
);

873 
rg‘
->
	`CÜru±
(
Œue
);

874 
m©
->
	`CÜru±
(
Œue
);

876 * 
d–x
 = 
Ãw
 [
dim
];

877 
m©
->
	`d¿wV®
(
d–x
);

878 
logh1
 = 
m©
->
	`logV®Prob
(
d–x
);

881 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`Shiá
(
d–x
,
tunšg
);

883 ià(! 
äom
->
	`isRoÙ
()) {

884 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`Compu‹CÚŒa¡
();

885 
	`AddToSÿË
(
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘CÚŒa¡
(),
Œue
);

887 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

888 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`Compu‹CÚŒa¡
();

889 
	`AddToSÿË
(
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘CÚŒa¡
(),
Œue
);

894 
logp2
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

896 
m©
->
	`GibbsRe§m¶e
(
sÿË¡©
,
sh­e¡©
);

897 
m©
->
	`Upd©e
();

899 
d–logp
 = 
rg‘
->
	`Upd©e
();

902 
logh2
 = 
m©
->
	`logV®Prob
(
d–x
);

905 
logq2
 = 0;

907 
logq2
 +ğ
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘LogProb
();

908 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

909 
logq2
 +ğ
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘LogProb
();

912 
d–logp
 -ğ
logq2
 - 
logq1
;

913 
d–logp
 +ğ
logp2
 - 
logp1
;

915 
acû±
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
d–logp
);

916 ià(! 
acû±
) {

917 
	`Re¡ÜeSuffic›ÁSti¡ic
();

918 
rg‘
->
	`CÜru±
(
çl£
);

919 
rg‘
->
	`Re¡Üe
();

920 
m©
->
	`CÜru±
(
çl£
);

921 
m©
->
	`Re¡Üe
();

924 
d–‘e
[] 
d–x
;

926  
acû±
;

927 
	}
}

929 
	$LoÿlB¿nchCÚjug©eMove
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
) {

931 
CÚjug©eRªdomBrownŸnP©h
* 
rg‘
 = 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
);

934 
logp1
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

937 
logq1
 = 0;

939 
logq1
 +ğ
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`G‘LogProb
();

940 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

941 
logq1
 +ğ
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
lšk
->
	`Out
())->
	`G‘LogProb
();

944 
	`SaveSuffic›ÁSti¡ic
();

946 ià(! 
äom
->
	`isRoÙ
()) {

947 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`Compu‹CÚŒa¡
();

948 
	`AddToSÿË
(
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`G‘CÚŒa¡
(),
çl£
);

950 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

951 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
lšk
->
	`Out
())->
	`Compu‹CÚŒa¡
();

952 
	`AddToSÿË
(
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
lšk
->
	`Out
())->
	`G‘CÚŒa¡
(),
çl£
);

955 
rg‘
->
	`CÜru±
(
Œue
);

956 
m©
->
	`CÜru±
(
Œue
);

958 
BrownŸnBridge
 *
Ùh”
 = 
Ãw
 
	`BrownŸnBridge
(
rg‘
->
	`g‘In™Age
(),¬g‘->
	`g‘Fš®Age
(), *
m©
 ,¬g‘->
	`g‘NSegm’ts
(),¬g‘->
	`g‘Segm’tL’gth
());

959 
Ùh”
->
	`g’”©eBridge
();

960 
rg‘
->
	`Shiá
(
Ùh”
,
tunšg
);

962 
logh1
 = 
Ùh”
->
	`g‘LogProb
();

964 ià(! 
äom
->
	`isRoÙ
()) {

965 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`Compu‹CÚŒa¡
();

966 
	`AddToSÿË
(
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`G‘CÚŒa¡
(),
Œue
);

968 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

969 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
lšk
->
	`Out
())->
	`Compu‹CÚŒa¡
();

970 
	`AddToSÿË
(
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
lšk
->
	`Out
())->
	`G‘CÚŒa¡
(),
Œue
);

974 
logp2
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

976 
m©
->
	`GibbsRe§m¶e
(
sÿË¡©
,
sh­e¡©
);

977 
m©
->
	`Upd©e
();

979 
d–logp
 = 
rg‘
->
	`Upd©e
();

982 
logh2
 = 
Ùh”
->
	`g‘LogProb
(*
m©
);

985 
logq2
 = 0;

987 
logq2
 +ğ
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`G‘LogProb
();

988 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

989 
logq2
 +ğ
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
lšk
->
	`Out
())->
	`G‘LogProb
();

992 
d–logp
 -ğ
logq2
 - 
logq1
;

993 
d–logp
 +ğ
logp2
 - 
logp1
;

995 
acû±
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
d–logp
);

996 ià(! 
acû±
) {

997 
	`Re¡ÜeSuffic›ÁSti¡ic
();

998 
rg‘
->
	`CÜru±
(
çl£
);

999 
rg‘
->
	`Re¡Üe
();

1000 
m©
->
	`CÜru±
(
çl£
);

1001 
m©
->
	`Re¡Üe
();

1004 
d–‘e
 
Ùh”
;

1006  
acû±
;

1007 
	}
}

1010 şas 
	cCÚjug©eBrownŸnEx‹º®AÎB¿nchMove
 : 
public
 
MCUpd©e
 {

1012 
CÚjug©eBrownŸnProûss
 *
´oûss
;

1013 
CÚjug©eInv”£Wish¬t
* 
	mŒuem©
;

1014 
Inv”£Wish¬tM©rix
* 
	mm©
;

1015 
CÚjug©ePu»BrownŸnProûss
* 
	mbrownŸÅroûss
;

1016 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
	mš¡ªroûss
;

1018 
	mtunšg
;

1019 
	mÄ•
;

1020 
	mdim
;

1022 
	msh­e¡©
;

1023 
CovM©rix
 
	msÿË¡©
;

1024 
	mbksh­e¡©
;

1025 
CovM©rix
 
	mbksÿË¡©
;

1027 
Mnode
* 
	mmnode
;

1029 
	mpublic
:

1031 
	$CÚjug©eBrownŸnEx‹º®AÎB¿nchMove
(
CÚjug©eInv”£Wish¬t
* 
šm©
, 
CÚjug©eBrownŸnProûss
* 
š´oûss
, 
štunšg
, 
šÄ•
è: 
	`sÿË¡©
(šm©->
	`G‘Dim
()), 
	`bksÿË¡©
(šm©->
	$G‘Dim
()) {

1032 
´oûss
 = 
š´oûss
;

1033 
brownŸÅroûss
 = 
š´oûss
->
	`G‘CÚjug©ePu»BrownŸnProûss
();

1034 
š¡ªroûss
 = 
š´oûss
->
	`G‘CÚjug©eIn¡ªtProûss
();

1035 
Œuem©
 = 
šm©
;

1036 
tunšg
 = 
štunšg
;

1037 
Ä•
 = 
šÄ•
;

1038 
dim
 = 
Œuem©
->
	`G‘Dim
();

1039 
mnode
 = 
Ãw
 
Mnode
;

1040 
	`RecursiveRegi¡”
(
	`G‘RoÙ
());

1043 cÚ¡ 
Lšk
* 
	$G‘RoÙ
() {

1044  
š¡ªroûss
->
	`G‘RoÙ
();

1045 
	}
}

1047 
	$RecursiveRegi¡”
(cÚ¡ 
Lšk
* 
äom
) {

1049 ià(! 
äom
->
	`isRoÙ
()) {

1050 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
)->
	`Regi¡”
(
mnode
);

1053 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

1054 
	`RecursiveRegi¡”
(
lšk
->
	`Out
());

1056 
	}
}

1058 
	$Move
(
tunšg_moduÏtÜ
){

1060 
Çcû±
 = 0;

1061 
ÁÙ
 = 0;

1064 
	`P»·»B¿nchSuffic›ÁSti¡ic
();

1065 
m©
 = 
Ãw
 
	`Inv”£Wish¬tM©rix
(
Œuem©
->
	`G‘DŸgÚ®M©rix
(),Œuem©->
	`G‘P
());

1066 
m©
->
	`CÜru±
(
çl£
);

1067 
m©
->
	`Upd©e
();

1068 
m©
->
	`GibbsRe§m¶e
(
sÿË¡©
,
sh­e¡©
);

1070 
	`P»·»Suffic›ÁSti¡ic
();

1071 
»p
=0;„•<
Ä•
;„ep++) {

1072 
Çcû±
 +ğ
	`AÎB¿nchCÚjug©eMove
(
tunšg
*
tunšg_moduÏtÜ
);

1073 
ÁÙ
++;

1076 
Œuem©
->
	`IÁeg¿‹
();

1077 
Œuem©
->
	`Re§m¶e
();

1079 
d–‘e
 
m©
;

1081  
Çcû±
 / 
ÁÙ
;

1082 
	}
}

1084 
	$Re£tSuffic›ÁSti¡ic
() {

1085 
sh­e¡©
 = 0;

1086  
i
=0; i<
dim
; i++){

1087  
j
=0; j<
dim
; j++){

1088 
sÿË¡©
[
i
][
j
] = 0;

1091 
	}
}

1093 
	$SaveSuffic›ÁSti¡ic
() {

1094 
bksh­e¡©
 = 
sh­e¡©
;

1095  
i
=0; i<
dim
; i++){

1096 
bksÿË¡©
[
i
][i] = 
sÿË¡©
[i][i];

1097  
j
=0; j<
i
; j++){

1098 
bksÿË¡©
[
i
][
j
] = 
sÿË¡©
[i][j];

1101 
	}
}

1103 
	$Re¡ÜeSuffic›ÁSti¡ic
() {

1104 
bksh­e¡©
 = 
sh­e¡©
;

1105  
i
=0; i<
dim
; i++){

1106 
sÿË¡©
[
i
][i] = 
bksÿË¡©
[i][i];

1107  
j
=0; j<
i
; j++){

1108 
sÿË¡©
[
i
][
j
] = 
bksÿË¡©
[i][j];

1109 
sÿË¡©
[
j
][
i
] = 
bksÿË¡©
[i][j];

1112 
	}
}

1114 
	$AddToSÿË
(cÚ¡ * 
š
, 
boŞ
 
pos
 = 
Œue
) {

1115 
•sÚ
 = 
pos
 ? 1.0 : -1.0;

1116  
i
=0; i<
dim
; i++){

1117 
sÿË¡©
[
i
][i] +ğ
•sÚ
 * 
š
[i] * in[i];

1118  
j
=0; j<
i
; j++){

1119 
sÿË¡©
[
i
][
j
] +ğ
•sÚ
 * 
š
[i] * in[j];

1120 
sÿË¡©
[
j
][
i
] = scalestat[i][j];

1123 
	}
}

1125 
	$AddToSÿË
(** 
š
, 
boŞ
 
pos
 = 
Œue
) {

1126 
•sÚ
 = 
pos
 ? 1.0 : -1.0;

1127  
i
=0; i<
dim
; i++){

1128 
j
=0; j<
dim
; j++) {

1129 
sÿË¡©
[
i
][
j
] +ğ
•sÚ
 * 
š
[i][j];

1132 
	}
}

1134 
	$P»·»Suffic›ÁSti¡ic
() {

1135 
	`Re£tSuffic›ÁSti¡ic
();

1136 
	`RecursiveAddSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

1137 
	}
}

1139 
	$RecursiveAddSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

1141 ià(! 
äom
->
	`isRoÙ
()) {

1143 
CÚjug©eMuÉiNÜm®
* 
rg‘
 = 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
);

1144 
rg‘
->
	`Compu‹CÚŒa¡
();

1145 
	`AddToSÿË
(
rg‘
->
	`G‘CÚŒa¡
(),
Œue
);

1147 
CÚjug©eRªdomBrownŸnP©h
* 
·th
 = 
brownŸÅroûss
->
	`G‘CÚjug©eRªdomBrownŸnP©h
(
äom
->
	`Out
());

1148 
·th
->
	`Compu‹CÚŒa¡
();

1149 
	`AddToSÿË
(
·th
->
	`G‘CÚŒa¡
(),
Œue
);

1151 
sh­e¡©
 +ğ
·th
->
	`g‘NSegm’ts
();

1153 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

1154 
	`RecursiveAddSuffic›ÁSti¡ic
(
lšk
->
	`Out
());

1156 
	}
}

1158 
	$P»·»B¿nchSuffic›ÁSti¡ic
() {

1159 
	`Re£tSuffic›ÁSti¡ic
();

1160 
	`RecursiveAddB¿nchSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

1161 
	}
}

1163 
	$RecursiveAddB¿nchSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

1165 ià(! 
äom
->
	`isRoÙ
()) {

1167 
CÚjug©eMuÉiNÜm®
* 
rg‘
 = 
š¡ªroûss
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
);

1168 
rg‘
->
	`Compu‹CÚŒa¡
();

1169 
	`AddToSÿË
(
rg‘
->
	`G‘CÚŒa¡
(),
Œue
);

1171 
sh­e¡©
 ++;

1173 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

1174 
	`RecursiveAddB¿nchSuffic›ÁSti¡ic
(
lšk
->
	`Out
());

1176 
	}
}

1178 
	$AÎB¿nchCÚjug©eMove
(
tunšg
) {

1180 
logp1
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

1181 
logq1
 = 
brownŸÅroûss
->
	`G‘LogProb
();

1183 
	`SaveSuffic›ÁSti¡ic
();

1185 
mnode
->
	`CÜru±
(
Œue
);

1187 
brownŸÅroûss
->
	`RecursivePrİo£Move
(
	`G‘RoÙ
(),
tunšg
,*
m©
);

1189 
	`P»·»Suffic›ÁSti¡ic
();

1192 
logp2
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

1193 
logq2
 = 
brownŸÅroûss
->
	`G‘LogProb
();

1195 
d–logp
 = 
mnode
->
	`Upd©e
();

1196 
d–logp
 -ğ
logq2
 - 
logq1
;

1197 
d–logp
 +ğ
logp2
 - 
logp1
;

1199 
acû±
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
d–logp
);

1200 ià(! 
acû±
) {

1201 
	`Re¡ÜeSuffic›ÁSti¡ic
();

1202 
mnode
->
	`CÜru±
(
çl£
);

1203 
mnode
->
	`Re¡Üe
();

1206  
acû±
;

1207 
	}
}

	@Chain.cpp

1 
	~"Chaš.h
"

2 
	~"ChrÚo.h
"

3 
	~<cm©h
>

5 
	gChaš
::
	$Chaš
() {

6 
ev”y
 = 1;

7 
uÁ
 = -1;

8 
size
 = 0;

9 
mod–
 = 0;

10 
Çme
 = "";

11 
	}
}

13 
	gChaš
::
	$MakeFes
(
fÜû
) {

14 ià(
	`if¡»am
((
Çme
 + ".·¿m").
	`c_¡r
()è&& (! 
fÜû
)) {

15 
û¼
 << "alreadyƒxisting chain, cannot override (unless in forcing mode)\n";

16 
	`ex™
(1);

18 
of¡»am
 
	`·¿m_os
((
Çme
 + ".·¿m").
	`c_¡r
());

19 
of¡»am
 
	`chaš_os
((
Çme
 + ".chaš").
	`c_¡r
());

20 
of¡»am
 
	`mÚ_os
((
Çme
 + ".mÚ™Ü").
	`c_¡r
());

21 
of¡»am
 
	`Œaû_os
((
Çme
 + ".Œaû").
	`c_¡r
());

22 
mod–
->
	`T¿ûH—d”
(
Œaû_os
);

23 
	}
}

25 
	gChaš
::
	$MÚ™Ü
() {

26 
of¡»am
 
	`Œaû_os
((
Çme
 + ".Œaû").
	`c_¡r
(), 
ios_ba£
::
­p
);

27 
mod–
->
	`T¿û
(
Œaû_os
);

28 
of¡»am
 
	`mÚ_os
((
Çme
 + ".mÚ™Ü").
	`c_¡r
());

29 
of¡»am
 
	`mÚ_d‘_os
((
Çme
 + ".d‘as").
	`c_¡r
());

30 
mod–
->
	`MÚ™Ü
(
mÚ_os
, 
mÚ_d‘_os
);

32 
	}
}

34 
	gChaš
::
	$SavePošt
() {

35 
of¡»am
 
	`chaš_os
((
Çme
 + ".chaš").
	`c_¡r
(), 
ios_ba£
::
­p
);

36 
mod–
->
	`ToSŒ—m
(
chaš_os
);

37 
size
++;

38 
	}
}

40 
	gChaš
::
	$Re£t
(
fÜû
) {

41 
size
 = 0;

42 
	`MakeFes
(
fÜû
);

43 
	`Save
();

44 
	}
}

46 
	gChaš
::
	$Move
() {

47 
i
=0; i<
ev”y
; i++) {

48 
mod–
->
	`Move
();

57 
	`SavePošt
();

58 
	`Save
();

59 
	`MÚ™Ü
();

60 
	}
}

62 
	gChaš
::
	$S¹
() {

63 
of¡»am
 
	`run_os
((
Çme
 + ".run").
	`c_¡r
());

64 
run_os
 << 1 << '\n';

65 
run_os
.
	`şo£
();

66 
	`Run
();

67 
	}
}

69 
	gChaš
::
	$G‘RuÂšgStus
() {

70 
if¡»am
 
	`run_is
((
Çme
 + ".run").
	`c_¡r
());

71 
run
;

72 
run_is
 >> 
run
;

73  
run
;

74 
	}
}

76 
	gChaš
::
	$Run
() {

77 
	`G‘RuÂšgStus
(è&& ((
uÁ
 =ğ-1è|| (
size
 <= until))) {

78 
ChrÚo
 
chrÚo
;

79 
chrÚo
.
	`Re£t
();

80 
chrÚo
.
	`S¹
();

81 
	`Move
();

82 
chrÚo
.
	`Stİ
();

88 
of¡»am
 
	`run_os
((
Çme
 + ".run").
	`c_¡r
());

89 
run_os
 << 0 << '\n';

90 
	}
}

	@Chain.h

1 #iâdeà
CHAIN_H


2 
	#CHAIN_H


	)

4 
	~<f¡»am
>

5 
	~<c¡dlib
>

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	~"ProbMod–.h
"

23 şas 
	cChaš
 {

25 
	mpublic
:

27 
Chaš
();

29 
	mvœtu®
 ~
	$Chaš
() {};

31 
vœtu®
 
	`MakeFes
(
fÜû
 = 0);

34 
vœtu®
 
	`MÚ™Ü
();

37 
vœtu®
 
	`SavePošt
();

40 
vœtu®
 
	`Re£t
(
fÜû
 = 0);

43 
vœtu®
 
	`Move
();

46 
vœtu®
 
	`S¹
();

49 
vœtu®
 
	`G‘RuÂšgStus
();

54 
vœtu®
 
	`Run
();

58 
vœtu®
 
¡ršg
 
	`G‘Mod–Ty³
() = 0;

62 
vœtu®
 
	`New
(
fÜû
 = 0) = 0;

65 
vœtu®
 
	`O³n
() = 0;

68 
vœtu®
 
	`Save
() = 0;

71 
¡ršg
 
	$G‘Name
(è{ 
Çme
;
	}
}

73 
	$S‘Ev”y
(
šev”y
è{
ev”y
 = iÃv”y;
	}
}

74 
	$S‘UÁ
(
šuÁ
è{
uÁ
 = inuÁ;
	}
}

76 
ProbMod–
* 
	$G‘Mod–
(è{ 
mod–
;
	}
}

77 
	$G‘Size
(è{ 
size
;
	}
}

80 
	g´Ùeùed
:

82 
ev”y
;

83 
	guÁ
;

84 
	gsize
;

85 
ProbMod–
* 
	gmod–
;

86 
¡ršg
 
	gÇme
;

	@Chrono.cpp

1 
	~"ChrÚo.h
"

3 
	gChrÚo
::
	$Re£t
() {

5 
TÙ®Time
 = 0;

6 
N
 = 0;

7 
	}
}

9 
	gChrÚo
::
	$S¹
() {

12 
timev®
 
tod
;

13 
	`g‘timeofday
(&
tod
,
NULL
);

14 
£c1
 = ((è
tod
.
tv_£c
);

15 
mli1
 = ((è
tod
.
tv_u£c
) / 1000;

16 
	}
}

18 
	gChrÚo
::
	$Stİ
() {

26 
timev®
 
tod
;

27 
	`g‘timeofday
(&
tod
,
NULL
);

28 
£c2
 = ((è
tod
.
tv_£c
);

29 
mli2
 = ((è
tod
.
tv_u£c
) / 1000;

30 
du¿tiÚ
 = 1000*(
£c2
 - 
£c1
è+ 
mli2
 - 
mli1
;

32 
TÙ®Time
 +ğ
du¿tiÚ
;

33 
	}
}

35 
	gChrÚo
::
İ”©Ü
++() {

36  
N
++;

39 
	gChrÚo
::
	$G‘Time
() {

40  
TÙ®Time
;

41 
	}
}

43 
	gChrÚo
::
	$G‘TimeP”CouÁ
() {

44  
TÙ®Time
 / 
N
;

45 
	}
}

47 
	gChrÚo
::
	$G‘CouÁ
() {

48  
N
;

49 
	}
}

	@Chrono.h

1 #iâdeà
CHRONO_H


2 
	#CHRONO_H


	)

4 
	~<ùime
>

6 
	~<sys/time.h
>

8 şas 
	cChrÚo
 {

10 
	mpublic
:

12 
	$ChrÚo
(){};

13 ~
	$ChrÚo
(è{
	}
};

14 
Re£t
();

15 
S¹
();

16 
Stİ
();

17 
	gİ”©Ü
++();

19 
G‘Time
();

20 
G‘TimeP”CouÁ
();

21 
G‘CouÁ
();

23 
	g´iv©e
:

26 
£c1
;

27 
	g£c2
;

28 
	gmli1
;

29 
	gmli2
;

31 
	gTÙ®Time
;

32 
	gN
;

	@Chronogram.h

1 #iâdeà
CHRONOGRAM_H


2 
	#CHRONOGRAM_H


	)

4 
	~"V®T»e.h
"

5 
	~"T»e.h
"

6 
	~<m©h.h
>

7 
	~<®gÜ™hm
>

8 
	~"RªdomTy³s.h
"

10 
	g‹m¶©e
<
şass
 
	gU
, cÏs 
	gV
> cÏs 
	gNodeB¿nchProûss
 : 
public
 
MCMC
 ,…ubliø
	gNodeB¿nchV®PŒT»e
<
	gRv¬
 <U>, 
	gDv¬
 <V> > {

12 
	gpublic
:

13 
U
 
v®
(cÚ¡ 
Node
* 
node
) {

14  
this
->
G‘NodeV®
(
node
)->
v®
();

17 
£tv®
(cÚ¡ 
Node
* 
node
, 
U
 
šv®
) {

18 
	gthis
->
G‘NodeV®
(
node
)->
£tv®
(
šv®
);

21 
V
 
v®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

22  
	gthis
->
G‘B¿nchV®
(
b¿nch
)->
v®
();

25 
£tv®
(cÚ¡ 
B¿nch
* 
b¿nch
, 
V
 
šv®
) {

26 
	gthis
->
G‘B¿nchV®
(
b¿nch
)->
£tv®
(
šv®
);

29 
vœtu®
 
d¿wSam¶e
() {

33 
vœtu®
 
G‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

34 
	gtÙ®
 = 
this
->
G‘NodeV®
(
äom
->
G‘Node
())->
G‘LogProb
();

35 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

36 
tÙ®
 +ğ
G‘LogProb
(
lšk
->
Out
());

38  
	gtÙ®
;

41 
vœtu®
 
G‘LogProb
() {

42  
G‘LogProb
(
this
->
G‘RoÙ
());

47 
şass
 
	gNodeD©e
 : 
public
 
Rv¬
<
PosR—l
>{

49 
´Ùeùed
:

51 
mš
, 
	gmax
;

53 
	gpublic
:

55 
NodeD©e
() {

59 
NodeD©e
(
V¬
<
PosR—l
>* 
šR©e
){

60 
Regi¡”
(
šR©e
);

61 
S‘Name
("date");

64 
d¿wSam¶e
(){}

67 
G‘Mš
() {

68  
	gmš
;

71 
G‘Max
() {

72  
	gmax
;

75 
vœtu®
 
S‘MšMax
(
šMš
, 
šMax
){

76 
	gmš
 = 
šMš
;

77 
	gmax
 = 
šMax
;

78 ià(
	gmax
 < 
	gmš
) {

79 
	gû¼
 << "”rÜ : max < mš : " << 
	gmš
 << '\t' << 
	gmax
 << '\n';

80 
ex™
(1);

84 
Prİo£Move
(
tunšg
) {

85 
	gm
 = (
max
 - 
mš
è* 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

86 
	gv®ue
 +ğ
m
;

87 (
	gv®ue
 < 
	gmš
è|| (v®u> 
	gmax
)){

88 ià(
	gv®ue
 < 
	gmš
){

89 
	gv®ue
 = 2 * 
mš
 - 
v®ue
;

91 ià(
	gv®ue
 > 
	gmax
){

92 
	gv®ue
 = 2 * 
max
 - 
v®ue
;

98 
Em±yMove
() {

99 
	gv®ue
 = (
max
 - 
mš
è* 
Rªdom
::
UnifÜm
() + min;

102 
vœtu®
 
logProb
(){ 0;}

107 
şass
 
	gB¿nchL’gth
 : 
public
 
Dv¬
<
PosR—l
>{

109 
´iv©e
:

110 
V¬
<
PosR—l
>* 
BefÜe
;

111 
	gV¬
<
	gPosR—l
>* 
	gAá”
;

112 
	gV¬
<
	gPosR—l
>* 
	gR©e
;

115 
	gpublic
:

116 
B¿nchL’gth
(
V¬
<
PosR—l
>* 
šBefÜe
, V¬<PosR—l>* 
šAá”
, V¬<PosR—l>* 
šR©e
){

117 
	gBefÜe
 = 
šBefÜe
;

118 
	gAá”
 = 
šAá”
;

119 
	gR©e
 = 
šR©e
;

120 
Regi¡”
(
šR©e
);

121 
Regi¡”
(
šBefÜe
);

122 
Regi¡”
(
šAá”
);

123 
S‘Name
("time");

124 
¥ecŸlUpd©e
();

128 ~
B¿nchL’gth
(){};

131 
¥ecŸlUpd©e
(){

132 
	gÃwv®
 = (
BefÜe
->
v®
(è- 
Aá”
->v®()è* 
R©e
->val();

133 ià(
	gÃwv®
 < 1e-7) {

134 
	gÃwv®
 = 1e-7;

136 
£tv®
(
Ãwv®
);

142 
şass
 
	gChrÚog¿m
 : 
public
 
NodeB¿nchProûss
<
PosR—l
, 
	gPosR—l
> {

144 
	gpublic
:

146 
ChrÚog¿m
() {}

148 
ChrÚog¿m
(
T»e
* 
šŒ“
, 
V¬
<
PosR—l
>* 
šR©e
) {

149 
S‘W™hRoÙ
(
çl£
);

150 
	gŒ“
 = 
šŒ“
;

151 
	g¿‹
 = 
šR©e
;

153 
RecursiveC»©eNode
(
G‘RoÙ
());

154 
RecursiveC»©eB¿nch
(
G‘RoÙ
());

156 
	gmaxage
 = 
RecursiveS‘NodesV®ues
(
G‘RoÙ
());

157 
RecursiveEqu®izeL—fNodes
(
G‘RoÙ
(),
maxage
);

158 
RecursiveNÜm®izeT»e
(
G‘RoÙ
(),
maxage
,
Œue
);

159 
RecursiveUpd©eB¿nches
(
G‘RoÙ
());

169 
ChrÚog¿m
(
T»e
* 
šŒ“
) {

170 
	g¿‹
 = 
Ãw
 
CÚ¡
<
PosR—l
>(1);

171 
S‘W™hRoÙ
(
çl£
);

172 
	gŒ“
 = 
šŒ“
;

174 
RecursiveC»©eNode
(
G‘RoÙ
());

175 
RecursiveC»©eB¿nch
(
G‘RoÙ
());

177 
	gmaxage
 = 
RecursiveS‘NodesV®ues
(
G‘RoÙ
());

178 
RecursiveEqu®izeL—fNodes
(
G‘RoÙ
(),
maxage
);

179 
RecursiveNÜm®izeT»e
(
G‘RoÙ
(),
maxage
,
Œue
);

180 
RecursiveUpd©eB¿nches
(
G‘RoÙ
());

195 
PrštAges
(
o¡»am
& 
os
) {

196 
PrštAges
(
os
,
G‘RoÙ
());

199 
PrštAges
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

200 ià(! 
	gäom
->
isL—f
()) {

201 
	gos
 << 
G‘T»e
()->
G‘LeáMo¡
(
äom
è<< '\t' << G‘T»e()->
G‘RightMo¡
(from) << '\t';

202 
	gos
 << 
G‘AbsŞu‹Time
(
äom
) << '\n';

203 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

204 
PrštAges
(
os
,
lšk
->
Out
());

209 
Regi¡”Node
(
DAGnode
* 
node
) {

210 
RecursiveRegi¡”
(
node
,
G‘RoÙ
());

213 
boŞ
 
comµo¤—l
(
V¬
<
PosR—l
>* 
a
, V¬<PosR—l>* 
b
è{ (((è
	ga
->
v®
()è> ((è
	gb
->val()));}

215 
	gveùÜ
<
	gV¬
<
	gPosR—l
>*> 
G‘D©eLi¡
() {

216 
	gveùÜ
<
	gV¬
<
	gPosR—l
>*> 
	gËaæi¡
 = 
G‘L—fLi¡
();

217 
	gveùÜ
<
	gV¬
<
	gPosR—l
>*> 
	gd©–i¡
;

218 
	gd©–i¡
.
push_back
(
Ëaæi¡
[0]);

219 
PushAges
(
G‘RoÙ
(),
d©–i¡
);

220 
sÜt
(
d©–i¡
.
begš
(), d©–i¡.
’d
(), 
ChrÚog¿m
::
comµo¤—l
);

221 ià(
	gd©–i¡
.
size
(è!ğ
G‘T»e
()->
G‘Size
() - 1) {

222 
û¼
 << "”rÜ : sizoàd©li¡ : " << 
d©–i¡
.
size
(è<< '\t' << 
G‘T»e
()->
G‘Size
() -1 << '\n';

224  
	gd©–i¡
;

227 * 
G‘D©es
(* 
±r
) {

228  
G‘D©es
(
G‘RoÙ
(),
±r
);

231 * 
G‘D©es
(cÚ¡ 
Lšk
* 
äom
, * 
±r
) {

232 ià(! 
	gäom
->
isL—f
()) {

233 *
	g±r
 = 
G‘NodeD©e
(
äom
->
G‘Node
())->
v®
();

234 
	g±r
++;

235 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

236 
±r
 = 
G‘D©es
(
lšk
->
Out
(),…tr);

239  
	g±r
;

242 * 
S‘D©es
(* 
±r
) {

243  
S‘D©es
(
G‘RoÙ
(),
±r
);

246 * 
S‘D©es
(cÚ¡ 
Lšk
* 
äom
, * 
±r
) {

247 ià(! 
	gäom
->
isL—f
()) {

248 
G‘NodeD©e
(
äom
->
G‘Node
())->
£tv®
(*
±r
);

249 
	g±r
++;

250 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

251 
±r
 = 
S‘D©es
(
lšk
->
Out
(),…tr);

254  
	g±r
;

257 
PushAges
(cÚ¡ 
Lšk
* 
äom
, 
veùÜ
<
V¬
<
PosR—l
>*>& 
d©–i¡
) {

258 ià(! 
	gäom
->
isL—f
()) {

259 
	gd©–i¡
.
push_back
(
G‘NodeD©e
(
äom
->
G‘Node
()));

260 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

261 
PushAges
(
lšk
->
Out
(), 
d©–i¡
);

266 
	gveùÜ
<
	gV¬
<
	gPosR—l
>*> 
G‘L—fLi¡
() {

267 
	gveùÜ
<
	gV¬
<
	gPosR—l
>*> 
	gËaæi¡
;

268 
PushL—ves
(
G‘RoÙ
(),
Ëaæi¡
);

269 ià(
	gËaæi¡
.
size
(è!ğ
G‘T»e
()->
G‘Size
()) {

270 
û¼
 << "”rÜ : sizoàËaàli¡ : " << 
Ëaæi¡
.
size
(è<< '\t' << 
G‘T»e
()->
G‘Size
() << '\n';

272  
	gËaæi¡
;

275 
PushL—ves
(cÚ¡ 
Lšk
* 
äom
, 
veùÜ
<
V¬
<
PosR—l
>*>& 
Ëaæi¡
) {

276 ià(
	gäom
->
isL—f
()) {

277 
	gËaæi¡
.
push_back
(
G‘NodeD©e
(
äom
->
G‘Node
()));

280 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

281 
PushL—ves
(
lšk
->
Out
(), 
Ëaæi¡
);

286 ~
ChrÚog¿m
(){

287 
RecursiveD–‘e
(
G‘RoÙ
());

290 
T»e
* 
G‘T»e
(){

291  
	gŒ“
;

294 
B¿nchL’gth
* 
G‘B¿nchL’gth
(cÚ¡ 
B¿nch
* 
b¿nch
) {

295 
B¿nchL’gth
* 
	gtmp
 = 
dyÇmic_ÿ¡
<B¿nchL’gth*>(
G‘B¿nchV®
(
b¿nch
));

296 ià(!
	gtmp
) {

297 
	gû¼
 << "error in Chronogram::GetBranchLength : dynamic cast \n";

298 
	gû¼
 << "b¿nch : " << 
	gb¿nch
 << '\n';

299 
ex™
(1);

301  
	gtmp
;

305 
NodeD©e
* 
G‘NodeD©e
(cÚ¡ 
Node
* 
node
) {

306 
NodeD©e
* 
	gtmp
 = 
dyÇmic_ÿ¡
<NodeD©e*>(
G‘NodeV®
(
node
));

307 ià(! 
	gtmp
) {

308 
	gû¼
 << "error in Chronogram::GetNodeDate : dynamic cast\n";

309 
ex™
(1);

311  
	gtmp
;

314 
	gV¬
<
	gPosR—l
>* 
G‘RoÙAge
(è{ 
G‘NodeV®
(
G‘RoÙ
()->
G‘Node
());}

316 
	gV¬
<
	gPosR—l
>* 
G‘R©e
(è{ 
	g¿‹
;}

318 
MuÉlyTimes
(cÚ¡ 
Lšk
* 
äom
, 
d
) {

319 
RecursiveMuÉlyTimes
(
äom
,
d
);

322 
MuÉlyL—fTimes
(cÚ¡ 
Lšk
* 
äom
, 
d
) {

323 
RecursiveMuÉlyL—fTimes
(
äom
,
d
);

326 
MuÉlyIÁ”ÇlTimes
(cÚ¡ 
Lšk
* 
äom
, 
d
) {

327 ià(! 
	gäom
->
isRoÙ
()) {

328 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(
d
 * G‘NodeV®(äom->G‘Node())->
v®
());

330 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

331 
MuÉlyIÁ”ÇlTimes
(
lšk
->
Out
(),
d
);

335 
G‘AbsŞu‹Time
(cÚ¡ 
Lšk
* 
äom
){

336  
G‘NodeV®
(
äom
->
G‘Node
())->
v®
();

340 
G‘B¿nchTimeL’gth
(cÚ¡ 
Lšk
* 
äom
){

341 
	gd
 = 
G‘AbsŞu‹Time
(
äom
->
Out
()) - GetAbsoluteTime(from);

342 ià(
	gd
 < 0) {

343 
	gd
 = -
d
;

344 
	gû¼
 << "error in chronogram:‚egativeime\n";

345 
	gû¼
 << 
G‘AbsŞu‹Time
(
äom
->
Out
()) << '\t' << GetAbsoluteTime(from) << '\n';

346 
ex™
(1);

348  
	gd
;

351 
G‘Di¡ªû
(cÚ¡ 
Lšk
* 
äom1
, cÚ¡ Lšk* 
äom2
) {

352 ià(
	gäom1
 =ğ
äom2
) {

355 cÚ¡ 
Lšk
* 
	glšk
 = 
G‘T»e
()->
G‘LCA
(
äom1
,
äom2
);

361 ià(
	glšk
 =ğ
äom1
) {

362  
G‘MidTime
(
äom1
è- G‘MidTime(
äom2
);

364 ià(
	glšk
 =ğ
äom2
) {

365  
G‘MidTime
(
äom2
è- G‘MidTime(
äom1
);

368  2 * 
G‘AbsŞu‹Time
(
lšk
è- 
G‘MidTime
(
äom1
è- G‘MidTime(
äom2
);

371 
G‘MidTime
(cÚ¡ 
Lšk
* 
äom
) {

372 ià(
	gäom
->
isRoÙ
()) {

373 
	gû¼
 << "error in chronogram::getmidtime: called on„oot\n";

374 
ex™
(1);

376  
G‘AbsŞu‹Time
(
äom
è+ 0.5 * 
G‘B¿nchTimeL’gth
(from);

379 
Sam¶e
() {

380 
d¿wSam¶e
(
this
->
G‘RoÙ
());

383 
d¿wSam¶e
(cÚ¡ 
Lšk
* 
äom
){

386 
CÏmp
() {

387 
RecursiveCÏmp
(
G‘RoÙ
());

390 
¥ecŸlUpd©e
() {

391 
RecursiveUpd©e
(
G‘RoÙ
());

394 
G‘TÙ®Time
() {

395  
RecursiveG‘TÙ®Time
(
G‘RoÙ
());

398 
RecursiveCÏmp
(cÚ¡ 
Lšk
* 
äom
) {

399 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

400 
RecursiveCÏmp
(
lšk
->
Out
());

402 
G‘NodeV®
(
äom
->
G‘Node
())->
CÏmp
();

405 
RecursiveG‘TÙ®Time
(cÚ¡ 
Lšk
* 
äom
) {

406 
	gtÙ®
 = 0;

407 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

408 
tÙ®
 +ğ
RecursiveG‘TÙ®Time
(
lšk
->
Out
());

410 ià(! 
	gäom
->
isRoÙ
()) {

411 
	gtÙ®
 +ğ
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
v®
();

413  
	gtÙ®
;

416 
RecursiveUpd©e
(cÚ¡ 
Lšk
* 
äom
) {

417 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

418 
RecursiveUpd©e
(
lšk
->
Out
());

420 ià(! 
	gäom
->
isRoÙ
()) {

421 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

426 
Move
(
tunšg
){

427 
	gn
 = 0;

428 
	gtmp
 = 
G’”®MoveTime
(
tunšg
, 
G‘RoÙ
(),
n
);

429  
	gtmp
 / 
	gn
;

432 
Em±yMove
(){

433 
Em±yMove
(
G‘RoÙ
());

436 
RecursiveRegi¡”
(
DAGnode
* 
node
, cÚ¡ 
Lšk
* 
äom
) {

437 
G‘NodeV®
(
äom
->
G‘Node
())->
Regi¡”
(
node
);

438 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

439 
RecursiveRegi¡”
(
node
,
lšk
->
Out
());

443 
G‘MšD–Time
(cÚ¡ 
Lšk
* 
äom
) {

444 
	gmš
 = -1;

445 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

446 
tmp
 = 
G‘B¿nchTimeL’gth
(
lšk
->
Out
());

447 ià((
	gmš
==-1è|| (
mš
 > 
tmp
)) {

448 
mš
 = 
tmp
;

450 
	gtmp2
 = 
G‘MšD–Time
(
lšk
->
Out
());

451 ià((
	gtmp2
 !ğ-1è&& (
mš
 > 
tmp2
)) {

452 
mš
 = 
tmp2
;

455  
	gmš
;

458 
G‘Nnode
() {

459  
G‘T»e
()->
G‘Nnode
();

462 
G‘Nš‹º®Node
() {

463  
G‘T»e
()->
G‘Nš‹º®Node
();

466 
RecursiveG‘Nš‹º®Node
(cÚ¡ 
Lšk
* 
äom
) {

467 
	gn
 = 0;

468 ià(! 
	gäom
->
isL—f
()) {

469 
	gn
++;

471 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

472 
n
 +ğ
RecursiveG‘Nš‹º®Node
(
lšk
->
Out
());

474  
	gn
;

477 
S‘MšMax
(cÚ¡ 
Lšk
* 
äom
){

478 
	gmax
 = 
G‘AbsŞu‹Time
(
äom
->
Out
());

479 
	gmš
 = 0;

480 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()){

481 if(
G‘AbsŞu‹Time
(
lšk
->
Out
()è> 
mš
){

482 
mš
 = 
G‘AbsŞu‹Time
(
lšk
->
Out
());

485 
G‘NodeD©e
(
äom
->
G‘Node
())->
S‘MšMax
(
mš
, 
max
);

488 
G‘LogProb
() {

489  
RecursiveG‘LogProb
(
G‘RoÙ
());

492 
	g´Ùeùed
:

494 
Rv¬
<
PosR—l
>* 
C»©eNodeV®
 (cÚ¡ 
Lšk
* 
lšk
){

495  
Ãw
 
NodeD©e
(
¿‹
);

498 
RecursiveC»©eNode
(
Lšk
* 
äom
) {

499 
	gnodev®
[
äom
->
G‘Node
()] = 
C»©eNodeV®
(from);

500 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

501 
RecursiveC»©eNode
(
lšk
->
Out
());

505 
	gDv¬
<
	gPosR—l
>* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
){

506 
B¿nchL’gth
* 
	gbl
 = 
Ãw
 B¿nchL’gth(
G‘NodeV®
(
lšk
->
G‘Node
()),G‘NodeV®Öšk->
Out
()->G‘Node()),
¿‹
);

507  
	gbl
;

510 
RecursiveC»©eB¿nch
(
Lšk
* 
äom
) {

511 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

512 
b¿nchv®
[
lšk
->
G‘B¿nch
()] = 
C»©eB¿nchV®
(link);

513 
RecursiveC»©eB¿nch
(
lšk
->
Out
());

517 
RecursiveMuÉlyTimes
(cÚ¡ 
Lšk
* 
äom
, 
d
) {

518 ià(! 
	gäom
->
isL—f
()) {

519 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(
d
 * G‘NodeV®(äom->G‘Node())->
v®
());

521 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

522 
RecursiveMuÉlyTimes
(
lšk
->
Out
(),
d
);

526 
RecursiveMuÉlyL—fTimes
(cÚ¡ 
Lšk
* 
äom
, 
d
) {

527 ià(
	gäom
->
isL—f
()) {

528 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(
d
 * G‘NodeV®(äom->G‘Node())->
v®
());

530 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

531 
RecursiveMuÉlyL—fTimes
(
lšk
->
Out
(),
d
);

538 
RecursiveS‘NodesV®ues
(cÚ¡ 
Lšk
* 
äom
){

539 
	gmaxage
 = 0;

540 ià(
	gäom
->
isRoÙ
()){

541 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(0);

544 
	gl
 = 
©of
(
äom
->
G‘B¿nch
()->
G‘Name
().
c_¡r
());

545 ià(
	gl
 <= 0) {

546 
û¼
 << "w¬nšg :‚Ú sŒiùly…os™ivb¿nch†’gth : " << 
l
 << '\n';

547 
	gû¼
 << "correcting‡nd settingo 0.001\n";

548 
	gl
 = 0.001;

550 
	gv®
 = 
l
 + 
G‘AbsŞu‹Time
(
äom
->
Out
());

551 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(
v®
);

552 
	gmaxage
 = 
v®
;

554 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

555 
tmp
 = 
RecursiveS‘NodesV®ues
(
lšk
->
Out
());

556 ià(
	gmaxage
 < 
	gtmp
) {

557 
	gmaxage
 = 
tmp
;

560  
	gmaxage
;

563 
RecursiveEqu®izeL—fNodes
(cÚ¡ 
Lšk
* 
äom
, 
maxage
) {

564 ià(
	gäom
->
isL—f
()) {

565 ià(
G‘NodeV®
(
äom
->
G‘Node
())->
v®
(è> 
	gmaxage
) {

566 
	gû¼
 << "”rÜ iÀËaàagequ®iz©iÚ : " << 
G‘NodeV®
(
äom
->
G‘Node
())->
v®
(è<< '\t' << 
	gmaxage
 << '\n';

567 
ex™
(1);

569 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(
maxage
);

571 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

572 
RecursiveEqu®izeL—fNodes
(
lšk
->
Out
(),
maxage
);

576 
RecursiveNÜm®izeT»e
(cÚ¡ 
Lšk
* 
äom
, 
maxage
, 
boŞ
 
šv”t
) {

577 ià(
	gšv”t
) {

578 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(1 - G‘NodeV®(äom->G‘Node())->
v®
(è/ 
maxage
);

581 
G‘NodeV®
(
äom
->
G‘Node
())->
£tv®
(G‘NodeV®(äom->G‘Node())->
v®
(è/ 
maxage
);

583 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

584 
RecursiveNÜm®izeT»e
(
lšk
->
Out
(),
maxage
, 
šv”t
);

588 
RecursiveUpd©eB¿nches
(cÚ¡ 
Lšk
* 
äom
) {

589 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()){

590 
G‘B¿nchL’gth
(
lšk
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

591 
RecursiveUpd©eB¿nches
(
lšk
->
Out
());

595 
MoveTime
(
tunšg
, 
Lšk
* 
äom
){

596 
S‘MšMax
(
äom
);

597  
G‘NodeV®
(
äom
->
G‘Node
())->
Move
(
tunšg
);

601 
vœtu®
 
G’”®MoveTime
(
tunšg
, 
Lšk
* 
äom
, & 
n
){

602 if(
	gäom
->
isL—f
()){

606 
	g»tour
 = 0;

607 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()){

608 
»tour
 +ğ
G’”®MoveTime
(
tunšg
,
lšk
->
Out
(),
n
);

610 if(!
	gäom
->
isRoÙ
()){

611 
	g»tour
 +ğ
MoveTime
(
tunšg
, 
äom
);

612 
	gn
++;

614  
	g»tour
;

618 
Em±yMove
(
Lšk
* 
äom
){

619 if(! 
	gäom
->
isL—f
()){

620 if(!
	gäom
->
isRoÙ
()){

621 
S‘MšMax
(
äom
);

622 
G‘NodeD©e
(
äom
->
G‘Node
())->
Em±yMove
();

624 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()){

625 
Em±yMove
(
lšk
->
Out
());

627 if(!
	gäom
->
isRoÙ
()){

628 
S‘MšMax
(
äom
);

629 
G‘NodeD©e
(
äom
->
G‘Node
())->
Em±yMove
();

634 
RecursiveG‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

635 
	g»t
 = 
G‘NodeV®
(
äom
->
G‘Node
())->
G‘LogProb
();

636 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

637 
»t
 +ğ
RecursiveG‘LogProb
(
lšk
->
Out
());

639  
	g»t
;

643 
	g´Ùeùed
:

645 
T»e
* 
Œ“
;

646 
	gV¬
<
	gPosR—l
>* 
	g¿‹
;

	@CodonSequenceAlignment.cpp

2 
	~<io¡»am
>

3 
	~<c¡dlib
>

4 
usšg
 
Çme¥aû
 
	g¡d
;

6 
	~"CodÚSequ’ûAlignm’t.h
"

7 
	~"Exû±iÚ.h
"

8 
	~"Rªdom.h
"

10 
	gCodÚSequ’ûAlignm’t
::
	$CodÚSequ’ûAlignm’t
(
Sequ’ûAlignm’t
* 
äom
, 
boŞ
 
fÜû_¡İs
, 
G’‘icCodeTy³
 
ty³
) {

12 
Œy
 {

13 
DNAsourû
 = 
äom
;

15 ià(
äom
->
Ns™e
 % 3 != 0) {

16 
û¼
 << "not multiple ofhree\n";

17 
	`ex™
(1);

19 
Ns™e
 = 
äom
->Nsite/3;

20 
Nxa
 = 
äom
->Ntaxa;

21 
CodÚS‹S·û
* 
‹mp¡©e¥aû
 = 
Ãw
 
	`CodÚS‹S·û
(
ty³
);

22 
¡©e¥aû
 = 
‹mp¡©e¥aû
;

25 
x£t
 = 
DNAsourû
->
	`G‘TaxÚS‘
();

29 
D©a
 = 
Ãw
 *[
Nxa
];

30 
i
=0; i<
Nxa
; i++) {

31 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

32 
j
=0; j<
Ns™e
; j++) {

33 
Œy
 {

34 
D©a
[
i
][
j
] = 
	`G‘CodÚS‹S·û
()->
	`G‘CodÚFromDNA
(
DNAsourû
->
	`G‘S‹
(i, 3*j), DNAsource->GetState(i, 3*j+1), DNAsource->GetState(i, 3*j+2));

35 ià(
D©a
[
i
][
j
] == -1) {

36 ià((
DNAsourû
->
	`G‘S‹
(
i
, 3*
j
) != -1) && (DNAsource->GetState(i, 3*j+1) != -1) && (DNAsource->GetState(i, 3*j+2) != -1)) {

42 
	`ÿtch
(...) {

46 ià(
fÜû_¡İs
) {

48 
D©a
[
i
][
j
] = -1;

51 
throw
;

58 
	`ÿtch
(
Exû±iÚ
) {

59 
û¼
 << "Codon Sequence Alignment: failedo„eadhe datafile\n";

60 
	`ex™
(1);

62 
	}
}

65 
	gCodÚSequ’ûAlignm’t
::
	$ToSŒ—mRªdomJackkniã
(
o¡»am
& 
os
, 
p
) {

67 * 
šşuded
 = 
Ãw
 [
Ns™e
];

68 
nšc
 = 0;

69 
i
=0; i<
Ns™e
; i++) {

70 ià(
Rªdom
::
	`UnifÜm
(è< 
p
) {

71 
šşuded
[
i
] = 1;

72 
nšc
 ++;

75 
os
 << 
Nxa
 << '\t' << 3 * 
nšc
 << '\n';

76 
max
 = 0;

77 
i
=0; i<
Nxa
; i++) {

78 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

79 ià(
max
 < 
l
) {

80 
max
 = 
l
;

84 
i
=0; i<
Nxa
; i++) {

85 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

86 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

87 
os
 << ' ';

89 
j
=0; j<
Ns™e
; j++) {

90 ià(
šşuded
[
j
]) {

91 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
));

94 
os
 << '\n';

96 
os
 << '\n';

97 
d–‘e
[] 
šşuded
;

98 
	}
}

100 
	gCodÚSequ’ûAlignm’t
::
	$ToSŒ—m
(
o¡»am
& 
os
) {

102 
os
 << 
Nxa
 << '\t' << 3 * 
Ns™e
 << '\n';

103 
max
 = 0;

104 
i
=0; i<
Nxa
; i++) {

105 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

106 ià(
max
 < 
l
) {

107 
max
 = 
l
;

111 
i
=0; i<
Nxa
; i++) {

112 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

113 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

114 
os
 << ' ';

116 
j
=0; j<
Ns™e
; j++) {

117 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
));

119 
os
 << '\n';

121 
os
 << '\n';

122 
	}
}

124 
	gCodÚSequ’ûAlignm’t
::
	$ToSŒ—m
(
o¡»am
& 
os
, 
pos
) {

126 
šşuded
 = 0;

127 
i
=0; i<
Ns™e
; i++) {

128 ià(! 
	`AÎMissšgCŞumn
(
i
)) {

129 
šşuded
++;

132 
os
 << 
Nxa
 << '\t' << 
šşuded
 << '\n';

134 
max
 = 0;

135 
i
=0; i<
Nxa
; i++) {

136 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

137 ià(
max
 < 
l
) {

138 
max
 = 
l
;

142 
i
=0; i<
Nxa
; i++) {

143 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

144 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

145 
os
 << ' ';

147 
j
=0; j<
Ns™e
; j++) {

148 ià(! 
	`AÎMissšgCŞumn
(
j
)) {

149 
os
 << 
	`G‘CodÚS‹S·û
()->
	`G‘DNAS‹S·û
()->
	`G‘S‹
(G‘CodÚS‹S·û()->
	`G‘CodÚPos™iÚ
(
pos
,G‘S‹(
i
,
j
)));

152 
os
 << '\n';

154 
os
 << '\n';

155 
	}
}

157 
	gCodÚSequ’ûAlignm’t
::
	$ToSŒ—mFourFŞdThœd
(
o¡»am
& 
os
) {

159 
ns™e
 = 0;

160 * 
šşuded
 = 
Ãw
 [
Ns™e
];

161 
j
=0; j<
Ns™e
; j++) {

162 
i
 = 0;

163 (
i
<
Nxa
è&& (
	`G‘S‹
(i,
j
è!ğ-2è&& ((G‘S‹(i,jè=ğ-1è|| (
	`G‘CodÚS‹S·û
()->
	`G‘Deg’”acy
(GetState(i,j)) == 4))) {

164 
i
++;

166 ià((
i
 =ğ
Nxa
è&& (! 
	`AÎMissšgCŞumn
(
j
))) {

167 
šşuded
[
j
] = 1;

168 
ns™e
++;

171 
šşuded
[
j
] = 0;

175 
os
 << 
Nxa
 << '\t' << 
ns™e
 << '\n';

176 
max
 = 0;

177 
i
=0; i<
Nxa
; i++) {

178 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

179 ià(
max
 < 
l
) {

180 
max
 = 
l
;

184 
i
=0; i<
Nxa
; i++) {

185 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

186 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

187 
os
 << ' ';

189 
j
=0; j<
Ns™e
; j++) {

190 ià(
šşuded
[
j
]) {

191 
os
 << 
	`G‘CodÚS‹S·û
()->
	`G‘DNAS‹S·û
()->
	`G‘S‹
(G‘CodÚS‹S·û()->
	`G‘CodÚPos™iÚ
(2,G‘S‹(
i
,
j
)));

194 
os
 << '\n';

196 
os
 << '\n';

197 
	}
}

199 
	gCodÚSequ’ûAlignm’t
::
	$ToSŒ—mFourFŞdTrËt
(
o¡»am
& 
os
) {

201 
ns™e
 = 0;

202 * 
šşuded
 = 
Ãw
 [
Ns™e
];

203 
j
=0; j<
Ns™e
; j++) {

204 
i
 = 0;

205 (
i
<
Nxa
è&& (
	`G‘S‹
(i,
j
è!ğ-2è&& ((G‘S‹(i,jè=ğ-1è|| (
	`G‘CodÚS‹S·û
()->
	`G‘Deg’”acy
(GetState(i,j)) == 4))) {

206 
i
++;

208 ià(
i
 =ğ
Nxa
) {

209 
šşuded
[
j
] = 1;

210 
ns™e
++;

213 
šşuded
[
j
] = 0;

217 
os
 << 
Nxa
 << '\t' << 3*
ns™e
 << '\n';

218 
max
 = 0;

219 
i
=0; i<
Nxa
; i++) {

220 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

221 ià(
max
 < 
l
) {

222 
max
 = 
l
;

226 
i
=0; i<
Nxa
; i++) {

227 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

228 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

229 
os
 << ' ';

231 
j
=0; j<
Ns™e
; j++) {

232 ià(
šşuded
[
j
]) {

233 
os
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(G‘S‹(
i
,
j
));

236 
os
 << '\n';

238 
os
 << '\n';

239 
	}
}

241 
	gCodÚSequ’ûAlignm’t
::
	$ToSŒ—mFourFŞdThœdwoCpG
(
o¡»am
& 
os
) {

243 
ns™e
 = 0;

244 * 
šşuded
 = 
Ãw
 [
Ns™e
];

245 
j
=0; j<
Ns™e
-1; j++) {

246 
boŞ
 
k“p
 = 
Œue
;

247 
i
=0; i<
Nxa
; i++) {

248 ià(
	`G‘S‹
(
i
,
j
) != -1) {

249 ià(
	`G‘S‹
(
i
,
j
) == -2) {

250 
k“p
 = 
çl£
;

252 ià(
	`G‘CodÚS‹S·û
()->
	`G‘Deg’”acy
(
	`G‘S‹
(
i
,
j
)) == 4) {

257 iàĞ(
	`G‘CodÚS‹S·û
()->
	`G‘CodÚPos™iÚ
(1,
	`G‘S‹
(
i
,
j
)) == 1) || (GetCodonStateSpace()->GetCodonPosition(0,GetState(i,j+1)) == 2)) {

258 
k“p
 = 
çl£
;

267 
k“p
 = 
çl£
;

282 ià(
k“p
 && (! 
	`AÎMissšgCŞumn
(
j
))) {

283 
šşuded
[
j
] = 1;

284 
ns™e
++;

287 
šşuded
[
j
] = 0;

291 
os
 << 
Nxa
 << '\t' << 
ns™e
 << '\n';

292 
max
 = 0;

293 
i
=0; i<
Nxa
; i++) {

294 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

295 ià(
max
 < 
l
) {

296 
max
 = 
l
;

300 
i
=0; i<
Nxa
; i++) {

301 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

302 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

303 
os
 << ' ';

305 
j
=0; j<
Ns™e
-1; j++) {

306 ià(
šşuded
[
j
]) {

307 
os
 << 
	`G‘CodÚS‹S·û
()->
	`G‘DNAS‹S·û
()->
	`G‘S‹
(G‘CodÚS‹S·û()->
	`G‘CodÚPos™iÚ
(2,G‘S‹(
i
,
j
)));

310 
os
 << '\n';

312 
os
 << '\n';

313 
	}
}

	@CodonSequenceAlignment.h

1 #iâdeà
CODONSEQUENCEALIGNMENT_H


2 
	#CODONSEQUENCEALIGNMENT_H


	)

5 
	~"CÚtšuousD©a.h
"

6 
	~"Sequ’ûAlignm’t.h
"

7 
	~"CodÚS‹S·û.h
"

8 
	~<cm©h
>

10 şas 
	cCodÚSequ’ûAlignm’t
 : 
public
 
Sequ’ûAlignm’t
 {

12 
public
:

14 
	$CodÚSequ’ûAlignm’t
(
CodÚSequ’ûAlignm’t
* 
äom
è: 
	`Sequ’ûAlignm’t
((
Sequ’ûAlignm’t
*) from) {}

16 
	$CodÚSequ’ûAlignm’t
(
CodÚSequ’ûAlignm’t
* 
äom
, 
s™emš
, 
s™emax
è: 
	`Sequ’ûAlignm’t
((
Sequ’ûAlignm’t
*èäom, s™emš, s™emaxè{
	}
}

17 
CodÚSequ’ûAlignm’t
(
Sequ’ûAlignm’t
* 
äom
, 
boŞ
 
fÜû_¡İs
 = 
çl£
,
G’‘icCodeTy³
 
ty³
 = 
Univ”§l
);

19 ~
	$CodÚSequ’ûAlignm’t
(è{
	}
}

21 
	$D–‘eAACÚ¡ªtS™es
() {

22 
i
=0;

23 
j
=0;

24 
Elimš©ed
 = 0;

25 
i
<
Ns™e
) {

26 
k
 = 0;

27 (
k
<
Nxa
è&& (
D©a
[k][
i
] =ğ
unknown
)) k++;

28 ià(
k
<
Nxa
) {

29 
a
 = 
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
D©a
[
k
][
i
]);

30 
k
++;

31 (
k
<
Nxa
è&& ((
D©a
[k][
i
] =ğ
unknown
è|| (
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(D©a[k][i]è=ğ
a
))) k++;

32 ià(
k
==
Nxa
) {

33 
Elimš©ed
 ++;

36 
k
=0; k<
Nxa
; k++) {

37 
D©a
[
k
][
j
] = D©a[k][
i
];

39 
j
++;

42 
i
++;

44 
Ns™e
 -ğ
Elimš©ed
;

45 
cout
 << "numb” oàpos™iÚ –imš©ed : " << 
Elimš©ed
 << '\n';

46 
	}
}

48 
	$NuşeÙide123Compos™iÚ®H‘”og’e™y
() {

50 ** 
xäeq12
 = 
Ãw
 *[
Nxa
];

51 ** 
xäeq3
 = 
Ãw
 *[
Nxa
];

52 
j
=0; j<
Nxa
; j++) {

53 
xäeq12
[
j
] = 
Ãw
 [
Nnuc
];

54 
xäeq3
[
j
] = 
Ãw
 [
Nnuc
];

55 
k
=0; k<
Nnuc
; k++) {

56 
xäeq12
[
j
][
k
] = 0;

57 
xäeq3
[
j
][
k
] = 0;

61 
i
=0; i<
Ns™e
; i++) {

62 
j
=0; j<
Nxa
; j++) {

63 
¡©e
 = 
	`G‘S‹
(
j
,
i
);

64 ià(
¡©e
 !ğ
unknown
) {

65 
xäeq12
[
j
][
	`G‘CodÚS‹S·û
()->
	`G‘CodÚPos™iÚ
(0,
¡©e
)]++;

66 
xäeq12
[
j
][
	`G‘CodÚS‹S·û
()->
	`G‘CodÚPos™iÚ
(1,
¡©e
)]++;

67 
xäeq3
[
j
][
	`G‘CodÚS‹S·û
()->
	`G‘CodÚPos™iÚ
(2,
¡©e
)]++;

72 
j
=0; j<
Nxa
; j++) {

73 
tÙ®
 = 0;

74 
k
=0; k<
Nnuc
; k++) {

75 
tÙ®
 +ğ
xäeq12
[
j
][
k
];

77 
k
=0; k<
Nnuc
; k++) {

78 
xäeq12
[
j
][
k
] /ğ
tÙ®
;

82 
j
=0; j<
Nxa
; j++) {

83 
tÙ®
 = 0;

84 
k
=0; k<
Nnuc
; k++) {

85 
tÙ®
 +ğ
xäeq3
[
j
][
k
];

87 
k
=0; k<
Nnuc
; k++) {

88 
xäeq3
[
j
][
k
] /ğ
tÙ®
;

93 
maxdi¡
 = 0;

94 
j
=0; j<
Nxa
; j++) {

95 
di¡
 = 0;

96 
k
=0; k<
Nnuc
; k++) {

97 
tmp
 = (
xäeq12
[
j
][
k
] - 
xäeq3
[j][k]);

98 
di¡
 +ğ
tmp
 *mp;

100 ià(
maxdi¡
 < 
di¡
) {

101 
maxdi¡
 = 
di¡
;

105 
j
=0; j<
Nxa
; j++) {

106 
d–‘e
[] 
xäeq12
[
j
];

107 
d–‘e
[] 
xäeq3
[
j
];

109 
d–‘e
[] 
xäeq12
;

110 
d–‘e
[] 
xäeq3
;

112  
maxdi¡
;

113 
	}
}

115 
NuşeÙideCompos™iÚ®H‘”og’e™y
(
o¡»am
* 
os
, 
pos
 = -1, ** 
comp
 = 0, o¡»am* 
os2
 = 0) {

117 ** 
xäeq
 = 0;

118 ià(
	gcomp
) {

119 
	gxäeq
 = 
comp
;

122 
	gxäeq
 = 
Ãw
 *[
Nxa
];

123 
	gj
=0; j<
	gNxa
; j++) {

124 
	gxäeq
[
j
] = 
Ãw
 [
Nnuc
];

125 
	gk
=0; k<
	gNnuc
; k++) {

126 
	gxäeq
[
j
][
k
] = 0;

131 
	gj
=0; j<
	gNxa
; j++) {

132 
	gk
=0; k<
	gNnuc
; k++) {

133 
	gxäeq
[
j
][
k
] = 0;

137 
	gi
=0; i<
	gNs™e
; i++) {

138 
	gj
=0; j<
	gNxa
; j++) {

139 
	g¡©e
 = 
G‘S‹
(
j
,
i
);

140 ià(
	g¡©e
 !ğ
unknown
) {

141 ià(
pos
 == -1) {

142 
xäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(0,
¡©e
)]++;

143 
	gxäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(1,
¡©e
)]++;

144 
	gxäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(2,
¡©e
)]++;

146 ià(
	gpos
 > 2) {

147 
	gû¼
 << "”rÜ iÀCodÚSequ’ûAlignm’t::NuşeÙideCompos™iÚH‘”og’e™y : " << 
	gpos
 << '\n';

148 
ex™
(1);

151 
	gxäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(
pos
,
¡©e
)]++;

158 * 
	gglob®äeq
 = 
Ãw
 [
Nnuc
];

159 
	gk
=0; k<
	gNnuc
; k++) {

160 
	gglob®äeq
[
k
] = 0;

161 
	gj
=0; j<
	gNxa
; j++) {

162 
	gglob®äeq
[
k
] +ğ
xäeq
[
j
][k];

167 
	gtÙ®
 = 0;

168 
	gk
=0; k<
	gNnuc
; k++) {

169 
	gtÙ®
 +ğ
glob®äeq
[
k
];

171 
	gk
=0; k<
	gNnuc
; k++) {

172 
	gglob®äeq
[
k
] /ğ
tÙ®
;

174 ià(
	gos
) {

175 (*
	gos
è<< 
	gNxa
 << '\t' << 4 << '\n';

177 ià(
	gos2
) {

178 (*
	gos2
è<< 
	gNxa
 << '\t' << 3 << '\n';

180 
	gj
=0; j<
	gNxa
; j++) {

181 ià(
	gos
) {

182 (*
	gos
è<< 
G‘TaxÚS‘
()->
G‘TaxÚ
(
j
);

184 ià(
	gos2
) {

185 (*
	gos2
è<< 
G‘TaxÚS‘
()->
G‘TaxÚ
(
j
);

187 
	gtÙ®
 = 0;

188 
	gk
=0; k<
	gNnuc
; k++) {

189 
	gtÙ®
 +ğ
xäeq
[
j
][
k
];

191 
	gk
=0; k<
	gNnuc
; k++) {

192 
	gxäeq
[
j
][
k
] /ğ
tÙ®
;

194 ià(
	gos
) {

195 
	gk
=0; k<
	gNnuc
; k++) {

196 (*
	gos
è<< '\t' << 
	gxäeq
[
j
][
k
];

198 (*
	gos
) << '\n';

200 ià(
	gos2
) {

201 
	ggc
 = 
xäeq
[
j
][1] +axfreq[j][2];

202 
	ggcs
 = (
xäeq
[
j
][2] -axäeq[j][1]è/ 
gc
;

203 
	g©s
 = (
xäeq
[
j
][0] -axäeq[j][3]è/ (1 - 
gc
);

204 (*
	gos2
è<< '\t' << 
	ggc
 << '\t' << 
exp
(
gcs
è<< '\t' <<ƒxp(
©s
);

205 (*
	gos2
) << '\n';

210 
	gmaxdi¡
 = 0;

211 
	gj
=0; j<
	gNxa
; j++) {

212 
	gdi¡
 = 0;

213 
	gk
=0; k<
	gNnuc
; k++) {

214 
	gtmp
 = (
xäeq
[
j
][
k
] - 
glob®äeq
[k]);

215 
	gdi¡
 +ğ
tmp
 *mp;

217 ià(
	gmaxdi¡
 < 
	gdi¡
) {

218 
	gmaxdi¡
 = 
di¡
;

222 
	gd–‘e
[] 
	gglob®äeq
;

223 ià(!
	gcomp
) {

224 
	gj
=0; j<
	gNxa
; j++) {

225 
	gd–‘e
[] 
	gxäeq
[
j
];

227 
	gd–‘e
[] 
	gxäeq
;

230  
	gmaxdi¡
;

233 
NuşeÙideCompos™iÚ®H‘”og’e™yOld
(
o¡»am
* 
os
, 
pos
 = -1, ** 
comp
 = 0) {

235 ** 
xäeq
 = 0;

236 ià(
	gcomp
) {

237 
	gxäeq
 = 
comp
;

240 
	gxäeq
 = 
Ãw
 *[
Nxa
];

241 
	gj
=0; j<
	gNxa
; j++) {

242 
	gxäeq
[
j
] = 
Ãw
 [
Nnuc
];

243 
	gk
=0; k<
	gNnuc
; k++) {

244 
	gxäeq
[
j
][
k
] = 0;

249 
	gj
=0; j<
	gNxa
; j++) {

250 
	gk
=0; k<
	gNnuc
; k++) {

251 
	gxäeq
[
j
][
k
] = 0;

255 
	gi
=0; i<
	gNs™e
; i++) {

256 
	gj
=0; j<
	gNxa
; j++) {

257 
	g¡©e
 = 
G‘S‹
(
j
,
i
);

258 ià(
	g¡©e
 !ğ
unknown
) {

259 ià(
pos
 == -1) {

260 
xäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(0,
¡©e
)]++;

261 
	gxäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(1,
¡©e
)]++;

262 
	gxäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(2,
¡©e
)]++;

264 ià(
	gpos
 > 2) {

265 
	gû¼
 << "”rÜ iÀCodÚSequ’ûAlignm’t::NuşeÙideCompos™iÚH‘”og’e™y : " << 
	gpos
 << '\n';

266 
ex™
(1);

269 
	gxäeq
[
j
][
G‘CodÚS‹S·û
()->
G‘CodÚPos™iÚ
(
pos
,
¡©e
)]++;

276 * 
	gglob®äeq
 = 
Ãw
 [
Nnuc
];

277 
	gk
=0; k<
	gNnuc
; k++) {

278 
	gglob®äeq
[
k
] = 0;

279 
	gj
=0; j<
	gNxa
; j++) {

280 
	gglob®äeq
[
k
] +ğ
xäeq
[
j
][k];

285 
	gtÙ®
 = 0;

286 
	gk
=0; k<
	gNnuc
; k++) {

287 
	gtÙ®
 +ğ
glob®äeq
[
k
];

289 
	gk
=0; k<
	gNnuc
; k++) {

290 
	gglob®äeq
[
k
] /ğ
tÙ®
;

292 
	gj
=0; j<
	gNxa
; j++) {

293 
	gtÙ®
 = 0;

294 
	gk
=0; k<
	gNnuc
; k++) {

295 
	gtÙ®
 +ğ
xäeq
[
j
][
k
];

297 
	gk
=0; k<
	gNnuc
; k++) {

298 
	gxäeq
[
j
][
k
] /ğ
tÙ®
;

299 ià(
	gos
) {

300 (*
	gos
è<< 
	gxäeq
[
j
][
k
] << '\t';

303 ià(
	gos
) {

304 (*
	gos
) << '\n';

307 ià(
	gos
) {

308 (*
	gos
) << '\n';

312 
	gmaxdi¡
 = 0;

313 
	gj
=0; j<
	gNxa
; j++) {

314 
	gdi¡
 = 0;

315 
	gk
=0; k<
	gNnuc
; k++) {

316 
	gtmp
 = (
xäeq
[
j
][
k
] - 
glob®äeq
[k]);

317 
	gdi¡
 +ğ
tmp
 *mp;

319 ià(
	gmaxdi¡
 < 
	gdi¡
) {

320 
	gmaxdi¡
 = 
di¡
;

324 
	gd–‘e
[] 
	gglob®äeq
;

325 ià(!
	gcomp
) {

326 
	gj
=0; j<
	gNxa
; j++) {

327 
	gd–‘e
[] 
	gxäeq
[
j
];

329 
	gd–‘e
[] 
	gxäeq
;

332  
	gmaxdi¡
;

335 
	$AmšoAcidCompos™iÚ®H‘”og’e™y
(
o¡»am
* 
os
) {

337 ** 
xäeq
 = 
Ãw
 *[
Nxa
];

338 
j
=0; j<
Nxa
; j++) {

339 
xäeq
[
j
] = 
Ãw
 [
N¯
];

340 
k
=0; k<
N¯
; k++) {

341 
xäeq
[
j
][
k
] = 0;

345 
i
=0; i<
Ns™e
; i++) {

346 
j
=0; j<
Nxa
; j++) {

347 
¡©e
 = 
	`G‘S‹
(
j
,
i
);

348 ià(
¡©e
 !ğ
unknown
) {

349 
xäeq
[
j
][
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
¡©e
)]++;

355 * 
glob®äeq
 = 
Ãw
 [
N¯
];

356 
k
=0; k<
N¯
; k++) {

357 
glob®äeq
[
k
] = 0;

358 
j
=0; j<
Nxa
; j++) {

359 
glob®äeq
[
k
] +ğ
xäeq
[
j
][k];

364 
tÙ®
 = 0;

365 
k
=0; k<
N¯
; k++) {

366 
tÙ®
 +ğ
glob®äeq
[
k
];

368 
k
=0; k<
N¯
; k++) {

369 
glob®äeq
[
k
] /ğ
tÙ®
;

371 
j
=0; j<
Nxa
; j++) {

372 
tÙ®
 = 0;

373 
k
=0; k<
N¯
; k++) {

374 
tÙ®
 +ğ
xäeq
[
j
][
k
];

376 
k
=0; k<
N¯
; k++) {

377 
xäeq
[
j
][
k
] /ğ
tÙ®
;

378 ià(
os
) {

379 (*
os
è<< 
xäeq
[
j
][
k
] << '\t';

382 ià(
os
) {

383 (*
os
) << '\n';

386 ià(
os
) {

387 (*
os
) << '\n';

391 
maxdi¡
 = 0;

392 
j
=0; j<
Nxa
; j++) {

393 
di¡
 = 0;

394 
k
=0; k<
N¯
; k++) {

395 
tmp
 = (
xäeq
[
j
][
k
] - 
glob®äeq
[k]);

396 
di¡
 +ğ
tmp
 *mp;

398 ià(
maxdi¡
 < 
di¡
) {

399 
maxdi¡
 = 
di¡
;

403 
d–‘e
[] 
glob®äeq
;

404 
j
=0; j<
Nxa
; j++) {

405 
d–‘e
[] 
xäeq
[
j
];

407 
d–‘e
[] 
xäeq
;

409  
maxdi¡
;

410 
	}
}

412 
CodÚS‹S·û
* 
	$G‘CodÚS‹S·û
() {

414  (
CodÚS‹S·û
*è(
¡©e¥aû
);

415 
	}
}

417 
ToSŒ—m
(
o¡»am
& 
os
);

418 
ToSŒ—m
(
o¡»am
& 
os
, 
pos
);

419 
ToSŒ—mFourFŞdThœd
(
o¡»am
& 
os
);

420 
ToSŒ—mFourFŞdTrËt
(
o¡»am
& 
os
);

421 
ToSŒ—mFourFŞdThœdwoCpG
(
o¡»am
& 
os
);

423 
ToSŒ—mRªdomJackkniã
(
o¡»am
& 
os
, 
p
);

425 
	g´iv©e
:

427 
Sequ’ûAlignm’t
* 
DNAsourû
;

432 şas 
	cGCCÚtšuousD©a
 : 
public
 
CÚtšuousD©a
 {

434 
public
:

436 
	$GCCÚtšuousD©a
(
CodÚSequ’ûAlignm’t
* 
äom
, 
pos
) {

437 
x£t
 = 
äom
->
	`G‘TaxÚS‘
();

438 ** 
äeq
 = 
Ãw
 *[
x£t
->
	`G‘Nxa
()];

439 
i
=0; i<
x£t
->
	`G‘Nxa
(); i++) {

440 
äeq
[
i
] = 
Ãw
 [
Nnuc
];

442 
äom
->
	`NuşeÙideCompos™iÚ®H‘”og’e™y
(0,
pos
,
äeq
);

443 
D©a
 = 
Ãw
 *[
x£t
->
	`G‘Nxa
()];

444 
Ns™e
 = 1;

445 
i
=0; i<
x£t
->
	`G‘Nxa
(); i++) {

446 
D©a
[
i
] = 
Ãw
 [1];

447 
tmp
 = 
äeq
[
i
][1] + freq[i][2];

448 
D©a
[
i
][0] = 
tmp
;

450 
û¼
 << 
x£t
->
	`G‘TaxÚ
(
i
è<< '\t' << 
tmp
 << '\t' << 
D©a
[i][0] << '\n';

453 
	}
};

	@CodonStateSpace.cpp

2 
	~<io¡»am
>

3 
	~<s¡»am
>

4 
	~<c¡dlib
>

5 
usšg
 
Çme¥aû
 
	g¡d
;

7 
	~"CodÚS‹S·û.h
"

8 
	~"Exû±iÚ.h
"

10 
	gCodÚS‹S·û
::
	$CodÚS‹S·û
(
G’‘icCodeTy³
 
ty³
) {

12 
nuc¡©e¥aû
 = 
Ãw
 
DNAS‹S·û
;

13 
´Ù¡©e¥aû
 = 
Ãw
 
PrÙešS‹S·û
;

15 
code
 = 
ty³
;

16 ià(
code
 =ğ
Univ”§l
) {

17 
N¡©e
 = 
NcodÚ
 - 
UniNStİCodÚs
;

19 
CodÚCodeW™hStİs
 = 
Ãw
 [
NcodÚ
];

20 
CodÚCode
 = 
Ãw
 [
N¡©e
];

22 
CodÚPos
 = 
Ãw
 *[
Npos
];

23 
pos
=0;…os<
Npos
;…os++) {

24 
CodÚPos
[
pos
] = 
Ãw
 [
N¡©e
];

27 
k
 = 0;

28 
i
=0; i<
NcodÚ
; i++) {

29 
CodÚCodeW™hStİs
[
i
] = 
UniCodÚCode
[i];

30 ià(
CodÚCodeW™hStİs
[
i
] != -1) {

31 
CodÚCode
[
k
] = 
CodÚCodeW™hStİs
[
i
];

32 
pos
=0;…os<
Npos
;…os++) {

33 
CodÚPos
[
pos
][
k
] = 
codÚpos
[pos][
i
];

35 
k
++;

39 
N¡İ
 = 
UniNStİCodÚs
;

40 
StİCodÚs
 = 
Ãw
 [
N¡İ
];

41 
StİPos1
 = 
Ãw
 [
N¡İ
];

42 
StİPos2
 = 
Ãw
 [
N¡İ
];

43 
StİPos3
 = 
Ãw
 [
N¡İ
];

44 
i
=0; i<
N¡İ
; i++) {

45 
StİCodÚs
[
i
] = 
UniStİCodÚs
[i];

46 
StİPos1
[
i
] = 
UniStİPos1
[i];

47 
StİPos2
[
i
] = 
UniStİPos2
[i];

48 
StİPos3
[
i
] = 
UniStİPos3
[i];

52 ià(
code
 =ğ
MtInv
) {

53 
N¡©e
 = 
NcodÚ
 - 
MtInvNStİCodÚs
;

55 
CodÚCodeW™hStİs
 = 
Ãw
 [
NcodÚ
];

56 
CodÚCode
 = 
Ãw
 [
N¡©e
];

58 
CodÚPos
 = 
Ãw
 *[
Npos
];

59 
pos
=0;…os<
Npos
;…os++) {

60 
CodÚPos
[
pos
] = 
Ãw
 [
N¡©e
];

63 
k
 = 0;

64 
i
=0; i<
NcodÚ
; i++) {

65 
CodÚCodeW™hStİs
[
i
] = 
MtInvCodÚCode
[i];

66 ià(
CodÚCodeW™hStİs
[
i
] != -1) {

67 
CodÚCode
[
k
] = 
CodÚCodeW™hStİs
[
i
];

68 
pos
=0;…os<
Npos
;…os++) {

69 
CodÚPos
[
pos
][
k
] = 
codÚpos
[pos][
i
];

71 
k
++;

75 
N¡İ
 = 
MtInvNStİCodÚs
;

76 
StİCodÚs
 = 
Ãw
 [
N¡İ
];

77 
StİPos1
 = 
Ãw
 [
N¡İ
];

78 
StİPos2
 = 
Ãw
 [
N¡İ
];

79 
StİPos3
 = 
Ãw
 [
N¡İ
];

80 
i
=0; i<
N¡İ
; i++) {

81 
StİCodÚs
[
i
] = 
MtInvStİCodÚs
[i];

82 
StİPos1
[
i
] = 
MtInvStİPos1
[i];

83 
StİPos2
[
i
] = 
MtInvStİPos2
[i];

84 
StİPos3
[
i
] = 
MtInvStİPos3
[i];

87 ià(
code
 =ğ
MtMam
) {

88 
N¡©e
 = 
NcodÚ
 - 
MtMamNStİCodÚs
;

90 
CodÚCodeW™hStİs
 = 
Ãw
 [
NcodÚ
];

91 
CodÚCode
 = 
Ãw
 [
N¡©e
];

93 
CodÚPos
 = 
Ãw
 *[
Npos
];

94 
pos
=0;…os<
Npos
;…os++) {

95 
CodÚPos
[
pos
] = 
Ãw
 [
N¡©e
];

98 
k
 = 0;

99 
i
=0; i<
NcodÚ
; i++) {

100 
CodÚCodeW™hStİs
[
i
] = 
MtMamCodÚCode
[i];

101 ià(
CodÚCodeW™hStİs
[
i
] != -1) {

102 
CodÚCode
[
k
] = 
CodÚCodeW™hStİs
[
i
];

103 
pos
=0;…os<
Npos
;…os++) {

104 
CodÚPos
[
pos
][
k
] = 
codÚpos
[pos][
i
];

106 
k
++;

110 
N¡İ
 = 
MtMamNStİCodÚs
;

111 
StİCodÚs
 = 
Ãw
 [
N¡İ
];

112 
StİPos1
 = 
Ãw
 [
N¡İ
];

113 
StİPos2
 = 
Ãw
 [
N¡İ
];

114 
StİPos3
 = 
Ãw
 [
N¡İ
];

115 
i
=0; i<
N¡İ
; i++) {

116 
StİCodÚs
[
i
] = 
MtMamStİCodÚs
[i];

117 
StİPos1
[
i
] = 
MtMamStİPos1
[i];

118 
StİPos2
[
i
] = 
MtMamStİPos2
[i];

119 
StİPos3
[
i
] = 
MtMamStİPos3
[i];

123 
û¼
 << "genetic code‚ot„ecognised\n";

124 
û¼
 << 
ty³
 << '\n';

125 
	`ex™
(1);

128 
	}
}

130 
	gCodÚS‹S·û
::~
	$CodÚS‹S·û
() {

132 
d–‘e
[] 
CodÚCode
;

133 
d–‘e
[] 
CodÚCodeW™hStİs
;

134 
pos
=0;…os<
Npos
;…os++) {

135 
d–‘e
[] 
CodÚPos
[
pos
];

137 
d–‘e
[] 
CodÚPos
;

139 
d–‘e
 
nuc¡©e¥aû
;

140 
d–‘e
 
´Ù¡©e¥aû
;

141 
	}
}

143 
¡ršg
 
	gCodÚS‹S·û
::
	$G‘S‹
(
codÚ
) {

144 
o¡ršg¡»am
 
s
;

145 ià(
codÚ
 == -1) {

146 
s
 << "---";

149 
s
 << 
DNAË‰”s
[
	`G‘CodÚPos™iÚ
(0,
codÚ
)] << DNAletters[GetCodonPosition(1,codon)] << DNAletters[GetCodonPosition(2,codon)];

151 ià(
s
.
	`¡r
().
	`Ëngth
() != 3) {

152 
û¼
 << "error inranslation\n";

153 
	`ex™
(1);

155  
s
.
	`¡r
();

156 
	}
}

158 
	gCodÚS‹S·û
::
	$G‘S‹
(
¡ršg
 
wÜd
) {

159  
	`G‘CodÚFromDNA
(
	`G‘DNAS‹S·û
()->
	`G‘S‹
(
wÜd
.
	`sub¡r
(0,1)),GetDNAStateSpace()->GetState(word.substr(1,1)),GetDNAStateSpace()->GetState(word.substr(2,1)));

160 
	}
}

162 
boŞ
 
	gCodÚS‹S·û
::
	$CheckStİ
(
pos1
, 
pos2
, 
pos3
) {

163 ià((
pos1
 =ğ
unknown
è|| (
pos2
 =ğunknownè|| (
pos3
 == unknown)) {

164  
çl£
;

166 
l
 = 0;

167 (
l
 < 
N¡İ
è&& ((
pos1
 !ğ
StİPos1
[l]è|| (
pos2
 !ğ
StİPos2
[l]è|| (
pos3
 !ğ
StİPos3
[l]))) {

168 
l
++;

170  (
l
 < 
N¡İ
);

171 
	}
}

173 
	gCodÚS‹S·û
::
	$G‘CodÚFromDNA
(
pos1
, 
pos2
, 
pos3
) {

174 ià((
pos1
 =ğ
unknown
è|| (
pos2
 =ğunknownè|| (
pos3
 == unknown)) {

175  
unknown
;

177 
l
 = 0;

178 (
l
<
	`G‘N¡©e
()è&& ((
pos1
 !ğ
	`G‘CodÚPos™iÚ
(0,l)è|| (
pos2
 !ğG‘CodÚPos™iÚ(1,l)è|| (
pos3
 != GetCodonPosition(2,l)))) {

179 
l
++;

181 ià(
l
 =ğ
	`G‘N¡©e
()) {

184 
û¼
 << "w¬nšg iÀCodÚS‹S·û::G‘CodÚFromDNA : ouˆoàbound : " << 
	`G‘DNAS‹S·û
()->
	`G‘S‹
(
pos1
è<< G‘DNAS‹S·û()->G‘S‹(
pos2
è<< G‘DNAS‹S·û()->G‘S‹(
pos3
) << '\n';

185 ià(
code
 =ğ
Univ”§l
) {

186 
û¼
 << "universal\n";

188 ià(
code
 =ğ
MtMam
) {

189 
û¼
 << "mt mam\n";

191 ià(
code
 =ğ
MtInv
) {

192 
û¼
 << "mt inv\n";

194 
throw
 
Ãw
 
Exû±iÚ
;

196  
l
;

198 
	}
}

200 
	gCodÚS‹S·û
::
	$G‘DifãršgPos™iÚ
(
i
, 
j
) {

203 ià((
	`G‘CodÚPos™iÚ
(0,
i
è=ğG‘CodÚPos™iÚ(0,
j
)) && (GetCodonPosition(1,i) == GetCodonPosition(1,j)) && (GetCodonPosition(2,i) == GetCodonPosition(2,j))) {

206 ià(
	`G‘CodÚPos™iÚ
(0,
i
è!ğG‘CodÚPos™iÚ(0,
j
)) {

207 ià((
	`G‘CodÚPos™iÚ
(1,
i
è=ğG‘CodÚPos™iÚ(1,
j
)) && (GetCodonPosition(2,i) == GetCodonPosition(2,j))) {

214 ià(
	`G‘CodÚPos™iÚ
(1,
i
è!ğG‘CodÚPos™iÚ(1,
j
)) {

215 ià((
	`G‘CodÚPos™iÚ
(0,
i
è=ğG‘CodÚPos™iÚ(0,
j
)) && (GetCodonPosition(2,i) == GetCodonPosition(2,j))) {

222 ià(
	`G‘CodÚPos™iÚ
(2,
i
è!ğG‘CodÚPos™iÚ(2,
j
)) {

223 ià((
	`G‘CodÚPos™iÚ
(1,
i
è=ğG‘CodÚPos™iÚ(1,
j
)) && (GetCodonPosition(0,i) == GetCodonPosition(0,j))) {

231 
	}
}

233 
	gCodÚS‹S·û
::
	$G‘Deg’”acy
(
codÚ
) {

235 ià(!
deg’”acy
.
	`size
()) {

236 
	`MakeDeg’”acyM­
();

238 ià(
codÚ
 == -1) {

241  
deg’”acy
[
codÚ
];

242 
	}
};

244 
	gCodÚS‹S·û
::
	$MakeDeg’”acyM­
() {

246 
codÚ
 =0; codÚ < 
N¡©e
; codon++) {

247 
û¼
 << 
codÚ
 << '\t' << 
	`G‘S‹
(codon) << '\t';

248 
pos1
 = 
	`G‘CodÚPos™iÚ
(0,
codÚ
);

249 
pos2
 = 
	`G‘CodÚPos™iÚ
(1,
codÚ
);

250 
¯
 = 
	`T¿n¦©iÚ
(
codÚ
);

251 
d
 = 0;

252 
n
=0;‚<
Nnuc
;‚++) {

253 
cod
 = 
	`G‘CodÚFromDNA
(
pos1
,
pos2
,
n
);

254 ià((
cod
 !ğ-1è&& (
	`T¿n¦©iÚ
(codè=ğ
¯
)) {

255 
d
++;

257 
û¼
 << 
	`G‘S‹
(
cod
);

258 ià(
cod
 == -1) {

259 
û¼
 << " $ ";

262 
û¼
 << ' ' << 
	`G‘PrÙešS‹S·û
()->
	`G‘S‹
(
	`T¿n¦©iÚ
(
cod
)) << ' ';

265 
û¼
 << '\t';

266 
û¼
 << 
d
 << '\n';

267 
deg’”acy
[
codÚ
] = 
d
;

269 
û¼
 << "ok\n";

270 
	}
};

272 
	gCodÚS‹S·û
::
	$IsNÚCTN—»¡
(
a
, 
b
) {

274 
noù
 = 1;

275 
Â
 = 0;

276 
c1
 = 0; c1 <
	`G‘N¡©e
(); c1++) {

277 ià(
	`T¿n¦©iÚ
(
c1
è=ğ
a
) {

278 
c2
 = 0; c2 <
	`G‘N¡©e
(); c2++) {

279 ià(
	`T¿n¦©iÚ
(
c2
è=ğ
b
) {

280 
pos
 = 
	`G‘DifãršgPos™iÚ
(
c1
,
c2
);

281 ià(
pos
 < 3) {

282 
Â
 = 
Œue
;

283 
n1
 = 
	`G‘CodÚPos™iÚ
(
pos
,
c1
);

284 
n2
 = 
	`G‘CodÚPos™iÚ
(
pos
,
c2
);

285 ià(((
n1
 =ğ1è&& (
n2
 == 3)) || ((n1 == 3) && (n2 == 1))) {

286 
noù
 = 
çl£
;

293 ià(! 
Â
) {

296  
noù
;

297 
	}
}

	@CodonStateSpace.h

1 #iâdeà
CODONSTATESPACE_H


2 
	#CODONSTATESPACE_H


	)

4 
	~"S‹S·û.h
"

5 
	~<m­
>

7 şas 
	cCodÚS‹S·û
 : 
public
 
S‹S·û
 {

9 
public
:

11 cÚ¡ 
Npos
 = 3;

16 
CodÚS‹S·û
(
G’‘icCodeTy³
 
šcode
);

17 ~
CodÚS‹S·û
();

23 
	$G‘N¡©e
(è{ 
N¡©e
;}

26 
	`G‘S‹
(
¡ršg
 
¡©e
);

29 
¡ršg
 
	`G‘S‹
(
¡©e
);

35 
DNAS‹S·û
* 
	$G‘DNAS‹S·û
(è{ 
nuc¡©e¥aû
;
	}
}

37 
PrÙešS‹S·û
* 
	$G‘PrÙešS‹S·û
(è{ 
´Ù¡©e¥aû
;
	}
}

42 
G‘CodÚFromDNA
(
pos1
, 
pos2
, 
pos3
);

54 
G‘DifãršgPos™iÚ
(
codÚ1
, 
codÚ2
);

58 
	$G‘CodÚPos™iÚ
(
pos
, 
codÚ
) {

59 ià((
pos
<0è|| (pos>=
Npos
)) {

60 
û¼
 << "GetCodonPosition:…os out of bound\n";

61 
û¼
 << 
pos
 << '\n';

62 
	`ex™
(1);

64 ià(
codÚ
 == -1) {

67 ià((
codÚ
<0è|| (codÚ>=
N¡©e
)) {

68 
û¼
 << "GetCodonPosition: codon out of bound\n";

69 
û¼
 << 
codÚ
 << '\n';

70 
	`ex™
(1);

72  
CodÚPos
[
pos
][
codÚ
];

73 
	}
}

75 
IsNÚCTN—»¡
(
amšßcid1
, 
amšßcid2
);

78 
	$T¿n¦©iÚ
(
codÚ
) {

79  
CodÚCode
[
codÚ
];

80 
	}
}

83 
boŞ
 
	$SynÚymous
(
codÚ1
, 
codÚ2
) {

84  (
CodÚCode
[
codÚ1
] =ğCodÚCode[
codÚ2
]);

85 
	}
}

89 
	$T¿n¦©iÚW™hStİs
(
codÚ
) {

90  
CodÚCodeW™hStİs
[
codÚ
];

91 
	}
}

93 
boŞ
 
CheckStİ
(
pos1
, 
pos2
, 
pos3
);

106 
G‘Deg’”acy
(
codÚ
);

108 
	$G‘N¡İ
() {

109  
N¡İ
;

110 
	}
}

112 cÚ¡ * 
	$G‘StİPos1
() {

113  
StİPos1
;

114 
	}
}

116 cÚ¡ * 
	$G‘StİPos2
() {

117  
StİPos2
;

118 
	}
}

120 cÚ¡ * 
	$G‘StİPos3
() {

121  
StİPos3
;

122 
	}
}

124 
	g´iv©e
:

126 
MakeDeg’”acyM­
();

128 
G’‘icCodeTy³
 
	gcode
;

129 
DNAS‹S·û
* 
	gnuc¡©e¥aû
;

130 
PrÙešS‹S·û
* 
	g´Ù¡©e¥aû
;

132 
	gN¡©e
;

138 * 
	gCodÚCodeW™hStİs
;

139 * 
	gCodÚCode
;

140 ** 
	gCodÚPos
;

141 * 
	gStİCodÚs
;

142 
	gN¡İ
;

143 * 
	gStİPos1
;

144 * 
	gStİPos2
;

145 * 
	gStİPos3
;

147 
	gm­
<,> 
	gdeg’”acy
;

	@CodonSubMatrix.cpp

1 
	~"CodÚSubM©rix.h
"

3 
	gMGCodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

5 
tÙ®
 = 0;

6 
j
=0; j<
	`G‘N¡©e
(); j++) {

7 ià(
i
!=
j
) {

8 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

9 ià((
pos
 != -1) && (pos != 3)) {

10 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

11 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

12 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

13 
tÙ®
 +ğ
Q
[
i
][
j
];

16 
Q
[
i
][
j
] = 0;

20 
Q
[
i
][i] = -
tÙ®
;

21 
	}
}

23 
	gMGCodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

26 
tÙ®
 = 0;

27 
i
=0; i<
	`G‘N¡©e
(); i++) {

28 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)) * NucMatrix->Stationary(GetCodonPosition(1,i)) * NucMatrix->Stationary(GetCodonPosition(2,i));

29 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

33 
i
=0; i<
	`G‘N¡©e
(); i++) {

34 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

36 
	}
}

38 
	gMGCodÚSubM©rix
::
	$Compu‹NucA¼ays
() {

40 
û¼
 << "error: in mg codon sub matrix compute‚uc‡rray\n";

41 
	`ex™
(1);

42 
i
=0; i<
Nnuc
; i++) {

43 
j
=0; j<
Nnuc
; j++) {

44 ià(
i
 !ğ
j
) {

45 
syÂuÿ¼ay
[
i
][
j
] = (*
NucM©rix
)(i,j);

46 
nÚsyÂuÿ¼ay
[
i
][
j
] = (*
NucM©rix
)(i,j);

50 cÚ¡ * 
¡©
 = 
NucM©rix
->
	`G‘StiÚ¬y
();

51 cÚ¡ * 
¡İpos1
 = 
	`G‘CodÚS‹S·û
()->
	`G‘StİPos1
();

52 cÚ¡ * 
¡İpos2
 = 
	`G‘CodÚS‹S·û
()->
	`G‘StİPos2
();

53 cÚ¡ * 
¡İpos3
 = 
	`G‘CodÚS‹S·û
()->
	`G‘StİPos3
();

54 
¡İ¡©
 = 0;

55 
i
=0; i<
	`G‘CodÚS‹S·û
()->
	`G‘N¡İ
(); i++) {

56 
¡İ¡©
 +ğ
¡©
[
¡İpos1
[
i
]] * st[
¡İpos2
[i]] * st[
¡İpos3
[i]];

58 
	}
}

60 
	gMGOmegaCodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

62 
tÙ®
 = 0;

63 
j
=0; j<
	`G‘N¡©e
(); j++) {

64 ià(
i
!=
j
) {

65 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

66 ià((
pos
 != -1) && (pos != 3)) {

67 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

68 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

69 ià(
a
 =ğ
b
) {

70 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

71 
û¼
 << 
pos
 << '\n';

72 
	`ex™
(1);

74 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

75 ià(! 
	`SynÚymous
(
i
,
j
)) {

76 
Q
[
i
][
j
] *ğ
	`G‘Omega
();

80 
Q
[
i
][
j
] = 0;

82 
tÙ®
 +ğ
Q
[
i
][
j
];

85 
Q
[
i
][i] = -
tÙ®
;

86 ià(
tÙ®
 <0) {

87 
û¼
 << "negative„ate‡way\n";

88 
	`ex™
(1);

90 
	}
}

93 
	gMGOmegaCodÚSubM©rix
::
	$Compu‹NucA¼ays
() {

95 
i
=0; i<
Nnuc
; i++) {

96 
j
=0; j<
Nnuc
; j++) {

97 ià(
i
 !ğ
j
) {

98 
syÂuÿ¼ay
[
i
][
j
] = (*
NucM©rix
)(i,j);

99 
nÚsyÂuÿ¼ay
[
i
][
j
] = 
omega
 * (*
NucM©rix
)(i,j);

103 cÚ¡ * 
¡©
 = 
NucM©rix
->
	`G‘StiÚ¬y
();

104 cÚ¡ * 
¡İpos1
 = 
	`G‘CodÚS‹S·û
()->
	`G‘StİPos1
();

105 cÚ¡ * 
¡İpos2
 = 
	`G‘CodÚS‹S·û
()->
	`G‘StİPos2
();

106 cÚ¡ * 
¡İpos3
 = 
	`G‘CodÚS‹S·û
()->
	`G‘StİPos3
();

107 
¡İ¡©
 = 0;

108 
i
=0; i<
	`G‘CodÚS‹S·û
()->
	`G‘N¡İ
(); i++) {

109 
¡İ¡©
 +ğ
¡©
[
¡İpos1
[
i
]] * st[
¡İpos2
[i]] * st[
¡İpos3
[i]];

111 
	}
}

114 
	gAmšoAcidReduûdCodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

118 
a
=0;‡<
	`G‘N¡©e
();‡++) {

119 
mStiÚ¬y
[
a
] = 0;

122 
i
=0; i<
	`G‘CodÚS‹S·û
()->
	`G‘N¡©e
(); i++) {

123 
mStiÚ¬y
[
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
)] +ğ
	`G‘CodÚSubM©rix
()->
	`StiÚ¬y
(i);

126 
	}
}

128 
	gAmšoAcidReduûdCodÚSubM©rix
::
	$Compu‹A¼ay
(
a
) {

132 
b
=0; b<
	`G‘N¡©e
(); b++) {

133 
Q
[
a
][
b
] = 0;

136 
i
=0; i<
	`G‘CodÚS‹S·û
()->
	`G‘N¡©e
(); i++) {

137 ià(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
è=ğ
a
) {

138 
j
=0; j<
	`G‘CodÚS‹S·û
()->
	`G‘N¡©e
(); j++) {

139 
b
 = 
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
j
);

140 ià(
b
 !ğ
a
) {

141 
Q
[
a
][
b
] +ğ
	`G‘CodÚSubM©rix
()->
	`StiÚ¬y
(
i
è* (*G‘CodÚSubM©rix())(i,
j
);

147 
b
=0; b<
	`G‘N¡©e
(); b++) {

148 ià(
b
 !ğ
a
) {

149 
Q
[
a
][
b
] /ğ
mStiÚ¬y
[a];

153 
tÙ®
 = 0;

154 
b
=0; b<
	`G‘N¡©e
(); b++) {

155 ià(
b
 !ğ
a
) {

156 
tÙ®
 +ğ
Q
[
a
][
b
];

159 
Q
[
a
][a] = -
tÙ®
;

160 
	}
}

	@CodonSubMatrix.h

2 #iâdeà
CODONSUBMATRIX_H


3 
	#CODONSUBMATRIX_H


	)

5 
	~"RªdomSubM©rix.h
"

6 
	~"CodÚS‹S·û.h
"

8 cÚ¡ 
	gomegamš
 = 1e-10;

12 şas 
	cCodÚSubM©rix
 : 
public
 
vœtu®
 
SubM©rix
 {

14 
public
:

16 
	$CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
boŞ
 
šnÜm®i£
è: 
	`SubM©rix
(š¡©e¥aû->
	`G‘N¡©e
(),šnÜm®i£), 
	$¡©e¥aû
(
š¡©e¥aû
) {}

18 
CodÚS‹S·û
* 
	$G‘CodÚS‹S·û
(è{ 
¡©e¥aû
;
	}
}

21 
boŞ
 
	$SynÚymous
(
codÚ1
, 
codÚ2
è{ 
¡©e¥aû
->
	`SynÚymous
(codÚ1,codÚ2);
	}
}

22 
	$G‘CodÚPos™iÚ
(
pos
, 
codÚ
è{ 
¡©e¥aû
->
	`G‘CodÚPos™iÚ
Õos,codÚ);
	}
}

23 
	$G‘DifãršgPos™iÚ
(
codÚ1
, 
codÚ2
è{ 
¡©e¥aû
->
	`G‘DifãršgPos™iÚ
(codÚ1,codÚ2);
	}
}

25 
	g´Ùeùed
:

26 
CodÚS‹S·û
* 
¡©e¥aû
;

33 şas 
	cNucCodÚSubM©rix
 : 
public
 
vœtu®
 
CodÚSubM©rix
 {

35 
public
:

37 
	$NucCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
boŞ
 
šnÜm®i£
) :

38 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

39 
	$CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
){

41 
	`S‘NucM©rix
(
šNucM©rix
);

44 
SubM©rix
* 
	$G‘NucM©rix
() {

45  
NucM©rix
;

46 
	}
}

48 
	g´Ùeùed
:

50 
	$S‘NucM©rix
(
SubM©rix
* 
šm©rix
) {

51 
NucM©rix
 = 
šm©rix
;

52 ià(
NucM©rix
->
	`G‘N¡©e
(è!ğ
Nnuc
) {

53 
û¼
 << "error in CodonSubMatrix: underyling mutation…rocess should be‡ 4x4 matrix\n";

54 
throw
;

56 
	}
}

58 
SubM©rix
* 
	gNucM©rix
;

64 
şass
 
	gRªdomCodÚSubM©rix
 : 
public
 
vœtu®
 
CodÚSubM©rix
,…ubliøvœtu® 
	gRªdomSubM©rix
 {

66 
	gpublic
:

68 
RªdomCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
boŞ
 
šnÜm
 = 
çl£
) :

69 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm
),

70 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm
),

71 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm
) {}

79 şas 
	cMGCodÚSubM©rix
 : 
public
 
NucCodÚSubM©rix
 {

81 
public
:

83 
	$MGCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

84 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

85 
	`CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

86 
	$NucCodÚSubM©rix
(
š¡©e¥aû
,
šNucM©rix
,
šnÜm®i£
) {

88 
syÂuÿ¼ay
 = 
Ãw
 *[
Nnuc
];

89 
nÚsyÂuÿ¼ay
 = 
Ãw
 *[
Nnuc
];

90 
i
=0; i<
Nnuc
; i++) {

91 
syÂuÿ¼ay
[
i
] = 
Ãw
 [
Nnuc
];

92 
nÚsyÂuÿ¼ay
[
i
] = 
Ãw
 [
Nnuc
];

93 
j
=0; j<
Nnuc
; j++) {

94 
syÂuÿ¼ay
[
i
][
j
] = 0;

95 
nÚsyÂuÿ¼ay
[
i
][
j
] = 0;

98 
nucæag
 = 
çl£
;

101 
vœtu®
 ~
	$MGCodÚSubM©rix
() {

102 
i
=0; i<
Nnuc
; i++) {

103 
d–‘e
[] 
syÂuÿ¼ay
[
i
];

104 
d–‘e
[] 
nÚsyÂuÿ¼ay
[
i
];

106 
	}
}

108 ** 
	$G‘SynNucA¼ay
() {

109 ià(! 
nucæag
) {

110 
	`Compu‹NucA¼ays
();

111 
nucæag
 = 
Œue
;

113  
syÂuÿ¼ay
;

114 
	}
}

116 ** 
	$G‘NÚSynNucA¼ay
() {

117 ià(! 
nucæag
) {

118 
	`Compu‹NucA¼ays
();

119 
nucæag
 = 
Œue
;

121  
nÚsyÂuÿ¼ay
;

122 
	}
}

124 
	$G‘NÜmSt
() {

125 ià(! 
nucæag
) {

126 
	`Compu‹NucA¼ays
();

127 
nucæag
 = 
Œue
;

129  1 - 
¡İ¡©
;

130 
	}
}

132 
	g´Ùeùed
:

135 
Compu‹A¼ay
(
¡©e
);

136 
Compu‹StiÚ¬y
();

138 
vœtu®
 
Compu‹NucA¼ays
();

140 
vœtu®
 
	$CÜru±M©rix
() {

141 
nucæag
 = 
çl£
;

142 
SubM©rix
::
	`CÜru±M©rix
();

143 
	}
}

145 ** 
	gsyÂuÿ¼ay
;

146 ** 
	gnÚsyÂuÿ¼ay
;

147 
	g¡İ¡©
;

148 
boŞ
 
	gnucæag
;

155 
şass
 
	gRªdomMGCodÚSubM©rix
 : 
public
 
MGCodÚSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

157 
	gpublic
:

159 
RªdomMGCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

160 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

161 
CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

162 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

163 
MGCodÚSubM©rix
(
š¡©e¥aû
,
šm©rix
, 
šnÜm®i£
) ,

164 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

165 
m©rix
(
šm©rix
) {

167 
Regi¡”
(
m©rix
);

168 
¥ecŸlUpd©e
();

173 
S‘P¬am‘”s
() {

174 
S‘NucM©rix
(
m©rix
);

177 
	g´Ùeùed
:

179 
RªdomSubM©rix
* 
m©rix
;

185 şas 
	cMGOmegaCodÚSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

187 
public
:

189 
	$MGOmegaCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
šomega
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

190 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

191 
	`CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

192 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
) ,

193 
	$omega
(
šomega
) {}

196 
	$G‘Omega
(è{ 
omega
 + 
omegamš
;
	}
}

198 
	g´Ùeùed
:

201 
Compu‹A¼ay
(
¡©e
);

202 
	$S‘Omega
(
šomega
è{
omega
 = inomega;
	}
}

204 
vœtu®
 
Compu‹NucA¼ays
();

206 
	$ToSŒ—m
(
o¡»am
& 
os
) {

207 
os
 << "Omeg¨: " << 
omega
 << '\n';

208 
os
 << "nuc matrix\n";

209 
	`G‘NucM©rix
()->
	`ToSŒ—m
(
os
);

210 
os
 << '\n';

211 
SubM©rix
::
	`ToSŒ—m
(
os
);

212 
	}
}

216 
	gomega
;

219 
şass
 
	gRªdomMGOmegaCodÚSubM©rix
 : 
public
 
MGOmegaCodÚSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

221 
	gpublic
:

223 
RªdomMGOmegaCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
PosR—l
>* 
šRªdomOmega
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

224 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

225 
CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

226 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

227 
MGOmegaCodÚSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomOmega
->
v®
(), 
šnÜm®i£
) ,

228 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

229 
m©rix
(
šm©rix
),

230 
RªdomOmega
(
šRªdomOmega
) {

232 
Regi¡”
(
m©rix
);

233 
Regi¡”
(
RªdomOmega
);

234 
¥ecŸlUpd©e
();

242 
S‘P¬am‘”s
() {

243 
S‘NucM©rix
(
m©rix
);

244 
S‘Omega
(
RªdomOmega
->
v®
());

247 
	g´Ùeùed
:

249 
RªdomSubM©rix
* 
m©rix
;

250 
	gV¬
<
	gPosR—l
>* 
	gRªdomOmega
;

262 şas 
	cAmšoAcidReduûdCodÚSubM©rix
 : 
public
 
vœtu®
 
SubM©rix
 {

264 
public
:

265 
	$AmšoAcidReduûdCodÚSubM©rix
(
CodÚSubM©rix
* 
šcodÚm©rix
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
	`SubM©rix
(
N¯
,šnÜm®i£), 
	$codÚm©rix
(
šcodÚm©rix
) {

266 
¯¡©e¥aû
 = 
Ãw
 
	`PrÙešS‹S·û
();

270 
CodÚSubM©rix
* 
	$G‘CodÚM©rix
(è{ 
codÚm©rix
;
	}
}

271 
CodÚSubM©rix
* 
	$G‘CodÚSubM©rix
(è{ 
codÚm©rix
;
	}
}

272 
CodÚS‹S·û
* 
	$G‘CodÚS‹S·û
(è{ 
	`G‘CodÚM©rix
()->
	`G‘CodÚS‹S·û
();
	}
}

273 
PrÙešS‹S·û
* 
	$G‘PrÙešS‹S·û
(è{ 
¯¡©e¥aû
;
	}
}

275 
	g´Ùeùed
:

277 
	$S‘CodÚM©rix
(
CodÚSubM©rix
* 
šcodÚm©rix
) {

278 
codÚm©rix
 = 
šcodÚm©rix
;

279 
	}
}

281 
Compu‹A¼ay
(
¡©e
);

282 
Compu‹StiÚ¬y
();

284 
CodÚSubM©rix
* 
	gcodÚm©rix
;

285 
PrÙešS‹S·û
* 
	g¯¡©e¥aû
;

295 
şass
 
	gRªdomAmšoAcidReduûdCodÚSubM©rix
 : 
public
 
AmšoAcidReduûdCodÚSubM©rix
,…ubliø
	gRªdomSubM©rix
 {

297 
	gpublic
:

299 
RªdomAmšoAcidReduûdCodÚSubM©rix
(
RªdomCodÚSubM©rix
* 
š¿ndomcodÚm©rix
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

300 
SubM©rix
(
N¯
, 
šnÜm®i£
),

301 
AmšoAcidReduûdCodÚSubM©rix
(
š¿ndomcodÚm©rix
,
šnÜm®i£
) ,

302 
RªdomSubM©rix
(
N¯
, 
šnÜm®i£
) ,

303 
¿ndomcodÚm©rix
(
š¿ndomcodÚm©rix
) {

305 
Regi¡”
(
¿ndomcodÚm©rix
);

306 
¥ecŸlUpd©e
();

310 
S‘P¬am‘”s
() {

311 
S‘CodÚM©rix
(
¿ndomcodÚm©rix
);

314 
	g´Ùeùed
:

316 
RªdomCodÚSubM©rix
* 
¿ndomcodÚm©rix
;

	@CommutativeBrownianProcess.h

2 #iâdeà
COMMUTATIVEBROWNIANPROCESS_H


3 
	#COMMUTATIVEBROWNIANPROCESS_H


	)

5 
	~"BrownŸnProûss.h
"

6 
	~"V®T»e.h
"

8 
şass
 
	gCommutiveIÁeg¿lP©h
 : 
public
 
Dv¬
<
PosR—l
> {

9 
public
:

11 
CommutiveIÁeg¿lP©h
(
RªdomBrownŸnP©h
 *
šbrownŸnP©h
, 
V¬
<
R—lVeùÜ
> *
šup
, V¬<R—lVeùÜ> *
šdown
, 
ššdex
 = 0) {

13 
brownŸnP©h
 = 
šbrownŸnP©h
;

14 
	gup
 = 
šup
;

15 
	gdown
 = 
šdown
;

16 
	gšdex
 = 
ššdex
;

17 
S‘Name
("Commutative Brownian Path Average");

19 
Regi¡”
(
up
);

20 
Regi¡”
(
down
);

21 
Regi¡”
(
brownŸnP©h
);

22 
Regi¡”
(
brownŸnP©h
->
g‘Up
());

23 
Regi¡”
(
brownŸnP©h
->
g‘Down
());

26 
¥ecŸlUpd©e
();

28 
¥ecŸlUpd©e
() {

29 
£tv®
(
brownŸnP©h
->
g‘IÁeg¿l
(
šdex
, 
up
->
v®
()[šdex], 
down
->val()[index]));

32 
	g´iv©e
:

34 
RªdomBrownŸnP©h
 *
brownŸnP©h
;

35 
	gV¬
<
	gR—lVeùÜ
> *
	gup
, *
	gdown
;

36 
	gšdex
;

39 
şass
 
	gCommutiveBrownŸnProûss
 : 
public
 
B¿nchV®PŒT»e
<
Dv¬
<
PosR—l
> >

41 
public
:

43 
CommutiveBrownŸnProûss
(
BrownŸnProûss
* 
šbrownŸnProûss
, 
ššdex
 = 0) {

44 
S‘W™hRoÙ
(
çl£
);

45 
	gbrownŸnProûss
 = 
šbrownŸnProûss
;

46 
	gšdex
 = 
ššdex
;

47 
RecursiveC»©e
(
G‘RoÙ
());

49 
	gvœtu®
 ~
CommutiveBrownŸnProûss
() {

50 
RecursiveD–‘e
(
G‘RoÙ
());

53 
vœtu®
 
	gDv¬
<
	gPosR—l
>* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

55 
MuÉiNÜm®
* 
	gvdown
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
->
Out
());

58 
MuÉiNÜm®
* 
	gvup
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
);

61 
RªdomBrownŸnP©h
* 
	gbrownŸnP©h
 = 
brownŸnProûss
->
G‘Pu»BrownŸnProûss
()->
G‘RªdomBrownŸnP©h
(
lšk
);

64  
Ãw
 
CommutiveIÁeg¿lP©h
(
brownŸnP©h
, 
vup
, 
vdown
, 
šdex
);

67 
¥ecŸlUpd©e
() {

68 
RecursiveS³cŸlUpd©e
(
G‘RoÙ
());

71 
RecursiveS³cŸlUpd©e
(cÚ¡ 
Lšk
* 
äom
) {

72 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

73 
RecursiveS³cŸlUpd©e
(
lšk
->
Out
());

74 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

79 
vœtu®
 
T»e
* 
G‘T»e
() {

80  
	gbrownŸnProûss
->
G‘T»e
();

83 
	g´Ùeùed
:

84 
´iv©e
:

86 
BrownŸnProûss
* 
brownŸnProûss
;

87 
	gšdex
;

	@Conjugate.h

2 #iâdeà
CONJUGATE_H


3 
	#CONJUGATE_H


	)

5 
usšg
 
Çme¥aû
 
	g¡d
;

6 
	~"MCMC.h
"

7 
	~<£t
>

9 
şass
 
	gRnode
;

11 
	g£t
<
	tDAGnode
*>::
	tcÚ¡_™”©Ü
 
	tş™
;

13 şas 
	cSemiCÚjPriÜ
 {

15 
	mpublic
:

20 
vœtu®
 
Re£tSuffic›ÁSti¡ic
() = 0;

21 
vœtu®
 
SaveSuffic›ÁSti¡ic
() = 0;

22 
vœtu®
 
Re¡ÜeSuffic›ÁSti¡ic
() = 0;

25 
vœtu®
 
SuffStLogProb
() = 0;

28 
	$SemiCÚjPriÜ
() {

29 
suff¡©_æag
 = 
çl£
;

30 
aùive_æag
 = 
çl£
;

31 
cÜru±_couÁ”
 = 0;

34 
vœtu®
 ~
	$SemiCÚjPriÜ
(è{
	}
}

37 
vœtu®
 
IÇùiv©eSuffic›ÁSti¡ic
() = 0;

38 
vœtu®
 
CÚjug©eNÙifyCÜru±
(
boŞ
 
bk
) = 0;

39 
vœtu®
 
CÚjug©eNÙifyUpd©e
() = 0;

40 
vœtu®
 
CÚjug©eNÙifyRe¡Üe
() = 0;

43 
vœtu®
 
	$CÜru±Suffic›ÁSti¡ic
() {

44 
suff¡©_æag
 = 
çl£
;

45 
	}
}

47 
boŞ
 
	$isAùive
() {

48  
aùive_æag
;

49 
	}
}

51 
	g´Ùeùed
:

53 
boŞ
 
suff¡©_æag
;

54 
boŞ
 
	gaùive_æag
;

55 
	gcÜru±_couÁ”
;

58 şas 
	cCÚjSam¶šg
 {

60 
	mpublic
:

62 
£t
<
	tSemiCÚjPriÜ
*>::
	tcÚ¡_™”©Ü
 
	tıl™
;

64 
	mvœtu®
 ~
	$CÚjSam¶šg
() {}

67 
vœtu®
 
	`AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) = 0;

76 
vœtu®
 
	$CÚjug©eCÜru±
(
boŞ
 
bk
) {

77 
ıl™
 
i
=
cÚjug©e_up
.
	`begš
(); i!=cÚjug©e_up.
	`’d
(); i++) {

78 ià((*
i
)->
	`isAùive
()) {

79 (*
i
)->
	`CÚjug©eNÙifyCÜru±
(
bk
);

82 
	}
}

84 
vœtu®
 
	$CÚjug©eUpd©e
(
boŞ
& 
aùive
) {

85 
»t
 = 0;

86 
ıl™
 
i
=
cÚjug©e_up
.
	`begš
(); i!=cÚjug©e_up.
	`’d
(); i++) {

87 ià((*
i
)->
	`isAùive
()) {

88 
aùive
 = 
Œue
;

89 
»t
 +ğ(*
i
)->
	`CÚjug©eNÙifyUpd©e
();

92  
»t
;

93 
	}
}

95 
vœtu®
 
	$CÚjug©eRe¡Üe
(
boŞ
& 
aùive
) {

96 
ıl™
 
i
=
cÚjug©e_up
.
	`begš
(); i!=cÚjug©e_up.
	`’d
(); i++) {

97 ià((*
i
)->
	`isAùive
()) {

98 
aùive
 = 
Œue
;

99 (*
i
)->
	`CÚjug©eNÙifyRe¡Üe
();

102 
	}
}

104 
boŞ
 
	$isUpAùive
() {

105 
ıl™
 
i
=
cÚjug©e_up
.
	`begš
();

106 (
i
 !ğ
cÚjug©e_up
.
	`’d
()è&& (!(*i)->
	`isAùive
())) i++;

107  (
i
 !ğ
cÚjug©e_up
.
	`’d
());

108 
	}
}

117 
	$NÙifyAùiv©eSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
äom
) {

119 
ıl™
 
i
=
cÚjug©e_up
.
	`begš
(); i!=cÚjug©e_up.
	`’d
(); i++) {

120 ià(*(
i
è!ğ
äom
) {

121 (*
i
)->
	`IÇùiv©eSuffic›ÁSti¡ic
();

124 
	}
}

126 
	g´Ùeùed
:

128 
£t
<
SemiCÚjPriÜ
*> 
cÚjug©e_up
;

133 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gDSemiCÚjug©ePriÜ
 : 
public
 
vœtu®
 
Dv¬
<
T
>,…ubliø
	gSemiCÚjPriÜ
 {

135 
	gpublic
:

140 
vœtu®
 
logProb
() = 0;

150 
vœtu®
 
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
) {

151 ià(! 
isAùive
()) {

152 
	gDv¬
<
	gT
>::
CÜru±
(
Œue
);

160 
	gthis
->
loÿlCÜru±
(
Œue
);

161 
	gbklog´ob
 = 
log´ob
;

167 
vœtu®
 
CÜru±
(
boŞ
 
bk
) {

168 ià(! 
isAùive
()) {

169 
	gDv¬
<
	gT
>::
CÜru±
(
bk
);

177 
	gthis
->
loÿlCÜru±
(
bk
);

178 ià(
	gbk
) {

179 
	gbklog´ob
 = 
log´ob
;

186 
vœtu®
 
FuÎUpd©e
(
boŞ
 
check
) {

187  
Upd©e
();

190 
vœtu®
 
Upd©e
() {

191 
	g»t
 = 0;

192 ià(! 
isAùive
()) {

193 
	g»t
 = 
Dv¬
<
T
>::
Upd©e
();

196 ià(! 
	gthis
->
	gæag
) {

197 
boŞ
 
	gup_ok
 = 
Œue
;

198 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

199 
	gup_ok
 &ğ(*
i
)->
isUpd©ed
();

201 ià(
	gup_ok
) {

202 
	gthis
->
loÿlUpd©e
();

203 
	glog´ob
 = 
this
->
logProb
();

204 
	g»t
 +ğ
log´ob
 - 
bklog´ob
;

208  
	g»t
;

211 
vœtu®
 
Re¡Üe
() {

212 ià(! 
isAùive
()) {

213 
	gDv¬
<
	gT
>::
Re¡Üe
();

217 ià(! 
	gthis
->
isUpd©ed
()) {

218 
boŞ
 
	gup_ok
 = 
Œue
;

219 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

220 
	gup_ok
 &ğ(*
i
)->
isUpd©ed
();

222 ià(
	gup_ok
) {

223 
	gthis
->
loÿlRe¡Üe
();

224 
	glog´ob
 = 
bklog´ob
;

235 
vœtu®
 
NÙifyCÜru±
(
boŞ
 
bk
) {

236 ià(! 
isAùive
()) {

237 
	gDv¬
<
	gT
>::
NÙifyCÜru±
(
bk
);

245 
	gthis
->
loÿlCÜru±
(
bk
);

246 ià(
	gbk
) {

247 
	gbklog´ob
 = 
log´ob
;

254 
vœtu®
 
NÙifyUpd©e
() {

255 
	g»t
 = 0;

256 ià(! 
isAùive
()) {

257 
	g»t
 = 
Dv¬
<
T
>::
NÙifyUpd©e
();

260 ià(! 
	gthis
->
	gæag
) {

261 
boŞ
 
	gup_ok
 = 
Œue
;

262 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

263 
	gup_ok
 &ğ(*
i
)->
isUpd©ed
();

265 ià(
	gup_ok
) {

266 
	gthis
->
loÿlUpd©e
();

267 
	glog´ob
 = 
this
->
logProb
();

268 
	g»t
 +ğ
log´ob
 - 
bklog´ob
;

272  
	g»t
;

275 
vœtu®
 
NÙifyRe¡Üe
() {

276 ià(! 
isAùive
()) {

277 
	gDv¬
<
	gT
>::
NÙifyRe¡Üe
();

281 ià(! 
	gthis
->
isUpd©ed
()) {

282 
boŞ
 
	gup_ok
 = 
Œue
;

283 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

284 
	gup_ok
 &ğ(*
i
)->
isUpd©ed
();

286 ià(
	gup_ok
) {

287 
	gthis
->
loÿlRe¡Üe
();

288 
	glog´ob
 = 
bklog´ob
;

307 
vœtu®
 
CÚjug©eNÙifyUpd©e
() {

308 
	gû¼
 << "conjugate‚otify\n";

309 
ex™
(1);

310 
	gcÜru±_couÁ”
--;

311 ià(! 
	gcÜru±_couÁ”
) {

312 
	gthis
->
	gæag
 = 
çl£
;

313 
Compu‹Suffic›ÁSti¡ic
();

315 
	gthis
->
loÿlUpd©e
();

316 
	glog´ob
 = 
this
->
logProb
();

317  
	glog´ob
 - 
	gbklog´ob
;

322 
vœtu®
 
CÚjug©eNÙifyCÜru±
(
boŞ
 
bk
) {

323 
	gû¼
 << "conjugate‚otify corrupt\n";

324 
ex™
(1);

325 ià(! 
isAùive
()) {

326 
	gû¼
 << "error in Conjugate corrupt\n";

327 
ex™
(1);

329 ià(! 
	gcÜru±_couÁ”
) {

330 ià(
	gbk
) {

331 
SaveSuffic›ÁSti¡ic
();

333 
CÜru±Suffic›ÁSti¡ic
();

334 
	gthis
->
loÿlCÜru±
(
bk
);

335 ià(
	gbk
) {

336 
	gbklog´ob
 = 
log´ob
;

338 
	gthis
->
	gæag
 = 
Œue
;

340 
	gcÜru±_couÁ”
++;

343 
vœtu®
 
CÚjug©eNÙifyRe¡Üe
() {

344 
	gû¼
 << "conjugate‚otify\n";

345 
ex™
(1);

346 
	gcÜru±_couÁ”
--;

347 ià(! 
	gcÜru±_couÁ”
) {

348 
Re¡ÜeSuffic›ÁSti¡ic
();

349 
	gthis
->
loÿlRe¡Üe
();

350 
	glog´ob
 = 
bklog´ob
;

367 
vœtu®
 
Aùiv©eSuffic›ÁSti¡ic
() {

368 ià(! 
	gaùive_æag
) {

370 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

371 
CÚjSam¶šg
* 
	gp
 = 
dyÇmic_ÿ¡
<CÚjSam¶šg*> (*
i
);

372 ià(!
	gp
) {

373 
Dnode
* 
	gq
 = 
dyÇmic_ÿ¡
<Dnode*> (*
i
);

374 ià(! 
	gq
) {

375 
	gû¼
 << "error :‚on conjugate child‚odes, cannot‡ctivate sufficient statistic\n";

376 
	gû¼
 << (*
	gi
) << '\n';

377 
ex™
(1);

380 ià(
	gp
) {

381 
	gp
->
NÙifyAùiv©eSuffic›ÁSti¡ic
(
this
);

384 
	gsuff¡©_æag
 = 
çl£
;

385 
	gaùive_æag
 = 
Œue
;

386 
Compu‹Suffic›ÁSti¡ic
();

387 
	gthis
->
loÿlUpd©e
();

388 
	glog´ob
 = 
logProb
();

392 
vœtu®
 
IÇùiv©eSuffic›ÁSti¡ic
() {

393 ià(
	gaùive_æag
) {

394 
	gaùive_æag
 = 
çl£
;

395 
	gsuff¡©_æag
 = 
çl£
;

396 
CÜru±
(
çl£
);

397 
Upd©e
();

401 
vœtu®
 
Compu‹Suffic›ÁSti¡ic
() {

402 ià(
	gaùive_æag
) {

403 ià(! 
	gsuff¡©_æag
) {

404 
Re£tSuffic›ÁSti¡ic
();

405 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

406 
CÚjSam¶šg
* 
	gp
 = 
dyÇmic_ÿ¡
<CÚjSam¶šg*> (*
i
);

407 ià(
	gp
) {

408 
	gp
->
AddSuffic›ÁSti¡ic
(
this
);

411 
	gsuff¡©_æag
 = 
Œue
;

416 
	g´iv©e
:

418 
bklog´ob
;

419 
	glog´ob
;

423 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gSemiCÚjug©ePriÜ
 : 
public
 
vœtu®
 
Rv¬
<
T
>,…ubliø
	gSemiCÚjPriÜ
 {

425 
	gpublic
:

430 
vœtu®
 
logProb
() = 0;

440 
vœtu®
 
CÜru±
(
boŞ
 
bk
) {

441 ià(! 
isAùive
()) {

442 
	gRv¬
<
	gT
>::
CÜru±
(
bk
);

445 ià(
	gbk
) {

446 
	gthis
->
	gbkv®ue
 = *
this
;

448 
	gthis
->
loÿlCÜru±
(
bk
);

454 
vœtu®
 
Upd©e
() {

455 
	g»t
 = 0;

456 ià(! 
isAùive
()) {

457 
	g»t
 = 
Rv¬
<
T
>::
Upd©e
();

460 ià(! 
	gthis
->
	gæag
) {

461 
boŞ
 
	gup_ok
 = 
Œue
;

462 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

463 
	gup_ok
 &ğ(*
i
)->
isUpd©ed
();

465 ià(
	gup_ok
) {

466 
	g»t
 = 
this
->
loÿlUpd©e
();

470  
	g»t
;

473 
vœtu®
 
Re¡Üe
() {

474 ià(! 
isAùive
()) {

475 
	gRv¬
<
	gT
>::
Re¡Üe
();

478 
	gthis
->
£tv®
(
this
->
bkv®ue
);

479 ià(! 
	gthis
->
isUpd©ed
()) {

480 
boŞ
 
	gup_ok
 = 
Œue
;

481 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

482 
	gup_ok
 &ğ(*
i
)->
isUpd©ed
();

484 ià(
	gup_ok
) {

485 
	gthis
->
loÿlRe¡Üe
();

486 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

487 (*
	gi
)->
NÙifyRe¡Üe
();

502 
vœtu®
 
CÚjug©eNÙifyUpd©e
() {

503 
	gcÜru±_couÁ”
--;

504 ià(! 
	gcÜru±_couÁ”
) {

505 
	gthis
->
	gæag
 = 
çl£
;

506 
Compu‹Suffic›ÁSti¡ic
();

507  
	gthis
->
loÿlUpd©e
();

512 
vœtu®
 
CÚjug©eNÙifyCÜru±
(
boŞ
 
bk
) {

513 ià(! 
isAùive
()) {

514 
	gû¼
 << "error in Conjugate corrupt\n";

515 
ex™
(1);

517 ià(! 
	gcÜru±_couÁ”
) {

518 ià(
	gbk
) {

519 
SaveSuffic›ÁSti¡ic
();

521 
CÜru±Suffic›ÁSti¡ic
();

522 
	gthis
->
loÿlCÜru±
(
bk
);

523 
	gthis
->
	gæag
 = 
Œue
;

525 
	gcÜru±_couÁ”
++;

528 
vœtu®
 
CÚjug©eNÙifyRe¡Üe
() {

529 
	gcÜru±_couÁ”
--;

530 ià(! 
	gcÜru±_couÁ”
) {

531 
Re¡ÜeSuffic›ÁSti¡ic
();

532 
	gthis
->
loÿlRe¡Üe
();

549 
vœtu®
 
Aùiv©eSuffic›ÁSti¡ic
() {

550 ià(! 
	gthis
->
isCÏm³d
()) {

551 ià(! 
	gaùive_æag
) {

553 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

554 
CÚjSam¶šg
* 
	gp
 = 
dyÇmic_ÿ¡
<CÚjSam¶šg*> (*
i
);

563 ià(
	gp
) {

564 
	gp
->
NÙifyAùiv©eSuffic›ÁSti¡ic
(
this
);

567 
	gsuff¡©_æag
 = 
çl£
;

568 
	gaùive_æag
 = 
Œue
;

569 
Compu‹Suffic›ÁSti¡ic
();

570 
	gthis
->
loÿlUpd©e
();

575 
vœtu®
 
IÇùiv©eSuffic›ÁSti¡ic
() {

576 ià(
	gaùive_æag
) {

577 
	gaùive_æag
 = 
çl£
;

578 
	gsuff¡©_æag
 = 
çl£
;

579 
CÜru±
(
çl£
);

580 
Upd©e
();

584 
vœtu®
 
Compu‹Suffic›ÁSti¡ic
() {

585 ià(
	gaùive_æag
) {

586 ià(! 
	gsuff¡©_æag
) {

587 
Re£tSuffic›ÁSti¡ic
();

588 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

589 
CÚjSam¶šg
* 
	gp
 = 
dyÇmic_ÿ¡
<CÚjSam¶šg*> (*
i
);

590 ià(
	gp
) {

591 
	gp
->
AddSuffic›ÁSti¡ic
(
this
);

594 
	gsuff¡©_æag
 = 
Œue
;

601 
	g‹m¶©e
 <
şass
 
	gR
> cÏs 
	gCÚjug©ePriÜ
 : 
public
 
vœtu®
 
SemiCÚjug©ePriÜ
<
R
> {

603 
public
:

605 
CÚjug©ePriÜ
() {

606 
š‹g¿‹d_æag
 = 
çl£
;

609 
	gvœtu®
 ~
CÚjug©ePriÜ
() {}

612 
vœtu®
 
GibbsRe§m¶e
() = 0;

614 
IÇùiv©eSuffic›ÁSti¡ic
() {

615 ià(
	gthis
->
	gaùive_æag
) {

616 ià(
isIÁeg¿‹d
()) {

617 
GibbsRe§m¶e
();

623 
	gš‹g¿‹d_æag
 = 
çl£
;

625 
	gthis
->
	gaùive_æag
 = 
çl£
;

626 
	gthis
->
	gsuff¡©_æag
 = 
çl£
;

628 
	gthis
->
CÜru±
(
çl£
);

629 
	gthis
->
Upd©e
();

633 
boŞ
 
isIÁeg¿‹d
() {

634  
	gš‹g¿‹d_æag
;

637 
IÁeg¿‹
() {

638 ià(! 
	gthis
->
isCÏm³d
()) {

639 
	gš‹g¿‹d_æag
 = 
Œue
;

640 
	gthis
->
Aùiv©eSuffic›ÁSti¡ic
();

644 
Re§m¶e
() {

645 
IÇùiv©eSuffic›ÁSti¡ic
();

648 
	g´iv©e
:

650 
boŞ
 
š‹g¿‹d_æag
;

654 
	g‹m¶©e
 <
şass
 
	gT
> cÏs 
	gCÚjug©eSam¶šg
 : 
public
 
vœtu®
 
Rv¬
<
T
>,…ubliø
	gCÚjSam¶šg
 {

656 
	gpublic
:

658 
vœtu®
 
CÜru±
(
boŞ
 
bk
) {

659 
Rv¬
<
T
>::
CÜru±
(
bk
);

660 
CÚjug©eCÜru±
(
bk
);

663 
vœtu®
 
NÙifyCÜru±
(
boŞ
 
bk
) {

664 
	gRv¬
<
	gT
>::
NÙifyCÜru±
(
bk
);

665 
CÚjug©eCÜru±
(
bk
);

668 
vœtu®
 
Upd©e
() {

669 
	g»t
 = 0;

670 ià(! 
	gthis
->
isUpd©ed
()) {

671 
boŞ
 
	gup_ok
 = 
Œue
;

672 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

673 
	gup_ok
 &ğ(*
i
)->
isV®ueUpd©ed
();

676 ià(
	gup_ok
) {

677 
boŞ
 
	gaùive
 = 
çl£
;

678 
	g»t
 +ğ
CÚjug©eUpd©e
(
aùive
);

679 ià(! 
	gaùive
) {

680 
	g»t
 +ğ
this
->
loÿlUpd©e
();

683 
	gthis
->
	gæag
 = 
Œue
;

685 
	gthis
->
	gv®ue_upd©ed
 = 
Œue
;

686 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

687 
	g»t
 +ğ(*
i
)->
NÙifyUpd©e
();

691  
	g»t
;

694 
vœtu®
 
Re¡Üe
() {

695 ià(! 
	gthis
->
isUpd©ed
()) {

696 
	gRv¬
<
	gT
>::
Re¡ÜeBackup
();

697 
boŞ
 
	gup_ok
 = 
Œue
;

698 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

699 
	gup_ok
 &ğ(*
i
)->
isV®ueUpd©ed
();

702 ià(
	gup_ok
) {

703 
	gRv¬
<
	gT
>::
Re¡ÜeBackup
();

704 
boŞ
 
	gaùive
 = 
çl£
;

705 
CÚjug©eRe¡Üe
(
aùive
);

706 ià(! 
	gaùive
) {

707 
	gthis
->
loÿlRe¡Üe
();

710 
	gthis
->
	gæag
 = 
Œue
;

712 
	gthis
->
	gv®ue_upd©ed
 = 
Œue
;

713 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

714 (*
	gi
)->
NÙifyRe¡Üe
();

720 
vœtu®
 
NÙifyUpd©e
() {

721 
	g»t
 = 0;

722 ià(! 
	gthis
->
isUpd©ed
()) {

723 
boŞ
 
	gup_ok
 = 
Œue
;

724 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

725 
	gup_ok
 &ğ(*
i
)->
isV®ueUpd©ed
();

728 ià(
	gup_ok
) {

729 
boŞ
 
	gaùive
 = 
çl£
;

730 
	g»t
 +ğ
CÚjug©eUpd©e
(
aùive
);

731 ià(! 
	gaùive
) {

732 
	g»t
 +ğ
this
->
loÿlUpd©e
();

733 ià(! 
	gthis
->
	gv®ue_upd©ed
) {

734 
	gthis
->
	gv®ue_upd©ed
 = 
Œue
;

735 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

736 
	g»t
 +ğ(*
i
)->
NÙifyUpd©e
();

741 
	gthis
->
	gæag
 = 
Œue
;

742 
	gthis
->
	gv®ue_upd©ed
 = 
Œue
;

746  
	g»t
;

749 
vœtu®
 
NÙifyRe¡Üe
() {

750 ià(! 
	gthis
->
isUpd©ed
()) {

751 
boŞ
 
	gup_ok
 = 
Œue
;

752 
ş™
 
	gi
=
this
->
up
.
begš
(); i!ñhis->up.
’d
(); i++) {

753 
	gup_ok
 &ğ(*
i
)->
isV®ueUpd©ed
();

756 ià(
	gup_ok
) {

757 
boŞ
 
	gaùive
 = 
çl£
;

758 
CÚjug©eRe¡Üe
(
aùive
);

759 ià(! 
	gaùive
) {

760 ià(! 
	gthis
->
	gv®ue_upd©ed
) {

761 
	gRv¬
<
	gT
>::
Re¡ÜeBackup
();

763 
	gthis
->
loÿlRe¡Üe
();

764 ià(! 
	gthis
->
	gv®ue_upd©ed
) {

765 
	gthis
->
	gv®ue_upd©ed
 = 
Œue
;

766 
ş™
 
	gi
=
this
->
down
.
begš
(); i!ñhis->down.
’d
(); i++) {

767 (*
	gi
)->
NÙifyRe¡Üe
();

772 
	gthis
->
	gæag
 = 
Œue
;

773 
	gthis
->
	gv®ue_upd©ed
 = 
Œue
;

	@ConjugateGTRModel.cpp

2 
	~"D¿wT»e.h
"

3 
	~"CÚjug©eGTRMod–.h
"

4 
	~"IID.h
"

6 
	gCÚjug©eGTRMod–
::
	$CÚjug©eGTRMod–
(
¡ršg
 
d©afe
, sŒšg 
Œ“fe
) {

9 
d©a
 = 
Ãw
 
	`FeSequ’ûAlignm’t
(
d©afe
);

10 
Ns™e
 = 
d©a
->
	`G‘Ns™e
();

11 
N¡©e
 = 
d©a
->
	`G‘N¡©e
();

13 
xÚ£t
 = 
d©a
->
	`G‘TaxÚS‘
();

16 
Œ“
 = 
Ãw
 
	`T»e
(
Œ“fe
);

19 
Œ“
->
	`Regi¡”W™h
(
xÚ£t
);

21 
û¼
 << "tree‡nd data ok\n";

23 
PriÜLambda
 = 
Ãw
 
CÚ¡
<
PosR—l
>(10);

24 
mu
 = 
Ãw
 
CÚ¡
<
PosR—l
>(1);

25 
Ïmbda
 = 
Ãw
 
	`ExpÚ’tŸl
(
PriÜLambda
,
ExpÚ’tŸl
::
MEAN
);

26 
gamŒ“
 = 
Ãw
 
	`CÚjug©eGammaT»e
(
Œ“
,
mu
,
Ïmbda
);

28 
PriÜV¬R©e
 = 
Ãw
 
CÚ¡
<
PosR—l
>(1);

29 
®pha
 = 
Ãw
 
	`ExpÚ’tŸl
(
PriÜV¬R©e
,
ExpÚ’tŸl
::
MEAN
);

30 
¿‹
 = 
Ãw
 
	`CÚjug©eGammaIIDA¼ay
(
Ns™e
,
®pha
,alpha);

32 
»Ì©e
 = 
Ãw
 
	`IIDCÚjug©eGamma
(
N¡©e
*(Nstate-1)/2);

33 
¡©iÚ¬y
 = 
Ãw
 
	`SemiCÚjug©eDœichËt
(
N¡©e
);

34 
m©rix
 = 
Ãw
 
	`GTRRªdomSubM©rix
(
»Ì©e
, 
¡©iÚ¬y
);

47 
û¼
 << "new…hyloprocess\n";

48 
phylİroûss
 = 
Ãw
 
	`CÚjug©eOÃM©rixRASPhyloProûss
(
gamŒ“
, 
¿‹
, 
m©rix
, 
d©a
);

50 
û¼
 << "unfold\n";

51 
phylİroûss
->
	`UnfŞd
();

53 
û¼
 << "register\n";

54 
	`RoÙRegi¡”
(
PriÜV¬R©e
);

55 
	`RoÙRegi¡”
(
PriÜLambda
);

56 
	`RoÙRegi¡”
(
mu
);

57 
	`RoÙRegi¡”
(
»Ì©e
);

58 
	`RoÙRegi¡”
(
¡©iÚ¬y
);

59 
	`Regi¡”
();

61 
û¼
 << "initialise\n";

62 
	`Sam¶e
();

63 
	`T¿û
(
û¼
);

65 
û¼
 << "model created\n";

66 
	}
}

68 
	gCÚjug©eGTRMod–
::~
	$CÚjug©eGTRMod–
() {

70 
	}
}

72 
CÚjug©eGTRMod–
::
	$G‘LogPriÜ
() {

73 
tÙ®
 = 0;

74 
tÙ®
 +ğ
®pha
->
	`G‘LogProb
();

75 
tÙ®
 +ğ
¿‹
->
	`G‘LogProb
();

76 
tÙ®
 +ğ
Ïmbda
->
	`G‘LogProb
();

77 
tÙ®
 +ğ
gamŒ“
->
	`G‘LogProb
();

78 
tÙ®
 +ğ
¡©iÚ¬y
->
	`G‘LogProb
();

79 
tÙ®
 +ğ
»Ì©e
->
	`G‘LogProb
();

80  
tÙ®
;

81 
	}
}

83 
	gCÚjug©eGTRMod–
::
	$G‘LogLik–ihood
() {

84  
phylİroûss
->
	`G‘LogProb
();

85 
	}
}

87 
	gCÚjug©eGTRMod–
::
	$G‘LogProb
() {

88  
	`G‘LogPriÜ
(è+ 
	`G‘LogLik–ihood
();

89 
	}
}

91 
	gCÚjug©eGTRMod–
::
	$G‘M—nR©e
() {

92 
tÙ®
 = 0;

93 
i
=0; i<
Ns™e
; i++) {

94 
tÙ®
 +ğ(*
¿‹
)[
i
]->
	`v®
();

96 
tÙ®
 /ğ
Ns™e
;

97  
tÙ®
;

98 
	}
}

100 
	gCÚjug©eGTRMod–
::
	$G‘V¬R©e
() {

101 
m—n
 = 0;

102 
v¬
 = 0;

103 
i
=0; i<
Ns™e
; i++) {

104 
tmp
 = (*
¿‹
)[
i
]->
	`v®
();

105 
m—n
 +ğ
tmp
;

106 
v¬
 +ğ
tmp
 *mp;

108 
m—n
 /ğ
Ns™e
;

109 
v¬
 /ğ
Ns™e
;

110 
v¬
 -ğ
m—n
 * mean;

111  
v¬
;

112 
	}
}

114 
	gCÚjug©eGTRMod–
::
	$G‘L’gth
() {

115  
gamŒ“
->
	`G‘TÙ®L’gth
(è* 
phylİroûss
->
	`G‘M©rix
()->
	`G‘R©e
(è* 
	`G‘M—nR©e
();

116 
	}
}

118 
	gCÚjug©eGTRMod–
::
	$T¿ûH—d”
(
o¡»am
& 
os
) {

119 
os
 << "#logprior\tlnL\tlength\tlambda\talpha\tmeanrate\tvarrate\tstatent\tmeanrr\trrent\n";

120 
	}
}

122 
	gCÚjug©eGTRMod–
::
	$T¿û
(
o¡»am
& 
os
) {

123 
os
 << 
	`G‘LogPriÜ
(è<< '\t' << 
	`G‘LogLik–ihood
();

124 
os
 << '\t' << 
Ïmbda
->
	`v®
();

125 
os
 << '\t' << 
®pha
->
	`v®
();

126 
os
 << '\t' << 
	`G‘M—nR©e
();

127 
os
 << '\t' << 
	`G‘V¬R©e
();

128 
os
 << '\t' << 
¡©iÚ¬y
->
	`v®
().
	`G‘EÁrİy
();

129 
os
 << '\t' << 
»Ì©e
->
	`v®
().
	`G‘M—n
(è<< '\t' <<„–¿‹->v®().
	`G‘EÁrİy
();

130 
os
 << '\n';

131 
	}
}

133 
	gCÚjug©eGTRMod–
::
	$MakeScheduËr
() {

134 
û¼
 << "scheduler is inactivated\n";

135 
	}
}

137 
	gCÚjug©eGTRMod–
::
	$Move
(
tunšg
) {

139 
i
=0; i<
Ns™e
; i++) {

140 (*
¿‹
)[
i
]->
	`IÁeg¿‹
();

142 
j
=0; j<10; j++) {

143 
®pha
->
	`Move
(
tunšg
);

145 
i
=0; i<
Ns™e
; i++) {

146 (*
¿‹
)[
i
]->
	`Re§m¶e
();

150 
gamŒ“
->
	`IÁeg¿‹
();

151 
j
=0; j<10; j++) {

152 
Ïmbda
->
	`Move
(
tunšg
);

154 
gamŒ“
->
	`Re§m¶e
();

157 
»Ì©e
->
	`IÁeg¿‹
();

158 
»Ì©e
->
	`Re§m¶e
();

161 
¡©iÚ¬y
->
	`Aùiv©eSuffic›ÁSti¡ic
();

163 
j
=0; j<100; j++) {

164 
¡©iÚ¬y
->
	`Move
(
tunšg
,1);

165 
¡©iÚ¬y
->
	`Move
(
tunšg
/10,1);

166 
¡©iÚ¬y
->
	`Move
(
tunšg
/50,2);

167 
¡©iÚ¬y
->
	`Move
(0.1*
tunšg
);

168 
¡©iÚ¬y
->
	`Move
(0.01*
tunšg
);

169 
¡©iÚ¬y
->
	`Move
(0.001*
tunšg
);

172 
¡©iÚ¬y
->
	`IÇùiv©eSuffic›ÁSti¡ic
();

174 
phylİroûss
->
	`Move
(
tunšg
);

177 
	}
}

179 
	gCÚjug©eGTRMod–
::
	$d¿wSam¶e
() {

181 
®pha
->
	`Sam¶e
();

182 
¿‹
->
	`Sam¶e
();

185 
Ïmbda
->
	`Sam¶e
();

186 
gamŒ“
->
	`Sam¶e
();

189 
¡©iÚ¬y
->
	`Sam¶e
();

190 
»Ì©e
->
	`Sam¶e
();

193 
phylİroûss
->
	`Sam¶e
();

194 
	}
}

196 
	gCÚjug©eGTRMod–
::
	$ToSŒ—m
(
o¡»am
& 
os
) {

198 
os
 << *
®pha
 << '\n';

199 
os
 << *
¿‹
 << '\n';

200 
os
 << *
Ïmbda
 << '\n';

201 
os
 << *
gamŒ“
 << '\n';

202 
os
 << *
¡©iÚ¬y
 << '\n';

203 
os
 << *
»Ì©e
 << '\n';

204 
	}
}

206 
	gCÚjug©eGTRMod–
::
	$FromSŒ—m
(
i¡»am
& 
is
) {

208 
is
 >> *
®pha
;

209 
is
 >> *
¿‹
;

210 
is
 >> *
Ïmbda
;

211 
is
 >> *
gamŒ“
;

212 
is
 >> *
¡©iÚ¬y
;

213 
is
 >> *
»Ì©e
;

214 
	}
}

	@ConjugateGTRModel.h

1 #iâdeà
CONJUGATEGTRMODEL_H


2 
	#CONJUGATEGTRMODEL_H


	)

4 
	~"ProbMod–.h
"

5 
	~"CÚjug©eP©h.h
"

6 
	~"CÚjug©eGammaT»e.h
"

7 
	~"CÚjug©eOÃM©rixPhyloProûss.h
"

9 
	~"IID.h
"

21 şas 
	cCÚjug©eGTRMod–
 : 
public
 
ProbMod–
 {

23 
public
:

25 
CÚjug©eGTRMod–
(
¡ršg
 
d©afe
, sŒšg 
Œ“fe
);

27 ~
CÚjug©eGTRMod–
();

29 
G‘LogPriÜ
();

30 
G‘LogLik–ihood
();

31 
G‘LogProb
();

33 
MakeScheduËr
();

35 
Move
(
tunšg
 = 1);

37 
d¿wSam¶e
();

39 
G‘M—nR©e
();

40 
G‘V¬R©e
();

41 
G‘L’gth
();

43 
T¿ûH—d”
(
o¡»am
& 
os
);

44 
T¿û
(
o¡»am
& 
os
);

46 
PrštT»e
(
o¡»am
& 
os
);

47 
T»eToPS
(
¡ršg
 
f’ame
);

49 
ToSŒ—m
(
o¡»am
& 
os
);

50 
FromSŒ—m
(
i¡»am
& 
is
);

52 
Po¡M­pšg
(
o¡»am
& 
os
, 
boŞ
 
»d
);

53 
Po¡M­pšg
(
s™e
, 
o¡»am
& 
os
, 
boŞ
 
»d
);

54 
Po¡P»dM­pšg
(
o¡»am
& 
os
, 
boŞ
 
»d
);

55 
Po¡P»dM­pšg
(
s™e
, 
o¡»am
& 
os
, 
boŞ
 
»d
);

57 
CÚjug©eGammaT»e
* 
	mgamŒ“
;

59 
	m´iv©e
:

60 
T»e
* 
Œ“
;

61 
Sequ’ûAlignm’t
* 
	md©a
;

62 
TaxÚS‘
* 
	mxÚ£t
;

64 
	mNs™e
;

65 
	mN¡©e
;

68 
	mDv¬
<
	mPosR—l
>* 
	mPriÜV¬R©e
;

69 
ExpÚ’tŸl
* 
	m®pha
;

70 
CÚjug©eGammaIIDA¼ay
* 
	m¿‹
;

73 
	mDv¬
<
	mPosR—l
>* 
	mPriÜLambda
;

74 
	mDv¬
<
	mPosR—l
>* 
	mmu
;

75 
ExpÚ’tŸl
* 
	mÏmbda
;

78 
IIDCÚjug©eGamma
* 
	m»Ì©e
;

81 
SemiCÚjug©eDœichËt
* 
	m¡©iÚ¬y
;

83 
GTRRªdomSubM©rix
* 
	mm©rix
;

85 
CÚjug©eOÃM©rixRASPhyloProûss
* 
	mphylİroûss
;

	@ConjugateGammaTree.h

1 #iâdeà
CONJUGATEGAMMATREE_H


2 
	#CONJUGATEGAMMATREE_H


	)

4 
	~"B¿nchProûss.h
"

5 
	~"CÚjug©ePoissÚ.h
"

7 
şass
 
	gPoissÚSemiCÚjug©eT»e
 : 
public
 
B¿nchProûss
<
PosR—l
> {

9 
public
:

11 
PoissÚSemiCÚjug©e
* 
G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

12 
PoissÚSemiCÚjug©e
* 
p
 = 
dyÇmic_ÿ¡
<PoissÚSemiCÚjug©e*> (
B¿nchProûss
<
PosR—l
>::
G‘B¿nchV®
(
b¿nch
));

13 ià(! 
	gp
) {

14 ià(
	gB¿nchProûss
<
	gPosR—l
>::
G‘B¿nchV®
(
b¿nch
)) {

15 
û¼
 << "error in PoissonSemiConjugateTree: invalid dynamic cast\n";

16 
ex™
(1);

19  
	gp
;

22 
PoissÚSemiCÚjug©eT»e
(
T»e
* 
šŒ“
è: 
B¿nchProûss
<
PosR—l
>(intree) {}

24 
IÇùiv©eSuffic›ÁSti¡ic
() {

25 
IÇùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

28 
IÇùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

29 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

30 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
IÇùiv©eSuffic›ÁSti¡ic
();

31 
IÇùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

36 şas 
	cCÚjug©eGammaT»e
 : 
public
 
PoissÚSemiCÚjug©eT»e
 {

38 
public
:

40 
CÚjug©eGamma
* 
	$G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

41 
CÚjug©eGamma
* 
p
 = 
dyÇmic_ÿ¡
<CÚjug©eGamma*> (
PoissÚSemiCÚjug©eT»e
::
	`G‘B¿nchV®
(
b¿nch
));

42 ià(! 
p
) {

43 ià(
B¿nchProûss
<
PosR—l
>::
	`G‘B¿nchV®
(
b¿nch
)) {

44 
û¼
 << "error in ConjugateGammaTree: invalid dynamic cast\n";

45 
	`ex™
(1);

48  
p
;

51 
	`CÚjug©eGammaT»e
(
T»e
* 
šŒ“
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
è: 
	$PoissÚSemiCÚjug©eT»e
(
šŒ“
) {

52 
®pha
 = 
š®pha
;

53 
b‘a
 = 
šb‘a
;

54 
	`RecursiveC»©e
(
Œ“
->
	`G‘RoÙ
());

55 
	}
}

57 ~
	$CÚjug©eGammaT»e
() {

58 
	`RecursiveD–‘e
(
Œ“
->
	`G‘RoÙ
());

59 
	}
}

61 
	$IÁeg¿‹
() {

62 
	`IÁeg¿‹
(
	`G‘RoÙ
());

63 
	}
}

65 
	$IÁeg¿‹
(cÚ¡ 
Lšk
* 
äom
) {

66 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

67 
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())->
	`IÁeg¿‹
();

68 
	`IÁeg¿‹
(
lšk
->
	`Out
());

70 
	}
}

72 
	$Re§m¶e
() {

73 
	`IÇùiv©eSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

74 
	}
}

76 
	g´Ùeùed
:

78 
Rv¬
<
PosR—l
>* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

79  
Ãw
 
	`CÚjug©eGamma
(
®pha
,
b‘a
);

80 
	}
}

82 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

83 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

	@ConjugateInverseWishart.h

2 #iâdeà
CONJUGATEWISHART_H


3 
	#CONJUGATEWISHART_H


	)

5 
	~"CÚjug©e.h
"

6 
	~"Inv”£Wish¬tM©rix.h
"

12 
şass
 
	gMuÉiNÜm®SemiCÚjug©e
 : 
vœtu®
 
public
 
SemiCÚjug©ePriÜ
<
CovM©rix
> {

14 
public
:

16 
MuÉiNÜm®SemiCÚjug©e
(
šdim
) :

17 
Rv¬
<
CovM©rix
>(CovM©rix(
šdim
)),

18 
sÿË¡©
(
šdim
), 
bksÿË¡©
(indim)

21 ~
MuÉiNÜm®SemiCÚjug©e
(){}

24 
Re£tSuffic›ÁSti¡ic
() {

25 
	gsh­e¡©
 = 0;

26  
	gi
=0; i<
	gdim
; i++){

27  
	gj
=0; j<
	gdim
; j++){

28 
	gsÿË¡©
[
i
][
j
] = 0;

34 
SaveSuffic›ÁSti¡ic
() {

35 
	gbksh­e¡©
 = 
sh­e¡©
;

36  
	gi
=0; i<
	gdim
; i++){

37 
	gbksÿË¡©
[
i
][i] = 
sÿË¡©
[i][i];

38  
	gj
=0; j<
	gi
; j++){

39 
	gbksÿË¡©
[
i
][
j
] = 
sÿË¡©
[i][j];

44 
Re¡ÜeSuffic›ÁSti¡ic
() {

45 
	gbksh­e¡©
 = 
sh­e¡©
;

46  
	gi
=0; i<
	gdim
; i++){

47 
	gsÿË¡©
[
i
][i] = 
bksÿË¡©
[i][i];

48  
	gj
=0; j<
	gi
; j++){

49 
	gsÿË¡©
[
i
][
j
] = 
bksÿË¡©
[i][j];

50 
	gsÿË¡©
[
j
][
i
] = 
bksÿË¡©
[i][j];

55 
AddToSh­e
() {

56 
	gsh­e¡©
 ++;

59 
AddToSÿË
(cÚ¡ * 
š
) {

60  
	gi
=0; i<
	gdim
; i++){

61 
	gsÿË¡©
[
i
][i] +ğ
š
[i] * in[i];

62  
	gj
=0; j<
	gi
; j++){

63 
	gsÿË¡©
[
i
][
j
] +ğ
š
[i] * in[j];

64 
	gsÿË¡©
[
j
][
i
] = 
sÿË¡©
[i][j];

69 
AddToSh­e
(
N
) {

70 
	gsh­e¡©
 +=
N
;

73 
AddToSÿË
(** 
š
) {

74  
	gi
=0; i<
	gdim
; i++){

75 
	gj
=0; j<
	gdim
; j++) {

76 
	gsÿË¡©
[
i
][
j
] +ğ
š
[i][j];

81 
SuffStLogProb
() {

82 
	gt
, 
	gŒaû
 = 0;

83  
	gi
=0; i<
	gdim
; i++){

84 
	gt
 = 0;

85  
	gj
=0; j<
	gdim
; j++){

86 
	gt
 +ğ
sÿË¡©
[
i
][
j
] * 
G‘InvM©rix
()[j][i];

88 
	gŒaû
 +ğ
t
;

90  -0.5 * (
sh­e¡©
 * 
G‘LogD‘”mšªt
(è+ 
	gŒaû
);

93 
	g´Ùeùed
:

95 
sh­e¡©
;

96 
CovM©rix
 
	gsÿË¡©
;

97 
	gbksh­e¡©
;

98 
CovM©rix
 
	gbksÿË¡©
;

103 
şass
 
	gSemiCÚjug©eInv”£Wish¬t
 : 
vœtu®
 
public
 
Inv”£Wish¬tM©rix
, vœtu®…ubliø
	gMuÉiNÜm®SemiCÚjug©e
{

105 
	gpublic
:

107 
SemiCÚjug©eInv”£Wish¬t
(
SigmaZ”o
* 
šDŸgÚ®M©rix
, 
šP
) :

108 
Rv¬
<
CovM©rix
>(
šDŸgÚ®M©rix
->
G‘Dim
()),

109 
Inv”£Wish¬tM©rix
(
šDŸgÚ®M©rix
, 
šP
),

110 
MuÉiNÜm®SemiCÚjug©e
(
šDŸgÚ®M©rix
->
G‘Dim
())

113 
logProb
() {

114 ià(
isAùive
()) {

115  
	gInv”£Wish¬tM©rix
::
logProb
(è+ 
SuffStLogProb
();

117 {  
	gInv”£Wish¬tM©rix
::
logProb
(); }

120 
loÿlRe¡Üe
() {

121 
Re¡ÜeSuffic›ÁSti¡ic
();

122 
	gInv”£Wish¬tM©rix
::
loÿlRe¡Üe
();

125 
loÿlCÜru±
(
boŞ
 
bk
) {

126 ià(
	gbk
) {

127 
SaveSuffic›ÁSti¡ic
();

129 
	gInv”£Wish¬tM©rix
::
loÿlCÜru±
(
bk
);

136 
şass
 
	gCÚjug©eInv”£Wish¬t
 : 
public
 
CÚjug©ePriÜ
<
CovM©rix
>,…ubliø
	gSemiCÚjug©eInv”£Wish¬t
 {

138 
	gpublic
:

140 
CÚjug©eInv”£Wish¬t
(
SigmaZ”o
* 
šDŸgÚ®M©rix
, 
šP
) :

141 
Rv¬
<
CovM©rix
>(
šDŸgÚ®M©rix
->
G‘Dim
()),

142 
	gSemiCÚjug©ePriÜ
<
	gCovM©rix
>(),

143 
Inv”£Wish¬tM©rix
(
šDŸgÚ®M©rix
, 
šP
),

144 
MuÉiNÜm®SemiCÚjug©e
(
šDŸgÚ®M©rix
->
G‘Dim
()),

145 
	gCÚjug©ePriÜ
<
	gCovM©rix
>(),

146 
SemiCÚjug©eInv”£Wish¬t
(
šDŸgÚ®M©rix
, 
šP
)

149 
GibbsRe§m¶e
() {

151 
	gi
=0; i<
G‘Dim
(); i++){

152 
	gsÿË¡©
[
i
][i] +ğ
dŸgÚ®M©rix
->
v®
(i);

154 
	gP
 +ğ
sh­e¡©
;

155 
	gsÿË¡©
.
DŸgÚ®i£
();

156 
d¿wSam¶e
(&
sÿË¡©
);

157 
	gi
=0; i<
G‘Dim
(); i++){

158 
	gsÿË¡©
[
i
][i] -ğ
dŸgÚ®M©rix
->
v®
(i);

160 
	gP
 -ğ
sh­e¡©
;

162 ià(!
isPos™iveDefše
()) {

163 
	gcout
 << " drawForWishart de SigmaZero„envoie un sigma‚on dÃ©fini…ositif\n";

164 
ex™
(1);

169 
logProb
() {

170 ià(
isAùive
()) {

173 ià(
isIÁeg¿‹d
()) {

175 
	gi
=0; i<
G‘Dim
(); i++){

176 
	gsÿË¡©
[
i
][i] +ğ
dŸgÚ®M©rix
->
v®
(i);

178 
CovM©rix
* 
	gpo¡sÿË
 = 
Ãw
 CovM©rix(
sÿË¡©
);

179 
	gpo¡sh­e
 = 
P
 + 
sh­e¡©
;

180 
	gl
 = 
dŸgÚ®M©rix
->
G‘LogD‘”mšªt
(è* 
P
 * 0.5 - 
po¡sÿË
->G‘LogD‘”mšªt(è* 
po¡sh­e
 * 0.5;

181 
d–‘e
 
	gpo¡sÿË
;

182 
	gi
=0; i<
G‘Dim
(); i++){

183 
	gsÿË¡©
[
i
][i] -ğ
dŸgÚ®M©rix
->
v®
(i);

185  
	gl
;

189  
	gSemiCÚjug©eInv”£Wish¬t
::
logProb
();

192  
	gInv”£Wish¬tM©rix
::
logProb
();

195 
DŸgÚ®LogPriÜ
() {

196 
	g»t
 = 
G‘Dim
(è* 
Rªdom
::
logGamma
(0.5 * (
P
 + G‘Dim(è- 1)è+ 0.5 * G‘Dim(è* (P + G‘Dim(è-1è* 
log
(2.0è- 0.5 * P*G‘Dim(è*†og(2.0è- Rªdom::
logMuÉiv¬Ÿ‹Gamma
(0.5 * P,GetDim());

197 
	gi
=0; i<
G‘Dim
(); i++) {

198 
	g»t
 -ğ0.5 * (
G‘Dim
(è- 1è* 
log
(
dŸgÚ®M©rix
->
v®
(
i
));

206  
	g»t
;

209 
DŸgÚ®LogPriÜ
(
mš
, 
max
) {

210 
	g»t
 = 
G‘Dim
(è* 
Rªdom
::
logGamma
(0.5 * (
P
 + G‘Dim(è- 1)è+ 0.5 * G‘Dim(è* (P + G‘Dim(è-1è* 
log
(2.0è- 0.5 * P*G‘Dim(è*†og(2.0è- Rªdom::
logMuÉiv¬Ÿ‹Gamma
(0.5 * P,GetDim());

211 ià(
G‘Dim
() != 1) {

212 
tmp
 = 2.0 / (
G‘Dim
(è- 1è* (
exp
(-0.5*(G‘Dim()-1è* 
log
(
mš
)è-ƒxp(-0.5*(G‘Dim()-1è*†og(
max
))) / (log(max) -†og(min));

213 
	g»t
 +ğ
G‘Dim
(è* 
log
(
tmp
);

215  
	g»t
;

218 
DŸgÚ®LogPo¡”iÜ
() {

219 
	g»t
 = 
G‘Dim
(è* 
Rªdom
::
logGamma
(0.5 * (
P
 + 
sh­e¡©
 + G‘Dim(è- 1)è+ 0.5 * G‘Dim(è* (P + +sh­e¡© + G‘Dim(è-1è* 
log
(2.0è- 0.5 * (P + sh­e¡©è*G‘Dim(è*†og(2.0è- Rªdom::
logMuÉiv¬Ÿ‹Gamma
(0.5 * (P + shapestat),GetDim());

220 
	gi
=0; i<
G‘Dim
(); i++) {

221 
	g»t
 -ğ0.5 * (
G‘Dim
(è- 1è* 
log
(
dŸgÚ®M©rix
->
v®
(
i
è+ 
sÿË¡©
[i][i]);

225  
	g»t
;

231 
şass
 
	gCÚjug©eMuÉiNÜm®
 : 
public
 
CÚjug©eSam¶šg
<
R—lVeùÜ
>,…ubliø
	gMuÉiNÜm®
 {

233 
	gpublic
:

235 
CÚjug©eMuÉiNÜm®
(
MuÉiNÜm®SemiCÚjug©e
* 
šsigma
, 
V¬
<
R—lVeùÜ
>* 
šup
 = 0, V¬<
PosR—l
>* 
štime
 = 0, V¬<PosR—l>* 
šsÿË
 = 0, V¬<R—lVeùÜ>* 
šdriá
 = 0, V¬<PosR—l>* 
šdriáphi
 = 0, V¬<PosR—l>* 
šd©e
=0, V¬<R—lVeùÜ>* 
šdriá2
 = 0, V¬<PosR—l>* 
šdriáphi2
 = 0, V¬<PosR—l>* 
šagesÿË
 = 0, 
škt
 = 0, 
G’”icTimeLše
* 
tim–še
 = 0, V¬<
R—l
>* 
®pha
 = 0) :

237 
Rv¬
<
R—lVeùÜ
>(),

238 
	gCÚjug©eSam¶šg
<
	gR—lVeùÜ
>(),

239 
MuÉiNÜm®
(
šsigma
, 
šup
, 
štime
, 
šsÿË
, 
šdriá
, 
šdriáphi
, 
šd©e
, 
šdriá2
, 
šdriáphi2
, 
šagesÿË
, 
škt
, 
tim–še
, 
®pha
)

241 
	gcÚjug©e_up
.
š£¹
(
šsigma
);

242 
	gcÚŒa¡
 = 0;

245 
CÚjug©eMuÉiNÜm®
(
unu£d
, 
MuÉiNÜm®SemiCÚjug©e
* 
šsigma
, 
V¬
<
R—lVeùÜ
>* 
šroÙm—n
, V¬<
PosR—lVeùÜ
>* 
šroÙv¬
è: 
MuÉiNÜm®
(unused,insigma,inrootmean,inrootvar) {

247 
	gcÚjug©e_up
.
š£¹
(
šsigma
);

248 
	gcÚŒa¡
 = 0;

251 
CÚjug©eMuÉiNÜm®
(
MuÉiNÜm®SemiCÚjug©e
* 
šsigma
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<
PosR—l
>* 
štime
, V¬<PosR—l>* 
šd©e
, V¬<PosR—l>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
è: 
MuÉiNÜm®
(insigma,inup,intime,indate,inagescale,inscalefunction) {

253 
	gcÚjug©e_up
.
š£¹
(
šsigma
);

254 
	gcÚŒa¡
 = 0;

257 ~
CÚjug©eMuÉiNÜm®
() {}

259 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

260 ià(
	gup
) {

261 
MuÉiNÜm®SemiCÚjug©e
* 
	g´iÜ
 = 
dyÇmic_ÿ¡
<MuÉiNÜm®SemiCÚjug©e*>(
·»Á
);

262 ià(! 
	g´iÜ
) {

263 
	gcout
 << "castƒrror in ConjugateMultiNormal::AddSuffStat\n";

264 
ex™
(1);

266 
	g´iÜ
->
AddToSh­e
();

267 
Compu‹CÚŒa¡
();

268 
	g´iÜ
->
AddToSÿË
(
cÚŒa¡
);

273 
Prİo£Move
(
tunšg
) {

275 ià(
isUpAùive
()) {

276  
Sim¶ePrİo£Move
(
tunšg
);

278  
	gMuÉiNÜm®
::
Prİo£Move
(
tunšg
);

281 
Compu‹CÚŒa¡
() {

282 ià(! 
	gcÚŒa¡
) {

283 
	gcÚŒa¡
 = 
Ãw
 [
G‘Dim
()];

285 
	g‰
 = 
time
->
v®
();

286 ià(
	gsÿËfunùiÚ
) {

287 
	gt2
 = 
d©e
->
v®
(è* 
agesÿË
->val();

288 
	gt1
 = (
d©e
->
v®
(è+ 
time
->v®()è* 
agesÿË
->val();

289 
	gsÿËçùÜ
 = 
sÿËfunùiÚ
->
G‘SÿlšgFaùÜ
(
t1
,
t2
);

290 
	g‰
 *ğ
sÿËçùÜ
;

292 ià(
	gsÿË
) {

293 
	g‰
 *ğ
sÿË
->
v®
();

295 
	groÙt
 = 
sq¹
(
‰
);

296 ià(
	gdriá
) {

297 ià(
	gdriáphi
) {

298 
	gu
 = 
time
->
v®
();

299 ià(
	gdriáphi
->
v®
() > 1e-10) {

300 
	gu
 = 
exp
(-
driáphi
->
v®
(è* 
d©e
->v®()è* (1 -ƒxp(-driáphi->v®(è* 
time
->val())) / driftphi->val();

302 
	gi
=0; i<
G‘Dim
(); i++) {

303 
	gcÚŒa¡
[
i
] = ((*
this
)[i] - 
u
 * (*
driá
)[i] - (*
up
)[i]è/ 
roÙt
;

307 
	gi
=0; i<
G‘Dim
(); i++) {

308 
	gcÚŒa¡
[
i
] = ((*
this
)[i] - 
‰
 * (*
driá
)[i] - (*
up
)[i]è/ 
roÙt
;

313 
	gi
=0; i<
G‘Dim
(); i++) {

314 
	gcÚŒa¡
[
i
] = ((*
this
)[i] - (*
up
)[i]è/ 
roÙt
;

319 * 
G‘CÚŒa¡
() {

320  
	gcÚŒa¡
;

323 
	g´iv©e
:

324 * 
cÚŒa¡
;

330 
şass
 
	gCÚjug©eMuÉiv¬Ÿ‹NÜm®
 : 
public
 
CÚjug©eSam¶šg
<
R—lVeùÜ
>,…ubliø
	gMuÉiv¬Ÿ‹NÜm®
 {

332 
	gpublic
:

334 
CÚjug©eMuÉiv¬Ÿ‹NÜm®
(
MuÉiNÜm®SemiCÚjug©e
* 
šsigma
) :

335 
Rv¬
<
R—lVeùÜ
>(),

336 
	gCÚjug©eSam¶šg
<
	gR—lVeùÜ
>(),

337 
MuÉiv¬Ÿ‹NÜm®
(
šsigma
)

339 
	gcÚjug©e_up
.
š£¹
(
šsigma
);

342 ~
CÚjug©eMuÉiv¬Ÿ‹NÜm®
() {}

344 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

345 
MuÉiNÜm®SemiCÚjug©e
* 
	g´iÜ
 = 
dyÇmic_ÿ¡
<MuÉiNÜm®SemiCÚjug©e*>(
·»Á
);

346 ià(! 
	g´iÜ
) {

347 
	gcout
 << "castƒrror in ConjugateMultiNormal::AddSuffStat\n";

348 
ex™
(1);

350 
	g´iÜ
->
AddToSh­e
();

351 
	g´iÜ
->
AddToSÿË
(
G‘A¼ay
());

	@ConjugateMultiVariateTreeProcess.h

1 #iâdeà
CONJUGATEMULTIVARIATETREEPROCESS


2 
	#CONJUGATEMULTIVARIATETREEPROCESS


	)

4 
	~"MuÉiV¬Ÿ‹T»eProûss.h
"

5 
	~"CÚjug©eInv”£Wish¬t.h
"

6 
	~"CÚtšuousD©a.h
"

7 
	~"AutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss.h
"

10 şas 
	cCÚjug©eMuÉiV¬Ÿ‹T»eProûss
 : 
public
 
vœtu®
 
MuÉiV¬Ÿ‹T»eProûss
 {

12 
´Ùeùed
:

14 
CÚjug©eInv”£Wish¬t
* 
sigma
;

16 
	mpublic
:

18 
	$CÚjug©eMuÉiV¬Ÿ‹T»eProûss
() {}

20 
	`CÚjug©eMuÉiV¬Ÿ‹T»eProûss
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
NodeB¿nchV¬T»e
<
PosR—l
,PosR—l>* 
šchrÚo
, 
V¬
<PosR—l>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
, V¬<
R—lVeùÜ
>* 
šroÙm—n
 = 0, V¬<
PosR—lVeùÜ
>* 
šroÙv¬
 = 0){

22 
sigma
 = 
šsigma
;

23 
MuÉiV¬Ÿ‹T»eProûss
::
sigma
 = 
šsigma
;

24 
Œ“
 = 
šchrÚo
;

25 
chrÚo
 = 
šchrÚo
;

26 
agesÿË
 = 
šagesÿË
;

27 
sÿËfunùiÚ
 = 
šsÿËfunùiÚ
;

28 
sÿËŒ“
 = 0;

29 
driá
 = 0;

30 
roÙm—n
 = 
šroÙm—n
;

31 
roÙv¬
 = 
šroÙv¬
;

32 
	`RecursiveC»©e
(
	`G‘RoÙ
());

33 
	}
}

35 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
L’gthT»e
* 
šŒ“
, L’gthT»e* 
šsÿËŒ“
 = 0, 
V¬
<
R—lVeùÜ
>* 
šdriá
 = 0, V¬<R—lVeùÜ>* 
šroÙm—n
 = 0, V¬<
PosR—lVeùÜ
>* 
šroÙv¬
 = 0){

37 
sigma
 = 
šsigma
;

38 
	gMuÉiV¬Ÿ‹T»eProûss
::
sigma
 = 
šsigma
;

39 
	gŒ“
 = 
šŒ“
;

40 
	gsÿËŒ“
 = 
šsÿËŒ“
;

41 
	gdriá
 = 
šdriá
;

42 
	groÙm—n
 = 
šroÙm—n
;

43 
	groÙv¬
 = 
šroÙv¬
;

44 
	gsÿËfunùiÚ
 = 0;

45 
RecursiveC»©e
(
G‘RoÙ
());

48 ~
	$CÚjug©eMuÉiV¬Ÿ‹T»eProûss
(){

49 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

50 
	}
}

53 
CÚjug©eMuÉiNÜm®
* 
	$G‘CÚjug©eMuÉiNÜm®
(cÚ¡ 
Lšk
* 
lšk
) {

54 
CÚjug©eMuÉiNÜm®
* 
m
 = 
dyÇmic_ÿ¡
<CÚjug©eMuÉiNÜm®*> (
	`G‘NodeV®
(
lšk
->
	`G‘Node
()));

55  
m
;

56 
	}
}

58 
	$DAgo¡šosKªdZ
(* 
KK
, * 
ZZ1
, * 
ZZ2
) {

60 * 
m1
 = 
Ãw
 [
	`G‘Dim
()];

61 * 
m2
 = 
Ãw
 [
	`G‘Dim
()];

62 * 
m3
 = 
Ãw
 [
	`G‘Dim
()];

63 * 
m4
 = 
Ãw
 [
	`G‘Dim
()];

65 
n
 = 
	`G‘CÚŒa¡M—n
(
m1
);

66 
	`G‘CÚŒa¡C’Œ®Mom’t
(
m2
,
m1
,2);

67 
	`G‘CÚŒa¡C’Œ®Mom’t
(
m3
,
m1
,3);

68 
	`G‘CÚŒa¡C’Œ®Mom’t
(
m4
,
m1
,4);

70 
i
=0; i<
	`G‘Dim
(); i++) {

71 
g1
 = 
m3
[
i
] / 
	`sq¹
(
m2
[i] * m2[i] * m2[i]);

72 
g2
 = 
m4
[
i
] / 
m2
[i] / m2[i] - 3;

74 
mu2
 = 6.0 * (
n
-2) / (n+1) / (n+3);

75 
gamma2
 = 36.0 * (
n
-7) * (n*n + 2*n -5) / (n-2) / (n+5) / (n+7) / (n+9);

76 
W2
 = 
	`sq¹
(2*
gamma2
 +4)- 1;

77 
W
 = 
	`sq¹
(
W2
);

78 
d–
 = 1.0 / 
	`sq¹
(
	`log
(
W
));

79 
®pha
 = 
	`sq¹
(2 / (
W2
 - 1));

80 
t
 = 
g1
 / 
®pha
 / 
	`sq¹
(
mu2
);

81 
Z1
 = 
d–
 * 
	`log
(
t
 + 
	`sq¹
(t*t+1));

83 
mmu1
 = -6.0 / (
n
+1);

84 
mmu2
 = 24.0 * 
n
 * (n-2) * (n-3) / (n+1) / (n+1) / (n+3) / (n+5);

85 
ggamma1
 = 6.0 * (
n
*À-5*À+ 2è/ (n+7è/ (n+9è* 
	`sq¹
(6.0 * (n+3) * (n+5) /‚ / (n-2) / (n-3));

86 
A
 = 6.0 + 8.0 / 
ggamma1
* (2.0 / ggamma1 + 
	`sq¹
(1 + 4.0 / ggamma1 / ggamma1));

87 
Z2
 = 
	`sq¹
(9.0 * 
A
 / 2è* (1 - 2.0 / 9 / A - 
	`exp
Ğ1.0 / 3 * 
	`log
Ğ(1 - 2.0 / Aè/ (1.0 + (
g2
 - 
mmu1
è/ sq¹(
mmu2
) * sqrt(2.0 / (A - 4))))));

89 
ZZ1
[
i
] = 
Z1
 * Z1;

90 
ZZ2
[
i
] = 
Z2
 * Z2;

91 
KK
[
i
] = 
ZZ1
[i] + 
ZZ2
[i];

94 
d–‘e
[] 
m1
;

95 
d–‘e
[] 
m2
;

96 
d–‘e
[] 
m3
;

97 
d–‘e
[] 
m4
;

98 
	}
}

100 
	$G‘CÚŒa¡M—n
(* 
m
) {

101 
i
=0; i<
	`G‘Dim
(); i++) {

102 
m
[
i
] = 0;

104 
n
 = 0;

105 
	`RecursiveG‘CÚŒa¡M—n
(
	`G‘RoÙ
(),
m
,
n
);

106 
i
=0; i<
	`G‘Dim
(); i++) {

107 
m
[
i
] /ğ
n
;

109  
n
;

110 
	}
}

112 
	$G‘CÚŒa¡C’Œ®Mom’t
(* 
mk
, * 
m1
, 
k
) {

113 
i
=0; i<
	`G‘Dim
(); i++) {

114 
mk
[
i
] = 0;

116 
n
 = 0;

117 
	`RecursiveG‘CÚŒa¡C’Œ®Mom’t
(
	`G‘RoÙ
(),
mk
,
m1
,
k
,
n
);

118 
i
=0; i<
	`G‘Dim
(); i++) {

119 
mk
[
i
] /ğ
n
;

121  
n
;

122 
	}
}

124 
	$RecursiveG‘CÚŒa¡M—n
(cÚ¡ 
Lšk
* 
äom
, * 
m
, & 
n
) {

125 ià(! 
äom
->
	`isRoÙ
()) {

126 * 
c
 = 
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘CÚŒa¡
();

127 
i
=0; i<
	`G‘Dim
(); i++) {

128 
m
[
i
] +ğ
c
[i];

130 
n
++;

132 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

133 
	`RecursiveG‘CÚŒa¡M—n
(
lšk
->
	`Out
(),
m
,
n
);

135 
	}
}

137 
	$RecursiveG‘CÚŒa¡C’Œ®Mom’t
(cÚ¡ 
Lšk
* 
äom
, * 
mk
, cÚ¡ * 
m1
, 
k
, & 
n
) {

138 ià(! 
äom
->
	`isRoÙ
()) {

139 * 
c
 = 
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘CÚŒa¡
();

140 
i
=0; i<
	`G‘Dim
(); i++) {

141 
mk
[
i
] +ğ
	`pow
((
c
[i] - 
m1
[i]),
k
);

143 
n
++;

145 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

146 
	`RecursiveG‘CÚŒa¡C’Œ®Mom’t
(
lšk
->
	`Out
(),
mk
,
m1
,
k
,
n
);

148 
	}
}

151 
	g´Ùeùed
 :

153 
Rv¬
<
R—lVeùÜ
>* 
	$C»©eNodeV®
(cÚ¡ 
Lšk
* 
lšk
){

154 if(!
lšk
->
	`isRoÙ
()){

155 ià(
sÿËfunùiÚ
) {

156  
Ãw
 
	`CÚjug©eMuÉiNÜm®
(
sigma
, 
	`G‘MuÉiNÜm®
(
lšk
->
	`Out
()), 
Œ“
->
	`G‘B¿nchV®
Öšk->
	`G‘B¿nch
()), 
chrÚo
->
	`G‘NodeV®
Öšk->
	`G‘Node
()), 
agesÿË
, 
sÿËfunùiÚ
);

158  
Ãw
 
	`CÚjug©eMuÉiNÜm®
(
sigma
, 
	`G‘MuÉiNÜm®
(
lšk
->
	`Out
()), 
Œ“
->
	`G‘B¿nchV®
Öšk->
	`G‘B¿nch
()), (
sÿËŒ“
 ? sÿËŒ“->G‘B¿nchV®Öšk->G‘B¿nch()è: 0), 
driá
);

161  
Ãw
 
	`CÚjug©eMuÉiNÜm®
(
sigma
);

163 
	}
}

167 şas 
	cCÚjug©eMuÉiV¬Ÿ‹Move
 : 
public
 
MCUpd©e
 {

169 
CÚjug©eInv”£Wish¬t
* 
sigma
;

170 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
	mŒ“
;

171 
	mV¬A¼ay
<
	mPosR—l
>* 
	m´iÜOnSigmaZ”o
;

172 
	mnmove
;

173 
	mtunšg
;

175 
	mpublic
:

177 
	$CÚjug©eMuÉiV¬Ÿ‹Move
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
šŒ“
, 
štunšg
, 
šnmove
){

179 
sigma
 = 
šsigma
;

180 
Œ“
 = 
šŒ“
;

181 
tunšg
 = 
štunšg
;

182 
nmove
 =
šnmove
;

186 
	$Move
(
tunšg_moduÏtÜ
){

187 
sigma
->
	`IÁeg¿‹
();

189 
r
 = 0;

191 
i
=0; i<
nmove
; i++){

192 
r
 +ğ
Œ“
->
	`Move
(
tunšg
 * 
tunšg_moduÏtÜ
);

199 
sigma
->
	`Re§m¶e
();

201  
nmove
 ? 
r
/nmove : 1.0;

202 
	}
}

205 şas 
	cCÚjug©eInv”£Wish¬tPriÜMove
 : 
public
 
MCUpd©e
 {

207 
CÚjug©eInv”£Wish¬t
* 
sigma
;

208 
	mRªdomV¬A¼ay
<
	mPosR—l
>* 
	m´iÜOnSigmaZ”o
;

209 
	mnmove
;

210 
	mtunšg
;

212 
	mpublic
:

214 
CÚjug©eInv”£Wish¬tPriÜMove
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
RªdomV¬A¼ay
<
PosR—l
>* 
š´iÜOnSigmaZ”o
, 
štunšg
, 
šnmove
){

215 
	msigma
 = 
šsigma
;

216 
	m´iÜOnSigmaZ”o
 = 
š´iÜOnSigmaZ”o
;

217 
	mtunšg
 = 
štunšg
;

218 
	mnmove
 =
šnmove
;

221 
	$Move
(
tunšg_moduÏtÜ
){

222 
sigma
->
	`IÁeg¿‹
();

224 
r
 = 0;

226 
i
=0; i<
nmove
; i++){

227 
r
 +ğ
´iÜOnSigmaZ”o
->
	`Move
(
tunšg
 * 
tunšg_moduÏtÜ
);

229 
sigma
->
	`Re§m¶e
();

231  
r
/
nmove
;

232 
	}
}

235 şas 
	cCÚjug©eMuÉiV¬Ÿ‹P›ûwi£T¿n¦©iÚMove
 : 
public
 
MCUpd©e
 {

237 
CÚjug©eInv”£Wish¬t
* 
sigma
;

238 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
	mŒ“
;

239 
	mRªdomV¬A¼ay
<
	mPosR—l
>* 
	m´iÜOnSigmaZ”o
;

240 
	mnmove
;

241 
	mtunšg
;

242 
	mšdex
;

243 
	mk
;

245 
	mpublic
:

247 
	$CÚjug©eMuÉiV¬Ÿ‹P›ûwi£T¿n¦©iÚMove
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
šŒ“
, 
štunšg
, 
ššdex
, 
šk
,
šnmove
){

249 
sigma
 = 
šsigma
;

250 
Œ“
 = 
šŒ“
;

251 
tunšg
 = 
štunšg
;

252 
nmove
 =
šnmove
;

253 
šdex
 = 
ššdex
;

254 
k
 = 
šk
;

258 
	$Move
(
tunšg_moduÏtÜ
){

259 
sigma
->
	`IÁeg¿‹
();

261 
r
 = 0;

263 
i
=0; i<
nmove
; i++){

264 
r
 +ğ
Œ“
->
	`P›ûwi£T¿n¦©iÚMove
(
tunšg
 * 
tunšg_moduÏtÜ
,
šdex
,
k
);

271 
sigma
->
	`Re§m¶e
();

273  
r
/
nmove
;

274 
	}
}

277 
şass
 
	gCÚjug©eMuÉiV¬Ÿ‹WhŞeT»eP›ûwi£T¿n¦©iÚMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

279 
CÚjug©eInv”£Wish¬t
* 
	gsigma
;

280 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
	gŒ“
;

281 
	gRªdomV¬A¼ay
<
	gPosR—l
>* 
	g´iÜOnSigmaZ”o
;

282 
	gnmove
;

283 
	gtunšg
;

284 
	gšdex
;

285 
	gk
;

287 
	gpublic
:

289 
CÚjug©eMuÉiV¬Ÿ‹WhŞeT»eP›ûwi£T¿n¦©iÚMove
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
šŒ“
, 
štunšg
, 
ššdex
, 
šk
,
šnmove
){

290 
	gsigma
 = 
šsigma
;

291 
	gŒ“
 = 
šŒ“
;

292 
	gtunšg
 = 
štunšg
;

293 
	gnmove
 =
šnmove
;

294 
	gšdex
 = 
ššdex
;

295 
	gk
 = 
šk
;

296 
	gŒ“
->
RecursiveRegi¡”
(
this
,
Œ“
->
G‘RoÙ
());

299 
Move
(
tunšg_moduÏtÜ
){

300 
	gtÙ
 = 0;

301 
	gsigma
->
IÁeg¿‹
();

302 
	gi
=0; i<
	gnmove
; i++){

303 
CÜru±
(
Œue
);

304 
	gu
 = 
tunšg
 * 
tunšg_moduÏtÜ
 * (
Rªdom
::
UnifÜm
() - 0.5);

305 
	gŒ“
->
P›ûwi£T¿n¦©iÚ
(
u
,
šdex
,
k
);

306 
	glog¿tio
 = 
Upd©e
();

307 
boŞ
 
	gacû±ed
 = (
log
(
Rªdom
::
UnifÜm
()è< 
log¿tio
);

308 ià(! 
	gacû±ed
) {

309 
CÜru±
(
çl£
);

310 
Re¡Üe
();

313 
	gtÙ
++;

316 
	gsigma
->
Re§m¶e
();

319  
	gtÙ
/
	gnmove
;

325 
şass
 
	gCÚjug©eAutoReg»ssiveMuÉiNÜm®
 : 
public
 
CÚjug©eSam¶šg
<
R—lVeùÜ
>,…ubliø
	gAutoReg»ssiveMuÉiNÜm®
 {

327 
	gpublic
:

329 
CÚjug©eAutoReg»ssiveMuÉiNÜm®
(
MuÉiNÜm®SemiCÚjug©e
* 
šsigma
, 
V¬
<
R—lVeùÜ
>* 
šm—n
, V¬<
PosR—l
>* 
šphi
, V¬<R—lVeùÜ>* 
šup
 = 0, V¬<PosR—l>* 
štime
 = 0) :

330 
Rv¬
<
R—lVeùÜ
>(),

331 
	gCÚjug©eSam¶šg
<
	gR—lVeùÜ
>(),

332 
AutoReg»ssiveMuÉiNÜm®
(
šsigma
, 
šm—n
, 
šphi
, 
šup
, 
štime
)

334 
	gcÚjug©e_up
.
š£¹
(
šsigma
);

335 
	gcÚŒa¡
 = 0;

338 ~
CÚjug©eAutoReg»ssiveMuÉiNÜm®
() {}

340 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

341 
MuÉiNÜm®SemiCÚjug©e
* 
	g´iÜ
 = 
dyÇmic_ÿ¡
<MuÉiNÜm®SemiCÚjug©e*>(
·»Á
);

342 ià(! 
	g´iÜ
) {

343 
	gcout
 << "castƒrror in ConjugateMultiNormal::AddSuffStat\n";

344 
ex™
(1);

346 
	g´iÜ
->
AddToSh­e
();

347 
Compu‹CÚŒa¡
();

348 
	g´iÜ
->
AddToSÿË
(
cÚŒa¡
);

351 
Compu‹CÚŒa¡
() {

352 ià(! 
	gcÚŒa¡
) {

353 
	gcÚŒa¡
 = 
Ãw
 [
G‘Dim
()];

355 if(
isRoÙ
()){

356 
	gmu
 = 1.0 / 
sq¹
(2 * 
phi
->
v®
());

357  
	gi
=0; i <
G‘Dim
(); i++){

358 
	gcÚŒa¡
[
i
] = ((*
this
)[i] -(*
m—n
)[i]è/ 
mu
;

362 
	gexpo
 = 
exp
(-
phi
->
v®
(è* 
time
->val());

363 
	gmu
 = 
sq¹
 ((1 - 
exp
(-2 * 
phi
->
v®
(è* 
time
->val())) / 2 /…hi->val());

364  
	gi
=0; i <
G‘Dim
(); i++){

365 
	gcÚŒa¡
[
i
] = ((*
this
)[i] - (*
up
)[i] * 
expo
 - (*
m—n
)[i] * (1 -ƒxpo)è/ 
mu
;

370 
	g´iv©e
:

371 * 
cÚŒa¡
;

375 
şass
 
	gCÚjug©eAutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
 : 
public
 
AutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
, 
	gCÚjug©eMuÉiV¬Ÿ‹T»eProûss
 {

377 
	gpublic
:

379 
CÚjug©eAutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
(
CÚjug©eInv”£Wish¬t
* 
šsigma
, 
V¬
<
R—lVeùÜ
>* 
šm—n
, V¬<
PosR—l
>* 
šphi
, 
L’gthT»e
* 
šŒ“
){

380 
	gsigma
 = 
šsigma
;

381 
	gphi
 = 
šphi
;

382 
	gm—n
 = 
šm—n
;

383 
	gAutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
::
sigma
 = 
šsigma
;

384 
	gŒ“
 = 
šŒ“
;

385 
RecursiveC»©e
(
G‘RoÙ
());

388 ~
CÚjug©eAutoReg»ssiveMuÉiV¬Ÿ‹T»eProûss
(){

389 
RecursiveD–‘e
(
G‘RoÙ
());

393 
	g´Ùeùed
 :

395 
Rv¬
<
R—lVeùÜ
>* 
C»©eNodeV®
(cÚ¡ 
Lšk
* 
lšk
){

396 if(!
lšk
->
isRoÙ
()){

397  
Ãw
 
CÚjug©eAutoReg»ssiveMuÉiNÜm®
(
sigma
, 
m—n
, 
phi
, 
G‘MuÉiNÜm®
(
lšk
->
Out
()), 
Œ“
->
G‘B¿nchV®
Öšk->
G‘B¿nch
()));

400  
Ãw
 
CÚjug©eAutoReg»ssiveMuÉiNÜm®
(
sigma
, 
m—n
, 
phi
);

407 şas 
	cCÚjug©eMuÉiV¬Ÿ‹Ex‹º®Move
 : 
public
 
MCUpd©e
 {

409 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
Œ“
;

410 
CÚjug©eInv”£Wish¬t
* 
	mŒuem©
;

411 
Inv”£Wish¬tM©rix
* 
	mm©
;

412 
	mtunšg
;

413 
	mÄ•
;

414 
	mdim
;

416 
	msh­e¡©
;

417 
CovM©rix
 
	msÿË¡©
;

418 
	mbksh­e¡©
;

419 
CovM©rix
 
	mbksÿË¡©
;

421 
	mpublic
:

423 
	$CÚjug©eMuÉiV¬Ÿ‹Ex‹º®Move
(
CÚjug©eInv”£Wish¬t
* 
šm©
, 
CÚjug©eMuÉiV¬Ÿ‹T»eProûss
* 
šŒ“
, 
štunšg
, 
šÄ•
è: 
	`sÿË¡©
(šm©->
	`G‘Dim
()), 
	`bksÿË¡©
(šm©->
	$G‘Dim
()) {

424 
Œ“
 = 
šŒ“
;

425 
Œuem©
 = 
šm©
;

426 
tunšg
 = 
štunšg
;

427 
Ä•
 = 
šÄ•
;

428 
dim
 = 
Œuem©
->
	`G‘Dim
();

431 cÚ¡ 
Lšk
* 
	$G‘RoÙ
() {

432  
Œ“
->
	`G‘RoÙ
();

433 
	}
}

435 
	$Move
(
tunšg_moduÏtÜ
){

437 
Çcû±
 = 0;

438 
ÁÙ
 = 0;

440 
m©
 = 
Ãw
 
	`Inv”£Wish¬tM©rix
(
Œuem©
->
	`G‘DŸgÚ®M©rix
(),Œuem©->
	`G‘P
());

441 
m©
->
	`£tv®
(
Œuem©
->
	`v®
());

442 
m©
->
	`CÜru±
(
çl£
);

443 
m©
->
	`Upd©e
();

445 
	`P»·»Suffic›ÁSti¡ic
();

446 
»p
=0;„•<
Ä•
;„ep++) {

447 
	`RecursiveCÚjug©eMove
(
	`G‘RoÙ
(),
Çcû±
,
ÁÙ
,
tunšg
*
tunšg_moduÏtÜ
);

450 
Œuem©
->
	`£tv®
(
m©
->
	`v®
());

451 
Œuem©
->
	`CÜru±
(
çl£
);

452 
Œuem©
->
	`Upd©e
();

453 
d–‘e
 
m©
;

455  
Çcû±
 / 
ÁÙ
;

456 
	}
}

458 
	$Re£tSuffic›ÁSti¡ic
() {

459 
sh­e¡©
 = 0;

460  
i
=0; i<
dim
; i++){

461  
j
=0; j<
dim
; j++){

462 
sÿË¡©
[
i
][
j
] = 0;

465 
	}
}

467 
	$SaveSuffic›ÁSti¡ic
() {

468 
bksh­e¡©
 = 
sh­e¡©
;

469  
i
=0; i<
dim
; i++){

470 
bksÿË¡©
[
i
][i] = 
sÿË¡©
[i][i];

471  
j
=0; j<
i
; j++){

472 
bksÿË¡©
[
i
][
j
] = 
sÿË¡©
[i][j];

475 
	}
}

477 
	$Re¡ÜeSuffic›ÁSti¡ic
() {

478 
bksh­e¡©
 = 
sh­e¡©
;

479  
i
=0; i<
dim
; i++){

480 
sÿË¡©
[
i
][i] = 
bksÿË¡©
[i][i];

481  
j
=0; j<
i
; j++){

482 
sÿË¡©
[
i
][
j
] = 
bksÿË¡©
[i][j];

483 
sÿË¡©
[
j
][
i
] = 
bksÿË¡©
[i][j];

486 
	}
}

488 
	$AddToSÿË
(cÚ¡ * 
š
, 
boŞ
 
pos
 = 
Œue
) {

489 
•sÚ
 = 
pos
 ? 1.0 : -1.0;

490  
i
=0; i<
dim
; i++){

491 
sÿË¡©
[
i
][i] +ğ
•sÚ
 * 
š
[i] * in[i];

492  
j
=0; j<
i
; j++){

493 
sÿË¡©
[
i
][
j
] +ğ
•sÚ
 * 
š
[i] * in[j];

494 
sÿË¡©
[
j
][
i
] = scalestat[i][j];

497 
	}
}

499 
	$P»·»Suffic›ÁSti¡ic
() {

500 
	`Re£tSuffic›ÁSti¡ic
();

501 
	`RecursiveAddSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

502 
	}
}

504 
	$RecursiveAddSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

506 ià(! 
äom
->
	`isRoÙ
()) {

507 
CÚjug©eMuÉiNÜm®
* 
rg‘
 = 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
);

508 
rg‘
->
	`Compu‹CÚŒa¡
();

509 
	`AddToSÿË
(
rg‘
->
	`G‘CÚŒa¡
());

510 
sh­e¡©
++;

512 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

513 
	`RecursiveAddSuffic›ÁSti¡ic
(
lšk
->
	`Out
());

515 
	}
}

517 
	$RecursiveCÚjug©eMove
(cÚ¡ 
Lšk
* 
äom
, & 
Çcû±
, & 
ÁÙ
, 
tunšg
) {

519 
Çcû±
 +ğ
	`LoÿlCÚjug©eMove
(
äom
,
tunšg
);

520 
ÁÙ
++;

521 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

522 
	`RecursiveCÚjug©eMove
(
lšk
->
	`Out
(),
Çcû±
,
ÁÙ
,
tunšg
);

524 
	}
}

526 
	$LoÿlCÚjug©eMove
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
) {

528 
CÚjug©eMuÉiNÜm®
* 
rg‘
 = 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
);

531 
logp1
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

534 
logq1
 = 0;

536 
logq1
 +ğ
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘LogProb
();

537 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

538 
logq1
 +ğ
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘LogProb
();

541 
	`SaveSuffic›ÁSti¡ic
();

542 ià(! 
äom
->
	`isRoÙ
()) {

543 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`Compu‹CÚŒa¡
();

544 
	`AddToSÿË
(
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘CÚŒa¡
(),
çl£
);

546 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

547 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`Compu‹CÚŒa¡
();

548 
	`AddToSÿË
(
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘CÚŒa¡
(),
çl£
);

551 
rg‘
->
	`CÜru±
(
Œue
);

552 
m©
->
	`CÜru±
(
Œue
);

554 * 
d–x
 = 
Ãw
 [
dim
];

555 
m©
->
	`d¿wV®
(
d–x
);

556 
logh1
 = 
m©
->
	`logV®Prob
(
d–x
);

559 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`Shiá
(
d–x
,
tunšg
);

561 ià(! 
äom
->
	`isRoÙ
()) {

562 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`Compu‹CÚŒa¡
();

563 
	`AddToSÿË
(
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘CÚŒa¡
(),
Œue
);

565 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

566 
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`Compu‹CÚŒa¡
();

567 
	`AddToSÿË
(
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘CÚŒa¡
(),
Œue
);

571 
logp2
 = 
Œuem©
->
	`M¬gš®LogProb
(
sÿË¡©
,
sh­e¡©
);

573 
m©
->
	`GibbsRe§m¶e
(
sÿË¡©
,
sh­e¡©
);

574 
m©
->
	`Upd©e
();

576 
d–logp
 = 
rg‘
->
	`Upd©e
();

579 
logh2
 = 
m©
->
	`logV®Prob
(
d–x
);

582 
logq2
 = 0;

584 
logq2
 +ğ
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
äom
)->
	`G‘LogProb
();

585 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

586 
logq2
 +ğ
Œ“
->
	`G‘CÚjug©eMuÉiNÜm®
(
lšk
->
	`Out
())->
	`G‘LogProb
();

589 
d–logp
 -ğ
logq2
 - 
logq1
;

590 
d–logp
 +ğ
logp2
 - 
logp1
;

592 
acû±
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
d–logp
);

593 ià(! 
acû±
) {

594 
	`Re¡ÜeSuffic›ÁSti¡ic
();

595 
rg‘
->
	`CÜru±
(
çl£
);

596 
rg‘
->
	`Re¡Üe
();

597 
m©
->
	`CÜru±
(
çl£
);

598 
m©
->
	`Re¡Üe
();

601 
d–‘e
[] 
d–x
;

603  
acû±
;

604 
	}
}

	@ConjugateMultinomial.h

3 #iâdeà
CONJUGATEMULTINOMIAL_H


4 
	#CONJUGATEMULTINOMIAL_H


	)

6 
	~"CÚjug©e.h
"

7 
	~"RªdomTy³s.h
"

10 
şass
 
	gMuÉšomŸlSemiCÚjug©e
 : 
public
 
vœtu®
 
SemiCÚjug©ePriÜ
<
Profe
> {

12 
public
:

14 
MuÉšomŸlSemiCÚjug©e
(
dim’siÚ
) {

15 
couÁ
 = 
Ãw
 [
dim’siÚ
];

16 
	gbkcouÁ
 = 
Ãw
 [
dim’siÚ
];

19 
	gvœtu®
 ~
MuÉšomŸlSemiCÚjug©e
() {

20 
	gd–‘e
[] 
	gcouÁ
;

21 
	gd–‘e
[] 
	gbkcouÁ
;

24 
Re£tSuffic›ÁSti¡ic
() {

25 
	gk
=0; k<
G‘Dim
(); k++) {

26 
	gcouÁ
[
k
] = 0;

30 
SaveSuffic›ÁSti¡ic
() {

31 
	gk
=0; k<
G‘Dim
(); k++) {

32 
	gbkcouÁ
[
k
] = 
couÁ
[k];

36 
Re¡ÜeSuffic›ÁSti¡ic
() {

37 
	gk
=0; k<
G‘Dim
(); k++) {

38 
	gcouÁ
[
k
] = 
bkcouÁ
[k];

42 
AddCouÁs
(cÚ¡ * 
šcouÁ
) {

43 
	gk
=0; k<
G‘Dim
(); k++) {

44 
	gcouÁ
[
k
] +ğ
šcouÁ
[k];

48 
SuffStLogProb
() {

49 
	gtÙ®
 = 0;

50 
	gk
=0; k<
G‘Dim
(); k++) {

51 
	gtÙ®
 +ğ
couÁ
[
k
] * 
log
((*
this
)[k]);

53  
	gtÙ®
;

56 
	g´Ùeùed
:

58 * 
couÁ
;

59 * 
	gbkcouÁ
;

63 
şass
 
	gCÚjug©eMuÉšomŸl
 : 
public
 
CÚjug©eSam¶šg
<
IÁVeùÜ
>,…ubliø
	gMuÉšomŸl
 {

65 
	gpublic
:

67 
CÚjug©eMuÉšomŸl
(
MuÉšomŸlSemiCÚjug©e
* 
š´ob¬¿y
, 
N
è: 
MuÉšomŸl
(inprobarray,N) {

68 
	gcÚjug©e_up
.
š£¹
(
š´ob¬¿y
);

71 ~
CÚjug©eMuÉšomŸl
() {}

73 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

74 
MuÉšomŸlSemiCÚjug©e
* 
	gp
 = 
dyÇmic_ÿ¡
<MuÉšomŸlSemiCÚjug©e*>(
·»Á
);

75 ià(! 
	gp
) {

76 
	gû¼
 << "castƒrror in ConjugateMultinomial::AddSuffStat\n";

77 
ex™
(1);

79 
	gp
->
AddCouÁs
(
MuÉšomŸl
::
v®
().
G‘A¼ay
());

84 
şass
 
	gCÚjug©eDœichËt
 : 
public
 
CÚjug©ePriÜ
<
Profe
>,…ubliø
	gMuÉšomŸlSemiCÚjug©e
,…ubliø
	gDœichËt
 {

86 
	gpublic
:

88 
CÚjug©eDœichËt
(
dim’siÚ
è: 
MuÉšomŸlSemiCÚjug©e
(dim’siÚ), 
DœichËt
 (dimension) {}

90 
CÚjug©eDœichËt
(
V¬
<
Profe
>* 
šûÁ”
, V¬<
PosR—l
>* 
šcÚûÁ¿tiÚ
è: 
MuÉšomŸlSemiCÚjug©e
(šûÁ”->
G‘Dim
()), 
DœichËt
(incenter,inconcentration) {}

92 
GibbsRe§m¶e
() {

93 
	gtÙ®
 = 0;

94 
	gk
=0; k<
G‘Dim
(); k++) {

95 
	gtmp
 = 0;

96 ià(
	gcÚûÁ¿tiÚ
) {

97 
	gtmp
 = 
Rªdom
::
sGamma
(
cÚûÁ¿tiÚ
->
v®
(è* (
ûÁ”
->v®()[
k
] + 
couÁ
[k]));

100 
	gtmp
 = 
Rªdom
::
sGamma
(1 + 
couÁ
[
k
]);

102 ià(
	gtmp
 < 
	gProfe
::
MIN
) {

103 
tmp
 = 
Profe
::
MIN
;

105 (*
	gthis
)[
k
] = 
tmp
;

106 
	gtÙ®
 +ğ
tmp
;

108 
	gk
=0; k<
G‘Dim
(); k++) {

109 (*
	gthis
)[
k
] /ğ
tÙ®
;

113 
logProb
() {

114 ià(
isAùive
()) {

115 ià(
isIÁeg¿‹d
()) {

116 
	gtÙ®couÁ
 = 0;

117 
	gi
=0; i<
G‘Dim
(); i++) {

118 
	gtÙ®couÁ
 +ğ
couÁ
[
i
];

120 
	gtÙ®
 = 0;

121 ià(
	gcÚûÁ¿tiÚ
) {

122 
	gtÙ®
 +ğ
Rªdom
::
logGamma
(
cÚûÁ¿tiÚ
->
v®
()è- Rªdom::logGamma(cÚûÁ¿tiÚ->v®(è+ 
tÙ®couÁ
);

123 
	gi
=0; i<
G‘Dim
(); i++) {

124 
	gtÙ®
 -ğ
Rªdom
::
logGamma
(
cÚûÁ¿tiÚ
->
v®
(è* 
ûÁ”
->v®()[
i
]è- Rªdom::logGamma(cÚûÁ¿tiÚ->v®(è* c’‹r->v®()[i] + 
couÁ
[i]);

128 
	gtÙ®
 +ğ
Rªdom
::
logGamma
(
G‘Dim
()è- Rªdom::logGamma(G‘Dim(è+ 
tÙ®couÁ
);

129 
	gi
=0; i<
G‘Dim
(); i++) {

130 
	gtÙ®
 +ğ
Rªdom
::
logGamma
(1 + 
couÁ
[
i
]);

133  
	gtÙ®
;

135 
	gtÙ®
 = 0;

136 ià(
	gcÚûÁ¿tiÚ
) {

137 
	gtÙ®
 = 
Rªdom
::
logGamma
(
cÚûÁ¿tiÚ
->
v®
());

138 
	gi
=0; i<
G‘Dim
(); i++) {

139 
	gtÙ®
 -ğ
Rªdom
::
logGamma
(
cÚûÁ¿tiÚ
->
v®
(è* 
ûÁ”
->v®()[
i
]è- (cÚûÁ¿tiÚ->v®(è* c’‹r->v®()[i] + 
couÁ
[i] - 1è* 
log
((*
this
)[i]);

143 
	gtÙ®
 = 
Rªdom
::
logGamma
(
G‘Dim
());

144 
	gi
=0; i<
G‘Dim
(); i++) {

145 
	gtÙ®
 -ğ
couÁ
[
i
] * 
log
((*
this
)[i]);

148  
	gtÙ®
;

150  
	gDœichËt
::
logProb
();

154 
şass
 
	gG’”®izedMuÉšomŸlSemiCÚjug©e
 : 
public
 
vœtu®
 
SemiCÚjug©ePriÜ
<
Profe
> {

156 
public
:

158 
G’”®izedMuÉšomŸlSemiCÚjug©e
(
dim’siÚ
) {

159 
couÁ
 = 
Ãw
 [
dim’siÚ
];

160 
	gbkcouÁ
 = 
Ãw
 [
dim’siÚ
];

161 
	gb‘a¡©
 = 
Ãw
 [
dim’siÚ
];

162 
	gbkb‘a¡©
 = 
Ãw
 [
dim’siÚ
];

165 ~
G’”®izedMuÉšomŸlSemiCÚjug©e
() {

166 
	gd–‘e
[] 
	gcouÁ
;

167 
	gd–‘e
[] 
	gbkcouÁ
;

168 
	gd–‘e
[] 
	gb‘a¡©
;

169 
	gd–‘e
[] 
	gbkb‘a¡©
;

172 
Re£tSuffic›ÁSti¡ic
() {

173 
	gk
=0; k<
G‘Dim
(); k++) {

174 
	gcouÁ
[
k
] = 0;

175 
	gb‘a¡©
[
k
] = 0;

179 
SaveSuffic›ÁSti¡ic
() {

180 
	gk
=0; k<
G‘Dim
(); k++) {

181 
	gbkcouÁ
[
k
] = 
couÁ
[k];

182 
	gbkb‘a¡©
[
k
] = 
b‘a¡©
[k];

186 
Re¡ÜeSuffic›ÁSti¡ic
() {

187 
	gk
=0; k<
G‘Dim
(); k++) {

188 
	gcouÁ
[
k
] = 
bkcouÁ
[k];

189 
	gb‘a¡©
[
k
] = 
bkb‘a¡©
[k];

193 
AddToSh­e
(cÚ¡ * 
šcouÁ
) {

194 
	gk
=0; k<
G‘Dim
(); k++) {

195 
	gcouÁ
[
k
] +ğ
šcouÁ
[k];

199 
AddToSÿË
(cÚ¡ * 
šb‘a¡©
) {

200 
	gk
=0; k<
G‘Dim
(); k++) {

201 
	gb‘a¡©
[
k
] +ğ
šb‘a¡©
[k];

205 
SuffStLogProb
() {

206 
	gtÙ®
 = 0;

207 
	gk
=0; k<
G‘Dim
(); k++) {

208 
	gtÙ®
 +ğ
couÁ
[
k
] * 
log
((*
this
)[k]è- 
b‘a¡©
[k] * (*this)[k];

210  
	gtÙ®
;

213 
	g´Ùeùed
:

215 * 
couÁ
;

216 * 
	gbkcouÁ
;

217 * 
	gb‘a¡©
;

218 * 
	gbkb‘a¡©
;

222 
şass
 
	gSemiCÚjug©eDœichËt
 : 
public
 
G’”®izedMuÉšomŸlSemiCÚjug©e
,…ubliø
	gDœichËt
 {

224 
	gpublic
:

226 
SemiCÚjug©eDœichËt
(
dim’siÚ
è: 
G’”®izedMuÉšomŸlSemiCÚjug©e
(dim’siÚ), 
DœichËt
 (dimension) {}

228 
SemiCÚjug©eDœichËt
(
V¬
<
Profe
>* 
šûÁ”
, V¬<
PosR—l
>* 
šcÚûÁ¿tiÚ
è: 
G’”®izedMuÉšomŸlSemiCÚjug©e
(šûÁ”->
G‘Dim
()), 
DœichËt
(incenter,inconcentration) {}

230 
logProb
() {

231 ià(
isAùive
()) {

232 
	gtÙ®
 = 0;

233 ià(
	gcÚûÁ¿tiÚ
) {

234 
	gtÙ®
 = 
Rªdom
::
logGamma
(
cÚûÁ¿tiÚ
->
v®
());

235 
	gi
=0; i<
G‘Dim
(); i++) {

236 
	gtÙ®
 +ğ-
Rªdom
::
logGamma
(
cÚûÁ¿tiÚ
->
v®
(è* 
ûÁ”
->v®()[
i
]è- 
b‘a¡©
[i] * v®()[i] + (cÚûÁ¿tiÚ->v®(è* c’‹r->v®()[i] + 
couÁ
[i] - 1è* 
log
(val()[i]);

240 
	gtÙ®
 = 
Rªdom
::
logGamma
(
G‘Dim
());

241 
	gi
=0; i<
G‘Dim
(); i++) {

242 
	gtÙ®
 +ğ- 
b‘a¡©
[
i
] * 
v®
()[i] + 
couÁ
[i] * 
log
(val()[i]);

245  
	gtÙ®
;

247  
	gDœichËt
::
logProb
();

	@ConjugateOneMatrixPhyloProcess.h

1 #iâdeà
CONJUGATEONEMATRIXPHYLOPROCESS_H


2 
	#CONJUGATEONEMATRIXPHYLOPROCESS_H


	)

5 
	~"OÃM©rixPhyloProûss.h
"

6 
	~"CÚjug©eP©h.h
"

9 şas 
	cCÚjug©eOÃM©rixRASPhyloProûss
 : 
public
 
OÃM©rixRASPhyloProûss
 {

11 
public
:

13 
CÚjug©eOÃM©rixRASPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
V¬A¼ay
<
PosR—l
>* 
š¿‹
, 
RªdomSubM©rix
* 
šm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$OÃM©rixRASPhyloProûss
(
šŒ“
, 
š¿‹
, 
šm©rix
, 
šd©a
) {

14 
»Ì©e
 = 0;

15 
¡©
 = 0;

16 
GTRRªdomSubM©rix
* 
gŒm©rix
 = 
dyÇmic_ÿ¡
<GTRRªdomSubM©rix*>(
m©rix
);

17 ià(
gŒm©rix
) {

18 
»Ì©e
 = 
gŒm©rix
->
	`G‘RªdomR–©iveR©es
();

19 
¡©
 = 
gŒm©rix
->
	`G‘RªdomStiÚ¬›s
();

20 ià(! 
¡©
) {

21 
û¼
 << "error : gtr matrix does‚ot have„andom stat\n";

22 
	`ex™
(1);

24 ià(! 
»Ì©e
) {

25 
û¼
 << "error : gtr matrix does‚ot have„andom„elrate\n";

26 
	`ex™
(1);

31 
´iv©e
 :

33 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(
Lšk
* 
lšk
, 
s™e
) {

40  
Ãw
 
	`CÚjug©eRªdomB¿nchS™eP©h
(
this
, 
Œ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()), 
	`G‘R©e
(
s™e
), 
m©rix
, 
¡©
, 
»Ì©e
);

41 
	}
}

43 
	gV¬
<
	gPosR—lVeùÜ
>* 
	g»Ì©e
;

44 
	gV¬
<
	gProfe
>* 
	g¡©
;

	@ConjugatePath.h

2 #iâdeà
CONJUGATEPATH_H


3 
	#CONJUGATEPATH_H


	)

5 
	~"RªdomB¿nchS™eP©h.h
"

6 
	~"CÚjug©e.h
"

7 
	~"IIDCÚjug©e.h
"

8 
	~"CÚjug©ePoissÚ.h
"

9 
	~"CÚjug©eMuÉšomŸl.h
"

10 
	~"GTRSubM©rix.h
"

12 
şass
 
	gL’gthCÚjug©eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomB¿nchS™eP©h
 {

14 
	gpublic
:

16 
L’gthCÚjug©eP©h
(
PhyloProûss
* 
š´oûss
, 
V¬
<
PosR—l
>* 
šËngth
è: 
RªdomB¿nchS™eP©h
(inprocess) {

17 
cÚj_Ëngth
 = 
dyÇmic_ÿ¡
<
PoissÚSemiCÚjug©e
*>(
šËngth
);

18 ià(
	gcÚj_Ëngth
) {

19 
	gcÚjug©e_up
.
š£¹
(
cÚj_Ëngth
);

20 
Regi¡”
(
cÚj_Ëngth
);

24 
boŞ
 
isM©ched
() {

25  (
	gcÚj_Ëngth
 != 0);

28 
	g´Ùeùed
:

30 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

31 ià(
cÚj_Ëngth
 && (
·»Á
 == conj_length)) {

32 
cÚj_Ëngth
->
AddToSh­e
(
G‘Nsub
());

33 
	gcÚj_Ëngth
->
AddToSÿË
(
L’gthSÿËSt
());

37 
L’gthSÿËSt
() {

38 
	gtÙ®
 = 0;

39 
Plšk
* 
	glšk
 = 
In™
();

40 
	glšk
) {

41 
	g¡©e
 = 
lšk
->
G‘S‹
();

42 
	gtÙ®
 +ğ-(*
G‘SubM©rix
())(
¡©e
,
	g¡©e
è* 
G‘R–©iveTime
(
lšk
);

43 
	glšk
 = 
lšk
->
Next
();

45  
tÙ®
 * 
G‘R©e
();

48 
	g´iv©e
:

50 
PoissÚSemiCÚjug©e
* 
cÚj_Ëngth
;

53 
şass
 
	gR©eCÚjug©eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomB¿nchS™eP©h
 {

55 
	gpublic
:

57 
R©eCÚjug©eP©h
(
PhyloProûss
* 
š´oûss
, 
V¬
<
PosR—l
>* 
š¿‹
è: 
RªdomB¿nchS™eP©h
(inprocess) {

58 
cÚj_¿‹
 = 
dyÇmic_ÿ¡
<
PoissÚSemiCÚjug©e
*>(
š¿‹
);

59 ià(
	gcÚj_¿‹
) {

60 
	gcÚjug©e_up
.
š£¹
(
cÚj_¿‹
);

61 
Regi¡”
(
cÚj_¿‹
);

65 
boŞ
 
isM©ched
() {

66  (
	gcÚj_¿‹
 != 0);

69 
	g´Ùeùed
:

71 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

72 ià(
cÚj_¿‹
 && (
·»Á
 == conj_rate)) {

73 
cÚj_¿‹
->
AddToSh­e
(
G‘Nsub
());

74 
	gcÚj_¿‹
->
AddToSÿË
(
R©eSÿËSt
());

78 
R©eSÿËSt
() {

79 
	gtÙ®
 = 0;

80 
Plšk
* 
	glšk
 = 
In™
();

81 
	glšk
) {

82 
	g¡©e
 = 
lšk
->
G‘S‹
();

83 
	gtÙ®
 +ğ-(*
G‘SubM©rix
())(
¡©e
,
	g¡©e
è* 
G‘R–©iveTime
(
lšk
);

84 
	glšk
 = 
lšk
->
Next
();

86  
tÙ®
 * 
G‘Time
();

89 
	g´iv©e
:

91 
PoissÚSemiCÚjug©e
* 
cÚj_¿‹
;

94 
şass
 
	gStiÚ¬yCÚjug©eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomB¿nchS™eP©h
 {

96 
	gpublic
:

98 
StiÚ¬yCÚjug©eP©h
(
PhyloProûss
* 
š´oûss
, 
V¬
<
Profe
>* 
š¡©
è: 
RªdomB¿nchS™eP©h
(inprocess) {

99 
cÚj_¡©
 = 
dyÇmic_ÿ¡
<
G’”®izedMuÉšomŸlSemiCÚjug©e
*>(
š¡©
);

100 ià(
	gcÚj_¡©
) {

101 
	gcÚjug©e_up
.
š£¹
(
cÚj_¡©
);

102 
Regi¡”
(
cÚj_¡©
);

106 
boŞ
 
isM©ched
() {

107  (
	gcÚj_¡©
 != 0);

110 
	g´Ùeùed
:

112 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

113 ià(
cÚj_¡©
 && (
·»Á
 == conj_stat)) {

114 * 
couÁs
 = 
Ãw
 [
G‘N¡©e
()];

115 * 
	gb‘a
 = 
Ãw
 [
G‘N¡©e
()];

116 
Compu‹St
(
couÁs
,
b‘a
);

117 
	gcÚj_¡©
->
AddToSh­e
(
couÁs
);

118 
	gcÚj_¡©
->
AddToSÿË
(
b‘a
);

119 
	gd–‘e
[] 
	gcouÁs
;

120 
	gd–‘e
[] 
	gb‘a
;

124 
Compu‹St
(* 
couÁs
, * 
b‘a
) {

126 
	gk
=0; k<
G‘N¡©e
(); k++) {

127 
	gcouÁs
[
k
] = 0;

128 
	gb‘a
[
k
] = 0;

130 
Plšk
* 
	glšk
 = 
In™
();

131 
	glšk
) {

132 
	g¡©e
 = 
lšk
->
G‘S‹
();

133 ià(
isRoÙ
()) {

134 
	gcouÁs
[
¡©e
]++;

137 ià(
	glšk
 !ğ
In™
()) {

138 
couÁs
[
¡©e
]++;

140 
	gk
=0; k<
G‘N¡©e
(); k++) {

141 ià(
	gk
 !ğ
¡©e
) {

142 ià(
G‘StiÚ¬y
()[
k
] > 0) {

143 
b‘a
[
k
] +ğ(*
G‘SubM©rix
())(
¡©e
,
	gk
è/ 
G‘StiÚ¬y
()[k] * 
G‘AbsŞu‹Time
(
lšk
è* 
G‘R©e
();

148 
	glšk
 = 
lšk
->
Next
();

152 
	g´iv©e
:

154 
G’”®izedMuÉšomŸlSemiCÚjug©e
* 
cÚj_¡©
;

158 
şass
 
	gR–©iveR©eCÚjug©eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomB¿nchS™eP©h
 {

160 
	gpublic
:

162 
R–©iveR©eCÚjug©eP©h
(
PhyloProûss
* 
š´oûss
, 
V¬
<
PosR—lVeùÜ
>* 
š»Ì©e
è: 
RªdomB¿nchS™eP©h
(inprocess) {

163 
cÚj_»Ì©e
 = 
dyÇmic_ÿ¡
<
IIDPoissÚSemiCÚjug©e
*>(
š»Ì©e
);

164 ià(
	gcÚj_»Ì©e
) {

165 
	gcÚjug©e_up
.
š£¹
(
cÚj_»Ì©e
);

166 
Regi¡”
(
cÚj_»Ì©e
);

170 
boŞ
 
isM©ched
() {

171  (
	gcÚj_»Ì©e
 != 0);

174 
	g´Ùeùed
:

176 
N¼
(è{ 
G‘N¡©e
() * (GetNstate() - 1) / 2;}

177 
¼šdex
(
i
, 
j
è{ 
	gGTRSubM©rix
::¼šdex(i,j,
G‘N¡©e
());}

179 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

180 ià(
	gcÚj_»Ì©e
 && (
	g·»Á
 =ğ
cÚj_»Ì©e
)) {

181 * 
couÁs
 = 
Ãw
 [
N¼
()];

182 * 
	gb‘a
 = 
Ãw
 [
N¼
()];

183 
Compu‹St
(
couÁs
,
b‘a
);

184 
	gcÚj_»Ì©e
->
AddToSh­e
(
couÁs
);

185 
	gcÚj_»Ì©e
->
AddToSÿË
(
b‘a
);

186 
	gd–‘e
[] 
	gcouÁs
;

187 
	gd–‘e
[] 
	gb‘a
;

191 
Compu‹St
(* 
couÁs
, * 
b‘a
) {

192 
	gk
=0; k<
N¼
() ; k++) {

193 
	gcouÁs
[
k
] = 0;

194 
	gb‘a
[
k
] = 0;

196 
Plšk
* 
	glšk
 = 
In™
();

197 
	glšk
) {

198 
	g¡©e
 = 
lšk
->
G‘S‹
();

199 ià(
	glšk
 !ğ
La¡
()) {

200 
couÁs
[
¼šdex
(
lšk
->
G‘S‹
(),†šk->
Next
()->GetState())]++;

202 
	gk
=0; k<
G‘N¡©e
(); k++) {

203 ià(
	gk
 !ğ
¡©e
) {

204 
b‘a
[
¼šdex
(
¡©e
,
k
)] +ğ
G‘StiÚ¬y
()[k] * 
G‘AbsŞu‹Time
(
lšk
è* 
G‘R©e
();

207 
	glšk
 = 
lšk
->
Next
();

211 
	g´iv©e
:

213 
IIDPoissÚSemiCÚjug©e
* 
cÚj_»Ì©e
;

217 
şass
 
	gCÚjug©eRªdomB¿nchS™eP©h
 : 
public
 
vœtu®
 
RªdomB¿nchS™eP©h
,…ubliø
	gL’gthCÚjug©eP©h
,…ubliø
	gR©eCÚjug©eP©h
,…ubliø
	gStiÚ¬yCÚjug©eP©h
,…ubliø
	gR–©iveR©eCÚjug©eP©h
 {

219 
	gpublic
:

221 
CÚjug©eRªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
, 
V¬
<
PosR—l
>* 
šËngth
, V¬<PosR—l>* 
š¿‹
, 
RªdomSubM©rix
* 
šm©rix
, V¬<
Profe
>* 
š¡©
, V¬<
PosR—lVeùÜ
>* 
š»Ì©e
) :

222 
RªdomB¿nchS™eP©h
(
š´oûss
, 
šËngth
, 
š¿‹
, 
šm©rix
, 
š¡©
),

223 
L’gthCÚjug©eP©h
(
š´oûss
,
šËngth
),

224 
R©eCÚjug©eP©h
(
š´oûss
,
š¿‹
),

225 
StiÚ¬yCÚjug©eP©h
(
š´oûss
,
š¡©
),

226 
R–©iveR©eCÚjug©eP©h
(
š´oûss
,
š»Ì©e
)

229 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

230 
	gL’gthCÚjug©eP©h
::
AddSuffic›ÁSti¡ic
(
·»Á
);

231 
	gR©eCÚjug©eP©h
::
AddSuffic›ÁSti¡ic
(
·»Á
);

232 
	gStiÚ¬yCÚjug©eP©h
::
AddSuffic›ÁSti¡ic
(
·»Á
);

233 
	gR–©iveR©eCÚjug©eP©h
::
AddSuffic›ÁSti¡ic
(
·»Á
);

	@ConjugatePoisson.h

2 #iâdeà
CONJUGATEPOISSON_H


3 
	#CONJUGATEPOISSON_H


	)

5 
	~"CÚjug©e.h
"

6 
	~"RªdomTy³s.h
"

7 
	~"IID.h
"

115 
şass
 
	gPoissÚSemiCÚjug©e
 : 
public
 
vœtu®
 
SemiCÚjug©ePriÜ
<
PosR—l
> {

117 
public
:

119 
vœtu®
 ~
PoissÚSemiCÚjug©e
() {}

121 
Re£tSuffic›ÁSti¡ic
() {

122 
sh­e¡©
 = 0;

123 
	gsÿË¡©
 = 0;

124 
	glogçù¡©
 = 0;

127 
SaveSuffic›ÁSti¡ic
() {

128 
	gbksh­e¡©
 = 
sh­e¡©
;

129 
	gbksÿË¡©
 = 
sÿË¡©
;

130 
	gbklogçù¡©
 = 
logçù¡©
;

133 
Re¡ÜeSuffic›ÁSti¡ic
() {

134 
	gsh­e¡©
 = 
bksh­e¡©
;

135 
	gsÿË¡©
 = 
bksÿË¡©
;

136 
	glogçù¡©
 = 
bklogçù¡©
;

139 
AddToSh­e
(
š
) {

140 
	gsh­e¡©
 +ğ
š
;

143 
AddToSÿË
(
š
) {

144 
	gsÿË¡©
 +ğ
š
;

147 
AddToLogFaù
(
š
) {

148 
	glogçù¡©
 +ğ
š
;

151 
SuffStLogProb
() {

152  
sh­e¡©
 * 
log
(
v®
()è- 
sÿË¡©
 * v®(è- 
	glogçù¡©
;

155 
	g´Ùeùed
:

157 
sh­e¡©
;

158 
	gsÿË¡©
;

159 
	glogçù¡©
;

160 
	gbksh­e¡©
;

161 
	gbksÿË¡©
;

162 
	gbklogçù¡©
;

167 
şass
 
	gCÚjug©ePoissÚ
 : 
public
 
CÚjug©eSam¶šg
<
IÁ
>,…ubliø
	gPoissÚ
 {

169 
	gpublic
:

171 
CÚjug©ePoissÚ
(
PoissÚSemiCÚjug©e
* 
šmu
è: 
PoissÚ
(inmu) {

172 
cÚjug©e_up
.
š£¹
(
šmu
);

175 ~
CÚjug©ePoissÚ
() {}

177 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

178 
PoissÚSemiCÚjug©e
* 
	g´iÜ
 = 
dyÇmic_ÿ¡
<PoissÚSemiCÚjug©e*>(
·»Á
);

179 ià(! 
	g´iÜ
) {

180 
	gû¼
 << "castƒrror in ConjugatePoisson::AddSuffStat\n";

181 
ex™
(1);

183 
	g´iÜ
->
AddToSh­e
(
v®
());

184 
	g´iÜ
->
AddToSÿË
(1.0);

185 
	g´iÜ
->
AddToLogFaù
(
Rªdom
::
logGamma
(1 + 
v®
()));

191 
şass
 
	gSemiCÚjug©eGamma
 : 
public
 
PoissÚSemiCÚjug©e
,…ubliø
	gGamma
 {

193 
	gpublic
:

195 
SemiCÚjug©eGamma
(
V¬
<
PosR—l
>* 
šsh­e
, V¬<PosR—l>* 
šsÿË
è: 
Gamma
(inshape,inscale) {}

197 
logProb
() {

198 ià(
isAùive
()) {

199  
	gGamma
::
logProb
(è+ 
SuffStLogProb
();

201  
	gGamma
::
logProb
();

206 
şass
 
	gCÚjug©eGamma
 : 
public
 
CÚjug©ePriÜ
<
PosR—l
>,…ubliø
	gSemiCÚjug©eGamma
 {

208 
	gpublic
:

210 
CÚjug©eGamma
(
V¬
<
PosR—l
>* 
šsh­e
, V¬<PosR—l>* 
šsÿË
è: 
SemiCÚjug©eGamma
(inshape,inscale) {}

212 
GibbsRe§m¶e
() {

214 ià(
	gsh­e¡©
 < 0) {

215 
	gû¼
 << "error :‚egative shapestat in conjugate gamma\n";

216 
ex™
(1);

218 ià(
	gsÿË¡©
 < 0) {

219 
	gû¼
 << "error :‚egative scalestat in conjugate gamma\n";

220 
ex™
(1);

223 
	gv®ue
 = 
Rªdom
::
Gamma
(
sh­e
->
v®
(è+ 
sh­e¡©
, 
sÿË
->v®(è+ 
sÿË¡©
);

226 ià(
	gv®ue
 < 
	gGAMMAMIN
) {

227 
	gv®ue
 = 
GAMMAMIN
;

230 
	gthis
->
£tv®
(
v®ue
);

233 
logProb
() {

234 ià(
isAùive
()) {

237 ià(
isIÁeg¿‹d
()) {

238 
	gpo¡sh­e
 = 
sh­e
->
v®
(è+ 
sh­e¡©
;

239 
	gpo¡sÿË
 = 
sÿË
->
v®
(è+ 
sÿË¡©
;

240  -
	gRªdom
::
logGamma
(
sh­e
->
v®
()è+ sh­e->v®(è* 
log
(
sÿË
->v®()è+ 
Rªdom
::logGamma(
po¡sh­e
è-…o¡sh­*†og(
po¡sÿË
è- 
logçù¡©
;

244  
	gSemiCÚjug©eGamma
::
logProb
();

247  
	gGamma
::
logProb
();

251 
şass
 
	gCÚjug©eGammaIIDA¼ay
 : 
public
 
IIDA¼ay
<
PosR—l
> {

253 
public
:

254 
CÚjug©eGammaIIDA¼ay
(
šsize
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
è: 
IIDA¼ay
<PosReal>(insize) {

255 
®pha
 = 
š®pha
;

256 
	gb‘a
 = 
šb‘a
;

257 
C»©e
();

260 
CÚjug©eGamma
* 
	gİ”©Ü
[](
	gs™e
) {

261  
	gdyÇmic_ÿ¡
<
	gCÚjug©eGamma
*>(
	g¬¿y
[
s™e
]);

264 
	g´Ùeùed
:

266 
Rv¬
<
PosR—l
>* 
C»©eV®
(
s™e
) {

267  
Ãw
 
CÚjug©eGamma
(
®pha
, 
b‘a
);

270 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

271 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

	@ContinuousData.h

1 #iâdeà
CONTINUOUSDATA_H


2 
	#CONTINUOUSDATA_H


	)

4 
	~"TaxÚS‘.h
"

5 
	~<f¡»am
>

6 
	~<cm©h
>

7 
	~<s¡»am
>

11 şas 
	cCÚtšuousD©a
 {

13 
	mpublic
:

15 
	$CÚtšuousD©a
() {}

17 
	$CÚtšuousD©a
(cÚ¡ 
TaxÚS‘
* 
šx£t
, 
šNs™e
) {

18 
x£t
 = 
šx£t
;

19 
Ns™e
 = 
šNs™e
;

20 
D©a
 = 
Ãw
 *[
	`G‘Nxa
()];

21 
i
=0; i<
	`G‘Nxa
(); i++) {

22 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

23 
j
=0; j<
Ns™e
; j++) {

24 
D©a
[
i
][
j
] = 0;

27 
ch¬Çme
 = 
Ãw
 
¡ršg
[
	`G‘Ns™e
()];

28 
j
=0; j<
Ns™e
; j++) {

29 
ch¬Çme
[
j
] = "none";

31 
	}
}

33 
	$CÚtšuousD©a
(
CÚtšuousD©a
* 
äom
) {

34 
x£t
 = 
äom
->
	`G‘TaxÚS‘
();

35 
Ns™e
 = 
äom
->
	`G‘Ns™e
();

36 
D©a
 = 
Ãw
 *[
	`G‘Nxa
()];

37 
i
=0; i<
	`G‘Nxa
(); i++) {

38 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

39 
j
=0; j<
Ns™e
; j++) {

40 
D©a
[
i
][
j
] = 
äom
->Data[i][j];

43 
ch¬Çme
 = 
Ãw
 
¡ršg
[
	`G‘Ns™e
()];

44 
j
=0; j<
Ns™e
; j++) {

45 
ch¬Çme
[
j
] = 
äom
->charname[j];

47 
	}
}

49 
	$ToSŒ—m
(
o¡»am
& 
os
, 
TaxÚS‘
* 
x£t
 = 0) {

51 ià(! 
x£t
) {

53 
os
 << 
	`G‘Nxa
(è<< '\t' << 
	`G‘Ns™e
() << '\n';

54 
i
=0; i<
	`G‘Nxa
(); i++) {

55 
os
 << 
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
i
);

68 
j
=0; j<
	`G‘Ns™e
(); j++) {

69 
os
 << '\t' << 
D©a
[
i
][
j
];

80 
os
 << '\n';

85 
Áaxa
 = 0;

86 
i
=0; i<
	`G‘Nxa
(); i++) {

87 ià(
x£t
->
	`G‘TaxÚIndex
(
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
i
)) != -1) {

88 
Áaxa
++;

92 
os
 << 
Áaxa
 << '\t' << 
	`G‘Ns™e
() << '\n';

93 
i
=0; i<
	`G‘Nxa
(); i++) {

94 ià(
x£t
->
	`G‘TaxÚIndex
(
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
i
)) != -1) {

95 
os
 << 
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
i
);

96 
j
=0; j<
	`G‘Ns™e
(); j++) {

97 
os
 << '\t' << 
D©a
[
i
][
j
];

99 
os
 << '\n';

103 
	}
}

105 
	$ToSŒ—mLog
(
o¡»am
& 
os
) {

107 
os
 << 
	`G‘Nxa
(è<< '\t' << 
	`G‘Ns™e
() << '\n';

108 
i
=0; i<
	`G‘Nxa
(); i++) {

109 
os
 << 
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
i
);

122 
j
=0; j<
	`G‘Ns™e
(); j++) {

123 ià(
D©a
[
i
][
j
] == -1) {

124 
os
 << '\t' << -1;

127 
os
 << '\t' << 
	`log
(
D©a
[
i
][
j
]);

130 
os
 << '\n';

132 
	}
}

135 cÚ¡ 
TaxÚS‘
* 
	$G‘TaxÚS‘
() {

136  
x£t
;

137 
	}
}

139 
	$G‘Nxa
() {

140  
	`G‘TaxÚS‘
()->
	`G‘Nxa
();

141 
	}
}

143 
	$G‘Ns™e
() {

144  
Ns™e
;

145 
	}
}

147 
boŞ
 
	$isMissšg
(
xÚ
, 
s™e
) {

148  
D©a
[
xÚ
][
s™e
] == -1;

149 
	}
}

151 
boŞ
 
	$isMissšg
(
xÚ
) {

152 
boŞ
 
mis
 = 
Œue
;

153 
i
=0; i<
Ns™e
; i++) {

154 
mis
 &ğ(
D©a
[
xÚ
][
i
] == -1);

156  
mis
;

157 
	}
}

159 
boŞ
 
	$isMissšg
(
¡ršg
 
xÇme
) {

160 
šdex
 = 
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
xÇme
);

161  (
šdex
 == -1);

162 
	}
}

173 
	$G‘M—nLog
(
s™e
) {

174 
tÙ®
 = 0;

175 
n
 = 0;

176 
j
=0; j<
	`G‘Nxa
(); j++) {

177 ià(
D©a
[
j
][
s™e
] != -1) {

178 
tÙ®
 +ğ
	`log
(
D©a
[
j
][
s™e
]);

179 
n
++;

182  
tÙ®
 / 
n
;

183 
	}
}

185 
¡ršg
 
	$G‘Ch¬aù”Name
(
s™e
) {

186  
ch¬Çme
[
s™e
];

187 
	}
}

189 
	$G‘S‹
(
¡ršg
 
xÚ
, 
s™e
) {

190  
D©a
[
x£t
->
	`G‘TaxÚIndex
(
xÚ
)][
s™e
];

191 
	}
}

194 
	$G‘S‹
(
xÚ
, 
s™e
) {

195  
D©a
[
xÚ
][
s™e
];

196 
	}
}

199 
	gNs™e
;

200 cÚ¡ 
TaxÚS‘
* 
	gx£t
;

201 ** 
	gD©a
;

202 
¡ršg
* 
	gch¬Çme
;

206 şas 
	cFeCÚtšuousD©a
 : 
public
 
CÚtšuousD©a
 {

208 
public
:

209 
	$FeCÚtšuousD©a
(
i¡»am
& 
is
) {

210 
	`R—dD©aFromFe
(
is
);

213 
	$FeCÚtšuousD©a
(
¡ršg
 
f’ame
) {

214 
if¡»am
 
	`is
(
f’ame
.
	`c_¡r
());

215 ià(! 
is
) {

216 
û¼
 << "”rÜ wh’ o³nšg f: " << 
f’ame
 << '\n';

217 
	`ex™
(1);

219 
	`R—dD©aFromFe
(
is
);

220 
	}
}

222 
	g´iv©e
:

224 
	$R—dD©aFromFe
(
i¡»am
& 
is
) {

226 
¡ršg
 
‹mp
;

227 
is
 >> 
‹mp
;

228 
Nxa
;

229 ià(
‹mp
 == "#TRAITS") {

230 
is
 >> 
Nxa
;

231 
is
 >> 
Ns™e
;

232 
ch¬Çme
 = 
Ãw
 
¡ršg
[
Ns™e
];

233 
j
=0; j<
Ns™e
; j++) {

234 
is
 >> 
ch¬Çme
[
j
];

238 
Nxa
 = 
	`©oi
(
‹mp
.
	`c_¡r
());

239 
is
 >> 
Ns™e
;

240 
ch¬Çme
 = 
Ãw
 
¡ršg
[
Ns™e
];

241 
j
=0; j<
Ns™e
; j++) {

242 
o¡ršg¡»am
 
s
;

243 
s
 << "ch¬aù”" << 
j
+1;

244 
ch¬Çme
[
j
] = 
s
.
	`¡r
();

249 
¡ršg
* 
Çme
 = 
Ãw
 sŒšg[
Nxa
];

250 
D©a
 = 
Ãw
 *[
Nxa
];

251 
i
=0; i<
Nxa
; i++) {

252 
is
 >> 
Çme
[
i
];

253 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

254 
j
=0; j<
Ns™e
; j++) {

255 
is
 >> 
D©a
[
i
][
j
];

258 
x£t
 = 
Ãw
 
	`TaxÚS‘
(
Çme
,
Nxa
);

259 
d–‘e
[] 
Çme
;

261 
	}
}

	@CovMatrix.cpp

2 
	~"CovM©rix.h
"

4 
	gCovM©rix
::
maxn
 = 0;

5 
	gCovM©rix
::
ndŸg
 = 0;

6 
	gCovM©rix
::
max”rÜ
 = 0;

7 
	gCovM©rix
::
tÙ”rÜ
 = 0;

	@CovMatrix.h

1 #iâdeà
COVMATRIX_H


2 
	#COVMATRIX_H


	)

4 
	~"lš®g.h
"

5 
	~<io¡»am
>

6 
	~<c¡dlib
>

7 
	~<s¡»am
>

8 
	~<cm©h
>

10 
usšg
 
Çme¥aû
 
	g¡d
;

12 
	~"RªdomTy³s.h
"

13 
	~"V®A¼ay.h
"

15 
şass
 
	gCovM©rix
 : 
public
 
Ba£Ty³
,…ubliø
	gMuÉliÿtive
 {

17 
	g´Ùeùed
:

22 
dim
;

25 ** 
	gv®ue
;

27 
boŞ
 
	gÜthÚÜm®
;

28 
boŞ
 
	gdŸgæag
;

31 
	gmaxn
;

32 
	gndŸg
;

33 
	gmax”rÜ
;

34 
	gtÙ”rÜ
;

36 
	gpublic
:

38 
G‘M—nDŸgE¼Ü
() {

39 ià(
ndŸg
) {

40  
tÙ”rÜ
 / 
ndŸg
;

45 
G‘MaxDŸgE¼Ü
() {

46  
	gmax”rÜ
;

49 
G‘MaxDŸgN
() {

50  
	gmaxn
;

53 
CovM©rix
(è: 
dim
(0è, 
v®ue
(0è, 
ÜthÚÜm®
(
çl£
) {}

55 
CovM©rix
(
šdim
è: 
ÜthÚÜm®
(
çl£
) {

56 
dim
 = 
šdim
;

57 
C»©eAÎM©rix
();

58 
	gdŸgæag
 = 
çl£
;

61 
CovM©rix
(** 
Q
, 
šdim
è: 
ÜthÚÜm®
(
çl£
) {

62 
dim
 = 
šdim
;

63 
C»©eAÎM©rix
();

64 
	gi
=0; i<
G‘Dim
(); i++) {

65 
	gv®ue
[
i
][i] = 
Q
[i][i];

66 
	gj
=0; j<
	gi
; j++) {

67 
	gv®ue
[
i
][
j
] = 
Q
[i][j];

68 
	gv®ue
[
j
][
i
] = 
v®ue
[i][j];

71 
	gdŸgæag
 = 
çl£
;

74 
CovM©rix
(cÚ¡ CovM©rix& 
äom
è: 
ÜthÚÜm®
(
çl£
) {

75 
dim
 = 
äom
.
G‘Dim
();

76 
C»©eAÎM©rix
();

77 
	gdŸgæag
 = 
çl£
;

78 *
	gthis
 = 
äom
;

81 
S‘O¹hoNÜm®
(
boŞ
 
š
) {

82 
	gÜthÚÜm®
 = 
š
;

85 
C»©eAÎM©rix
(){

86 
	gv®ue
 = 
Ãw
 *[
G‘Dim
()];

87 
	gi
=0; i<
G‘Dim
(); i++) {

88 
	gv®ue
[
i
] = 
Ãw
 [
G‘Dim
()];

89 
	gj
=0; j<
G‘Dim
(); j++) {

90 
	gv®ue
[
i
][
j
] = 0;

94 
	gšvv®ue
 = 
Ãw
 *[
G‘Dim
()];

95 
	gi
=0; i<
G‘Dim
(); i++) {

96 
	gšvv®ue
[
i
] = 
Ãw
 [
G‘Dim
()];

99 
	gu
 = 
Ãw
 *[
G‘Dim
()];

100 
	gi
=0; i<
G‘Dim
(); i++) {

101 
	gu
[
i
] = 
Ãw
 [
G‘Dim
()];

104 
	gšvu
 = 
Ãw
 *[
G‘Dim
()];

105 
	gi
=0; i<
G‘Dim
(); i++) {

106 
	gšvu
[
i
] = 
Ãw
 [
G‘Dim
()];

109 
	gv
 = 
Ãw
 [
G‘Dim
()];

110 
	glogv
 = 
Ãw
 [
G‘Dim
()];

114 ~
CovM©rix
() {

116 
	gi
=0; i<
G‘Dim
(); i++) {

117 
	gd–‘e
[] 
	gv®ue
[
i
];

118 
	gd–‘e
[] 
	gšvv®ue
[
i
];

119 
	gd–‘e
[] 
	gu
[
i
];

120 
	gd–‘e
[] 
	gšvu
[
i
];

122 
	gd–‘e
[] 
	gv®ue
;

123 
	gd–‘e
[] 
	gšvv®ue
;

124 
	gd–‘e
[] 
	gu
;

125 
	gd–‘e
[] 
	gšvu
;

127 
	gd–‘e
[] 
	gv
;

128 
	gd–‘e
[] 
	glogv
;

134 
	gCovM©rix
& 
	gİ”©Ü
=(cÚ¡ 
CovM©rix
& 
äom
) {

135 ià(!
dim
) {

136 
dim
 = 
äom
.
G‘Dim
();

137 
C»©eAÎM©rix
();

138 
	gdŸgæag
 = 
çl£
;

140 ià(
	gdim
 !ğ
äom
.
dim
) {

141 
û¼
 << "error :‚on matching dimenstion for matrix\n";

142 
	gû¼
 << 
G‘Dim
(è<< '\t' << 
	gäom
.GetDim() << '\n';

143 
ex™
(1);

145 
	gi
=0; i<
G‘Dim
(); i++){

146 
	gv®ue
[
i
][i] =
äom
.
v®ue
[i][i];

147 
	gj
=0; j<
	gi
; j++){

148 
	gv®ue
[
i
][
j
] =
äom
.
v®ue
[i][j];

149 
	gv®ue
[
j
][
i
] =
äom
.
v®ue
[i][j];

152 
	gdŸgæag
 = 
çl£
;

153  *
	gthis
;

156 
£tV®
(** 
v®
, 
šDim
) {

157 ià(!
	gdim
) {

158 
	gdim
 = 
šDim
;

159 
C»©eAÎM©rix
();

160 
	gdŸgæag
 = 
çl£
;

162 ià(
	gdim
 !ğ
šDim
) {

163 
û¼
 << "error :‚on matching dimenstion for matrix\n";

164 
	gû¼
 << 
G‘Dim
(è<< '\t' << 
	gšDim
 << '\n';

165 
ex™
(1);

167 
	gi
=0; i<
G‘Dim
(); i++){

168 
	gv®ue
[
i
][i] =
v®
[i][i];

169 
	gj
=0; j<
	gi
; j++){

170 
	gv®ue
[
i
][
j
] =
v®
[i][j];

171 
	gv®ue
[
j
][
i
] =
v®
[i][j];

174 
	gdŸgæag
 = 
çl£
;

200 
	gCovM©rix
& 
	gİ”©Ü
+=(cÚ¡ 
CovM©rix
 
äom
) {

201 
i
=0; 
	gi
<
G‘Dim
(); i++){

202 
	gv®ue
[
i
][i] +ğ
äom
.
v®ue
[i][i];

203 
	gj
=0; j<
	gi
; j++){

204 
	gv®ue
[
i
][
j
] +ğ
äom
.
v®ue
[i][j];

205 
	gv®ue
[
j
][
i
] +ğ
äom
.
v®ue
[i][j];

208  *
	gthis
;

209 
	gdŸgæag
 = 
çl£
;

212 * 
	gİ”©Ü
[](
	gi
) {

213 * 
	gv
 = 
v®ue
[
i
];

214  
	gv
;

217 
İ”©Ü
()(
	gi
, 
	gj
) const {

218  
	gv®ue
[
i
][
j
];

221 
	gCovM©rix
& 
	gİ”©Ü
*=(
sÿl
) {

222 
i
=0; 
	gi
<
G‘Dim
(); i++){

223 
	gv®ue
[
i
][i] *ğ
sÿl
;

224 
	gj
=0; j<
	gi
; j++){

225 
	gv®ue
[
i
][
j
] *ğ
sÿl
;

226 
	gv®ue
[
j
][
i
] *ğ
sÿl
;

229 
	gdŸgæag
 = 
çl£
;

230  *
	gthis
;

233 
CovM©rix
 
	gİ”©Ü
*(
	gsÿl
) {

235 
CovM©rix
 
	gcm
 = *
this
;

236 
	gcm
*=
sÿl
;

237  
	gcm
;

241 
vœtu®
 
Prİo£Move
(
tunšg
) {

242 
	gj
 = (è(
G‘Dim
(è* (G‘Dim()+1è* 0.5 * 
Rªdom
::
UnifÜm
());

243 
	gi
=0;

244 
	gi
+1<=
j
){

245 
i
++;

246 
	gj
 -ğ
i
;

249 ià(
	gi
 =ğ
j
) {

250 
šfbound
 = 0;

251 
	gk
=0; k<
G‘Dim
(); k++) {

252 ià(
	gk
 !ğ
i
) {

253 
tmp
 = 
v®ue
[
i
][
k
] * value[i][k] / value[k][k];

254 ià(
	gšfbound
 < 
	gtmp
) {

255 
	gšfbound
 = 
tmp
;

259 
	gm
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

260 
	gv®ue
[
i
][i] +ğ
m
;

261 ià(
	gv®ue
[
i
][i] < 
	gšfbound
) {

262 
	gv®ue
[
i
][i] = 2 * 
šfbound
 - 
v®ue
[i][i];

266 
	gbound
 = 
sq¹
(
v®ue
[
i
][i] * v®ue[
j
][j]);

267 
	gm
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

268 
	gv®ue
[
i
][
j
] +ğ
m
;

269 (
	gv®ue
[
i
][
j
] < -
	gbound
) || (value[i][j] > bound)) {

270 ià(
	gv®ue
[
i
][
j
] < -
	gbound
) {

271 
	gv®ue
[
i
][
j
] = -2 * 
bound
 - 
v®ue
[i][j];

273 ià(
	gv®ue
[
i
][
j
] > 
	gbound
) {

274 
	gv®ue
[
i
][
j
] = 2 * 
bound
 - 
v®ue
[i][j];

277 
	gv®ue
[
j
][
i
] = 
v®ue
[i][j];

333 
vœtu®
 
d¿wV®
(* 
vec
){

334 * 
	g¿ndomv®ues
 = 
Ãw
 [
G‘Dim
()];

335 
	gi
=0; i<
G‘Dim
(); i++) {

336 
	g¿ndomv®ues
[
i
] = 
Rªdom
::
sNÜm®
(è* 
sq¹
(
G‘Eig’V®
()[i]);

337 
	gvec
[
i
]=0;

339 
	gi
=0; i<
G‘Dim
(); i++) {

340 
	gj
=0; j<
G‘Dim
(); j++) {

341 
	gvec
[
j
] +ğ
¿ndomv®ues
[
i
] * 
G‘Eig’Veù
()[j][i];

344 
	gd–‘e
[] 
	g¿ndomv®ues
;

347 
d¿wV®Inv
(* 
vec
){

348 * 
	g¿ndomv®ues
 = 
Ãw
 [
G‘Dim
()];

349 
	gi
=0; i<
G‘Dim
(); i++) {

350 
	g¿ndomv®ues
[
i
] = 
Rªdom
::
sNÜm®
(è/ 
sq¹
(
G‘Eig’V®
()[i]);

351 
	gvec
[
i
]=0;

353 
	gi
=0; i<
G‘Dim
(); i++) {

354 
	gj
=0; j<
G‘Dim
(); j++) {

355 
	gvec
[
j
] +ğ
¿ndomv®ues
[
i
] * 
G‘Eig’Veù
()[j][i];

358 
	gd–‘e
[] 
	g¿ndomv®ues
;

361 
logV®Prob
(* 
dv®
) {

363 
	gtXSX
 = 0;

364 
	gi
=0; i<
G‘Dim
() ; i++) {

365 
	gtXSX
 +ğ
G‘InvM©rix
()[
i
][i] * 
dv®
[i] * dval[i];

366 
	gj
=0; j<
	gi
 ; j++) {

367 
	gtXSX
 +ğ2 * 
G‘InvM©rix
()[
i
][
j
] * 
dv®
[j] * dval[i];

370  -0.5 * (
G‘LogD‘”mšªt
(è+ 
	gtXSX
);

373 
	g´iv©e
:

376 ** 
švv®ue
;

382 ** 
	gu
;

383 ** 
	gšvu
;

384 * 
	gv
;

385 * 
	glogv
;

387 
	gpublic
:

390 * 
G‘Eig’V®
() {

391 ià(! 
dŸgæag
è
DŸgÚ®i£
();

392  
	gv
;

395 * 
G‘LogEig’V®
() {

396 ià(! 
	gdŸgæag
è
DŸgÚ®i£
();

397  
	glogv
;

400 ** 
G‘Eig’Veù
() {

401 ià(! 
	gdŸgæag
) {

402 
DŸgÚ®i£
();

405  
	gu
;

408 
G‘D‘”mšªt
() {

409 
	g»t
 = 1;

410 
	gi
=0; i<
G‘Dim
(); i++) {

411 
	g»t
 *ğ
G‘Eig’V®
()[
i
];

413  
	g»t
;

416 
G‘LogD‘”mšªt
() {

417 
	g»t
 = 0;

418 
	gi
=0; i<
G‘Dim
(); i++) {

419 
	g»t
 +ğ
G‘LogEig’V®
()[
i
];

427  
	g»t
;

430 ** 
G‘InvEig’Veù
() {

431 ià(! 
	gdŸgæag
è
DŸgÚ®i£
();

432  
	gšvu
;

435 
G‘Dim
()const {

436  
	gdim
;

439 
Re£t
() {

440 
	gi
=0; i<
G‘Dim
(); i++) {

441 
	gj
=0; j<
G‘Dim
(); j++) {

442 
	gv®ue
[
i
][
j
] = 0;

447 
S‘Id’t™y
() {

448 
	gi
=0; i<
G‘Dim
(); i++) {

449 
	gj
=0; j<
G‘Dim
(); j++) {

450 
	gv®ue
[
i
][
j
] = 0;

453 
	gi
=0; i<
G‘Dim
(); i++) {

454 
	gv®ue
[
i
][i] = 1;

458 
Projeù
(
šdex
, ** 
m
) {

460 
	gk
 = 0;

461 
	gi
=0; i<
G‘Dim
(); i++) {

462 ià(
	gi
 !ğ
šdex
) {

463 
l
 = 0;

464 
	gj
=0; j<
G‘Dim
(); j++) {

465 ià(
	gj
 !ğ
šdex
) {

466 
m
[
k
][
l
] = 
v®ue
[
i
][
j
] - v®ue[i][
šdex
] * value[j][index] / value[index][index];

467 
	gl
++;

470 
	gk
++;

540 
SÿÏrMuÉliÿtiÚ
(
sÿl
) {

541 
	gi
=0; i<
G‘Dim
(); i++) {

542 
	gj
=0; j<
G‘Dim
(); j++) {

543 
	gv®ue
[
i
][
j
] *ğ
sÿl
;

546 
	gdŸgæag
 = 
çl£
;

547  
G‘Dim
();

550 ** 
G‘M©rix
() {

551  
	gv®ue
;

554 ** 
G‘M©rix
() const{

555  
	gv®ue
;

558 ** 
G‘InvM©rix
() {

559 ià(! 
	gdŸgæag
è
DŸgÚ®i£
();

560  
	gšvv®ue
;

564 
boŞ
 
isPos™iveDefše
(){

565 ià(! 
	gdŸgæag
è
DŸgÚ®i£
();

566 
boŞ
 
	gr
 = 
Œue
;

567 
	gi
=0; i<
G‘Dim
(); i++){

568 if(
G‘Eig’V®
()[
i
] <= 1e-6){

569 
r
 = 
çl£
;

572  
	gr
;

575 
CÜru±DŸg
() {

576 
	gdŸgæag
 = 
çl£
;

579 
G‘Max
() {

580 
	gmax
 = 0;

581 
	gi
=0; i<
G‘Dim
(); i++) {

582 
	gj
=0; j<
G‘Dim
(); j++) {

583 
	gtmp
 = 
çbs
(
v®ue
[
i
][
j
]);

584 ià(
	gmax
 < 
	gtmp
) {

585 
	gmax
 = 
tmp
;

589  
	gmax
;

593 
Inv”t
(){

594 ** 
	ga
 = 
Ãw
 *[
G‘Dim
()];

595 
	gi
=0; i<
G‘Dim
(); i++) {

596 
	ga
[
i
] = 
Ãw
 [
G‘Dim
()];

600 
	gi
=0; i<
G‘Dim
(); i++) {

601 
	gj
=0; j<
G‘Dim
(); j++) {

602 
	ga
[
i
][
j
] = 
v®ue
[i][j];

608 
	glogd‘
 = 
LšAlg
::
Gauss
(
a
,
G‘Dim
(),
v®ue
);

611 
	gi
=0; i<
G‘Dim
(); i++) {

612 
	gd–‘e
[] 
	ga
[
i
];

614 
	gd–‘e
[] 
	ga
;

615 
	gdŸgæag
 = 
çl£
;

616 ià(
isšf
(
logd‘
)) {

617 
	gû¼
 << "error in cov matrix:‚on invertible\n";

619 
ex™
(1);

624 
CheckInv”£
() {

625 
	gmax
 = 0;

626 
	gi
=0; i<
G‘Dim
(); i++) {

627 
	gj
=0; j<
G‘Dim
(); j++) {

628 
	gtÙ
 = 0;

629 
	gk
=0; k<
G‘Dim
(); k++) {

630 
	gtÙ
 +ğ
v®ue
[
i
][
k
] * 
G‘InvM©rix
()[k][
j
];

632 ià(
	gi
 =ğ
j
) {

633 
tÙ
 --;

635 ià(
	gmax
 < 
çbs
(
tÙ
)) {

636 
	gmax
 = 
çbs
(
tÙ
);

640  
	gmax
;

644 
DŸgÚ®i£
() {

645 
	gnmax
 = 1000;

646 
	g•sÚ
 = 1e-10;

648 
	gn
 = 
LšAlg
::
DŸgÚ®izeSymm‘ricM©rix
(
v®ue
,
dim
,
nmax
,
•sÚ
,
v
,
u
);

649 ià(
	gmaxn
 < 
	gn
) {

650 
	gmaxn
 = 
n
;

652 
boŞ
 
	gçed
 = (
n
 =ğ
nmax
);

653 ià(
	gçed
) {

654 
	gû¼
 << "diag failed\n";

655 
	gû¼
 << 
	gn
 << '\n';

656 
	gi
=0; i<
	gdim
; i++) {

657 
	gj
=0; j<
	gdim
; j++) {

658 
	gû¼
 << 
	gv®ue
[
i
][
j
] << '\t';

660 
	gû¼
 << '\n';

662 
ex™
(1);

666 
	gi
=0; i<
	gdim
; i++) {

667 
	gtÙ®
 = 0;

668 
	gj
=0; j<
	gdim
; j++) {

669 
	gtÙ®
 +ğ
u
[
j
][
i
] * u[j][i];

673 
	gi
=0; i<
	gdim
; i++) {

674 
	gj
=0; j<
	gdim
; j++) {

675 
	gšvu
[
j
][
i
] = 
u
[i][j];

679 
	gi
=0; i<
G‘Dim
(); i++) {

680 
	glogv
[
i
] = 
log
(
v
[i]);

683 
	gLšAlg
::
Gauss
(
v®ue
,
G‘Dim
(),
švv®ue
);

685 
	gdŸgæag
 = 
Œue
;

686 
	gtmp
 = 
CheckDŸg
();

687 ià(
	gmax”rÜ
 < 
	gtmp
) {

688 
	gmax”rÜ
 = 
tmp
;

690 
	gtÙ”rÜ
 +ğ
tmp
;

691 
	gndŸg
 ++;

692  
	gçed
;

856 
CheckDŸg
() {

857 ** 
	ga
 = 
Ãw
 *[
G‘Dim
()];

858 ** 
	gb
 = 
Ãw
 *[
G‘Dim
()];

859 
	gi
=0; i<
G‘Dim
(); i++) {

860 
	ga
[
i
] = 
Ãw
 [
G‘Dim
()];

861 
	gb
[
i
] = 
Ãw
 [
G‘Dim
()];

890 
	gi
=0; i<
G‘Dim
(); i++) {

891 
	gj
=0; j<
G‘Dim
(); j++) {

892 
	gtÙ
 = 0;

893 
	gk
=0; k<
G‘Dim
(); k++) {

894 
	gtÙ
 +ğ
švu
[
i
][
k
] * 
G‘M©rix
()[k][
j
];

896 
	ga
[
i
][
j
] = 
tÙ
;

900 
	gmax
 = 0;

903 
	gi
=0; i<
G‘Dim
(); i++) {

904 
	gj
=0; j<
G‘Dim
(); j++) {

905 
	gtÙ
 = 0;

906 
	gk
=0; k<
G‘Dim
(); k++) {

907 
	gtÙ
 +ğ
a
[
i
][
k
] * 
u
[k][
j
];

909 
	gb
[
i
][
j
] = 
tÙ
;

910 ià(
	gi
 !ğ
j
) {

911 ià(
max
 < 
çbs
(
tÙ
)) {

912 
max
 = 
çbs
(
tÙ
);

935 
	gi
=0; i<
G‘Dim
(); i++) {

936 
	gd–‘e
[] 
	ga
[
i
];

937 
	gd–‘e
[] 
	gb
[
i
];

939 
	gd–‘e
[] 
	ga
;

940 
	gd–‘e
[] 
	gb
;

942  
	gmax
;

972 
Sÿ‰”izeOnZ”o
(** 
šV®ues
, 
Nv®
){

973 
	gi
=0; i<
G‘Dim
(); i++) {

974 
	gj
=0; j<
G‘Dim
(); j++) {

975 
	gv®ue
[
i
][
j
] = 0;

976 
	gl
=0;†<
	gNv®
;†++) {

977 
	gv®ue
[
i
][
j
] +ğ
šV®ues
[
l
][i] * inValues[l][j];

981 
	gdŸgæag
 = 
çl£
;

984 
Sÿ‰”izeOnZ”o
(
V¬A¼ay
<
R—lVeùÜ
>* 
šV®ues
){

985 
	gNv®
 = 
šV®ues
->
G‘Size
();

986 
	gi
=0; i<
G‘Dim
(); i++) {

987 
	gj
=0; j<
G‘Dim
(); j++) {

988 
	gv®ue
[
i
][
j
] = 0;

989 
	gl
=0;†<
	gNv®
;†++) {

990 
	gv®ue
[
i
][
j
] +ğ(*
šV®ues
->
G‘V®
(
l
))[i] * (*inValues->GetVal(l))[j];

994 
	gdŸgæag
 = 
çl£
;

997 
PrštCÜ»ÏtiÚCÛffic›Ás
(
o¡»am
& 
os
) {

998 
	gi
=0; i<
G‘Dim
(); i++) {

999 
	gj
=0; j<
G‘Dim
(); j++) {

1000 ià(
	gi
==
j
) {

1001 
os
 << "\t-";

1004 
	gos
 << '\t' << 
G‘M©rix
()[
i
][
j
] / 
sq¹
(GetMatrix()[i][i] * GetMatrix()[j][j]);

1007 
	gos
 << '\n';

1011 
PrštEig’VeùÜs
(
o¡»am
& 
os
) {

1012 
	gos
 << "val";

1013 
	gj
=0; j<
G‘Dim
(); j++) {

1014 
	gos
 << '\t' << 
	gj
;

1016 
	gos
 << '\n';

1017 
	gi
=0; i<
G‘Dim
(); i++) {

1018 
	gos
 << 
	gv
[
i
] << '\t';

1019 
	gj
=0; j<
G‘Dim
(); j++) {

1020 
	gos
 << '\t' << 
	gu
[
i
][
j
];

1022 
	gos
 << '\n';

1024 
	gos
 << '\n';

1025 
	gos
 << "inverseƒigenvector matrix\n";

1026 
	gi
=0; i<
G‘Dim
(); i++) {

1027 
	gj
=0; j<
G‘Dim
(); j++) {

1028 
	gos
 << '\t' << 
	gšvu
[
i
][
j
];

1030 
	gos
 << '\n';

1032 
	gos
 << '\n';

1035 ** 
	g´İ
 = 
Ãw
 *[
G‘Dim
()];

1036 
	gi
=0; i<
G‘Dim
(); i++) {

1037 
	g´İ
[
i
] = 
Ãw
 [
G‘Dim
()];

1039 
	gi
=0; i<
G‘Dim
(); i++) {

1040 
	gtÙ®
 = 0;

1041 
	gj
=0; j<
G‘Dim
(); j++) {

1042 
	g´İ
[
i
][
j
] = 
švu
[j][i] * invu[j][i] * 
v
[j];

1045 
	gtÙ®
 +ğ
´İ
[
i
][
j
];

1047 
	gj
=0; j<
G‘Dim
(); j++) {

1048 
	g´İ
[
i
][
j
] /ğ
tÙ®
;

1051 
	gos
 << "proportion of varianceƒxplained\n";

1052 
	gi
=0; i<
G‘Dim
(); i++) {

1053 
	gos
 << 
	gi
;

1054 
	gj
=0; j<
G‘Dim
(); j++) {

1055 
	gos
 << '\t' << 
	g´İ
[
i
][
j
];

1057 
	gos
 << '\n';

1059 
	gos
 << '\n';

1060 
	gi
=0; i<
G‘Dim
(); i++) {

1061 
	gd–‘e
[] 
	g´İ
[
i
];

1063 
	gd–‘e
[] 
	g´İ
;

1067 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, cÚ¡ 
	gCovM©rix
& 
	gr
) {

1068 
	gi
=0; i<
	gr
.
G‘Dim
(); i++) {

1069 
	gj
=0; j<
	gr
.
G‘Dim
(); j++) {

1070 
	gos
 << '\t' << 
	gr
.
G‘M©rix
()[
i
][
j
];

1072 
	gos
 << '\n';

1074  
	gos
;

1077 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gCovM©rix
& 
	gr
) {

1078 
	gi
=0; i<
	gr
.
G‘Dim
(); i++) {

1079 
	gj
=0; j<
	gr
.
G‘Dim
(); j++) {

1080 
	gis
 >> 
	gr
.
	gv®ue
[
i
][
j
];

1083  
	gis
;

	@DAGnode.cpp

2 
	~<®gÜ™hm
>

4 
	~"Rªdom.h
"

5 
	~"ProbMod–.h
"

6 
	~"RªdomSubM©rix.h
"

8 
boŞ
 
	gDAGnode
::
š™mode
 = 
Œue
;

16 cÚ¡ 
	gMCMC
::
MAXDIFF
 = 1e-4;

18 
	gDAGnode
::~
	$DAGnode
() {

19 
	`D‘ach
();

20 
	}
}

22 
	gDAGnode
::
	$G‘Chd»nNumb”
() {

23 
tÙ
 = 0;

24 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

25 
tÙ
++;

27  
tÙ
;

28 
	}
}

30 
	gDAGnode
::
	$D‘ach
() {

31 
up
.
	`size
()) {

32 
	`D”egi¡”From
(*
up
.
	`begš
());

34 
down
.
	`size
()) {

35 (*
down
.
	`begš
())->
	`D”egi¡”From
(
this
);

42 
	}
}

44 
	gDAGnode
::
	$D”egi¡”From
(
DAGnode
* 
·»Á
) {

45 ià(
·»Á
) {

46 
·»Á
->
down
.
	`”a£
(
this
);

47 
up
.
	`”a£
(
·»Á
);

49 
	}
}

51 
	gDAGnode
::
	$Regi¡”
(
DAGnode
* 
·»Á
) {

52 ià(
·»Á
) {

53 
·»Á
->
down
.
	`š£¹
(
this
);

54 
up
.
	`š£¹
(
·»Á
);

56 
	}
}

58 
	gDAGnode
::
	$RecursiveRegi¡”
(
ProbMod–
* 
mod–
) {

59 
ş™
 
i
=
up
.
	`begš
();

60 (
i
!=
up
.
	`’d
()è&& (*i)->
æag
) i++;

61 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

63 
ş™
 
i
=
up
.
	`begš
(); i!=up.
	`’d
(); i++) {

64 
up_ok
 &ğ(*
i
)->
æag
;

66 ià(
up_ok
) {

67 
mod–
->
	`Regi¡”
(
this
);

68 
æag
 = 
Œue
;

69 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

70 (*
i
)->
	`RecursiveRegi¡”
(
mod–
);

73 
	}
}

75 
boŞ
 
	gDAGnode
::
	$CheckUpd©eFÏgs
() {

76 
boŞ
 
»t
 = 
æag
;

77 ià(! 
æag
) {

78 
û¼
 << "æagƒ¼Ü : " << 
	`G‘Name
() << '\n';

80 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

81 
»t
 &ğ(*
i
)->
	`CheckUpd©eFÏgs
();

83  
»t
;

84 
	}
}

96 
	gRnode
::
	$CÜru±
(
boŞ
 
bk
) {

97 
v®ue_upd©ed
 = 
çl£
;

98 
	`loÿlCÜru±
(
bk
);

99 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

100 (*
i
)->
	`NÙifyCÜru±
(
bk
);

102 
	}
}

104 
	gRnode
:: 
	$NÙifyCÜru±
(
boŞ
 
bk
) {

105 
	`loÿlCÜru±
(
bk
);

106 
	}
}

108 
	gRnode
::
	$loÿlCÜru±
(
boŞ
 
bk
) {

109 ià(
bk
) {

110 
bklog´ob
 = 
log´ob
;

112 
æag
 = 
çl£
;

113 
	}
}

115 
	gRnode
::
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
) {

116 
loÿlCÜru±
(
Œue
);

117 ià(
	gm
.
fšd
(
this
è=ğ
m
.
’d
()) {

118 
m
[
this
] = 1;

119 
ş™
 
	gi
=
down
.
begš
(); i!=down.
’d
(); i++) {

120 (*
	gi
)->
FuÎCÜru±
(
m
);

129 
	gRnode
::
	$Upd©e
() {

130 
»t
 = 0;

131 ià(! 
æag
) {

132 
ş™
 
i
=
up
.
	`begš
();

133 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

134 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

142 ià(
up_ok
) {

143 
»t
 = 
	`loÿlUpd©e
();

144 
v®ue_upd©ed
 = 
Œue
;

145 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

146 
»t
 +ğ(*
i
)->
	`NÙifyUpd©e
();

150  
»t
;

151 
	}
}

153 
	gRnode
::
	$NÙifyUpd©e
() {

154 
»t
 = 0;

155 ià(! 
æag
) {

156 
ş™
 
i
=
up
.
	`begš
();

157 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

158 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

169 ià(
up_ok
) {

170 
»t
 = 
	`loÿlUpd©e
();

171 ià(! 
v®ue_upd©ed
) {

172 
v®ue_upd©ed
 = 
Œue
;

173 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

174 
»t
 +ğ(*
i
)->
	`NÙifyUpd©e
();

179  
»t
;

180 
	}
}

182 
	gRnode
::
	$loÿlUpd©e
() {

183 
log´ob
 = 
	`logProb
();

184 
æag
 = 
Œue
;

185  
log´ob
-
bklog´ob
;

186 
	}
}

188 
	gRnode
::
	$FuÎUpd©e
(
boŞ
 
check
) {

189 
»t
 = 0;

190 ià(! 
æag
) {

191 
ş™
 
i
=
up
.
	`begš
();

192 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

193 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

201 ià(
up_ok
) {

202 
»t
 = 
	`loÿlUpd©e
();

203 
v®ue_upd©ed
 = 
Œue
;

204 ià((
	`çbs
(
»t
)>
MCMC
::
MAXDIFF
è&& 
check
) {

205 
û¼
 << "NON ZERO CHECKSUM : " << 
	`G‘Name
() << '\n';

206 
û¼
 << "numb” oà·»Á : " << 
up
.
	`size
() << '\n';

207 
throw
 
	`CheckSumExû±iÚ
(
»t
);

209 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

210 
»t
 +ğ(*
i
)->
	`FuÎUpd©e
(
check
);

214  
»t
;

216 
	}
}

241 
	gRnode
::
	$Re¡Üe
() {

242 ià(! 
æag
) {

243 
ş™
 
i
=
up
.
	`begš
();

244 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

245 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

253 ià(
up_ok
) {

254 
	`loÿlRe¡Üe
();

255 
v®ue_upd©ed
 = 
Œue
;

256 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

257 (*
i
)->
	`NÙifyRe¡Üe
();

261 
	}
}

263 
	gRnode
::
	$NÙifyRe¡Üe
() {

264 ià(! 
æag
) {

265 
ş™
 
i
=
up
.
	`begš
();

266 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

267 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

275 ià(
up_ok
) {

276 
	`loÿlRe¡Üe
();

277 ià(! 
v®ue_upd©ed
) {

278 
v®ue_upd©ed
 = 
Œue
;

279 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

280 (*
i
)->
	`NÙifyRe¡Üe
();

285 
	}
}

287 
	gRnode
::
	$loÿlRe¡Üe
() {

288 
log´ob
 = 
bklog´ob
;

295 
æag
 = 
Œue
;

296 
	}
}

309 
	gDnode
::
	$CÜru±
(
boŞ
 
bk
) {

310 
	`loÿlCÜru±
(
bk
);

311 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

312 (*
i
)->
	`NÙifyCÜru±
(
bk
);

314 
	}
}

316 
	gDnode
:: 
	$NÙifyCÜru±
(
boŞ
 
bk
) {

317 
	`CÜru±
(
bk
);

318 
	}
}

320 
	gDnode
::
	$loÿlCÜru±
(
boŞ
 
bk
) {

321 
æag
 = 
çl£
;

322 
	}
}

324 
	gDnode
::
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
) {

325 
loÿlCÜru±
(
Œue
);

326 ià(
	gm
.
fšd
(
this
è=ğ
m
.
’d
()) {

327 
m
[
this
] = 1;

328 
ş™
 
	gi
=
down
.
begš
(); i!=down.
’d
(); i++) {

329 (*
	gi
)->
FuÎCÜru±
(
m
);

338 
	gDnode
::
	$Upd©e
() {

339 
»t
 = 0;

340 ià(! 
æag
) {

341 
ş™
 
i
=
up
.
	`begš
();

342 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

343 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

351 ià(
up_ok
) {

352 
»t
 = 
	`loÿlUpd©e
();

353 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

354 
»t
 +ğ(*
i
)->
	`NÙifyUpd©e
();

358  
»t
;

359 
	}
}

361 
	gDnode
::
	$NÙifyUpd©e
() {

362  
	`Upd©e
();

363 
	}
}

365 
	gDnode
::
	$loÿlUpd©e
() {

366 
	`¥ecŸlUpd©e
();

367 
æag
 = 
Œue
;

369 
	}
}

371 
	gDnode
::
	$FuÎUpd©e
(
boŞ
 
check
) {

372 
»t
 = 0;

373 ià(! 
æag
) {

374 
ş™
 
i
=
up
.
	`begš
();

375 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

376 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

384 ià(
up_ok
) {

385 
»t
 = 
	`loÿlUpd©e
();

386 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

387 
»t
 +ğ(*
i
)->
	`FuÎUpd©e
(
check
);

391  
»t
;

392 
	}
}

415 
	gDnode
::
	$Re¡Üe
() {

416 ià(! 
æag
) {

417 
ş™
 
i
=
up
.
	`begš
();

418 (
i
!=
up
.
	`’d
()è&& ((*i)->
	`isV®ueUpd©ed
())) i++;

419 
boŞ
 
up_ok
 = (
i
 =ğ
up
.
	`’d
());

427 ià(
up_ok
) {

428 
	`loÿlRe¡Üe
();

429 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

430 (*
i
)->
	`NÙifyRe¡Üe
();

434 
	}
}

436 
	gDnode
::
	$NÙifyRe¡Üe
() {

437 
	`Re¡Üe
();

438 
	}
}

440 
	gDnode
::
	$loÿlRe¡Üe
() {

441 
æag
 = 
Œue
;

442 
	}
}

455 
	gMnode
::
	$CÜru±
(
boŞ
 
bk
) {

456 
æag
 = 
çl£
;

457 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

458 (*
i
)->
	`CÜru±
(
bk
);

460 
	}
}

466 
	gMnode
::
	$Upd©e
() {

467 
æag
 = 
Œue
;

468 
»t
 = 0;

469 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

470 
»t
 +ğ(*
i
)->
	`Upd©e
();

472  
»t
;

473 
	}
}

479 
	gMnode
::
	$Re¡Üe
() {

480 
æag
 = 
Œue
;

481 
ş™
 
i
=
down
.
	`begš
(); i!=down.
	`’d
(); i++) {

482 (*
i
)->
	`Re¡Üe
();

484 
	}
}

	@DAGnode.h

2 #iâdeà
RNODE_H


3 
	#RNODE_H


	)

5 
	~<£t
>

7 
	~<m­
>

9 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	~"Rªdom.h
"

11 
	~"MCMC.h
"

13 
şass
 
	gDAGnode
;

14 
şass
 
	gProbMod–
;

16 
	g£t
<
	tDAGnode
*>::
	tcÚ¡_™”©Ü
 
	tş™
;

19 şas 
	cDAGnode
 {

21 
	mpublic
:

23 
boŞ
 
š™mode
;

25 
ä›nd
 
şass
 
	mProbMod–
;

26 
ä›nd
 
şass
 
	mRnode
;

27 
ä›nd
 
şass
 
	mDnode
;

29 
	$DAGnode
(è: 
	`æag
(
çl£
), 
	`Çme
("") {}

30 
vœtu®
 ~
	`DAGnode
();

34 
	$G‘ChdNumb”
(è{ 
down
.
	`size
();
	}
}

36 
	$S‘Name
(
¡ršg
 
šÇme
è{ 
Çme
 = iÂame;
	}
}

37 
¡ršg
 
	$G‘Name
(è{ 
Çme
;
	}
}

39 
vœtu®
 
Regi¡”
(
DAGnode
* 
š
);

42 
RecursiveRegi¡”
(
ProbMod–
* 
mod–
);

44 
boŞ
 
CheckUpd©eFÏgs
();

45 
G‘Chd»nNumb”
();

49 
vœtu®
 
CÜru±
(
boŞ
 
bk
) = 0;

50 
vœtu®
 
Upd©e
() = 0;

51 
vœtu®
 
Re¡Üe
() = 0;

53 
boŞ
 
	$isUpd©ed
(è{ 
æag
;
	}
}

54 
vœtu®
 
boŞ
 
	$isV®ueUpd©ed
(è{ 
æag
;
	}
}

56 
vœtu®
 
NÙifyCÜru±
(
boŞ
 
bk
) = 0;

57 
vœtu®
 
NÙifyUpd©e
() = 0;

58 
vœtu®
 
NÙifyRe¡Üe
() = 0;

61 
vœtu®
 
FuÎUpd©e
(
boŞ
 
check
 = 
çl£
) = 0;

62 
vœtu®
 
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
) = 0;

66 
	g´Ùeùed
:

68 
public
:

69 
£t
<
DAGnode
*> 
up
;

70 
	g£t
<
	gDAGnode
*> 
	gdown
;

72 
D‘ach
();

73 
D”egi¡”From
(
DAGnode
* 
·»Á
);

75 
boŞ
 
	gæag
;

76 
¡ršg
 
	gÇme
;

80 
şass
 
	gRnode
 : 
public
 
vœtu®
 
DAGnode
,…ubliø
	gMH
 {

82 
	gpublic
:

84 
Rnode
(è: 
log´ob
(0), 
bklog´ob
(0), 
v®ue_upd©ed
 (
çl£
) {}

86 
vœtu®
 
G‘Fa¡LogProb
(è{ (
	gæag
 ? 
	glog´ob
 : 
logProb
());}

88 
vœtu®
 
G‘LogProb
(è{  
logProb
();}

96 
vœtu®
 
Move
(
tunšg
 = 1) {

97 ià(! 
isCÏm³d
()) {

98 
CÜru±
(
Œue
);

99 
	glogHa¡šgs
 = 
Prİo£Move
(
tunšg
);

100 
	gd–LogProb
 = 
Upd©e
();

101 
	glogR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

102 
boŞ
 
	gacû±ed
 = (
log
(
Rªdom
::
UnifÜm
()è< 
logR©io
);

103 ià(! 
	gacû±ed
) {

104 
CÜru±
(
çl£
);

105 
Re¡Üe
();

107  (è
	gacû±ed
;

112 
vœtu®
 
CÜru±
(
boŞ
 
bk
);

113 
vœtu®
 
Upd©e
();

114 
vœtu®
 
Re¡Üe
();

117 
vœtu®
 
NÙifyCÜru±
(
boŞ
 
bk
);

118 
vœtu®
 
NÙifyUpd©e
();

119 
vœtu®
 
NÙifyRe¡Üe
();

121 
vœtu®
 
FuÎUpd©e
(
boŞ
 
check
 = 
çl£
);

122 
vœtu®
 
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
);

138 
boŞ
 
isV®ueUpd©ed
(è{ 
	gv®ue_upd©ed
;}

140 
vœtu®
 
loÿlUpd©e
();

142 
	g´Ùeùed
:

144 
vœtu®
 
logProb
() = 0;

146 
vœtu®
 
Re¡ÜeBackup
() {}

148 
vœtu®
 
loÿlRe¡Üe
();

149 
vœtu®
 
loÿlCÜru±
(
boŞ
 
bk
);

151 
	glog´ob
;

152 
	gbklog´ob
;

153 
boŞ
 
	gv®ue_upd©ed
;

156 şas 
	cDnode
 : 
public
 
vœtu®
 
DAGnode
 {

158 
public
:

160 
vœtu®
 
CÜru±
(
boŞ
 
bk
);

161 
vœtu®
 
Upd©e
();

162 
vœtu®
 
Re¡Üe
();

164 
vœtu®
 
loÿlUpd©e
();

166 
vœtu®
 
¥ecŸlUpd©e
() = 0;

168 
vœtu®
 
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
);

169 
vœtu®
 
FuÎUpd©e
(
boŞ
 
check
 = 
çl£
);

171 
	m´Ùeùed
:

173 
vœtu®
 
NÙifyCÜru±
(
boŞ
 
bk
);

174 
vœtu®
 
NÙifyUpd©e
();

175 
vœtu®
 
NÙifyRe¡Üe
();

180 
vœtu®
 
loÿlRe¡Üe
();

181 
vœtu®
 
loÿlCÜru±
(
boŞ
 
bk
);

185 şas 
	cMnode
 : 
public
 
vœtu®
 
DAGnode
 {

187 
public
:

189 
	$Mnode
(
boŞ
 
šæag
 = 
Œue
) {

190 
æag
 = 
šæag
;

193 
vœtu®
 
	`CÜru±
(
boŞ
 
bk
);

194 
vœtu®
 
	`Upd©e
();

195 
vœtu®
 
	`Re¡Üe
();

197 
´Ùeùed
:

199 
vœtu®
 
	$NÙifyCÜru±
(
boŞ
 
bk
è{
	}
}

200 
vœtu®
 
	$NÙifyUpd©e
(è{ 0;
	}
}

201 
vœtu®
 
	$NÙifyRe¡Üe
(è{
	}
}

203 
vœtu®
 
	$FuÎUpd©e
(
boŞ
 
check
 = 
çl£
è{ 0;
	}
}

204 
vœtu®
 
FuÎCÜru±
(
m­
<
DAGnode
*,>& 
m
) {}

	@DrawTree.cpp

2 
	~"D¿wT»e.h
"

3 
	~<s¡»am
>

4 
	~<io¡»am
>

5 
	~<f¡»am
>

6 
	~<cm©h
>

7 
	~"SŒšgSŒ—mUts.h
"

11 
	gD¿wT»e
::
	$RecursiveCompu‹Size
(cÚ¡ 
Lšk
* 
äom
) {

12 ià(
äom
->
	`isL—f
()) {

13 
size
[
äom
] = 1;

16 
tÙ
 = 0;

17 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

18 
tÙ
 +ğ
	`RecursiveCompu‹Size
(
lšk
->
	`Out
());

20 
size
[
äom
] = 
tÙ
;

22  
size
[
äom
];

23 
	}
}

25 
	gD¿wT»e
::
	$RecursiveCompu‹D•th
(cÚ¡ 
Lšk
* 
äom
) {

26 ià(
äom
->
	`isL—f
()) {

27 
d•th
[
äom
] = 
	`G‘L’gth
(from);

30 
max
=0;

31 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

32 
tmp
 = 
	`RecursiveCompu‹D•th
(
lšk
->
	`Out
());

33 ià(
max
 < 
tmp
) {

34 
max
 = 
tmp
;

37 
max
 +ğ
	`G‘L’gth
(
äom
);

38 
d•th
[
äom
] = 
max
;

40  
d•th
[
äom
];

41 
	}
}

43 
	gD¿wT»e
::
	$D¿w
(
¡ršg
 
rg‘
) {

45 
¡ršg
 
‹xfe
 = 
rg‘
 + ".tex";

46 
of¡»am
 
	`os
(
‹xfe
.
	`c_¡r
());

48 ià(
h—d”
) {

49 
os
 << "\\documentclass{";

50 ià(
b—m”
) {

51 
os
 << "beamer";

54 
os
 << "amsart";

56 
os
 << "}\n";

58 
os
 << "\\usepackage{times}\n";

59 
os
 << "\\usepackage{pgf}\n";

60 
os
 << "\\usepackage[english]{babel}\n";

61 
os
 << "\\usepackage{tikz}\n";

62 
os
 << "\\usepackage{nopageno}\n";

63 
os
 << '\n';

65 
os
 << "\\begin{document}\n";

66 ià(
b—m”
) {

67 
os
 << "\\begin{frame}[plain]\n";

69 
os
 << "\\begin{center}\n";

72 
os
 << "\\begin{center}\n";

75 
	`P»·»D¿wšg
();

77 
sÿËX
 = 
sizeX
 / 
	`G‘D•th
();

78 
¡¬tX
 = (
	`G‘D•th
(è- G‘D•th(
	`G‘RoÙ
())è* 
sÿËX
;

79 
sÿËY
 = 
sizeY
 / (
	`G‘Size
(
	`G‘RoÙ
()) - 1);

81 
os
 << "\\begin{tikzpicture}\n";

82 
os
 << "[ªchÜ=we¡,fÚt=\\fÚtsize{" << 
fÚtsize
 << "}{" << fÚtsiz<< "}\\£ËùfÚt,sÿË=" << 
‹xsÿË
<< "]\n";

84 
os
 << '\n';

86 
	`RecursiveD¿w
(
	`G‘RoÙ
(),
os
,
¡¬tX
,
sizeY
/2,
sÿËX
,
sÿËY
);

88 
	`RecursiveAá”D¿w
(
	`G‘RoÙ
(),
os
,
¡¬tX
,
sizeY
/2,
sÿËX
,
sÿËY
);

90 ià(
Z
) {

91 
û¼
 << "write group‚ames\n";

92 
	`Wr™eGroupNames
(
os
);

95 
	`FšishD¿wšg
(
os
,
sÿËX
,
sÿËY
);

98 
os
 << '\n';

99 
os
 << "\\end{tikzpicture}\n";

101 ià(
h—d”
) {

102 
os
 << "\\end{center}\n";

103 ià(
b—m”
) {

104 
os
 << "\\end{frame}\n";

106 
os
 << "\\end{document}\n";

109 
os
 << "\\end{center}\n";

111 
os
.
	`şo£
();

113 
	}
}

115 
	gD¿wT»e
::
	$P»·»D¿wšg
() {

117 
	`Compu‹Size
();

118 
	`Compu‹D•th
();

119 
	}
}

121 
	gD¿wT»e
::
	$Wr™eGroupNames
(
o¡»am
& 
os
) {

123 
m­
<cÚ¡ 
Node
*,
¡ršg
>::
™”©Ü
 
i
=
grou²ame
.
	`begš
(); i!=grou²ame.
	`’d
(); i++) {

125 cÚ¡ 
Node
* 
node
 = 
i
->
fœ¡
;

126 
¡ršg
 
Çme
 = 
i
->
£cÚd
;

127 ià(
grou±ext
[
node
]) {

128 
û¼
 << 
Çme
 << '\n';

129 
x
 = 
sizeX
 + 
Z
;

130 
y
 = 
groupy
[
node
];

131 
û¼
 << 
x
 << '\t' << 
y
 << '\n';

132 
os
 << "\\·th [ªchÜ=we¡] (" << 
	`‹x­´ox
(
x
è<< "," <<ex­´ox(
y
è<< "ènode[fÚt=\\fÚtsize{" << 
groupfÚtsize
 << "}{" << groupfÚtsiz<< "}\\£ËùfÚt] {" << 
Çme
 << " };\n";

135 
	}
}

137 
	gD¿wT»e
::
	$RecursiveD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
X
, 
Y
, 
sÿËX
, 
sÿËY
) {

144 
»t
 = 0;

146 ià(
äom
->
	`isL—f
()) {

147 ià(
w™hËaâames
) {

149 
os
 << "\\·th (" << 
	`‹x­´ox
(
X
è+ 
shiáÇme
 << "," <<ex­´ox(
Y
è<< "ènod{ " << 
	`G‘P»L—fNodeName
(
äom
è<< " \\, " << "\\™ " << 
	`G‘L—fNodeName
(from) << " };\n";

152 
»t
 = 
Y
;

157 
y
 = 
Y
 - 0.5 * 
	`G‘Size
(
äom
è* 
sÿËY
;

159 ià(
grou²ame
[
äom
->
	`G‘Node
()] != "") {

160 
groupy
[
äom
->
	`G‘Node
()] = 
Y
;

163 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();

164 
yfœ¡
 = 0;

165 
yÏ¡
 = 0;

167 
lšk
 !ğ
äom
) {

170 
xoff£t
 = 
	`G‘L’gth
(
lšk
è* 
sÿËX
;

173 
y¥ª
 = 
	`G‘Size
(
lšk
->
	`Out
()è* 
sÿËY
;

176 
y
 +ğ0.5 * 
y¥ª
;

179 
x
 = 
X
 + 
xoff£t
;

180 
dowÄ‘
 = 
	`RecursiveD¿w
(
lšk
->
	`Out
(), 
os
, 
x
, 
y
, 
sÿËX
, 
sÿËY
);

183 
	`LoÿlD¿wB¿nch
(
lšk
,
os
,
X
,
dowÄ‘
,
xoff£t
);

185 
	`LoÿlD¿w
(
lšk
,
os
,
x
,
dowÄ‘
,
sÿËX
,
sÿËY
);

187 ià(
lšk
 =ğ
äom
->
	`Next
()) {

188 
yfœ¡
 = 
dowÄ‘
;

191 ià(
lšk
->
	`Next
(è=ğ
äom
) {

192 
yÏ¡
 = 
dowÄ‘
;

196 
y
 +ğ0.5 * 
y¥ª
;

198 
lšk
 =†šk->
	`Next
();

202 
	`LoÿlD¿wV”tiÿlT¿™
(
äom
, 
os
, 
X
, 
yfœ¡
, 
yÏ¡
);

204 
»t
 = (
yfœ¡
 + 
yÏ¡
) / 2;

206 ià(
äom
->
	`isRoÙ
()) {

207 
	`LoÿlD¿w
(
äom
,
os
,
X
,
»t
,
sÿËX
,
sÿËY
);

208 
	`LoÿlD¿wB¿nch
(
äom
,
os
,
X
,
»t
,0);

211  
»t
;

212 
	}
}

214 
	gD¿wT»e
::
	$RecursiveAá”D¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
X
, 
Y
, 
sÿËX
, 
sÿËY
) {

221 
»t
 = 0;

223 ià(
äom
->
	`isL—f
()) {

224 
»t
 = 
Y
;

229 
y
 = 
Y
 - 0.5 * 
	`G‘Size
(
äom
è* 
sÿËY
;

231 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();

232 
yfœ¡
 = 0;

233 
yÏ¡
 = 0;

235 
lšk
 !ğ
äom
) {

238 
xoff£t
 = 
	`G‘L’gth
(
lšk
è* 
sÿËX
;

241 
y¥ª
 = 
	`G‘Size
(
lšk
->
	`Out
()è* 
sÿËY
;

244 
y
 +ğ0.5 * 
y¥ª
;

247 
x
 = 
X
 + 
xoff£t
;

248 
dowÄ‘
 = 
	`RecursiveAá”D¿w
(
lšk
->
	`Out
(), 
os
, 
x
, 
y
, 
sÿËX
, 
sÿËY
);

250 
	`LoÿlAá”D¿w
(
lšk
->
	`Out
(),
os
,
x
,
dowÄ‘
,
sÿËX
,
sÿËY
);

252 ià(
lšk
 =ğ
äom
->
	`Next
()) {

253 
yfœ¡
 = 
dowÄ‘
;

256 ià(
lšk
->
	`Next
(è=ğ
äom
) {

257 
yÏ¡
 = 
dowÄ‘
;

261 
y
 +ğ0.5 * 
y¥ª
;

263 
lšk
 =†šk->
	`Next
();

266 
»t
 = (
yfœ¡
 + 
yÏ¡
) / 2;

268 ià(
äom
->
	`isRoÙ
()) {

269 
	`LoÿlAá”D¿w
(
äom
,
os
,
X
,
»t
,
sÿËX
,
sÿËY
);

272  
»t
;

273 
	}
}

275 
	gD¿wT»e
::
	$LoÿlD¿wB¿nch
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
, 
dx
) {

276 ià(! 
lšk
->
	`isRoÙ
()) {

277 
os
 << "\\·th [d¿w] (" << 
	`‹x­´ox
(
x
è<< ',' <<ex­´ox(
y
è<< "è-- +(" <<ex­´ox(
dx
) << ",0);\n";

279 ià((!
lšk
->
	`Out
()->
	`isL—f
()è&& 
w™hnod‘ext
) {

280 
	`Wr™eNodeText
(
lšk
->
	`Out
(),
os
,
x
+
dx
,
y
);

282 
	}
}

284 
	gD¿wT»e
::
	$LoÿlD¿wV”tiÿlT¿™
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y1
, 
y2
) {

285 
os
 << "\\·th [d¿w] (" << 
	`‹x­´ox
(
x
è<< ',' <<ex­´ox(
y1
è<< "è-- +(0," <<ex­´ox(
y2
-y1) << ");\n";

286 
	}
}

288 
	gD¿wT»e
::
	$D¿wNodeText
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
) {

289 ià(! 
lšk
->
	`Out
()->
	`isL—f
()) {

292 
	}
}

295 
	gBubbËT»e
::
	$Compu‹MaxNodeV®
(cÚ¡ 
Lšk
* 
äom
) {

296 
max
 = 0;

297 ià(
äom
->
	`isL—f
()) {

298 
max
 = 
	`çbs
(
	`G‘NodeMax
(
äom
));

301 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

302 
tmp
 = 
	`Compu‹MaxNodeV®
(
lšk
->
	`Out
());

303 ià(
max
 < 
tmp
) {

304 
max
 = 
tmp
;

308 
tmp
 = 
	`G‘NodeMax
(
äom
);

309 ià(
max
 < 
tmp
) {

310 
max
 = 
tmp
;

313  
max
;

314 
	}
}

317 
	gBubbËT»e
::
	$Compu‹MšNodeV®
(cÚ¡ 
Lšk
* 
äom
) {

318 
mš
 = 0;

319 ià(
äom
->
	`isL—f
()) {

320 
mš
 = 
	`çbs
(
	`G‘NodeMš
(
äom
));

323 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

324 
tmp
 = 
	`Compu‹MšNodeV®
(
lšk
->
	`Out
());

325 ià(((! 
äom
->
	`isL—f
()è&& (
lšk
 =ğäom->
	`Next
())è|| (
mš
 > 
tmp
)) {

326 
mš
 = 
tmp
;

329 
tmp
 = 
	`G‘NodeMš
(
äom
);

330 ià(
mš
 > 
tmp
) {

331 
mš
 = 
tmp
;

334  
mš
;

335 
	}
}

337 
	gBubbËT»e
::
	$P»·»D¿wšg
() {

339 
D¿wT»e
::
	`P»·»D¿wšg
();

351 
max
 = 
	`Compu‹MaxNodeV®
(
	`G‘RoÙ
());

352 
nodesÿË
 = 
maxnodev®
 / 
	`exp
(0.5 * 
nod•ow”
 * 
	`log
(
max
));

354 
	}
}

357 
	gBubbËT»e
::
	$Wr™eBubbËText
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
) {

358 
os
 << "\\·th [ªchÜ=we¡] (" << 
	`‹x­´ox
(
x
è<< "," <<ex­´ox(
y
è<< "ènod{" << "(" << 
	`G‘NodeMš
(
lšk
è<< "," << 
	`G‘NodeMax
(link) << ")" << " };\n";

359 
	}
}

361 
	gBubbËT»e
::
	$G‘CœşeNodeMš
(cÚ¡ 
Lšk
* 
lšk
) {

362  
	`­´ox
(
nodesÿË
 * 
	`exp
(0.5 * 
nod•ow”
 * 
	`log
(
	`G‘NodeMš
(
lšk
->
	`Out
()))));

363 
	}
}

365 
	gBubbËT»e
::
	$G‘CœşeNodeMax
(cÚ¡ 
Lšk
* 
lšk
) {

366  
	`­´ox
(
nodesÿË
 * 
	`exp
(0.5 * 
nod•ow”
 * 
	`log
(
	`G‘NodeMax
(
lšk
->
	`Out
()))));

367 
	}
}

369 
	gBubbËT»e
::
	$G‘CœşeNodeV®
(cÚ¡ 
Lšk
* 
lšk
) {

370 
d
 = 0;

382 
d
 = 
	`­´ox
(
nodesÿË
 * 
	`exp
(0.5 * 
nod•ow”
 * 
	`log
(
	`G‘NodeV®
(
lšk
->
	`Out
()))));

384  
d
;

385 
	}
}

387 
	gBubbËT»e
::
	$D¿wNodeBubbË
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
) {

391 
dmš
 = 
	`G‘CœşeNodeMš
(
lšk
);

392 
dmax
 = 
	`G‘CœşeNodeMax
(
lšk
);

393 
û¼
 << 
dmš
 << '\t' << 
dmax
 << '\n';

394 
os
 << "\\·th [flôed,İac™y=0.7,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
x
è<< ',' <<ex­´ox(
y
è<< "ècœş(" << 
dmš
 << "pt);\n";

395 
os
 << "\\·th [flôed,İac™y=0.3,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
x
è<< ',' <<ex­´ox(
y
è<< "ècœş(" << 
dmax
 << "pt);\n";

398 
d
 = 
	`G‘CœşeNodeV®
(
lšk
);

399 ià(
d
 > 0) {

400 
os
 << "\\·th [flôed,İac™y=0.8,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
x
è<< ',' <<ex­´ox(
y
è<< "ècœş(" << 
d
 << "pt);\n";

403 
os
 << "\\·th [fl=blue,İac™y=0.8,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
x
è<< ',' <<ex­´ox(
y
è<< "ècœş(" << -
d
 << "pt);\n";

406 
	}
}

408 
	gBubbËT»e
::
	$FšishD¿wšg
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
) {

410 
dmš
 = (è(
	`log
(
	`Compu‹MšNodeV®
(
	`G‘RoÙ
())) /†og(10.0));

411 
dmax
 = (è(
	`log
(
	`Compu‹MaxNodeV®
(
	`G‘RoÙ
())) /†og(10.0));

412 
û¼
 << "min max\n";

413 
û¼
 << 
	`Compu‹MšNodeV®
(
	`G‘RoÙ
()) << '\n';

414 
û¼
 << 
	`Compu‹MaxNodeV®
(
	`G‘RoÙ
()) << '\n';

415 
û¼
 << 
dmš
 << '\t' << 
dmax
 << '\n';

416 
	`D¿wBubbËSÿË
(
os
, -
sizeX
 / 4, 0.7, 
dmš
, 
dmax
, 1);

418 
	}
}

420 
	gBubbËT»e
::
	$D¿wBubbËSÿË
(
o¡»am
& 
os
, 
x
, 
y
, 
logmš
, 
logmax
, 
log¡•
) {

422 
d–
 = 
nodesÿË
 / 15 * 
	`exp
(0.5 * 
nod•ow”
 * 
logmax
 * 
	`log
(10.0));

423 
yy
 = 
y
;

424 
d
 = 
logmš
; d<=
logmax
; d+ğ
log¡•
) {

425 
m
 = 
nodesÿË
 * 
	`exp
(0.5 * 
nod•ow”
 * 
d
 * 
	`log
(10.0));

426 
os
 << "\\·th [flôed,İac™y=0.8,ªchÜ=ûÁ”] (" << 
x
 << ',' << 
sizeY
 - 
yy
 << "ècœş(" << 
m
 << "pt);\n";

427 
os
 << "\\·th (" << 
x
 << ',' << 
sizeY
 - 
yy
 << "ènod{ " << ((è
	`exp
(
d
 * 
	`log
(10.0))) << " };\n";

428 
yy
 +ğ
d–
;

430 
	}
}

432 
	gChrÚoD¿wT»e
::
	$D¿wTimeIÁ”v®
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

433 ià(! 
lšk
->
	`Out
()->
	`isL—f
()) {

434 ià((! 
Úlygroups
è|| (
grou²ame
[
lšk
->
	`Out
()->
	`G‘Node
()] != "")) {

435 ià(
lšk
->
	`isRoÙ
()) {

438 
tmš
 = 
xsÿË
 * (
	`G‘D•th
(è- 
	`G‘MšTime
(
lšk
->
	`Out
()));

439 
tmax
 = 
xsÿË
 * (
	`G‘D•th
(è- 
	`G‘MaxTime
(
lšk
->
	`Out
()));

444 
off£t
 = 0.5 * 
b¬width
;

451 
cŞÜ
 = 
groupcŞÜ
[
lšk
->
	`Out
()->
	`G‘Node
()];

452 ià(
cŞÜ
 == 0) {

453 
os
 << "\\·th [fl=blue,İac™y=0.5,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
tmš
è<< ',' <<ex­´ox(
y
-
off£t
è<< "è»ùªgË (" <<ex­´ox(
tmax
) << ',' <<exapprox(y+offset) << ");\n";

455 ià(
cŞÜ
 == 1) {

456 
off£t
 *= 1.5;

457 
os
 << "\\·th [fl=blue,İac™y=0.6,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
tmš
è<< ',' <<ex­´ox(
y
-
off£t
è<< "è»ùªgË (" <<ex­´ox(
tmax
) << ',' <<exapprox(y+offset) << ");\n";

459 ià(
cŞÜ
 == 2) {

460 
off£t
 *= 1.5;

461 
os
 << "\\·th [fl=Üªge,İac™y=0.6,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
tmš
è<< ',' <<ex­´ox(
y
-
off£t
è<< "è»ùªgË (" <<ex­´ox(
tmax
) << ',' <<exapprox(y+offset) << ");\n";

463 ià(
cŞÜ
 == 3) {

464 
off£t
 *= 1.5;

465 
os
 << "\\·th [flôed,İac™y=0.6,ªchÜ=ûÁ”] (" << 
	`‹x­´ox
(
tmš
è<< ',' <<ex­´ox(
y
-
off£t
è<< "è»ùªgË (" <<ex­´ox(
tmax
) << ',' <<exapprox(y+offset) << ");\n";

469 
	}
}

471 
	gChrÚoD¿wT»e
::
	$D¿wTimeSÿË
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
) {

475 
roÙmaxage
 = 
	`G‘MaxTime
();

480 
¡•
 = 10;

482 
y
 = -0.04 * 
sizeY
;

483 
dy
ğ0.006 * 
sizeY
;

484 
os
 << "\\·th [d¿w] (" << 
sizeX
 - 
xsÿË
 * (
roÙmaxage
+
¡•
è<< "," << 
y
 << ") -- (" << sizeX << "," << y << ");\n";

485 
tic
 = 0;

486 
age
=0;‡ge<
roÙmaxage
+
¡•
;‡ge += step) {

487 
x
 = 
sizeX
 - 
xsÿË
 * 
age
;

490 
os
 << "\\·th [d¿w] (" << 
x
 << "," << 
y
 + 
dy
 << ") -- +(0," << -2 *dy << ");\n";

492 ià(! (
tic
 % 5)) {

493 
os
 << "\\·th (" << 
x
 << "," << -8 *
dy
 << "ènode[b–ow,fÚt=\\fÚtsize{" << 
groupfÚtsize
 << "}{" << groupfÚtsiz<< "}\\£ËùfÚt] {" << 
tic
 * 10 << "};\n";

495 
tic
 ++;

497 
os
 << "\\·th (" << 
sizeX
 + 0.4 << "," << -8 *
dy
 << "ènode[b–ow,fÚt=\\fÚtsize{" << 
groupfÚtsize
 << "}{" << groupfontsize << "}\\selectfont] {Myr};\n";

500 
roÙage
 = 
	`G‘D•th
();

502 
os
 << "\\·th[d¿w,dashed,thš] (" << 
sizeX
 * (
roÙage
 - 65.0è/„oÙag<< "," << 
y
 << ")-- +(0," << 
sizeY
 - y << ");\n";

503 
os
 << "\\·th (" << 
sizeX
 * (
roÙage
 - 65.0è/„oÙag<< "," << - 8*
dy
 << "ènode[b–ow,fÚt=\\fÚtsize{" << 
groupfÚtsize
 << "}{" << groupfontsize << "}\\selectfont] {\\bf KPg};\n";

504 
	}
}

507 
	gH—tT»e
::
	$D¿wCI
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
) {

509 
m­
<cÚ¡ 
Node
*, >::
™”©Ü
 
imš
 = 
exŠodemš
.
	`fšd
(
lšk
->
	`G‘Node
());

510 
m­
<cÚ¡ 
Node
*, >::
™”©Ü
 
imax
 = 
exŠodemax
.
	`fšd
(
lšk
->
	`G‘Node
());

511 
o¡ršg¡»am
 
s
;

513 
s
.
	`´ecisiÚ
(2);

515 
z
 = 
	`G‘NodeV®
(
lšk
);

516 
s
 << 
fixed
 << 
z
 << " ";

518 
s
 << "(";

519 ià(
imš
 =ğ
exŠodemš
.
	`’d
()) {

520 
s
 << "?";

523 
tmp
 = 
imš
->
£cÚd
;

524 
s
 << 
fixed
 << 
tmp
;

526 
s
 << " , ";

527 ià(
imš
 =ğ
exŠodemax
.
	`’d
()) {

528 
s
 << "?";

531 
tmp
 = 
imax
->
£cÚd
;

532 
s
 << 
fixed
 << 
tmp
;

534 
s
 << ")";

536 
b¿nchfÚtsize
 = 3;

537 
os
 << "\\·th (" << 
	`‹x­´ox
(
x
è<< "," <<ex­´ox(
y
è<< "ènode[above=-2,fÚt=\\fÚtsize{" << 
b¿nchfÚtsize
 << "}{" << b¿nchfÚtsiz<< "}\\£ËùfÚt] {" << 
s
.
	`¡r
() << "};\n";

539 
	}
}

541 
	gH—tT»e
::
	$LoÿlD¿wB¿nch
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
, 
dx
) {

542 ià(! 
lšk
->
	`isRoÙ
()) {

543 
z2
 = 
	`G‘NodeV®
(
lšk
->
	`Out
());

544 
z1
 = 
unib¿nch
 ? 
	`G‘NodeV®
(
lšk
->
	`Out
()) : GetNodeVal(link);

549 
zmid
 = 0.5 * (
z1
 + 
z2
);

550 
¡ršg
 
s1
 = 
	`G‘CŞÜCode
(
z1
);

551 
¡ršg
 
s2
 = 
	`G‘CŞÜCode
(
z2
);

552 
¡ršg
 
smid
 = 
	`G‘CŞÜCode
(
zmid
);

553 
os
 << "\\shade[left color=";

554 
os
 << 
s1
;

555 
os
 << ",„ight color =";

556 
os
 << 
s2
;

557 
os
 << ", middle color = ";

558 
os
 << 
smid
;

559 
os
 << "]";

561 
os
 << " (" << 
	`‹x­´ox
(
x
è<< "," <<ex­´ox(
y
-0.5*
thickÃss
è<< "è»ùªgË (" <<ex­´ox(x+
dx
) << ',' <<exapprox(y+0.5*thickness) << ");\n";

563 ià(
w™hb¿nchv®
) {

564 
xmid
 = 
x
 + 0.5 * 
dx
;

565 
m­
<cÚ¡ 
B¿nch
*,
¡ršg
>::
™”©Ü
 
i
 = 
b¿nchv®
.
	`fšd
(
lšk
->
	`G‘B¿nch
());

567 
o¡ršg¡»am
 
s
;

568 ià(
i
 =ğ
b¿nchv®
.
	`’d
()) {

570 
s
 << "?";

584 
¡ršg
 
tmp
 = 
i
->
£cÚd
;

585 
k
 = 0; k<
tmp
.
	`Ëngth
(); k++) {

586 
c
 = 
tmp
[
k
];

587 ià(
c
 == '/') {

588 
s
 << " / ";

591 
s
 << 
c
;

596 
b¿nchfÚtsize
 = 4;

597 
os
 << "\\·th (" << 
	`‹x­´ox
(
xmid
è<< "," <<ex­´ox(
y
è<< "ènode[above=-2,fÚt=\\fÚtsize{" << 
b¿nchfÚtsize
 << "}{" << b¿nchfÚtsiz<< "}\\£ËùfÚt] {" << 
s
.
	`¡r
() << "};\n";

601 ià((!
lšk
->
	`Out
()->
	`isL—f
()è&& 
w™hnod‘ext
) {

602 
	`Wr™eNodeText
(
lšk
->
	`Out
(),
os
,
x
+
dx
,
y
);

604 
	}
}

606 
¡ršg
 
	gH—tT»e
::
	$G‘CŞÜCode
(
z
) {

608 
x
 = (
z
 - 
mšnodev®
è/ (
maxnodev®
 - minnodeval);

609 ià(
x
 > 1) {

610 
x
 = 1;

612 ià(
x
 < 0) {

613 
x
 = 0;

615 ià((
x
<0) || (x>1)) {

616 
û¼
 << "”rÜ iÀcŞÜ cod: " << 
x
 << '\n';

617 
	`ex™
(1);

620 
o¡ršg¡»am
 
s
;

621 
s
 << "»d!" << ((è(100*
x
)) << "!yellow";

622  
s
.
	`¡r
();

647 
	}
}

649 
	gH—tT»e
::
	$Compu‹MaxNodeV®
(cÚ¡ 
Lšk
* 
äom
) {

650 
max
 = 0;

651 ià(
äom
->
	`isL—f
()) {

652 
max
 = 
	`çbs
(
	`G‘NodeV®
(
äom
));

655 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

656 
tmp
 = 
	`Compu‹MaxNodeV®
(
lšk
->
	`Out
());

657 ià(
max
 < 
tmp
) {

658 
max
 = 
tmp
;

662 
tmp
 = 
	`G‘NodeV®
(
äom
);

663 ià(
max
 < 
tmp
) {

664 
max
 = 
tmp
;

667  
max
;

668 
	}
}

671 
	gH—tT»e
::
	$Compu‹MšNodeV®
(cÚ¡ 
Lšk
* 
äom
) {

672 
mš
 = 0;

673 ià(
äom
->
	`isL—f
()) {

674 
mš
 = 
	`çbs
(
	`G‘NodeV®
(
äom
));

677 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

678 
tmp
 = 
	`Compu‹MšNodeV®
(
lšk
->
	`Out
());

679 ià(((! 
äom
->
	`isL—f
()è&& (
lšk
 =ğäom->
	`Next
())è|| (
mš
 > 
tmp
)) {

680 
mš
 = 
tmp
;

683 
tmp
 = 
	`G‘NodeV®
(
äom
);

684 ià(
mš
 > 
tmp
) {

685 
mš
 = 
tmp
;

688  
mš
;

689 
	}
}

691 
	gH—tT»e
::
	$P»·»D¿wšg
() {

692 
D¿wT»e
::
	`P»·»D¿wšg
();

693 
û¼
 << 
mšnodev®
 << '\t' << 
maxnodev®
 << '\n';

694 ià(
maxnodev®
 == -1) {

695 
maxnodev®
 = 
	`Compu‹MaxNodeV®
(
	`G‘RoÙ
());

697 ià(
mšnodev®
 == -1) {

698 
mšnodev®
 = 
	`Compu‹MšNodeV®
(
	`G‘RoÙ
());

700 
û¼
 << 
mšnodev®
 << '\t' << 
maxnodev®
 << '\n';

701 
	}
}

703 
	gH—tT»e
::
	$FšishD¿wšg
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
) {

704 
	`MakeSÿË
(
os
);

705 
	}
}

707 
	gH—tT»e
::
	$MakeSÿË
(
o¡»am
& 
os
) {

709 
y
 = -0.04 * 
sizeY
;

710 
dy
ğ0.006 * 
sizeY
;

711 
x
 = 0.04 * 
sizeX
;

712 
dx
 = 
sizeX
 / 5;

713 
mš
 = 
mšnodev®
;

714 
max
 = 
maxnodev®
;

715 
z1
 = 
mš
;

716 
z2
 = 
max
;

717 
zmid
 = 0.5 * (
z1
 + 
z2
);

718 
¡ršg
 
s1
 = 
	`G‘CŞÜCode
(
z1
);

719 
¡ršg
 
s2
 = 
	`G‘CŞÜCode
(
z2
);

720 
¡ršg
 
smid
 = 
	`G‘CŞÜCode
(
zmid
);

721 
os
 << "\\shade[left color=";

722 
os
 << 
s1
;

723 
os
 << ",„ight color =";

724 
os
 << 
s2
;

725 
os
 << ", middle color = ";

726 
os
 << 
smid
;

727 
os
 << "]";

729 
os
 << " (" << 
	`‹x­´ox
(
x
è<< "," <<ex­´ox(
y
-0.5*
thickÃss
è<< "è»ùªgË (" <<ex­´ox(x+
dx
-0.04) << ',' <<exapprox(y+0.5*thickness) << ");\n";

731 
ng¿d
 = 2;

732 
i
=0; i <ğ
ng¿d
; i++) {

733 
xx
 = 
	`‹x­´ox
(
x
 + 
dx
 * ((è
i
è/ 
ng¿d
);

734 
os
 << "\\·th [d¿w] (" << 
xx
 << "," << 
y
 + 
dy
 << ") -- +(0," << -2 *dy << ");\n";

735 
os
.
	`´ecisiÚ
(3);

736 
x
 = ((è((è(10 * (
mš
 + (
max
-mšè* ((è
i
è/ 
ng¿d
)))) / 10;

737 
os
 << "\\·th (" << 
xx
 << "," << -8 *
dy
 << "ènode[b–ow,fÚt=\\fÚtsize{" << 
groupfÚtsize
 << "}{" << groupfÚtsiz<< "}\\£ËùfÚt] {" << 
x
 << "};\n";

740 
	}
}

743 
	gD¿wT»e
::
	$Wr™eNodeText
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
) {

744 
os
 << "\\·th [ªchÜ=southƒa¡,fÚt=\\fÚtsize{" << 
fÚtsize
 << "}{" << fÚtsiz<< "}\\£ËùfÚt,sÿË=" << 
‹xsÿË
<< "]";

746 
os
 << "(" << 
	`‹x­´ox
(
x
-0.1è<< "," <<ex­´ox(
y
è<< "ènod{" << 
	`G‘NodeName
(
lšk
) << " };\n";

748 
	}
}

750 
	gH—tT»e
::
	$S‘B¿nchV®
(
¡ršg
 
šfe
) {

751 
if¡»am
 
	`is
(
šfe
.
	`c_¡r
());

752 ià(!
is
) {

753 
û¼
 << "”rÜ iÀh—‰»e: did‚Ù fšd " << 
šfe
 << '\n';

754 
	`ex™
(1);

760 
boŞ
 
cÚt
 = 
Œue
;

761 
cÚt
) {

762 
¡ršg
 
Çme1
, 
Çme2
;

763 
¡ršg
 
tmp
;

765 
is
 >> 
Çme1
 >> 
Çme2
 >> 
tmp
;

766 
û¼
 << 
Çme1
 << '\t' << 
Çme2
 << '\t' << 
tmp
 << '\n';

767 ià(
Çme1
 != "END") {

768 cÚ¡ 
Lšk
* 
lšk
 = 
	`G‘LCA
(
Çme1
,
Çme2
);

769 ià(! 
lšk
) {

770 
û¼
 << "”rÜ iÀh—‰»e: did‚Ù fšd commÚ‡nû¡Ü oà" << 
Çme1
 << "‡nd " << 
Çme2
 << '\n';

771 
	`ex™
(1);

773 ià(! 
lšk
->
	`isRoÙ
()) {

775 
b¿nchv®
[
lšk
->
	`G‘B¿nch
()] = 
tmp
;

779 
û¼
 << "end\n";

780 
cÚt
 = 
çl£
;

783 
w™hb¿nchv®
 = 
Œue
;

784 
	}
}

786 
	gH—tT»e
::
	$S‘Ex‹º®NodeV®
(
¡ršg
 
šfe
) {

787 
if¡»am
 
	`is
(
šfe
.
	`c_¡r
());

788 ià(!
is
) {

789 
û¼
 << "”rÜ iÀh—‰»e: did‚Ù fšd " << 
šfe
 << '\n';

790 
	`ex™
(1);

792 
n
;

793 
is
 >> 
n
;

794 
i
=0; i<
n
; i++) {

795 
¡ršg
 
Çme1
, 
Çme2
;

796 
tmp
;

797 
is
 >> 
Çme1
 >> 
Çme2
 >> 
tmp
;

798 cÚ¡ 
Lšk
* 
lšk
 = 
	`G‘LCA
(
Çme1
,
Çme2
);

799 ià(! 
lšk
) {

800 
û¼
 << "”rÜ iÀh—‰»e: did‚Ù fšd commÚ‡nû¡Ü oà" << 
Çme1
 << "‡nd " << 
Çme2
 << '\n';

801 
	`ex™
(1);

803 
û¼
 << 
lšk
 << '\t' << 
Çme1
 << '\t' << 
Çme2
 << '\n';

804 
exŠodev®
[
lšk
->
	`G‘Node
()] = 
tmp
;

806 
w™hex‹º®nodev®
 = 
Œue
;

807 
	}
}

809 
	gH—tT»e
::
	$S‘Ex‹º®NodeCI
(
¡ršg
 
šfe
) {

810 
if¡»am
 
	`is
(
šfe
.
	`c_¡r
());

811 ià(!
is
) {

812 
û¼
 << "”rÜ iÀh—‰»e: did‚Ù fšd " << 
šfe
 << '\n';

813 
	`ex™
(1);

815 
n
;

816 
is
 >> 
n
;

817 
i
=0; i<
n
; i++) {

818 
¡ršg
 
Çme1
, 
Çme2
;

819 
tmpmš
, 
tmpmax
;

820 
is
 >> 
Çme1
 >> 
Çme2
 >> 
tmpmš
 >> 
tmpmax
;

821 cÚ¡ 
Lšk
* 
lšk
 = 
	`G‘LCA
(
Çme1
,
Çme2
);

822 ià(! 
lšk
) {

823 
û¼
 << "”rÜ iÀh—‰»e: did‚Ù fšd commÚ‡nû¡Ü oà" << 
Çme1
 << "‡nd " << 
Çme2
 << '\n';

824 
	`ex™
(1);

826 
û¼
 << 
lšk
 << '\t' << 
Çme1
 << '\t' << 
Çme2
 << '\n';

827 
exŠodemš
[
lšk
->
	`G‘Node
()] = 
tmpmš
;

828 
exŠodemax
[
lšk
->
	`G‘Node
()] = 
tmpmax
;

830 
w™hex‹º®nodeci
 = 
Œue
;

831 
	}
}

	@DrawTree.h

2 #iâdeà
DRAWTREE_H


3 
	#DRAWTREE_H


	)

5 
	~"T»e.h
"

6 
	~<cm©h
>

8 şas 
	cFeT»e
 : 
public
 
T»e
 {

10 
public
:

12 
	$FeT»e
(
¡ršg
 
f’ame
è: 
	`T»e
(f’ameè, 
	`Ëafv®
(-1), 
	`š‹º®v®
(-1), 
	$»sÿË
(0) {

13 
	`Check
(
	`G‘RoÙ
());

16 
	`G‘NodeMš
(cÚ¡ 
Lšk
* 
äom
);

17 
	`G‘NodeMax
(cÚ¡ 
Lšk
* 
äom
);

18 
	`G‘NodeV®
(cÚ¡ 
Lšk
* 
äom
);

20 
¡ršg
 
	`G‘L—fNodeName
(cÚ¡ 
Lšk
* 
äom
);

22 
boŞ
 
	$HasNodeMšMax
() const {

23  ((
š‹º®v®
 =ğ2è&& (
Ëafv®
 == 2));

24 
	}
}

26 
boŞ
 
	$HasNodeV®
() const {

27  ((
š‹º®v®
 =ğ1è&& (
Ëafv®
 == 1));

28 
	}
}

30 
boŞ
 
	$HasL—fMšMax
() const {

31  (
Ëafv®
 == 2);

32 
	}
}

34 
boŞ
 
	$HasL—fV®
() const {

35  (
Ëafv®
 == 1);

36 
	}
}

38 
boŞ
 
	$HasIÁ”ÇlMšMax
() const {

39  (
š‹º®v®
 == 2);

40 
	}
}

42 
boŞ
 
	$HasIÁ”ÇlV®
() const {

43  (
š‹º®v®
 == 1);

44 
	}
}

46 
	$TabuÏ‹
(
o¡»am
& 
os
) {

47 
	`RecursiveTabuÏ‹
(
	`G‘RoÙ
(),
os
);

48 
	}
}

50 
	$S‘ResÿlšgFaùÜ
(
š
) {

51 
»sÿË
 = 
š
;

52 
	}
}

54 
	g´Ùeùed
:

56 
	$RecursiveTabuÏ‹
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
) {

57 
os
 << 
	`G‘L—fNodeName
(
	`G‘LeáMo¡Lšk
(
äom
)è<< '\t' << G‘L—fNodeName(
	`G‘RightMo¡Lšk
(äom)è<< '\t' << 
	`G‘NodeV®
(from) << '\n';

58 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

59 
	`RecursiveTabuÏ‹
(
lšk
->
	`Out
(),
os
);

61 
	}
}

63 
Check
(cÚ¡ 
Lšk
* 
äom
);

65 
	gËafv®
;

66 
	gš‹º®v®
;

67 
	g»sÿË
;

71 şas 
	cD¿wT»e
 {

74 
	mpublic
:

76 
	$D¿wT»e
(è: 
	`´ec
(2), 
	`b—m”
(
Œue
), 
	`sizeX
(6), 
	`sizeY
(10), 
	`Z
(0), 
	`fÚtsize
(4), 
	`groupfÚtsize
(6), 
	`h—d”
Ñrue), 
	`shiáÇme
(-0.02), 
	`‹xsÿË
(1.0), 
	`w™hËaâames
Ñrue), 
	$w™hnod‘ext
(
çl£
) {}

77 
vœtu®
 ~
	$D¿wT»e
(è{
	}
}

79 
D¿w
(
¡ršg
 
rg‘fe
);

80 
	$D¿w
(
¡ršg
 
rg‘fe
, 
šsizeX
, 
šsizeY
) {

81 
	`S‘SÿË
(
šsizeX
, 
šsizeY
);

82 
	`D¿w
(
rg‘fe
);

83 
	}
}

85 
	$S‘Docum’tStyË
(
¡ršg
 
¡yË
) {

86 ià(
¡yË
 == "beamer") {

87 
b—m”
 = 
Œue
;

89 ià(
¡yË
 == "article") {

90 
b—m”
 = 
çl£
;

93 
û¼
 << "in drawtree: does‚ot„ecognize style\n";

94 
	`ex™
(1);

96 
	}
}

98 
	$S‘NodeText
(
boŞ
 
šÁ
) {

99 
w™hnod‘ext
 = 
šÁ
;

100 
	}
}

104 
	$S‘SÿË
(
šsizeX
, 
šsizeY
) {

105 
sizeX
 = 
šsizeX
;

106 
sizeY
 = 
šsizeY
;

107 
	}
}

109 
	$S‘GroupOff£t
(
šZ
) {

110 
Z
 = 
šZ
;

111 
	}
}

113 
	$G‘GroupOff£t
() {

114  
Z
;

115 
	}
}

117 
	$S‘TexSÿË
(
šsÿË
) {

118 
‹xsÿË
 = 
šsÿË
;

119 
	}
}

121 
	$S‘W™hL—fNames
(
boŞ
 
š
) {

122 
w™hËaâames
 = 
š
;

123 
	}
}

125 
	$S‘FÚtSize
(
šfÚtsize
) {

126 
fÚtsize
 = 
šfÚtsize
;

127 
	}
}

129 
	$S‘GroupFÚtSize
(
šfÚtsize
) {

130 
groupfÚtsize
 = 
šfÚtsize
;

131 
	}
}

133 
	$S‘ShiáName
(
s
) {

134 
shiáÇme
 = 
s
;

135 
	}
}

137 
	$S‘W™hH—d”
(
boŞ
 
h
) {

138 
h—d”
 = 
h
;

139 
	}
}

141 
vœtu®
 
	$G‘L’gth
(cÚ¡ 
Lšk
* 
lšk
) const = 0;

142 
vœtu®
 
¡ršg
 
	$G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
) const = 0;

144 
vœtu®
 
¡ršg
 
	$G‘L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) {

145  
	`G‘NodeName
(
lšk
);

146 
	}
}

148 
Wr™eNodeText
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
mš
, 
max
);

150 
vœtu®
 
¡ršg
 
	$G‘P»L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
è{ "";
	}
}

152 
	$G‘D•th
(cÚ¡ 
Lšk
* 
lšk
è{ 
d•th
[lšk];
	}
}

153 
vœtu®
 
	$G‘D•th
(è{ 
	`G‘D•th
(
	`G‘RoÙ
());
	}
}

155 
	$G‘Size
(cÚ¡ 
Lšk
* 
lšk
è{ 
size
[lšk];
	}
}

157 
vœtu®
 cÚ¡ 
Lšk
* 
	$G‘RoÙ
() const = 0;

159 
vœtu®
 cÚ¡ 
Lšk
* 
	`G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
) = 0;

161 
	$S‘Groups
(
¡ršg
 
f’ame
) {

163 
if¡»am
 
	`is
(
f’ame
.
	`c_¡r
());

164 
N
;

165 
is
 >> 
N
;

166 
i
=0; i<
N
; i++) {

167 
¡ršg
 
x1
, 
x2
, 
Çme
;

168 
‹xt
,
cŞÜ
;

169 
is
 >> 
Çme
 >> 
x1
 >> 
x2
 >> 
‹xt
 >> 
cŞÜ
;

170 cÚ¡ 
Lšk
* 
lšk
 = 
	`G‘LCA
(
x1
,
x2
);

171 ià(
lšk
) {

172 
grou²ame
[
lšk
->
	`G‘Node
()] = 
Çme
;

173 
grou±ext
[
lšk
->
	`G‘Node
()] = 
‹xt
;

174 
groupcŞÜ
[
lšk
->
	`G‘Node
()] = 
cŞÜ
;

177 
û¼
 << "did‚Ù fšd commÚ‡nû¡Ü of: " << 
x1
 << '\t' << 
x2
 << '\n';

178 
	`ex™
(1);

181 
	}
}

183 
	g´Ùeùed
:

186 
	$Compu‹Size
() {

187 
size
.
	`ş—r
();

188 
	`RecursiveCompu‹Size
(
	`G‘RoÙ
());

189 
	}
}

190 
RecursiveCompu‹Size
(cÚ¡ 
Lšk
* 
äom
);

193 
	$Compu‹D•th
() {

194 
d•th
.
	`ş—r
();

195 
	`RecursiveCompu‹D•th
(
	`G‘RoÙ
());

196 
	}
}

197 
RecursiveCompu‹D•th
(cÚ¡ 
Lšk
* 
äom
);

199 
RecursiveD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
X
, 
Y
, 
xsÿË
, 
ysÿË
);

200 
RecursiveAá”D¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
X
, 
Y
, 
xsÿË
, 
ysÿË
);

202 
vœtu®
 
	$LoÿlAá”D¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
è{
	}
}

204 
vœtu®
 
	$LoÿlD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

205 
	`D¿wNodeText
(
äom
,
os
,
x
,
y
);

206 
	}
}

208 
vœtu®
 
LoÿlD¿wV”tiÿlT¿™
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y1
, 
y2
);

209 
vœtu®
 
LoÿlD¿wB¿nch
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
, 
dx
);

211 
D¿wNodeText
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
);

213 
Wr™eGroupNames
(
o¡»am
& 
os
);

215 
vœtu®
 
P»·»D¿wšg
();

216 
vœtu®
 
	$FšishD¿wšg
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
è{
	}
}

218 
šlše
 
	$‹x­´ox
(
f
) {

219 
tmp
 = ((è((è(
f
 * 10000))) / 10000;

220 ià(
	`çbs
(
tmp
) < 1e-6) {

221 
tmp
 = 0;

223  
tmp
;

224 
	}
}

226 
šlše
 
	$­´ox
(
f
) {

227 
i
=0; i<
´ec
; i++) {

228 
f
 *= 10;

230 
f
 = (() (() f));

231 
i
=0; i<
´ec
; i++) {

232 
f
 /= 10;

234  
f
;

235 
	}
}

237 
	g´ec
;

239 
boŞ
 
	gb—m”
;

240 
	gsizeX
;

241 
	gsizeY
;

242 
	gZ
;

243 
	gfÚtsize
;

244 
	ggroupfÚtsize
;

246 
	gm­
<cÚ¡ 
	gLšk
*, > 
	gsize
;

247 
	gm­
<cÚ¡ 
	gLšk
*, > 
	gd•th
;

249 
boŞ
 
	gh—d”
;

251 
	gshiáÇme
;

253 
	g‹xsÿË
;

255 
boŞ
 
	gw™hËaâames
;

256 
boŞ
 
	gw™hnod‘ext
;

258 
	gm­
<cÚ¡ 
	gNode
*, 
	g¡ršg
> 
	ggrou²ame
;

259 
	gm­
<cÚ¡ 
	gNode
*, > 
	ggroupy
;

260 
	gm­
<cÚ¡ 
	gNode
*, > 
	ggrou±ext
;

261 
	gm­
<cÚ¡ 
	gNode
*, > 
	ggroupcŞÜ
;

266 
şass
 
	gFeD¿wT»e
 : 
public
 
FeT»e
,…ubliø
	gD¿wT»e
 {

268 
	gpublic
:

270 
FeD¿wT»e
(
¡ršg
 
f’ame
è: 
FeT»e
(filename) {}

272 
¡ršg
 
G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
ècÚ¡ { 
T»e
::GetNodeName(link);}

273 
Lšk
* 
G‘RoÙ
(ècÚ¡ { 
	gT»e
::GetRoot();}

274 cÚ¡ 
Lšk
* 
G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
è{ 
	gT»e
::GetLCA(tax1,tax2);}

276 
vœtu®
 
¡ršg
 
G‘L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) {

277  
	gFeT»e
::
G‘L—fNodeName
(
lšk
);

280 
G‘L’gth
(cÚ¡ 
Lšk
* 
äom
) const {

281 ià(! 
	gäom
->
G‘B¿nch
()) {

284  
©of
(
äom
->
G‘B¿nch
()->
G‘Name
().
c_¡r
());

290 şas 
	cBubbËT»e
 : 
public
 
vœtu®
 
D¿wT»e
 {

292 
public
:

294 
	$BubbËT»e
(è: 
	`maxnodev®
(10.0), 
	`nod•ow”
(1.0è, 
	$w™hbubbË‹xt
(
çl£
) {}

296 
vœtu®
 
	`G‘NodeMš
(cÚ¡ 
Lšk
* 
äom
) = 0;

297 
vœtu®
 
	`G‘NodeMax
(cÚ¡ 
Lšk
* 
äom
) = 0;

298 
vœtu®
 
	`G‘NodeV®
(cÚ¡ 
Lšk
* 
äom
) = 0;

300 
vœtu®
 
	`G‘CœşeNodeV®
(cÚ¡ 
Lšk
* 
lšk
);

301 
vœtu®
 
	`G‘CœşeNodeMš
(cÚ¡ 
Lšk
* 
lšk
);

302 
vœtu®
 
	`G‘CœşeNodeMax
(cÚ¡ 
Lšk
* 
lšk
);

304 
	$S‘NodeSÿË
(
sÿË
) {

305 
maxnodev®
 = 
sÿË
;

306 
	}
}

308 
	$S‘NodePow”
(
p
) {

309 
nod•ow”
 = 
p
;

310 
	}
}

312 
	$S‘BubbËText
(
boŞ
 
šÁ
) {

313 
w™hbubbË‹xt
 = 
šÁ
;

314 
	}
}

316 
	g´Ùeùed
:

318 
	$LoÿlD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

319 
D¿wT»e
::
	`LoÿlD¿w
(
äom
,
os
,
x
,
y
,
xsÿË
,
ysÿË
);

320 
	`D¿wNodeBubbË
(
äom
,
os
,
x
,
y
);

321 ià((!
äom
->
	`Out
()->
	`isL—f
()è&& 
w™hbubbË‹xt
) {

322 
	`Wr™eBubbËText
(
äom
,
os
,
x
,
y
);

324 
	}
}

326 
D¿wNodeBubbË
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
);

327 
Wr™eBubbËText
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
mš
, 
max
);

329 
P»·»D¿wšg
();

330 
FšishD¿wšg
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
);

332 
D¿wBubbËSÿË
(
o¡»am
& 
os
, 
x
, 
y
, 
mš
, 
max
, 
¡•
);

334 
Compu‹MaxNodeV®
(cÚ¡ 
Lšk
* 
äom
);

335 
Compu‹MšNodeV®
(cÚ¡ 
Lšk
* 
äom
);

337 
	gmaxnodev®
;

338 
	gnodesÿË
;

339 
	gnod•ow”
;

341 
boŞ
 
	gw™hbubbË‹xt
;

344 
şass
 
	gFeBubbËT»e
 : 
public
 
FeT»e
,…ubliø
	gBubbËT»e
 {

346 
	gpublic
:

348 
FeBubbËT»e
(
¡ršg
 
f’ame
è: 
FeT»e
(filename) {

349 ià(! 
HasNodeMšMax
()) {

350 
û¼
 << "error : filebubbletree should have min‡nd max values‡ssociatedoƒach‚ode\n";

354 
¡ršg
 
G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
ècÚ¡ { 
	gT»e
::GetNodeName(link);}

355 
vœtu®
 
¡ršg
 
G‘L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) {

356  
	gFeT»e
::
G‘L—fNodeName
(
lšk
);

359 
Lšk
* 
G‘RoÙ
(ècÚ¡ { 
	gT»e
::GetRoot();}

360 cÚ¡ 
Lšk
* 
G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
è{ 
	gT»e
::GetLCA(tax1,tax2);}

362 
G‘L’gth
(cÚ¡ 
Lšk
* 
äom
) const {

363 ià(! 
	gäom
->
G‘B¿nch
()) {

366  
©of
(
äom
->
G‘B¿nch
()->
G‘Name
().
c_¡r
());

381 
G‘NodeMš
(cÚ¡ 
Lšk
* 
äom
) {

382  
	gFeT»e
::
G‘NodeMš
(
äom
);

384 
G‘NodeMax
(cÚ¡ 
Lšk
* 
äom
) {

385  
	gFeT»e
::
G‘NodeMax
(
äom
);

387 
G‘NodeV®
(cÚ¡ 
Lšk
* 
äom
) {

388  
	gFeT»e
::
G‘NodeV®
(
äom
);

392 şas 
	cChrÚoD¿wT»e
 : 
public
 
vœtu®
 
D¿wT»e
 {

394 
public
:

396 
	$ChrÚoD¿wT»e
(è: 
	`b¬width
(0.04), 
	`w™htimesÿË
(
Œue
), 
	`Úlygroups
(
çl£
), 
	$maxtime
(0) {}

398 
vœtu®
 
	`G‘NodeMš
(cÚ¡ 
Lšk
* 
äom
) = 0;

399 
vœtu®
 
	`G‘NodeMax
(cÚ¡ 
Lšk
* 
äom
) = 0;

400 
vœtu®
 
	$G‘MšTime
(cÚ¡ 
Lšk
* 
äom
è{ 
	`G‘NodeMš
(äom);
	}
}

401 
vœtu®
 
	$G‘MaxTime
(cÚ¡ 
Lšk
* 
äom
è{ 
	`G‘NodeMax
(äom);
	}
}

403 
	$G‘MaxTime
() {

404 ià(
maxtime
) {

405  
maxtime
;

407  
	`G‘MaxTime
(
	`G‘RoÙ
());

408 
	}
}

410 
	$S‘MaxTime
(
štime
) {

411 
maxtime
 = 
štime
;

412 
	}
}

414 
	$S‘B¬Width
(
šw
) {

415 
b¬width
 = 
šw
;

416 
	}
}

418 
	$S‘TimeSÿË
(
boŞ
 
š
) {

419 
w™htimesÿË
 = 
š
;

420 
	}
}

422 
	$S‘OÆyGroups
(
boŞ
 
š
) {

423 
Úlygroups
 = 
š
;

424 
	}
}

426 
	$G‘D•th
() {

427 ià(
maxtime
) {

428  
maxtime
;

430  
D¿wT»e
::
	`G‘D•th
(
	`G‘RoÙ
());

431 
	}
}

433 
	g´Ùeùed
:

435 
	$FšishD¿wšg
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
) {

436 
	`D¿wTimeSÿË
(
os
,
xsÿË
,
ysÿË
);

437 
	}
}

439 
D¿wTimeSÿË
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
);

441 
	$LoÿlD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

442 
	`D¿wTimeIÁ”v®
(
äom
,
os
,
x
,
y
,
xsÿË
,
ysÿË
);

443 
	}
}

445 
D¿wTimeIÁ”v®
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
);

448 
	gb¬width
;

449 
boŞ
 
	gw™htimesÿË
;

450 
boŞ
 
	gÚlygroups
;

451 
	gmaxtime
;

455 
şass
 
	gFeChrÚoD¿wT»e
 : 
public
 
FeT»e
,…ubliø
	gChrÚoD¿wT»e
 {

457 
	gpublic
:

459 
FeChrÚoD¿wT»e
(
¡ršg
 
f’ame
è: 
FeT»e
(filename) {

460 ià(! 
HasIÁ”ÇlMšMax
()) {

461 
û¼
 << "error : filechronodrawtree should have min‡nd max values‡ssociatedoƒach internal‚ode\n";

465 
¡ršg
 
G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
ècÚ¡ { 
	gT»e
::GetNodeName(link);}

466 
vœtu®
 
¡ršg
 
G‘L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) {

467  
	gFeT»e
::
G‘L—fNodeName
(
lšk
);

470 
Lšk
* 
G‘RoÙ
(ècÚ¡ { 
	gT»e
::GetRoot();}

471 cÚ¡ 
Lšk
* 
G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
è{ 
	gT»e
::GetLCA(tax1,tax2);}

473 
G‘L’gth
(cÚ¡ 
Lšk
* 
äom
) const {

474 ià(! 
	gäom
->
G‘B¿nch
()) {

477 
	gx
 = 
©of
(
äom
->
G‘B¿nch
()->
G‘Name
().
c_¡r
());

478  
	gx
;

481 
G‘NodeMš
(cÚ¡ 
Lšk
* 
äom
) {

482  
	gFeT»e
::
G‘NodeMš
(
äom
);

484 
G‘NodeMax
(cÚ¡ 
Lšk
* 
äom
) {

485  
	gFeT»e
::
G‘NodeMax
(
äom
);

492 
	g´Ùeùed
:

494 
LoÿlD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

495 
	gD¿wT»e
::
LoÿlD¿w
(
äom
,
os
,
x
,
y
,
xsÿË
,
ysÿË
);

496 
	gChrÚoD¿wT»e
::
LoÿlD¿w
(
äom
,
os
,
x
,
y
,
xsÿË
,
ysÿË
);

499 
P»·»D¿wšg
() {

500 
	gD¿wT»e
::
P»·»D¿wšg
();

501 
	gChrÚoD¿wT»e
::
P»·»D¿wšg
();

509 şas 
	cH—tT»e
 : 
public
 
vœtu®
 
D¿wT»e
 {

511 
public
:

513 
	$H—tT»e
(è: 
	`maxnodev®
(-1), 
	`mšnodev®
(-1), 
	`nod•ow”
(1.0è, 
	`thickÃss
(0.06), 
	`unib¿nch
(
çl£
), 
	`w™hb¿nchv®
(çl£), 
	`w™hex‹º®nodev®
(çl£), 
	$w™hex‹º®nodeci
(
çl£
) {}

515 
	$S‘MšMax
(
mš
, 
max
) {

516 
mšnodev®
 = 
mš
;

517 
maxnodev®
 = 
max
;

518 
	}
}

520 
S‘B¿nchV®
(
¡ršg
 
šfe
);

521 
S‘Ex‹º®NodeV®
(
¡ršg
 
šfe
);

522 
S‘Ex‹º®NodeCI
(
¡ršg
 
šfe
);

524 
vœtu®
 cÚ¡ 
Lšk
* 
G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
) = 0;

526 
vœtu®
 
G‘NodeV®
(cÚ¡ 
Lšk
* 
äom
) = 0;

528 
	$S‘NodePow”
(
p
) {

529 
nod•ow”
 = 
p
;

530 
	}
}

532 
	$S‘ThickÃss
(
šth
) {

533 
thickÃss
 = 
šth
;

534 
	}
}

536 
	$S‘UniB¿nch
(
boŞ
 
šb
) {

537 
unib¿nch
 = 
šb
;

538 
	}
}

546 
	g´Ùeùed
:

548 
LoÿlD¿wB¿nch
(cÚ¡ 
Lšk
* 
lšk
, 
o¡»am
& 
os
, 
x
, 
y
, 
dx
);

551 
P»·»D¿wšg
();

552 
FšishD¿wšg
(
o¡»am
& 
os
, 
xsÿË
, 
ysÿË
);

553 
MakeSÿË
(
o¡»am
& 
os
);

555 
D¿wCI
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
);

557 
	$LoÿlAá”D¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

558 ià(
w™hex‹º®nodeci
) {

559 ià(! 
äom
->
	`isL—f
()) {

560 
	`D¿wCI
(
äom
,
os
,
x
,
y
);

563 
	}
}

565 
	$LoÿlD¿w
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
x
, 
y
, 
xsÿË
, 
ysÿË
) {

566 
D¿wT»e
::
	`LoÿlD¿w
(
äom
,
os
,
x
,
y
,
xsÿË
,
ysÿË
);

567 
	}
}

569 
¡ršg
 
G‘CŞÜCode
(
z
);

573 
Compu‹MaxNodeV®
(cÚ¡ 
Lšk
* 
äom
);

574 
Compu‹MšNodeV®
(cÚ¡ 
Lšk
* 
äom
);

576 
	gmaxnodev®
;

577 
	gmšnodev®
;

578 
	gnod•ow”
;

579 
	gthickÃss
;

581 
boŞ
 
	gunib¿nch
;

582 
boŞ
 
	gw™hb¿nchv®
;

583 
boŞ
 
	gw™hex‹º®nodev®
;

584 
boŞ
 
	gw™hex‹º®nodeci
;

585 
	gm­
<cÚ¡ 
	gB¿nch
*, 
	g¡ršg
> 
	gb¿nchv®
;

587 
	gm­
<cÚ¡ 
	gNode
*, > 
	gexŠodev®
;

588 
	gm­
<cÚ¡ 
	gNode
*, > 
	gexŠodemš
;

589 
	gm­
<cÚ¡ 
	gNode
*, > 
	gexŠodemax
;

593 
şass
 
	gFeH—tT»e
 : 
public
 
FeT»e
,…ubliø
	gH—tT»e
 {

595 
	gpublic
:

597 
FeH—tT»e
(
¡ršg
 
f’ame
è: 
FeT»e
(filename) {

598 ià(! 
HasNodeV®
()) {

599 
û¼
 << "error in fileheattree: only one value should be‡ssociated withƒach‚ode\n";

600 
	gû¼
 << "Ëaf: " << 
HasL—fV®
() << '\n';

601 
	gû¼
 << "š‹º® : " << 
HasIÁ”ÇlV®
() << '\n';

602 
ex™
(1);

606 
¡ršg
 
G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
ècÚ¡ { 
	gT»e
::GetNodeName(link);}

608 
vœtu®
 
¡ršg
 
G‘P»L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) {

610 
o¡ršg¡»am
 
	gs
;

612 ià(
	gw™hex‹º®nodeci
) {

613 
	gm­
<cÚ¡ 
	gNode
*, >::
cÚ¡_™”©Ü
 
imš
 = 
exŠodemš
.
fšd
(
lšk
->
G‘Node
());

614 
	gm­
<cÚ¡ 
	gNode
*, >::
cÚ¡_™”©Ü
 
imax
 = 
exŠodemax
.
fšd
(
lšk
->
G‘Node
());

616 
	gs
.
´ecisiÚ
(2);

618 
Lšk
* 
	glšk2
 = (Lšk*è
lšk
;

619 
	gz
 = 
G‘NodeV®
(
lšk2
);

620 
	gs
 << 
	gfixed
 << 
	gz
 << " ";

622 
	gs
 << "(";

623 ià(
	gimš
 =ğ
exŠodemš
.
’d
()) {

624 
s
 << "?";

627 
	gtmp
 = 
imš
->
£cÚd
;

628 
	gs
 << 
	gfixed
 << 
	gtmp
;

630 
	gs
 << " , ";

631 ià(
	gimš
 =ğ
exŠodemax
.
’d
()) {

632 
s
 << "?";

635 
	gtmp
 = 
imax
->
£cÚd
;

636 
	gs
 << 
	gfixed
 << 
	gtmp
;

638 
	gs
 << ")";

642  
	gs
.
¡r
();

645 
vœtu®
 
¡ršg
 
G‘L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) {

647 
o¡ršg¡»am
 
	gs
;

680 
	gs
 << 
	gFeT»e
::
G‘L—fNodeName
(
lšk
);

681 ià(
	gw™hnod‘ext
) {

682 
	gs
 << ' ' << ((è((è(10 * 
G‘NodeV®
(
lšk
))) ) / 10;

685  
	gs
.
¡r
();

688 
Lšk
* 
G‘RoÙ
(ècÚ¡ { 
	gT»e
::GetRoot();}

689 cÚ¡ 
Lšk
* 
G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
è{ 
	gT»e
::GetLCA(tax1,tax2);}

691 
G‘L’gth
(cÚ¡ 
Lšk
* 
äom
) const {

692 ià(! 
	gäom
->
G‘B¿nch
()) {

695 
	gx
 = 
©of
(
äom
->
G‘B¿nch
()->
G‘Name
().
c_¡r
());

696  
	gx
;

699 
G‘Ex‹º®NodeMš
(cÚ¡ 
Lšk
* 
äom
) {

700  
	gexŠodemš
[
äom
->
G‘Node
()];

703 
G‘Ex‹º®NodeMax
(cÚ¡ 
Lšk
* 
äom
) {

704  
	gexŠodemax
[
äom
->
G‘Node
()];

707 
G‘NodeV®
(cÚ¡ 
Lšk
* 
äom
) {

708 ià(
	gw™hex‹º®nodev®
) {

709  
	gexŠodev®
[
äom
->
G‘Node
()];

711  
	gFeT»e
::
G‘NodeV®
(
äom
);

	@EmpiricalSubMatrix.h

2 #iâdeà
EMPSUB_H


3 
	#EMPSUB_H


	)

5 
	~"SubM©rix.h
"

6 
	~"B¿nchS™eP©h.h
"

7 
	~<veùÜ
>

11 şas 
	cEmpœiÿlSubM©rix
 : 
public
 
vœtu®
 
SubM©rix
 {

13 
public
:

15 
	$EmpœiÿlSubM©rix
(
N¡©e
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
	$SubM©rix
(
N¡©e
, 
šnÜm®i£
) {

17 
·œcouÁs
 = 
Ãw
 *[
	`G‘N¡©e
()];

18 
i
=0; i<
	`G‘N¡©e
(); i++) {

19 
·œcouÁs
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

21 
¡©ecouÁs
 = 
Ãw
 [
	`G‘N¡©e
()];

24 
vœtu®
 ~
	$EmpœiÿlSubM©rix
() {

25 
d–‘e
[] 
¡©ecouÁs
;

26 
i
=0; i<
	`G‘N¡©e
(); i++) {

27 
d–‘e
[] 
·œcouÁs
[
i
];

29 
d–‘e
[] 
·œcouÁs
;

30 
	}
}

32 
	$AddP©h
(
B¿nchS™eP©h
* 
š·th
) {

33 
·thli¡
.
	`push_back
(
š·th
);

34 
	}
}

36 
	$ReäeshSti¡ics
() {

37 
i
=0; i<
	`G‘N¡©e
(); i++) {

38 
¡©ecouÁs
[
i
] = 0;

39 
j
=0; j<
	`G‘N¡©e
(); j++) {

40 
·œcouÁs
[
i
][
j
] = 0;

43 
i
=0; i<
·thli¡
.
	`size
(); i++) {

44 
·thli¡
[
i
]->
	`AddCouÁs
(
·œcouÁs
,
¡©ecouÁs
);

46 
	`CÜru±M©rix
();

47 
	}
}

49 
	g´Ùeùed
:

51 ** 
·œcouÁs
;

52 * 
	g¡©ecouÁs
;

54 
	gveùÜ
<
	gB¿nchS™eP©h
*> 
	g·thli¡
;

58 şas 
	cEmpœiÿlGTRSubM©rix
 : 
public
 
EmpœiÿlSubM©rix
 {

60 
public
 :

62 
	$EmpœiÿlGTRSubM©rix
(
N¡©e
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
	`SubM©rix
(N¡©e,šnÜm®i£), 
	$EmpœiÿlSubM©rix
(
N¡©e
,
šnÜm®i£
) {

63 
¼
 = 
Ãw
 [
	`G‘N¼
()];

64 
¡©
 = 
Ãw
 [
	`G‘N¡©e
()];

67 ~
	$EmpœiÿlGTRSubM©rix
() {

68 
d–‘e
[] 
¼
;

69 
d–‘e
[] 
¡©
;

70 
	}
}

72 
	$Compu‹A¼ay
(
i
) {

73 ià(! 
¡©æag
) {

74 
	`Upd©eStiÚ¬y
();

75 
	`Upd©eR–R©es
();

77 
tÙ®
 = 0;

78 
j
=0; j<
	`G‘N¡©e
(); j++) {

79 ià(
i
!=
j
) {

80 
Q
[
i
][
j
] = 
¼
[
	`¼šdex
(i,j,
	`G‘N¡©e
())] * 
¡©
[j];

81 
tÙ®
 +ğ
Q
[
i
][
j
];

87 
Q
[
i
][i] = - 
tÙ®
;

88 
	}
}

90 
	$Compu‹StiÚ¬y
() {

91 
tÙ®
 = 0;

92 
i
=0; i<
	`G‘N¡©e
(); i++) {

93 
¡©
[
i
] = 
¡©ecouÁs
[i];

94 
tÙ®
 +ğ
¡©
[
i
];

96 
i
=0; i<
	`G‘N¡©e
(); i++) {

97 
¡©
[
i
] /ğ
tÙ®
;

99 
	}
}

101 
	$Upd©eR–R©es
() {

102 
i
=0; i<
	`G‘N¼
(); i++) {

103 
¼
[
i
] = 0;

105 
i
=0; i<
	`G‘N¡©e
(); i++) {

106 
j
=0; j<
	`G‘N¡©e
(); j++) {

107 ià(
i
 !ğ
j
) {

108 
¼
[
	`¼šdex
(
i
,
j
,
	`G‘N¡©e
())] +ğ
·œcouÁs
[i][j];

112 
tÙ®
 = 0;

113 
i
=0; i<
	`G‘N¼
(); i++) {

114 
tÙ®
 +ğ
¼
[
i
];

116 
i
=0; i<
	`G‘N¼
(); i++) {

117 
¼
[
i
] /ğ
tÙ®
;

119 
	}
}

121 
	g´Ùeùed
:

123 
	$G‘N¼
() {

124  
N¡©e
 * (Nstate-1) / 2;

125 
	}
}

127 
	$¼šdex
(
i
, 
j
, 
n¡©e
) {

128  (
i
<
j
è? (2 * 
n¡©e
 - i - 1) * i / 2 + j - i - 1 : (2 *‚state - j - 1) * j / 2 + i - j - 1 ;

129 
	}
}

131 * 
	g¼
;

132 * 
	g¡©
;

	@EvolutionGCBrownianProcess.h

2 #iâdeà
BROWNIANGCSTATIONARY_H


3 
	#BROWNIANGCSTATIONARY_H


	)

5 
	~"RªdomSubM©rix.h
"

6 
	~"V®T»e.h
"

7 
	~"BrownŸnProûss.h
"

8 
	~"Inv”£Wish¬tM©rix.h
"

10 
şass
 
	gRoÙStiÚ¬y
 : 
public
 
Dv¬
<
Profe
> {

11 
public
 :

12 
RoÙStiÚ¬y
(
V¬
<
Un™R—l
> *
šgamma
) {

13 
this
->
dim
 = 4;

14 
	gthis
->
	g´ofe
 = 
Ãw
 [4];

15 
	ggamma
 = 
šgamma
;

16 
Regi¡”
(
gamma
);

17 
¥ecŸlUpd©e
();

21 
¥ecŸlUpd©e
() {

22 
	gi
=0; i<4; i++)

23 
	gthis
->
G‘A¼ay
()[
i
] = ((˜=ğ1 || i =ğ2è? 
gamma
->
v®
()/2 : (1-gamma->val())/2);

26 
	gV¬
<
	gUn™R—l
> *
	ggamma
;

30 şas 
	cSegm’tGCM©rix
 : 
public
 
SubM©rix
 {

31 
public
 :

32 
	$Segm’tGCM©rix
(
Profe
 *
š»Ì©e
, 
šgamma
è: 
	$SubM©rix
(4) {

33 
»Ì©e
 = 
š»Ì©e
;

34 
gamma
 = 
šgamma
;

37 
	$Compu‹A¼ay
(
i
) {

38 
tÙ
 = 0;

39 
j
=0; j<
	`G‘N¡©e
(); j++) {

40 if(
i
!=
j
) {

41 
Q
[
i
][
j
] = 
	`R–©iveR©e
(i,jè* ((j =ğ1 || j =ğ2è? 
gamma
/2 : (1-gamma)/2);

42 
tÙ
+=
Q
[
i
][
j
];

45 
Q
[
i
][i]=-
tÙ
;

47 
	}
}

49 
	$Compu‹StiÚ¬y
() {

50 
i
=0; i<
	`G‘N¡©e
(); i++)

51 
mStiÚ¬y
[
i
] = ((˜=ğ1 || i =ğ2è? 
gamma
/2 : (1-gamma)/2);

52 
	}
}

54 
	$R–©iveR©e
(
i
, 
j
è{ (*
»Ì©e
)[
	`¼šdex
(i,j,
	`G‘N¡©e
())];
	}
}

56 
	$¼šdex
(
i
, 
j
, 
n¡©e
) {

57  (
i
<
j
è? (2 * 
n¡©e
 - i - 1) * i / 2 + j - i - 1 : (2 *‚state - j - 1) * j / 2 + i - j - 1 ;

58 
	}
}

61 
	g´iv©e
 :

62 
Profe
 *
»Ì©e
;

63 
	ggamma
;

66 şas 
	cEvŞutiÚGCM©rix
 : 
public
 
T¿ns™iÚM©rix
 {

68 
public
 :

71 
	$EvŞutiÚGCM©rix
(
BrownŸnBridge
 *
šbrownŸnBridge
, cÚ¡ * 
šup
, cÚ¡ * 
šdown
, 
Profe
 *
š»Ì©e
, 
šgc
) :

72 
	$T¿ns™iÚM©rix
(4) {

73 
»Ì©e
 = 
š»Ì©e
;

74 
rStiÚ¬y
 = 0;

76 
brownŸnBridge
 = 
šbrownŸnBridge
;

77 
dim
 = 
brownŸnBridge
->
	`g‘Dim
();

78 
up
 = 
šup
;

79 
down
 = 
šdown
;

81 
gc
 = 
šgc
;

82 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

83 
i
=0; i<
	`G‘N¡©e
(); i++) {

84 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

86 
roÙ
 = 
çl£
;

88 
	`Compu‹A¼ay
();

89 
	`Compu‹StiÚ¬y
();

94 
	$EvŞutiÚGCM©rix
(cÚ¡ * 
šup
, 
šdim
, 
Profe
 *
š»Ì©e
, Prof*
š¡©iÚ¬y
, 
šgc
) :

95 
	$T¿ns™iÚM©rix
(4) {

97 
»Ì©e
 = 
š»Ì©e
;

98 
rStiÚ¬y
 = 
š¡©iÚ¬y
;

99 
up
 = 
šup
;

100 
dim
 = 
šdim
;

102 
down
 = 0;

103 
brownŸnBridge
 = 0;

105 
gc
 = 
šgc
;

107 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

108 
i
=0; i<
	`G‘N¡©e
(); i++) {

109 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

111 
roÙ
 = 
Œue
;

112 
	`Compu‹A¼ay
();

113 
	`Compu‹StiÚ¬y
();

117 
	}
}

120 ~
	$EvŞutiÚGCM©rix
() {

121 
i
=0; i<
	`G‘N¡©e
(); i++)

122 
d–‘e
[] 
tmp
[
i
];

123 
d–‘e
[] 
tmp
;

124 
	}
}

128 
vœtu®
 
	$Compu‹A¼ay
() {

130 
boŞ
 
exaùExp
 = 
çl£
;

133 
i
=0; i<
	`G‘N¡©e
(); i++)

134 
j
=0; j<
	`G‘N¡©e
(); j++)

135 
R
[
i
][
j
]= (i==j ? 1 : 0);

137 if(!
roÙ
) {

139 
nSegm’ts
 = 
brownŸnBridge
->
	`g‘NSegm’ts
();

140 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

141 
ËngthLeá
 = 0;

143 ** 
Rš‹r
 = 
Ãw
 *[
	`G‘N¡©e
()];

144 
i
=0; i<
	`G‘N¡©e
(); i++)

145 
Rš‹r
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

147 
k
=0; k<
nSegm’ts
; k++) {

150 
r1
 = 
up
[
r
] + 
ËngthLeá
/
Ëngth
 * (
down
[r]-up[r]);

151 
gc1
 = 
up
[
gc
] + 
ËngthLeá
/
Ëngth
 * (
down
[gc]-up[gc]);

152 
ËngthLeá
+=
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
);

153 
r2
 = 
up
[
r
] + 
ËngthLeá
/
Ëngth
 * (
down
[r]-up[r]);

154 
gc2
 = 
up
[
gc
] + 
ËngthLeá
/
Ëngth
 * (
down
[gc]-up[gc]);

157 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
r
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1,„)) );

159 
gamma1
 = 1.0/(1.0+
	`exp
(-(
gc1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
gc
))));

160 
gamma2
 = 1.0/(1.0+
	`exp
(-(
gc2
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
+1, 
gc
))));

161 
gamma
 = (
gamma1
+
gamma2
)/2;

163 
SubM©rix
* 
£gsub
 = 
Ãw
 
	`Segm’tGCM©rix
(
»Ì©e
, 
gamma
);

164 if(
exaùExp
) {

165 
Œy
 {

166 
£gsub
->
	`Compu‹ExpÚ’tŸl
(
rm
*
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
), 
Rš‹r
);

168 
	`ÿtch
 (
e
) {

169 
û¼
 << 
r1
 << " " << 
r2
 << " " << 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
r
è<< " " << brownŸnBridge->g‘V®ue(k+1,„è<< 
’dl
;

170 
û¼
 << 
up
[
r
] << " " << 
down
[r] << " " << 
Ëngth
 << " " << 
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
è<< 
’dl
;

171 
û¼
 << 
brownŸnBridge
->
	`g‘Un™V¬Ÿnû
();

172 
	`ex™
(0);

176 
£gsub
->
	`AµrßchExpÚ’tŸl
(
rm
*
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
), 
Rš‹r
);

178 
d–‘e
 
£gsub
;

179 
	`muÉly
(
Rš‹r
);

183 
i
=0; i<
	`G‘N¡©e
(); i++)

184 
d–‘e
[] 
Rš‹r
[
i
];

185 
d–‘e
[] 
Rš‹r
;

189 
	}
}

192 
vœtu®
 
	$Compu‹StiÚ¬y
() {

194 if(
roÙ
) {

196 
i
=0; i<
	`G‘N¡©e
(); i++) {

197 
¡©iÚ¬y
[
i
] = 
rStiÚ¬y
->
	`G‘A¼ay
()[i];

201 
i
=0; i<
	`G‘N¡©e
(); i++) {

202 
¡©iÚ¬y
[
i
] = 0.25;

205 
	}
}

207 
	$muÉly
(** 
Rš‹r
) {

208 
i
=0; i<
	`G‘N¡©e
(); i++) {

209 
j
=0; j<
	`G‘N¡©e
(); j++) {

210 
tmp
[
i
][
j
] = 0;

211 
k
=0; k<
	`G‘N¡©e
(); k++) {

212 
tmp
[
i
][
j
]+ğ
Rš‹r
[i][
k
]*
R
[k][j];

217 
i
=0; i<
	`G‘N¡©e
(); i++) {

218 
j
=0; j<
	`G‘N¡©e
(); j++)

219 
R
[
i
][
j
] = 
tmp
[i][j];

222 
	}
}

225 
	$£tUp
(cÚ¡ * 
šup
) {

226 
up
 = 
šup
;

227 
	}
}

229 
	$£tDown
(cÚ¡ * 
šdown
) {

230 
down
 = 
šdown
;

231 
	}
}

234 
	$m—nR
() {

236 
	}
}

240 
	g´Ùeùed
 :

241 
BrownŸnBridge
 *
brownŸnBridge
;

242 cÚ¡ *
	gup
, *
	gdown
;

243 
	gdim
;

245 
Profe
 *
	g»Ì©e
;

246 
Profe
 *
	grStiÚ¬y
;

248 cÚ¡ 
	gr
=0;

249 
	ggc
;

251 
boŞ
 
	groÙ
;

252 ** 
	gtmp
;

260 
şass
 
	gRªdomEvŞutiÚGCM©rix
 : 
public
 
EvŞutiÚGCM©rix
,…ubliø
	gRªdomT¿ns™iÚM©rix
 {

262 
	gpublic
 :

264 
RªdomEvŞutiÚGCM©rix
(
RªdomBrownŸnP©h
 *
šbrownŸnP©h
,
MuÉiNÜm®
* 
šup
, MuÉiNÜm®* 
šdown
,
V¬
<
Profe
> *
š»Ì©e
, 
gc
) :

265 
EvŞutiÚGCM©rix
(
šbrownŸnP©h
, 
šup
->
G‘A¼ay
(), 
šdown
->G‘A¼ay(), 
š»Ì©e
, 
gc
) {

266 
	gbrownŸnP©h
 = 
šbrownŸnP©h
;

267 
	gup
 = 
šup
;

268 
	gdown
 = 
šdown
;

269 
	g»Ì©e
 = 
š»Ì©e
;

272 
S‘Name
("Non commutativeransition matrix for‚ucleotidic sequences");

273 
Regi¡”
(
up
);

274 
Regi¡”
(
down
);

275 
Regi¡”
(
brownŸnP©h
);

276 
Regi¡”
(
brownŸnP©h
->
g‘Up
());

277 
Regi¡”
(
brownŸnP©h
->
g‘Down
());

278 
Regi¡”
(
»Ì©e
);

282 
RªdomEvŞutiÚGCM©rix
(
MuÉiNÜm®
* 
šup
, 
V¬
<
Profe
> *
š»Ì©e
, V¬<Profe> *
š¡©iÚ¬y
, 
gc
) :

283 
EvŞutiÚGCM©rix
(
šup
->
G‘A¼ay
(), inup->
G‘Dim
(), 
š»Ì©e
, 
š¡©iÚ¬y
, 
gc
) {

284 
	gup
 = 
šup
;

285 
	g»Ì©e
 = 
š»Ì©e
;

286 
	grStiÚ¬y
 = 
š¡©iÚ¬y
;

288 
S‘Name
("Non commutativeransition matrix for‚ucleotidic sequences");

290 
Regi¡”
(
up
);

291 
Regi¡”
(
»Ì©e
);

292 
Regi¡”
(
rStiÚ¬y
);

297 
S‘P¬am‘”s
() {

301 
Compu‹A¼ay
(è{
	gEvŞutiÚGCM©rix
::ComputeArray();}

302 
Compu‹StiÚ¬y
(è{
	gEvŞutiÚGCM©rix
::ComputeStationary();}

304 
	g´iv©e
 :

306 
RªdomBrownŸnP©h
 *
brownŸnP©h
;

307 
MuÉiNÜm®
 *
	gup
, *
	gdown
;

308 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

309 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

316 
şass
 
	gEvŞutiÚGCBrownŸnProûss
 : 
public
 
B¿nchV®PŒT»e
<
RªdomT¿ns™iÚM©rix
> {

318 
public
:

319 
EvŞutiÚGCBrownŸnProûss
(
BrownŸnProûss
 *
š´oûss
, 
V¬
<
Profe
>* 
š»Ì©e
, V¬<
Un™R—l
>* 
roÙGC¿‹
, 
šgc
è: 
brownŸnProûss
(š´oûss), 
»Ì©e
(š»Ì©e), 
gc
(ingc) {

320 
S‘W™hRoÙ
(
Œue
);

321 
	grStiÚ¬y
 = 
Ãw
 
RoÙStiÚ¬y
(
roÙGC¿‹
);

322 
RecursiveC»©e
(
G‘RoÙ
());

325 
	gvœtu®
 ~
EvŞutiÚGCBrownŸnProûss
() {

326 
RecursiveD–‘e
(
G‘RoÙ
());

330 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

332 
MuÉiNÜm®
* 
	gvup
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
);

333 if(
	glšk
->
isRoÙ
())

334  
Ãw
 
RªdomEvŞutiÚGCM©rix
(
vup
, 
»Ì©e
, 
rStiÚ¬y
, 
gc
);

336 
MuÉiNÜm®
* 
	gvdown
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
->
Out
());

338 
RªdomBrownŸnP©h
* 
	gbrownŸnP©h
 = 
brownŸnProûss
->
G‘Pu»BrownŸnProûss
()->
G‘RªdomBrownŸnP©h
(
lšk
);

341  
Ãw
 
RªdomEvŞutiÚGCM©rix
(
brownŸnP©h
, 
vup
, 
vdown
, 
»Ì©e
, 
gc
);

344 
¥ecŸlUpd©e
() {

345 
RecursiveS³cŸlUpd©e
(
G‘RoÙ
());

348 
RecursiveS³cŸlUpd©e
(cÚ¡ 
Lšk
* 
äom
) {

350 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

351 
RecursiveS³cŸlUpd©e
(
lšk
->
Out
());

352 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

357 
vœtu®
 
T»e
* 
G‘T»e
() {

358  
	gbrownŸnProûss
->
G‘T»e
();

362 
	g´iv©e
:

363 
BrownŸnProûss
* 
brownŸnProûss
;

364 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

365 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

366 
	ggc
;

	@EvolutionNucBrownianProcess.cpp

	@EvolutionNucBrownianProcess.h

1 #iâdeà
EVOLUTIONNUCBROWNIANPROCESS_H


2 
	#EVOLUTIONNUCBROWNIANPROCESS_H


	)

4 
	~"RªdomSubM©rix.h
"

5 
	~"V®T»e.h
"

6 
	~"BrownŸnProûss.h
"

7 
	~"Inv”£Wish¬tM©rix.h
"

10 şas 
	cEvŞutiÚNucM©rix
 : 
public
 
T¿ns™iÚM©rix
 {

12 
public
 :

15 
EvŞutiÚNucM©rix
(
BrownŸnBridge
 *
šbrownŸnBridge
, cÚ¡ * 
šup
, cÚ¡ * 
šdown
, 
SubM©rix
 *
šnucM©rix
, 
šgc
=-1) :

16 
T¿ns™iÚM©rix
(
šnucM©rix
->
	$G‘N¡©e
()) {

17 
nucM©rix
 = 
šnucM©rix
;

19 
brownŸnBridge
 = 
šbrownŸnBridge
;

20 
dim
 = 
brownŸnBridge
->
	`g‘Dim
();

21 
up
 = 
šup
;

22 
down
 = 
šdown
;

24 
gc
 = 
šgc
;

25 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

26 
i
=0; i<
	`G‘N¡©e
(); i++) {

27 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

29 
roÙ
 = 
çl£
;

31 
	`Compu‹A¼ay
();

36 
	`EvŞutiÚNucM©rix
(cÚ¡ * 
šup
, 
šdim
, 
SubM©rix
 *
šnucM©rix
, 
šgc
 = -1) :

37 
	`T¿ns™iÚM©rix
(
šnucM©rix
->
	$G‘N¡©e
()) {

39 
nucM©rix
 = 
šnucM©rix
;

40 
up
 = 
šup
;

41 
dim
 = 
šdim
;

43 
down
 = 0;

44 
brownŸnBridge
 = 0;

46 
gc
 = 
šgc
;

48 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

49 
i
=0; i<
	`G‘N¡©e
(); i++) {

50 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

52 
roÙ
 = 
Œue
;

53 
	`Compu‹A¼ay
();

55 
	}
}

58 ~
	$EvŞutiÚNucM©rix
() {

59 
i
=0; i<
	`G‘N¡©e
(); i++)

60 
d–‘e
[] 
tmp
[
i
];

61 
d–‘e
[] 
tmp
;

62 
	}
}

66 
vœtu®
 
	$Compu‹A¼ay
() {

68 
boŞ
 
exaùExp
 = 
çl£
;

71 
i
=0; i<
	`G‘N¡©e
(); i++)

72 
j
=0; j<
	`G‘N¡©e
(); j++)

73 
R
[
i
][
j
]= (i==j ? 1 : 0);

75 if(!
roÙ
) {

77 
nSegm’ts
 = 
brownŸnBridge
->
	`g‘NSegm’ts
();

78 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

79 
ËngthLeá
 = 0;

81 ** 
Rš‹r
 = 
Ãw
 *[
	`G‘N¡©e
()];

82 
i
=0; i<
	`G‘N¡©e
(); i++)

83 
Rš‹r
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

85 
k
=0; k<
nSegm’ts
; k++) {

88 
r1
 = 
up
[
r
] + 
ËngthLeá
/
Ëngth
 * (
down
[r]-up[r]);

89 
ËngthLeá
+=
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
);

90 
r2
 = 
up
[
r
] + 
ËngthLeá
/
Ëngth
 * (
down
[r]-up[r]);

93 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
r
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1,„)) );

94 if(
exaùExp
) {

95 
Œy
 {

96 
nucM©rix
->
	`Compu‹ExpÚ’tŸl
(
rm
*
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
), 
Rš‹r
);

98 
	`ÿtch
 (
e
) {

99 
û¼
 << 
r1
 << " " << 
r2
 << " " << 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
r
è<< " " << brownŸnBridge->g‘V®ue(k+1,„è<< 
’dl
;

100 
û¼
 << 
up
[
r
] << " " << 
down
[r] << " " << 
Ëngth
 << " " << 
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
è<< 
’dl
;

101 
û¼
 << 
brownŸnBridge
->
	`g‘Un™V¬Ÿnû
();

102 
	`ex™
(0);

107 
nucM©rix
->
	`AµrßchExpÚ’tŸl
(
rm
*
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
), 
Rš‹r
);

109 
	`muÉly
(
Rš‹r
);

113 
i
=0; i<
	`G‘N¡©e
(); i++)

114 
d–‘e
[] 
Rš‹r
[
i
];

115 
d–‘e
[] 
Rš‹r
;

119 
	}
}

122 
vœtu®
 
	$Compu‹StiÚ¬y
() {

123 
i
=0; i<
	`G‘N¡©e
(); i++) {

124 
¡©iÚ¬y
[
i
] = 
nucM©rix
->
	`StiÚ¬y
(i);

126 
	}
}

128 
	$muÉly
(** 
Rš‹r
) {

129 
i
=0; i<
	`G‘N¡©e
(); i++) {

130 
j
=0; j<
	`G‘N¡©e
(); j++) {

131 
tmp
[
i
][
j
] = 0;

132 
k
=0; k<
	`G‘N¡©e
(); k++) {

133 
tmp
[
i
][
j
]+ğ
Rš‹r
[i][
k
]*
R
[k][j];

138 
i
=0; i<
	`G‘N¡©e
(); i++) {

139 
j
=0; j<
	`G‘N¡©e
(); j++)

140 
R
[
i
][
j
] = 
tmp
[i][j];

143 
	}
}

164 
	$£tUp
(cÚ¡ * 
šup
) {

165 
up
 = 
šup
;

166 
	}
}

168 
	$£tDown
(cÚ¡ * 
šdown
) {

169 
down
 = 
šdown
;

170 
	}
}

173 
	$m—nR
() {

175 
	}
}

209 
	g´Ùeùed
 :

210 
BrownŸnBridge
 *
brownŸnBridge
;

211 cÚ¡ *
	gup
, *
	gdown
;

212 
	gdim
;

214 
SubM©rix
 *
	gnucM©rix
;

216 cÚ¡ 
	gr
=0;

217 
	ggc
;

219 
boŞ
 
	groÙ
;

220 ** 
	gtmp
;

228 
şass
 
	gRªdomEvŞutiÚNucM©rix
 : 
public
 
EvŞutiÚNucM©rix
,…ubliø
	gRªdomT¿ns™iÚM©rix
 {

230 
	gpublic
 :

232 
RªdomEvŞutiÚNucM©rix
(
RªdomBrownŸnP©h
 *
šbrownŸnP©h
,
MuÉiNÜm®
* 
šup
, MuÉiNÜm®* 
šdown
,
RªdomSubM©rix
 *
šnucM©rix
) :

233 
EvŞutiÚNucM©rix
(
šbrownŸnP©h
, 
šup
->
G‘A¼ay
(), 
šdown
->G‘A¼ay(), 
šnucM©rix
) {

234 
	gbrownŸnP©h
 = 
šbrownŸnP©h
;

235 
	gup
 = 
šup
;

236 
	gdown
 = 
šdown
;

237 
	gnucM©rix
 = 
šnucM©rix
;

239 
S‘Name
("Non commutativeransition matrix for‚ucleotidic sequences");

241 
Regi¡”
(
up
);

242 
Regi¡”
(
down
);

243 
Regi¡”
(
brownŸnP©h
);

244 
Regi¡”
(
brownŸnP©h
->
g‘Up
());

245 
Regi¡”
(
brownŸnP©h
->
g‘Down
());

246 
Regi¡”
(
nucM©rix
);

250 
RªdomEvŞutiÚNucM©rix
(
MuÉiNÜm®
* 
šup
, 
RªdomSubM©rix
 *
šnucM©rix
) :

251 
EvŞutiÚNucM©rix
(
šup
->
G‘A¼ay
(), inup->
G‘Dim
(), 
šnucM©rix
) {

252 
	gup
 = 
šup
;

253 
	gnucM©rix
 = 
šnucM©rix
;

255 
S‘Name
("Non commutativeransition matrix for‚ucleotidic sequences");

257 
Regi¡”
(
up
);

258 
Regi¡”
(
nucM©rix
);

262 
S‘P¬am‘”s
() {

266 
Compu‹A¼ay
(è{
	gEvŞutiÚNucM©rix
::ComputeArray();}

267 
Compu‹StiÚ¬y
(è{
	gEvŞutiÚNucM©rix
::ComputeStationary();}

269 
	g´iv©e
 :

271 
RªdomBrownŸnP©h
 *
brownŸnP©h
;

272 
MuÉiNÜm®
 *
	gup
, *
	gdown
;

273 
RªdomSubM©rix
 *
	gnucM©rix
;

280 
şass
 
	gEvŞutiÚNucBrownŸnProûss
 : 
public
 
B¿nchV®PŒT»e
<
RªdomT¿ns™iÚM©rix
> {

282 
public
:

283 
EvŞutiÚNucBrownŸnProûss
(
BrownŸnProûss
 *
š´oûss
, 
RªdomSubM©rix
* 
šnucM©rix
, 
šgc
, 
š‰
è: 
brownŸnProûss
(š´oûss), 
nucM©rix
(šnucM©rix), 
gc
(ingc) {

284 
S‘W™hRoÙ
(
Œue
);

285 
RecursiveC»©e
(
G‘RoÙ
());

288 
	gvœtu®
 ~
EvŞutiÚNucBrownŸnProûss
() {

289 
RecursiveD–‘e
(
G‘RoÙ
());

293 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

296 
MuÉiNÜm®
* 
	gvup
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
);

297 if(
	glšk
->
isRoÙ
())

298  
Ãw
 
RªdomEvŞutiÚNucM©rix
(
vup
, 
nucM©rix
);

300 
MuÉiNÜm®
* 
	gvdown
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
->
Out
());

302 
RªdomBrownŸnP©h
* 
	gbrownŸnP©h
 = 
brownŸnProûss
->
G‘Pu»BrownŸnProûss
()->
G‘RªdomBrownŸnP©h
(
lšk
);

305  
Ãw
 
RªdomEvŞutiÚNucM©rix
(
brownŸnP©h
, 
vup
, 
vdown
, 
nucM©rix
);

308 
¥ecŸlUpd©e
() {

309 
RecursiveS³cŸlUpd©e
(
G‘RoÙ
());

312 
RecursiveS³cŸlUpd©e
(cÚ¡ 
Lšk
* 
äom
) {

313 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

314 
RecursiveS³cŸlUpd©e
(
lšk
->
Out
());

315 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

320 
vœtu®
 
T»e
* 
G‘T»e
() {

321  
	gbrownŸnProûss
->
G‘T»e
();

325 
	g´iv©e
:

326 
BrownŸnProûss
* 
brownŸnProûss
;

327 
RªdomSubM©rix
* 
	gnucM©rix
;

328 
	ggc
;

	@EvolutionOmegaBrownianProcess.h

1 #iâdeà
EVOLUTIONOMEGABROWNIANPROCESS_H


2 
	#EVOLUTIONOMEGABROWNIANPROCESS_H


	)

5 
	~"RªdomSubM©rix.h
"

6 
	~"V®T»e.h
"

7 
	~"BrownŸnProûss.h
"

8 
	~"Inv”£Wish¬tM©rix.h
"

11 şas 
	cSegm’tOmegaM©rix
 : 
public
 
SubM©rix
 {

12 
public
 :

13 
	$Segm’tOmegaM©rix
(
SubM©rix
* 
šnucM©rix
, 
šomega
, 
CodÚS‹S·û
 *
š¡©eS·û
è: 
	`SubM©rix
(š¡©eS·û->
	$G‘N¡©e
()) {

14 
nucM©rix
 = 
šnucM©rix
;

15 
omega
 = 
šomega
;

16 
¡©eS·û
 = 
š¡©eS·û
;

19 
	$Compu‹A¼ay
(
i
) {

23 
tÙ
 = 0;

24 
j
=0; j<
	`G‘N¡©e
(); j++) {

25 if(
i
!=
j
) {

26 
s
 = 0;

27 
diff
 = 
¡©eS·û
->
	`G‘DifãršgPos™iÚ
(
i
, 
j
);

28 if(
diff
<3)

29 
s
 = 
nucM©rix
->
	`G‘Row
(
¡©eS·û
->
	`G‘CodÚPos™iÚ
(
diff
, 
i
))[¡©eS·û->G‘CodÚPos™iÚ(diff, 
j
)];

30 if(
¡©eS·û
->
	`SynÚymous
(
i
, 
j
))

31 
s
 *ğ
omega
;

33 
Q
[
i
][
j
] = 
s
;

34 
tÙ
+=
s
;

37 
Q
[
i
][i]=-
tÙ
;

38 if(
Q
[
i
][i] == 0) {

39 
û¼
 << "Q[i][i] = 0" << 
’dl
;

40 
	`ex™
(0);

44 
	}
}

46 
	$Compu‹StiÚ¬y
() {

47 
i
=0; i<
	`G‘N¡©e
(); i++)

48 
mStiÚ¬y
[
i
] = 
nucM©rix
->
	`G‘StiÚ¬y
()[
¡©eS·û
->
	`G‘CodÚPos™iÚ
(0, i)]*nucMatrix->GetStationary()[stateSpace->GetCodonPosition(1, i)]*nucMatrix->GetStationary()[stateSpace->GetCodonPosition(2, i)];

49 
	}
}

52 
	g´iv©e
 :

53 
SubM©rix
* 
nucM©rix
;

54 
	gomega
;

55 
CodÚS‹S·û
 *
	g¡©eS·û
;

59 şas 
	cEvŞutiÚOmegaM©rix
 : 
public
 
T¿ns™iÚM©rix
 {

61 
public
 :

64 
	$EvŞutiÚOmegaM©rix
(
RªdomBrownŸnP©h
* 
šbridge
, cÚ¡ * 
šup
, cÚ¡ * 
šdown
, 
SubM©rix
* 
šnucM©rix
, 
CodÚS‹S·û
* 
š¡©eS·û
, 
šposomega
) :

65 
	`T¿ns™iÚM©rix
(
š¡©eS·û
->
	$G‘N¡©e
()) {

66 
nucM©rix
 = 
šnucM©rix
;

67 
¡©eS·û
 = 
š¡©eS·û
;

69 
brownŸnBridge
 = 
šbridge
;

70 
dim
 = 
brownŸnBridge
->
	`g‘Dim
();

71 
up
 = 
šup
;

72 
down
 = 
šdown
;

74 
posomega
 = 
šposomega
;

76 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

77 
i
=0; i<
	`G‘N¡©e
(); i++) {

78 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

80 
roÙ
 = 
çl£
;

82 
	`Compu‹A¼ay
();

83 
	`Compu‹StiÚ¬y
();

87 
	$EvŞutiÚOmegaM©rix
(cÚ¡ * 
šup
, 
šdim
, 
SubM©rix
* 
šnucM©rix
, 
CodÚS‹S·û
* 
š¡©eS·û
, 
šposomega
) :

88 
	`T¿ns™iÚM©rix
(
š¡©eS·û
->
	$G‘N¡©e
()) {

90 
nucM©rix
 = 
šnucM©rix
;

91 
¡©eS·û
 = 
š¡©eS·û
;

93 
up
 = 
šup
;

94 
dim
 = 
šdim
;

96 
down
 = 0;

97 
brownŸnBridge
 = 0;

99 
posomega
 = 
šposomega
;

101 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

102 
i
=0; i<
	`G‘N¡©e
(); i++) {

103 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

105 
roÙ
 = 
Œue
;

106 
	`Compu‹A¼ay
();

107 
	`Compu‹StiÚ¬y
();

109 
	}
}

111 ~
	$EvŞutiÚOmegaM©rix
() {

112 
i
=0; i<
	`G‘N¡©e
(); i++)

113 
d–‘e
[] 
tmp
[
i
];

114 
d–‘e
[] 
tmp
;

115 
	}
}

119 
vœtu®
 
	$Compu‹A¼ay
() {

121 
boŞ
 
exaùExp
 = 
çl£
;

124 
i
=0; i<
	`G‘N¡©e
(); i++)

125 
j
=0; j<
	`G‘N¡©e
(); j++)

126 
R
[
i
][
j
]= (i==j ? 1 : 0);

128 if(!
roÙ
) {

130 
nSegm’ts
 = 
brownŸnBridge
->
	`g‘NSegm’ts
();

131 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

132 
ËngthLeá
 = 0;

134 ** 
Rš‹r
 = 
Ãw
 *[
	`G‘N¡©e
()];

135 
i
=0; i<
	`G‘N¡©e
(); i++)

136 
Rš‹r
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

138 
k
=0; k<
nSegm’ts
; k++) {

141 
r1
 = 
up
[
r
] + 
ËngthLeá
/
Ëngth
 * (
down
[r]-up[r]);

142 
omega1
 = 
up
[
posomega
] + 
ËngthLeá
/
Ëngth
 * (
down
[posomega]-up[posomega]);

143 
ËngthLeá
+=
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
);

144 
r2
 = 
up
[
r
] + 
ËngthLeá
/
Ëngth
 * (
down
[r]-up[r]);

145 
omega2
 = 
up
[
posomega
] + 
ËngthLeá
/
Ëngth
 * (
down
[posomega]-up[posomega]);

148 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
r
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1,„)) );

149 
omegam
 = 0.5 * ( 
	`exp
(
omega1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
posomega
)è+ƒxp(
omega2
 + brownianBridge->getValue(k+1,…osomega)) );

152 
SubM©rix
* 
£gsub
 = 
Ãw
 
	`Segm’tOmegaM©rix
(
nucM©rix
, 
omegam
, 
¡©eS·û
);

153 if(
exaùExp
) {

154 
Œy
 {

155 
£gsub
->
	`Compu‹ExpÚ’tŸl
(
rm
*
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
), 
Rš‹r
);

157 
	`ÿtch
 (
e
) {

158 
û¼
 << 
r1
 << " " << 
r2
 << " " << 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
r
è<< " " << brownŸnBridge->g‘V®ue(k+1,„è<< 
’dl
;

159 
û¼
 << 
up
[
r
] << " " << 
down
[r] << " " << 
Ëngth
 << " " << 
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
è<< 
’dl
;

160 
û¼
 << 
brownŸnBridge
->
	`g‘Un™V¬Ÿnû
();

161 
	`ex™
(0);

165 
£gsub
->
	`AµrßchExpÚ’tŸl
(
rm
*
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
), 
Rš‹r
);

167 
d–‘e
 
£gsub
;

168 
	`muÉly
(
Rš‹r
);

172 
i
=0; i<
	`G‘N¡©e
(); i++)

173 
d–‘e
[] 
Rš‹r
[
i
];

174 
d–‘e
[] 
Rš‹r
;

177 
	}
}

180 
vœtu®
 
	$Compu‹StiÚ¬y
() {

181 
i
=0; i<
	`G‘N¡©e
(); i++) {

182 
¡©iÚ¬y
[
i
] = 
nucM©rix
->
	`G‘StiÚ¬y
()[
¡©eS·û
->
	`G‘CodÚPos™iÚ
(0, i)]*nucMatrix->GetStationary()[stateSpace->GetCodonPosition(1, i)]*nucMatrix->GetStationary()[stateSpace->GetCodonPosition(2, i)];

184 
	}
}

186 
	$muÉly
(** 
Rš‹r
) {

187 
i
=0; i<
	`G‘N¡©e
(); i++) {

188 
j
=0; j<
	`G‘N¡©e
(); j++) {

189 
tmp
[
i
][
j
] = 0;

190 
k
=0; k<
	`G‘N¡©e
(); k++) {

191 
tmp
[
i
][
j
]+ğ
Rš‹r
[i][
k
]*
R
[k][j];

196 
i
=0; i<
	`G‘N¡©e
(); i++) {

197 
j
=0; j<
	`G‘N¡©e
(); j++)

198 
R
[
i
][
j
] = 
tmp
[i][j];

201 
	}
}

204 
	$£tUp
(cÚ¡ * 
šup
) {

205 
up
 = 
šup
;

206 
	}
}

208 
	$£tDown
(cÚ¡ * 
šdown
) {

209 
down
 = 
šdown
;

210 
	}
}

213 
	$m—nR
() {

215 
	}
}

219 
	g´Ùeùed
 :

220 
BrownŸnBridge
 *
brownŸnBridge
;

221 cÚ¡ *
	gup
, *
	gdown
;

222 
	gdim
;

224 
SubM©rix
 *
	gnucM©rix
;

225 
CodÚS‹S·û
 *
	g¡©eS·û
;

227 cÚ¡ 
	gr
=0;

228 
	gposomega
;

230 
boŞ
 
	groÙ
;

231 ** 
	gtmp
;

239 
şass
 
	gRªdomEvŞutiÚOmegaM©rix
 : 
public
 
EvŞutiÚOmegaM©rix
,…ubliø
	gRªdomT¿ns™iÚM©rix
 {

241 
	gpublic
 :

243 
RªdomEvŞutiÚOmegaM©rix
(
RªdomBrownŸnP©h
 *
šbrownŸnP©h
,
MuÉiNÜm®
* 
šup
, MuÉiNÜm®* 
šdown
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
CodÚS‹S·û
 *
š¡©eS·û
, 
posomega
) :

244 
EvŞutiÚOmegaM©rix
(
šbrownŸnP©h
, 
šup
->
G‘A¼ay
(), 
šdown
->G‘A¼ay(), 
šnucM©rix
, 
š¡©eS·û
, 
posomega
) {

245 
	gbrownŸnP©h
 = 
šbrownŸnP©h
;

246 
	gnucM©rix
 = 
šnucM©rix
;

247 
	g¡©eS·û
 = 
š¡©eS·û
;

248 
	gup
 = 
šup
;

249 
	gdown
 = 
šdown
;

252 
S‘Name
("Non commutativeransition matrix for‚ucleotidic sequences");

253 
Regi¡”
(
up
);

254 
Regi¡”
(
down
);

255 
Regi¡”
(
brownŸnP©h
);

256 
Regi¡”
(
brownŸnP©h
->
g‘Up
());

257 
Regi¡”
(
brownŸnP©h
->
g‘Down
());

258 
Regi¡”
(
nucM©rix
);

262 
RªdomEvŞutiÚOmegaM©rix
(
MuÉiNÜm®
* 
šup
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
CodÚS‹S·û
 *
š¡©eS·û
, 
posomega
) :

263 
EvŞutiÚOmegaM©rix
(
šup
->
G‘A¼ay
(), inup->
G‘Dim
(), 
šnucM©rix
, 
š¡©eS·û
, 
posomega
) {

264 
	gup
 = 
šup
;

265 
	gnucM©rix
 = 
šnucM©rix
;

266 
	g¡©eS·û
 = 
š¡©eS·û
;

268 
S‘Name
("Non commutativeransition matrix for‚ucleotidic sequences");

270 
Regi¡”
(
up
);

271 
Regi¡”
(
nucM©rix
);

276 
S‘P¬am‘”s
() {

280 
Compu‹A¼ay
(è{
	gEvŞutiÚOmegaM©rix
::ComputeArray();}

281 
Compu‹StiÚ¬y
(è{
	gEvŞutiÚOmegaM©rix
::ComputeStationary();}

283 
	g´iv©e
 :

285 
RªdomBrownŸnP©h
 *
brownŸnP©h
;

286 
MuÉiNÜm®
 *
	gup
, *
	gdown
;

287 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

288 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

290 
GTRRªdomSubM©rixW™hNÜmR©es
 *
	gnucM©rix
;

291 
CodÚS‹S·û
 *
	g¡©eS·û
;

298 
şass
 
	gEvŞutiÚOmegaBrownŸnProûss
 : 
public
 
B¿nchV®PŒT»e
<
RªdomT¿ns™iÚM©rix
> {

300 
public
:

301 
EvŞutiÚOmegaBrownŸnProûss
(
BrownŸnProûss
 *
š´oûss
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
CodÚS‹S·û
 *
š¡©eS·û
, 
šposomega
è: 
brownŸnProûss
(š´oûss), 
posomega
(inposomega) {

302 
S‘W™hRoÙ
(
Œue
);

303 
	gnucM©rix
 = 
šnucM©rix
;

304 
	g¡©eS·û
 = 
š¡©eS·û
;

305 
RecursiveC»©e
(
G‘RoÙ
());

308 
	gvœtu®
 ~
EvŞutiÚOmegaBrownŸnProûss
() {

309 
RecursiveD–‘e
(
G‘RoÙ
());

313 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

315 
MuÉiNÜm®
* 
	gvup
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
);

316 if(
	glšk
->
isRoÙ
())

317  
Ãw
 
RªdomEvŞutiÚOmegaM©rix
(
vup
, 
nucM©rix
, 
¡©eS·û
, 
posomega
);

319 
MuÉiNÜm®
* 
	gvdown
 = 
brownŸnProûss
->
G‘In¡ªtProûss
()->
G‘MuÉiNÜm®
(
lšk
->
Out
());

321 
RªdomBrownŸnP©h
* 
	gbrownŸnP©h
 = 
brownŸnProûss
->
G‘Pu»BrownŸnProûss
()->
G‘RªdomBrownŸnP©h
(
lšk
);

324  
Ãw
 
RªdomEvŞutiÚOmegaM©rix
(
brownŸnP©h
, 
vup
, 
vdown
, 
nucM©rix
, 
¡©eS·û
, 
posomega
);

327 
¥ecŸlUpd©e
() {

328 
RecursiveS³cŸlUpd©e
(
G‘RoÙ
());

331 
RecursiveS³cŸlUpd©e
(cÚ¡ 
Lšk
* 
äom
) {

333 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

334 
RecursiveS³cŸlUpd©e
(
lšk
->
Out
());

335 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

340 
vœtu®
 
T»e
* 
G‘T»e
() {

341  
	gbrownŸnProûss
->
G‘T»e
();

345 
	g´iv©e
:

346 
BrownŸnProûss
* 
brownŸnProûss
;

347 
GTRRªdomSubM©rixW™hNÜmR©es
 *
	gnucM©rix
;

348 
CodÚS‹S·û
 *
	g¡©eS·û
;

349 
	gposomega
;

	@EvolutionSegmentedCompoProcess.h

8 #iâdeà
EVOLUTIONSEGMENTEDCOMPOPROCESS_H


9 
	#EVOLUTIONSEGMENTEDCOMPOPROCESS_H


	)

11 
	~"EvŞutiÚSegm’‹dProûss.h
"

12 
	~"ChrÚo.h
"

13 
	~"BrownŸnMove.h
"

14 
	~"SumCÚ¡¿šed.h
"

16 şas 
	cCompoM©rix
 : 
vœtu®
 
public
 
EvŞutiÚSegm’‹dM©rix
 {

17 
public
 :

20 
CompoM©rix
(
RªdomBrownŸnP©h
* 
bridge
, 
V¬
<
R—lVeùÜ
>* 
up
, V¬<R—lVeùÜ>* 
down
, 
Profe
 *
š»Ì©e
, 
SumCÚ¡¿šedM­pšg
* 
šm­pšg
, 
k
, 
šoff£t
, 
N¡©e
) :

21 
T¿ns™iÚM©rix
(
N¡©e
), 
	$EvŞutiÚSegm’‹dM©rix
(
bridge
, 
up
, 
down
, 
N¡©e
, 
k
) {

22 
»Ì©e
 = 
š»Ì©e
;

23 
rStiÚ¬y
 = 0;

24 
off£t
 = 
šoff£t
;

25 
m­pšg
 = 
šm­pšg
;

27 
	`Compu‹A¼ay
();

31 
vœtu®
 
	$Compu‹R
(
ËngthLeá
, 
l
) {

34 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

35 
dt
 = 
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
);

38 
r1
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

39 
r2
 = 
up
[
POS_R
] + (
ËngthLeá
 + 
dt
)/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

42 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
POS_R
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1, POS_R)) );

45 ** 
b
 = 
m­pšg
->
ba£
;

47 
‹mpup
[
	`G‘N¡©e
()];

48 
‹mpdown
[
	`G‘N¡©e
()];

50 
¡©
[
	`G‘N¡©e
()];

52 
‹mpup
[0] = 0;

53 
‹mpdown
[0] = 0;

55 
i
=0; i<
	`G‘N¡©e
()-1; i++) {

56 
‹mpup
[
i
+1] = 
up
[
off£t
] + 
ËngthLeá
/
Ëngth
 * (
down
[off£t]-up[off£t]è+ 
brownŸnBridge
->
	`g‘V®ue
(
k
,offset);

57 
‹mpdown
[
i
+1] = 
up
[
off£t
] + (
ËngthLeá
 + 
dt
)/
Ëngth
 * (
down
[off£t]-up[off£t]è+ 
brownŸnBridge
->
	`g‘V®ue
(
k
,offset);

60 
tÙ®
 = 0;

61 
tÙup
 = 0;

62 
tÙdown
 = 0;

63 
i
=0; i<
	`G‘N¡©e
(); i++) {

64 
tmpup
 = 0;

65 
tmpdown
 = 0;

66 
j
=0; j<
	`G‘N¡©e
(); j++) {

67 
tmpup
 +ğ
b
[
j
][
i
] * 
‹mpup
[j];

68 
tmpdown
 +ğ
b
[
j
][
i
] * 
‹mpdown
[j];

70 
tÙup
 +ğ
tmpup
;

71 
tÙdown
 +ğ
tmpdown
;

72 
¡©
[
i
] = 
	`exp
(
tmpup
è+ƒxp(
tmpdown
);

73 
tÙ®
 +ğ
¡©
[
i
];

75 ià(
	`çbs
(
tÙup
) > 1e-6) {

76 
û¼
 << "error :‚on matching sum\n";

77 
û¼
 << "u°: " << 
tÙup
 << '\n';

79 ià(
	`çbs
(
tÙdown
) > 1e-6) {

80 
û¼
 << "error :‚on matching sum\n";

81 
û¼
 << "dowÀ: " << 
tÙdown
 << '\n';

83 
i
=0; i<
	`G‘N¡©e
(); i++) {

84 
¡©
[
i
] /ğ
tÙ®
;

87 
i
=0; i<
	`G‘N¡©e
(); i++) {

88 
tÙ
 = 0;

89 
j
=0; j<
	`G‘N¡©e
(); j++) {

90 if(
i
!=
j
) {

91 
R
[
i
][
j
] = 
rm
*
l
*
	`R–©iveR©e
(i,jè* 
¡©
[j];

92 
tÙ
+=
R
[
i
][
j
];

95 
R
[
i
][i]=-
tÙ
;

97 
	}
}

99 
	$R–©iveR©e
(
i
, 
j
è{ (*
»Ì©e
)[
	`¼šdex
(i,j,
	`G‘N¡©e
())];
	}
}

101 
	$¼šdex
(
i
, 
j
, 
n¡©e
) {

102  (
i
<
j
è? (2 * 
n¡©e
 - i - 1) * i / 2 + j - i - 1 : (2 *‚state - j - 1) * j / 2 + i - j - 1 ;

103 
	}
}

106 
vœtu®
 
	$Compu‹StiÚ¬y
() {

107 
i
=0; i<
	`G‘N¡©e
(); i++) {

108 
¡©iÚ¬y
[
i
] = 1.0 / 
	`G‘N¡©e
();

110 
	}
}

112 
	g´iv©e
 :

114 
Profe
 *
»Ì©e
;

115 
Profe
* 
	grStiÚ¬y
;

116 
SumCÚ¡¿šedM­pšg
* 
	gm­pšg
;

117 
	goff£t
;

121 
şass
 
	gRoÙCompoM©rix
 : 
vœtu®
 
public
 
T¿ns™iÚM©rix
, vœtu®…ubliø
	gRªdomT¿ns™iÚM©rix
 {

122 
	gpublic
 :

123 
RoÙCompoM©rix
(
V¬
<
Profe
>* 
š¡©iÚ¬y
, 
N¡©e
è: 
T¿ns™iÚM©rix
(N¡©e, 0, in¡©iÚ¬y->
G‘A¼ay
()) {

124 
Regi¡”
(
š¡©iÚ¬y
);

128 
vœtu®
 
Compu‹A¼ay
() {

130 
vœtu®
 
Compu‹StiÚ¬y
() {

132 
vœtu®
 
S‘P¬am‘”s
() {

135 
	g´iv©e
 :

139 şas 
	cEvŞutiÚSegm’‹dCompoB¿nch
 : 
public
 
EvŞutiÚSegm’‹dB¿nch
 {

141 
public
 :

143 
EvŞutiÚSegm’‹dCompoB¿nch
(
RªdomBrownŸnP©h
* 
šbridge
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, V¬<
Profe
>* 
š»Ì©e
, 
SumCÚ¡¿šedM­pšg
* 
šm­pšg
, 
šoff£t
, 
nS‹
, 
boŞ
 
·¿l
) :

144 
	$EvŞutiÚSegm’‹dB¿nch
(
šbridge
, 
šup
, 
šdown
, 
nS‹
, 
·¿l
) {

145 
»Ì©e
 = 
š»Ì©e
;

146 
m­pšg
 = 
šm­pšg
;

147 
off£t
 = 
šoff£t
;

148 
	`Regi¡”
(
»Ì©e
);

149 
	`C»©eAÎP
();

152 
	`EvŞutiÚSegm’‹dCompoB¿nch
(
V¬
<
R—lVeùÜ
>* 
šup
, V¬<
Profe
>* 
š¡©iÚ¬y
) :

153 
	`EvŞutiÚSegm’‹dB¿nch
(
šup
, 
š¡©iÚ¬y
->
	$G‘Dim
()) {

154 
rStiÚ¬y
 = 
š¡©iÚ¬y
;

155 
	`Regi¡”
(
rStiÚ¬y
);

156 
glob®T¿nsM©rix
 = 
	`C»©eRoÙM©rix
();

157 
	}
}

159 
vœtu®
 
EvŞutiÚSegm’‹dM©rix
* 
	$C»©eP
(
i
) {

160 
CompoM©rix
* 
tmp
 = 
Ãw
 
	`CompoM©rix
(
bridge
, 
up
, 
down
, 
»Ì©e
, 
m­pšg
, 
i
, 
off£t
, 
	`G‘N¡©e
());

161  
tmp
;

162 
	}
}

164 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
	$C»©eRoÙM©rix
() {

165  
Ãw
 
	`RoÙCompoM©rix
(
rStiÚ¬y
,„StiÚ¬y->
	`G‘Dim
());

166 
	}
}

168 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

169 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

170 
SumCÚ¡¿šedM­pšg
* 
	gm­pšg
;

171 
	goff£t
;

174 
şass
 
	gRoÙCompoStiÚ¬y
 : 
public
 
Dv¬
<
Profe
> {

175 
public
 :

176 
RoÙCompoStiÚ¬y
(
V¬
<
Un™R—l
> *
šgamma
) {

177 
dim
 = 4;

178 
	g´ofe
 = 
Ãw
 [
dim
];

179 
	ggamma
 = 
šgamma
;

180 
Regi¡”
(
gamma
);

181 
¥ecŸlUpd©e
();

185 
¥ecŸlUpd©e
() {

186 
	gi
=0; i<
	gdim
; i++)

187 
	g´ofe
[
i
] = ((˜=ğ1 || i =ğ2è? 
gamma
->
v®
()/2 : (1-gamma->val())/2);

190 
	gV¬
<
	gUn™R—l
> *
	ggamma
;

194 şas 
	cEvŞutiÚSegm’‹dCompoProûss
 : 
public
 
EvŞutiÚSegm’‹dProûss
 {

196 
public
 :

198 
EvŞutiÚSegm’‹dCompoProûss
(
BrownŸnProûss
 *
š´oûss
, 
V¬
<
Profe
>* 
š»Ì©e
, V¬<Profe>* 
roÙ¡©
, 
SumCÚ¡¿šedM­pšg
* 
šm­pšg
, 
šoff£t
, 
boŞ
 
·¿l
) :

199 
	$EvŞutiÚSegm’‹dProûss
(
š´oûss
, 
·¿l
) {

200 
»Ì©e
 = 
š»Ì©e
;

201 
rStiÚ¬y
 = 
roÙ¡©
;

202 
m­pšg
 = 
šm­pšg
;

203 
off£t
 = 
šoff£t
;

204 
	`RecursiveC»©e
(
	`G‘RoÙ
());

207 
vœtu®
 
EvŞutiÚSegm’‹dB¿nch
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
äom
) {

209 
MuÉiNÜm®
* 
vup
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
);

211 if(
äom
->
	`isRoÙ
()) {

212 
EvŞutiÚSegm’‹dB¿nch
* 
tmp
 = 
Ãw
 
	`EvŞutiÚSegm’‹dCompoB¿nch
(
vup
, 
rStiÚ¬y
);

213  
tmp
;

216 
MuÉiNÜm®
* 
vdown
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Out
());

219 
RªdomBrownŸnP©h
* 
brownŸnP©h
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
);

221 
EvŞutiÚSegm’‹dB¿nch
* 
tmp
 = 
Ãw
 
	`EvŞutiÚSegm’‹dCompoB¿nch
(
brownŸnP©h
, 
vup
, 
vdown
, 
»Ì©e
, 
m­pšg
, 
off£t
, 
rStiÚ¬y
->
	`G‘Dim
(), 
·¿l
);

222  
tmp
;

223 
	}
}

227 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

228 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

229 
SumCÚ¡¿šedM­pšg
* 
	gm­pšg
;

230 
	goff£t
;

	@EvolutionSegmentedGCProcess.h

8 #iâdeà
EVOLUTIONSEGMENTEDGCPROCESS_H


9 
	#EVOLUTIONSEGMENTEDGCPROCESS_H


	)

11 
	~"EvŞutiÚSegm’‹dProûss.h
"

12 
	~"ChrÚo.h
"

13 
	~"BrownŸnMove.h
"

15 şas 
	cGCM©rix
 : 
vœtu®
 
public
 
EvŞutiÚSegm’‹dM©rix
 {

16 
public
 :

19 
GCM©rix
(
RªdomBrownŸnP©h
* 
bridge
, 
V¬
<
R—lVeùÜ
>* 
up
, V¬<R—lVeùÜ>* 
down
, 
Profe
 *
š»Ì©e
, 
k
, 
šgc
) :

20 
T¿ns™iÚM©rix
(4), 
	$EvŞutiÚSegm’‹dM©rix
(
bridge
, 
up
, 
down
, 4, 
k
) {

21 
»Ì©e
 = 
š»Ì©e
;

22 
rStiÚ¬y
 = 0;

23 
gc
 = 
šgc
;

25 
	`Compu‹A¼ay
();

29 
vœtu®
 
	$Compu‹R
(
ËngthLeá
, 
l
) {

32 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

35 
r1
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

36 
gc1
 = 
up
[
gc
] + 
ËngthLeá
/
Ëngth
 * (
down
[gc]-up[gc]);

37 
ËngthLeá
+=
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
);

38 
r2
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

39 
gc2
 = 
up
[
gc
] + 
ËngthLeá
/
Ëngth
 * (
down
[gc]-up[gc]);

42 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
POS_R
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1, POS_R)) );

44 
gamma1
 = 1.0/(1.0+
	`exp
(-(
gc1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
gc
))));

45 
gamma2
 = 1.0/(1.0+
	`exp
(-(
gc2
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
+1, 
gc
))));

46 
gamma
 = (
gamma1
+
gamma2
)/2;

48 
i
=0; i<
	`G‘N¡©e
(); i++) {

49 
tÙ
 = 0;

50 
j
=0; j<
	`G‘N¡©e
(); j++) {

51 if(
i
!=
j
) {

53 
R
[
i
][
j
] = 
rm
*
l
*
	`R–©iveR©e
(i,jè* ((j =ğ1 || j =ğ2è? 
gamma
/2 : (1-gamma)/2);

54 
tÙ
+=
R
[
i
][
j
];

57 
R
[
i
][i]=-
tÙ
;

61 
	}
}

63 
	$R–©iveR©e
(
i
, 
j
è{ (*
»Ì©e
)[
	`¼šdex
(i,j,
	`G‘N¡©e
())];
	}
}

65 
	$¼šdex
(
i
, 
j
, 
n¡©e
) {

66  (
i
<
j
è? (2 * 
n¡©e
 - i - 1) * i / 2 + j - i - 1 : (2 *‚state - j - 1) * j / 2 + i - j - 1 ;

67 
	}
}

70 
vœtu®
 
	$Compu‹StiÚ¬y
() {

72 
i
=0; i<
	`G‘N¡©e
(); i++) {

73 
¡©iÚ¬y
[
i
] = 0.25;

75 
	}
}

77 
	g´iv©e
 :

79 
Profe
 *
»Ì©e
;

80 
Profe
* 
	grStiÚ¬y
;

81 
	ggc
;

85 
şass
 
	gRoÙGCM©rix
 : 
vœtu®
 
public
 
T¿ns™iÚM©rix
, vœtu®…ubliø
	gRªdomT¿ns™iÚM©rix
 {

86 
	gpublic
 :

87 
RoÙGCM©rix
(
V¬
<
Profe
>* 
š¡©iÚ¬y
, 
N¡©e
è: 
T¿ns™iÚM©rix
(N¡©e, 0, in¡©iÚ¬y->
G‘A¼ay
()) {

88 
Regi¡”
(
š¡©iÚ¬y
);

92 
vœtu®
 
Compu‹A¼ay
() {

94 
vœtu®
 
Compu‹StiÚ¬y
() {

96 
vœtu®
 
S‘P¬am‘”s
() {

99 
	g´iv©e
 :

103 şas 
	cEvŞutiÚSegm’‹dGCB¿nch
 : 
public
 
EvŞutiÚSegm’‹dB¿nch
 {

105 
public
 :

107 
EvŞutiÚSegm’‹dGCB¿nch
(
RªdomBrownŸnP©h
* 
šbridge
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, V¬<
Profe
>* 
š»Ì©e
, 
nS‹
, 
boŞ
 
·¿l
) :

108 
	$EvŞutiÚSegm’‹dB¿nch
(
šbridge
, 
šup
, 
šdown
, 
nS‹
, 
·¿l
) {

109 
»Ì©e
 = 
š»Ì©e
;

110 
	`Regi¡”
(
»Ì©e
);

111 
	`C»©eAÎP
();

114 
	`EvŞutiÚSegm’‹dGCB¿nch
(
V¬
<
R—lVeùÜ
>* 
šup
, V¬<
Profe
>* 
š¡©iÚ¬y
) :

115 
	`EvŞutiÚSegm’‹dB¿nch
(
šup
, 
š¡©iÚ¬y
->
	$G‘Dim
()) {

116 
rStiÚ¬y
 = 
š¡©iÚ¬y
;

117 
	`Regi¡”
(
rStiÚ¬y
);

118 
glob®T¿nsM©rix
 = 
	`C»©eRoÙM©rix
();

119 
	}
}

121 
vœtu®
 
EvŞutiÚSegm’‹dM©rix
* 
	$C»©eP
(
i
) {

122  
Ãw
 
	`GCM©rix
(
bridge
, 
up
, 
down
, 
»Ì©e
, 
i
, 1);

123 
	}
}

125 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
	$C»©eRoÙM©rix
() {

126  
Ãw
 
	`RoÙGCM©rix
(
rStiÚ¬y
,„StiÚ¬y->
	`G‘Dim
());

127 
	}
}

129 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

130 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

134 
şass
 
	gRoÙGCStiÚ¬y
 : 
public
 
Dv¬
<
Profe
> {

135 
public
 :

136 
RoÙGCStiÚ¬y
(
V¬
<
Un™R—l
> *
šgamma
) {

137 
dim
 = 4;

138 
	g´ofe
 = 
Ãw
 [
dim
];

139 
	ggamma
 = 
šgamma
;

140 
Regi¡”
(
gamma
);

141 
¥ecŸlUpd©e
();

145 
¥ecŸlUpd©e
() {

146 
	gi
=0; i<
	gdim
; i++)

147 
	g´ofe
[
i
] = ((˜=ğ1 || i =ğ2è? 
gamma
->
v®
()/2 : (1-gamma->val())/2);

150 
	gV¬
<
	gUn™R—l
> *
	ggamma
;

154 şas 
	cEvŞutiÚSegm’‹dGCProûss
 : 
public
 
EvŞutiÚSegm’‹dProûss
 {

156 
public
 :

158 
EvŞutiÚSegm’‹dGCProûss
(
BrownŸnProûss
 *
š´oûss
, 
V¬
<
Profe
>* 
š»Ì©e
, V¬<
Un™R—l
>* 
roÙGC¿‹
, 
boŞ
 
·¿l
) :

159 
	$EvŞutiÚSegm’‹dProûss
(
š´oûss
, 
·¿l
) {

160 
»Ì©e
 = 
š»Ì©e
;

161 
rStiÚ¬y
 = 
Ãw
 
	`RoÙGCStiÚ¬y
(
roÙGC¿‹
);

162 
	`RecursiveC»©e
(
	`G‘RoÙ
());

165 
vœtu®
 
EvŞutiÚSegm’‹dB¿nch
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
äom
) {

167 
MuÉiNÜm®
* 
vup
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
);

169 if(
äom
->
	`isRoÙ
())

170  
Ãw
 
	`EvŞutiÚSegm’‹dGCB¿nch
(
vup
, 
rStiÚ¬y
);

172 
MuÉiNÜm®
* 
vdown
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Out
());

175 
RªdomBrownŸnP©h
* 
brownŸnP©h
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
);

177  
Ãw
 
	`EvŞutiÚSegm’‹dGCB¿nch
(
brownŸnP©h
, 
vup
, 
vdown
, 
»Ì©e
, 
rStiÚ¬y
->
	`G‘Dim
(), 
·¿l
);

178 
	}
}

182 
	gV¬
<
	gProfe
> *
	g»Ì©e
;

183 
	gV¬
<
	gProfe
> *
	grStiÚ¬y
;

	@EvolutionSegmentedNucProcess.h

8 #iâdeà
EVOLUTIONSEGMENTEDNUCPROCESS_H


9 
	#EVOLUTIONSEGMENTEDNUCPROCESS_H


	)

11 
	~"EvŞutiÚSegm’‹dProûss.h
"

12 
	~"GTRSubM©rix.h
"

16 şas 
	cNucM©rix
 : 
vœtu®
 
public
 
EvŞutiÚSegm’‹dM©rix
 {

17 
public
 :

20 
NucM©rix
(
RªdomBrownŸnP©h
* 
bridge
, 
V¬
<
R—lVeùÜ
>* 
up
, V¬<R—lVeùÜ>* 
down
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
k
) :

21 
T¿ns™iÚM©rix
(4), 
	$EvŞutiÚSegm’‹dM©rix
(
bridge
, 
up
, 
down
, 4, 
k
) {

22 
nucM©rix
 = 
šnucM©rix
;

24 
	`Compu‹A¼ay
();

29 
vœtu®
 
	$Compu‹R
(
ËngthLeá
, 
l
) {

31 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

34 
r1
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

35 
ËngthLeá
+=
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
);

36 
r2
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

39 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
POS_R
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1, POS_R)) );

41 
i
=0; i<
	`G‘N¡©e
(); i++) {

42 
tÙ
 = 0;

43 
j
=0; j<
	`G‘N¡©e
(); j++) {

44 if(
i
!=
j
) {

45 
R
[
i
][
j
] = 
rm
*
l
*
nucM©rix
->
	`G‘Row
(i)[j];

46 
tÙ
+=
R
[
i
][
j
];

49 
R
[
i
][i]=-
tÙ
;

53 
	}
}

57 
vœtu®
 
	$Compu‹StiÚ¬y
() {

58 
i
=0; i<
	`G‘N¡©e
(); i++)

59 
¡©iÚ¬y
[
i
] = 
nucM©rix
->
	`G‘StiÚ¬y
()[i];

60 
	}
}

62 
	g´iv©e
 :

64 
GTRRªdomSubM©rixW™hNÜmR©es
* 
nucM©rix
;

68 
şass
 
	gRoÙNucM©rix
 : 
vœtu®
 
public
 
T¿ns™iÚM©rix
, vœtu®…ubliø
	gRªdomT¿ns™iÚM©rix
 {

69 
	gpublic
 :

70 
RoÙNucM©rix
(
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
N¡©e
è: 
T¿ns™iÚM©rix
(N¡©e, 0, 
Ãw
 [Nstate]) {

71 
	gnucM©rix
 = 
šnucM©rix
;

72 
Regi¡”
(
nucM©rix
);

75 
vœtu®
 
Compu‹A¼ay
() {

77 
vœtu®
 
Compu‹StiÚ¬y
() {

78 
	gi
=0; i<
G‘N¡©e
(); i++) {

79 
	g¡©iÚ¬y
[
i
] = 
nucM©rix
->
G‘StiÚ¬y
()[i];

82 
vœtu®
 
S‘P¬am‘”s
() {

85 
	g´iv©e
 :

86 
GTRRªdomSubM©rixW™hNÜmR©es
* 
nucM©rix
;

92 şas 
	cEvŞutiÚSegm’‹dNucB¿nch
 : 
public
 
EvŞutiÚSegm’‹dB¿nch
 {

94 
public
 :

96 
EvŞutiÚSegm’‹dNucB¿nch
(
RªdomBrownŸnP©h
* 
šbridge
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
boŞ
 
·¿l
) :

97 
EvŞutiÚSegm’‹dB¿nch
(
šbridge
, 
šup
, 
šdown
, 
šnucM©rix
->
G‘N¡©e
(), 
·¿l
) {

98 
	mnucM©rix
 = 
šnucM©rix
;

99 
Regi¡”
(
nucM©rix
);

100 
C»©eAÎP
();

103 
EvŞutiÚSegm’‹dNucB¿nch
(
V¬
<
R—lVeùÜ
>* 
šup
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
) :

104 
EvŞutiÚSegm’‹dB¿nch
(
šup
, 
šnucM©rix
->
	$G‘N¡©e
()) {

105 
nucM©rix
 = 
šnucM©rix
;

106 
	`Regi¡”
(
nucM©rix
);

107 
glob®T¿nsM©rix
 = 
	`C»©eRoÙM©rix
();

108 
	}
}

110 
vœtu®
 
EvŞutiÚSegm’‹dM©rix
* 
	$C»©eP
(
i
) {

111  
Ãw
 
	`NucM©rix
(
bridge
, 
up
, 
down
, 
nucM©rix
, 
i
);

112 
	}
}

114 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
	$C»©eRoÙM©rix
() {

115  
Ãw
 
	`RoÙNucM©rix
(
nucM©rix
,‚ucM©rix->
	`G‘N¡©e
());

116 
	}
}

118 
GTRRªdomSubM©rixW™hNÜmR©es
* 
	gnucM©rix
;

123 şas 
	cEvŞutiÚSegm’‹dNucProûss
 : 
public
 
EvŞutiÚSegm’‹dProûss
 {

125 
public
 :

127 
	$EvŞutiÚSegm’‹dNucProûss
(
BrownŸnProûss
 *
š´oûss
, 
GTRRªdomSubM©rixW™hNÜmR©es
* 
šnucM©rix
, 
boŞ
 
·¿l
) :

128 
	$EvŞutiÚSegm’‹dProûss
(
š´oûss
, 
·¿l
) {

129 
nucM©rix
 = 
šnucM©rix
;

130 
	`RecursiveC»©e
(
	`G‘RoÙ
());

133 
vœtu®
 
EvŞutiÚSegm’‹dB¿nch
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
äom
) {

135 
MuÉiNÜm®
* 
vup
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
);

137 if(
äom
->
	`isRoÙ
())

138  
Ãw
 
	`EvŞutiÚSegm’‹dNucB¿nch
(
vup
, 
nucM©rix
);

140 
MuÉiNÜm®
* 
vdown
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Out
());

143 
RªdomBrownŸnP©h
* 
brownŸnP©h
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
);

145  
Ãw
 
	`EvŞutiÚSegm’‹dNucB¿nch
(
brownŸnP©h
, 
vup
, 
vdown
, 
nucM©rix
, 
·¿l
);

146 
	}
}

149 
	g´iv©e
:

150 
GTRRªdomSubM©rixW™hNÜmR©es
* 
nucM©rix
;

	@EvolutionSegmentedOmegaProcess.h

2 #iâdeà
EVOLUTIONSEGMENTEDOMEGAPROCESS_H


3 
	#EVOLUTIONSEGMENTEDOMEGAPROCESS_H


	)

5 
	~"EvŞutiÚSegm’‹dProûss.h
"

6 
	~"MGCodÚT¿ns™iÚM©rix.h
"

10 #ifdeà
_OPENMP


11 
	~<omp.h
>

15 şas 
	cOmegaM©rix
 : 
public
 
EvŞutiÚSegm’‹dM©rix
 {

16 
public
 :

18 
OmegaM©rix
(
RªdomBrownŸnP©h
* 
bridge
, 
V¬
<
R—lVeùÜ
>* 
up
, V¬<R—lVeùÜ>* 
down
, 
MGOmegaCodÚT¿ns™iÚM©rix
* 
šcodÚM©rix
, 
k
, 
šposomega
) :

19 
T¿ns™iÚM©rix
(
šcodÚM©rix
->
G‘N¡©e
()), 
EvŞutiÚSegm’‹dM©rix
(
bridge
, 
up
, 
down
, incodÚM©rix->G‘N¡©e(), 
k
) {

21 
	mcodÚM©rix
 = 
šcodÚM©rix
;

22 
	mposomega
 = 
šposomega
;

25 
	mtmp
 = 
Ãw
 *[
G‘N¡©e
()];

26 
	mi
=0; i<
G‘N¡©e
(); i++) {

27 
	mtmp
[
i
] = 
Ãw
 [
G‘N¡©e
()];

28 
	mj
=0; j<
G‘N¡©e
(); j++) {

29 
	mtmp
[
i
][
j
] = 0;

32 
	mÜd”
 = 2;

33 
Compu‹A¼ay
();

37 
vœtu®
 
	$Compu‹StiÚ¬y
() {

39 
i
=0; i<
	`G‘N¡©e
(); i++) {

40 
¡©iÚ¬y
[
i
] = 
codÚM©rix
->
	`G‘StiÚ¬y
()[i];

42 
	}
}

44 
vœtu®
 
	$Compu‹R
(
ËngthLeá
, 
l
) {

46 
Ëngth
 = 
brownŸnBridge
->
	`g‘L’gth
();

49 
r1
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

50 
omega1
 = 
up
[
posomega
] + 
ËngthLeá
/
Ëngth
 * (
down
[posomega]-up[posomega]);

51 
ËngthLeá
+=
l
;

52 
r2
 = 
up
[
POS_R
] + 
ËngthLeá
/
Ëngth
 * (
down
[POS_R]-up[POS_R]);

53 
omega2
 = 
up
[
posomega
] + 
ËngthLeá
/
Ëngth
 * (
down
[posomega]-up[posomega]);

56 
rm
 = 0.5 * ( 
	`exp
(
r1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
POS_R
)è+ƒxp(
r2
 + brownianBridge->getValue(k+1, POS_R)) );

57 
omegam
 = 0.5 * ( 
	`exp
(
omega1
 + 
brownŸnBridge
->
	`g‘V®ue
(
k
, 
posomega
)è+ƒxp(
omega2
 + brownianBridge->getValue(k+1,…osomega)) );

60 if(
	`G‘Ord”
() > 1) {

61 
i
 = 0; i< 
	`G‘N¡©e
(); i++) {

62 
j
=0; j< 
	`G‘N¡©e
(); j++) {

63 
R
[
i
][
j
] = 0;

67 
codÚM©rix
->
	`Compu‹V®ues
(
R
, 
rm
*
l
, 
omegam
);

70 
	}
}

72 
vœtu®
 
	$Pow”Of2
(** 
y
, 
z
) {

73 if(
z
 == 1)

75 
codÚM©rix
->
	`squ¬e
(
y
, 
tmp
);

76 #ifdeà
_OPENMP


79 
i
=0; i<
	`G‘N¡©e
(); i++) {

80 
j
=0; j<
	`G‘N¡©e
(); j++)

81 
y
[
i
][
j
] = 
tmp
[i][j];

83 
EvŞutiÚSegm’‹dM©rix
::
	`Pow”Of2
(
y
, 
z
/2);

84 
	}
}

86 
	g´iv©e
 :

88 
MGOmegaCodÚT¿ns™iÚM©rix
 *
codÚM©rix
;

90 ** 
	gtmp
;

92 
	gposomega
;

96 
şass
 
	gRoÙOmegaM©rix
 : 
vœtu®
 
public
 
T¿ns™iÚM©rix
, vœtu®…ubliø
	gRªdomT¿ns™iÚM©rix
 {

97 
	gpublic
 :

98 
RoÙOmegaM©rix
(
MGCodÚT¿ns™iÚM©rix
* 
šm
è: 
T¿ns™iÚM©rix
(šm->
G‘N¡©e
(), 0, 
Ãw
 [inm->GetNstate()]) {

99 
	gm
 = 
šm
;

100 
Regi¡”
(
m
);

103 
vœtu®
 
Compu‹A¼ay
() {

105 
vœtu®
 
Compu‹StiÚ¬y
() {

106 
	gi
=0; i<
G‘N¡©e
(); i++) {

107 
	g¡©iÚ¬y
[
i
] = 
m
->
G‘StiÚ¬y
()[i];

111 
vœtu®
 
S‘P¬am‘”s
() {

114 
	g´iv©e
 :

115 
MGCodÚT¿ns™iÚM©rix
* 
m
;

118 şas 
	cEvŞutiÚSegm’‹dOmegaB¿nch
 : 
public
 
EvŞutiÚSegm’‹dB¿nch
 {

120 
public
 :

122 
EvŞutiÚSegm’‹dOmegaB¿nch
(
RªdomBrownŸnP©h
* 
šbridge
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, 
MGOmegaCodÚT¿ns™iÚM©rix
* 
šcodÚM©rix
, 
boŞ
 
·¿l
) :

123 
EvŞutiÚSegm’‹dB¿nch
(
šbridge
, 
šup
, 
šdown
, 
šcodÚM©rix
->
G‘N¡©e
(), 
·¿l
) {

124 
	mcodÚM©rix
 = 
šcodÚM©rix
;

125 
Regi¡”
(
codÚM©rix
);

126 
C»©eAÎP
();

129 
EvŞutiÚSegm’‹dOmegaB¿nch
(
V¬
<
R—lVeùÜ
>* 
šup
, 
MGOmegaCodÚT¿ns™iÚM©rix
* 
šcodÚM©rix
) :

130 
EvŞutiÚSegm’‹dB¿nch
(
šup
, 
šcodÚM©rix
->
	$G‘N¡©e
()) {

131 
codÚM©rix
 = 
šcodÚM©rix
;

132 
	`Regi¡”
(
codÚM©rix
);

133 
glob®T¿nsM©rix
 = 
	`C»©eRoÙM©rix
();

134 
	}
}

136 
vœtu®
 
EvŞutiÚSegm’‹dM©rix
* 
	$C»©eP
(
i
) {

137  
Ãw
 
	`OmegaM©rix
(
bridge
, 
up
, 
down
, 
codÚM©rix
, 
i
, 1);

138 
	}
}

140 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
	$C»©eRoÙM©rix
() {

141  
Ãw
 
	`RoÙOmegaM©rix
(
codÚM©rix
);

142 
	}
}

145 
	g´iv©e
 :

147 
MGOmegaCodÚT¿ns™iÚM©rix
* 
codÚM©rix
;

154 şas 
	cEvŞutiÚSegm’‹dOmegaProûss
 : 
public
 
EvŞutiÚSegm’‹dProûss
 {

156 
public
 :

158 
	$EvŞutiÚSegm’‹dOmegaProûss
(
BrownŸnProûss
 *
š´oûss
, 
MGOmegaCodÚT¿ns™iÚM©rix
* 
šcodÚM©rix
, 
boŞ
 
·¿l
) :

159 
	$EvŞutiÚSegm’‹dProûss
(
š´oûss
, 
·¿l
) {

160 
codÚM©rix
 = 
šcodÚM©rix
;

161 
	`RecursiveC»©e
(
	`G‘RoÙ
());

164 
vœtu®
 
EvŞutiÚSegm’‹dB¿nch
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
äom
) {

166 
MuÉiNÜm®
* 
vup
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
);

168 if(
äom
->
	`isRoÙ
())

169  
Ãw
 
	`EvŞutiÚSegm’‹dOmegaB¿nch
(
vup
, 
codÚM©rix
);

171 
MuÉiNÜm®
* 
vdown
 = 
´oûss
->
	`G‘In¡ªtProûss
()->
	`G‘MuÉiNÜm®
(
äom
->
	`Out
());

174 
RªdomBrownŸnP©h
* 
brownŸnP©h
 = 
´oûss
->
	`G‘Pu»BrownŸnProûss
()->
	`G‘RªdomBrownŸnP©h
(
äom
);

176  
Ãw
 
	`EvŞutiÚSegm’‹dOmegaB¿nch
(
brownŸnP©h
, 
vup
, 
vdown
, 
codÚM©rix
, 
·¿l
);

177 
	}
}

180 
MGOmegaCodÚT¿ns™iÚM©rix
* 
	gcodÚM©rix
;

	@EvolutionSegmentedProcess.h

1 #iâdeà
EVOLUTIONSEGMENTEDPROCESS_H


2 
	#EVOLUTIONSEGMENTEDPROCESS_H


	)

4 
	~"DAGnode.h
"

5 
	~"BrownŸnBridge.h
"

6 
	~"SubM©rix.h
"

7 
	~"RªdomBrownŸnP©h.h
"

8 
	~"BrownŸnProûss.h
"

9 
	~"V®T»e.h
"

12 #ifdeà
_OPENMP


13 
	~<omp.h
>

17 şas 
	cEvŞutiÚSegm’‹dM©rix
 : 
vœtu®
 
public
 
T¿ns™iÚM©rix
 {

20 
public
 :

22 
EvŞutiÚSegm’‹dM©rix
(
RªdomBrownŸnP©h
* 
šbridge
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, 
dim
, 
šk
) :

23 
	$T¿ns™iÚM©rix
(
dim
) {

25 
brownŸnBridge
 = 
šbridge
;

26 
up
 = 
šup
->
	`v®
().
	`G‘A¼ay
();

27 
down
 = 
šdown
->
	`v®
().
	`G‘A¼ay
();

29 
k
 = 
šk
;

30 
Üd”
 = 1;

31 
nbOrd”s
 = 
Ãw
 [11];

32 
i
=0; i<11; i++)

33 
nbOrd”s
[
i
] = 0;

35 
tmp
 = 
Ãw
 *[
	`G‘N¡©e
()];

36 
i
=0; i<
	`G‘N¡©e
(); i++) {

37 
tmp
[
i
] = 
Ãw
 [
	`G‘N¡©e
()];

42 
vœtu®
 
	$Compu‹A¼ay
() {

47 
ËngthLeá
 = 0;

49 
i
=0; i<
k
; i++) {

50 
ËngthLeá
+=
brownŸnBridge
->
	`g‘Segm’tL’gth
(
i
);

56 
	`Compu‹R
(
ËngthLeá
, 
brownŸnBridge
->
	`g‘Segm’tL’gth
(
k
));

59 
	`­´ßchExpÚ’tŸl
();

63 
	}
}

65 
	$Upd©eM©rix
() {

66 
	`Compu‹A¼ayAndSt
();

67 
	}
}

69 
vœtu®
 
Compu‹R
(
ËngthLeá
, 
l
) = 0;

70 
vœtu®
 
	$S‘P¬am‘”s
(è{
	}
}

73 
	$£tUp
(cÚ¡ * 
šup
) {

74 
up
 = 
šup
;

75 
	}
}

77 
	$£tDown
(cÚ¡ * 
šdown
) {

78 
down
 = 
šdown
;

79 
	}
}

81 
	$G‘Ord”
() {

82  
Üd”
;

83 
	}
}

85 
	$Re£tNbOrd”s
() {

86 
i
=0; i<11; i++)

87 
nbOrd”s
[
i
] = 0;

88 
	}
}

90 
	$G‘NbOrd”
(
o
) {

91  
nbOrd”s
[
o
];

92 
	}
}

95 
	$­´ßchExpÚ’tŸl
() {

97 
Üd”
 = 1;

98 
z
 = 0;

100 
maxdŸg
 = 0;

101 
i
=0; i<
	`G‘N¡©e
(); i++) {

102 if(
maxdŸg
< -
R
[
i
][i]) {

103 
maxdŸg
 = -
R
[
i
][i];

108 
z
<10 && 10*
maxdŸg
 > 
Üd”
) {

109 
Üd”
*=2;

110 
z
++;

112 
nbOrd”s
[
z
]++;

119 if(
Üd”
==1) {

120 
i
=0; i<
	`G‘N¡©e
(); i++)

121 
R
[
i
][i]+=1;

127 
i
=0; i<
	`G‘N¡©e
(); i++)

128 
j
=0; j<
	`G‘N¡©e
(); j++)

129 
R
[
i
][
j
] = R[i][j] / 
Üd”
 + (i==j ? 1 : 0);

134 
	`Pow”Of2
(
R
, 
Üd”
);

136 
	}
}

139 
vœtu®
 
	$Pow”Of2
(** 
y
, 
z
) {

140 if(
z
 == 1)

143 #ifdeà
_OPENMP


144 #´agm¨
omp
 
·¿Î–
 

146 
i
=0; i<
	`G‘N¡©e
(); i++) {

147 
j
=0; j<
	`G‘N¡©e
(); j++) {

148 
tmp
[
i
][
j
] = 0;

149 
k
=0; k<
	`G‘N¡©e
(); k++) {

150 
tmp
[
i
][
j
]+ğ
y
[i][
k
]*y[k][j];

154 #ifdeà
_OPENMP


157 
i
=0; i<
	`G‘N¡©e
(); i++) {

158 
j
=0; j<
	`G‘N¡©e
(); j++)

159 
y
[
i
][
j
] = 
tmp
[i][j];

161 
EvŞutiÚSegm’‹dM©rix
::
	`Pow”Of2
(
y
, 
z
/2);

162 
	}
}

167 
	g´Ùeùed
 :

168 
BrownŸnBridge
 *
brownŸnBridge
;

169 cÚ¡ *
	gup
, *
	gdown
;

171 cÚ¡ 
	gPOS_R
=0;

173 
	gk
;

175 ** 
	gtmp
;

177 
	gÜd”
;

178 * 
	gnbOrd”s
;

182 
şass
 
	gSegm’‹dB¿nchGlob®M©rix
 : 
vœtu®
 
public
 
T¿ns™iÚM©rix
, vœtu®…ubliø
	gRªdomT¿ns™iÚM©rix
 {

183 
	gpublic
 :

184 
Segm’‹dB¿nchGlob®M©rix
(
Dnode
 *
·»Á
, ** 
šR
, 
N¡©e
è: 
T¿ns™iÚM©rix
(Nstate, inR, 0) {

185 
Regi¡”
(
·»Á
);

187 
vœtu®
 
Compu‹A¼ay
() {

189 
vœtu®
 
Compu‹StiÚ¬y
() {

192 
vœtu®
 
S‘P¬am‘”s
() {

196 şas 
	cEvŞutiÚSegm’‹dB¿nch
 : 
public
 
Dnode
 {

198 
´Ùeùed
:

200 
RªdomBrownŸnP©h
* 
bridge
;

201 
	mV¬
<
	mR—lVeùÜ
>* 
	mup
;

202 
	mV¬
<
	mR—lVeùÜ
>* 
	mdown
;

203 
EvŞutiÚSegm’‹dM©rix
** 
	mP
;

204 
RªdomT¿ns™iÚM©rix
* 
	mglob®T¿nsM©rix
;

205 *** 
	mcumul
;

206 
boŞ
 
	mcumulUpd©ed
;

207 
	mnSegm’t
;

208 
	mnS‹
;

209 
boŞ
 
	m·¿l
;

212 
	mpublic
 :

214 
EvŞutiÚSegm’‹dB¿nch
(
RªdomBrownŸnP©h
* 
šbridge
, 
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, 
šnS‹
, 
boŞ
 
š·¿l
) {

216 
S‘Name
("Evolution Segmented Branch");

218 
	mbridge
 = 
šbridge
;

219 
	mup
 = 
šup
;

220 
	mnS‹
 = 
šnS‹
;

221 
	mdown
 = 
šdown
;

222 
	m·¿l
 = 
š·¿l
;

223 
Regi¡”
(
bridge
);

224 
Regi¡”
(
up
);

225 
Regi¡”
(
down
);

226 
Regi¡”
(
bridge
->
g‘Up
());

227 
Regi¡”
(
bridge
->
g‘Down
());

230 
	mnSegm’t
 = 
bridge
->
g‘NSegm’ts
();

231 
	mP
 = 
Ãw
 
EvŞutiÚSegm’‹dM©rix
*[
nSegm’t
];

233 
	mcumul
 = 
Ãw
 **[
nSegm’t
+1];

234 
	mk
=0; k<
	mnSegm’t
+1; k++) {

235 
	mcumul
[
k
] = 
Ãw
 *[
nS‹
];

236 
	mi
=0; i<
	mnS‹
; i++)

237 
	mcumul
[
k
][
i
] = 
Ãw
 [
nS‹
];

239 
	mglob®T¿nsM©rix
 = 
Ãw
 
Segm’‹dB¿nchGlob®M©rix
(
this
, 
cumul
[
nSegm’t
], 
nS‹
);

242 
	mcumulUpd©ed
 = 
çl£
;

247 
EvŞutiÚSegm’‹dB¿nch
(
V¬
<
R—lVeùÜ
>* 
šup
, 
šnS‹
) {

248 
S‘Name
("Evolution Root Branch");

249 
	gnS‹
 = 
šnS‹
;

251 
	gbridge
 = 0;

252 
	gup
 = 
šup
;

253 
	gdown
 = 0;

254 
	g·¿l
 = 
çl£
;

255 
Regi¡”
(
up
);

258 
	gnSegm’t
 = 0;

259 
	gP
 = 0;

260 
	gcumul
 = 0;

261 
	gcumulUpd©ed
 = 
çl£
;

266 ~
	$EvŞutiÚSegm’‹dB¿nch
() {

267 
i
=0; i<
nSegm’t
; i++) {

268 
d–‘e
 
P
[
i
];

270 
d–‘e
[] 
P
;

271 
i
=0; i<
nSegm’t
; i++) {

272 
j
=0; j<
nS‹
; j++) {

273 
d–‘e
[] 
cumul
[
i
][
j
];

275 
d–‘e
[] 
cumul
[
i
];

277 
d–‘e
[] 
cumul
;

278 
d–‘e
 
glob®T¿nsM©rix
;

279 
	}
}

281 
vœtu®
 
	$C»©eAÎP
() {

282 
i
=0; i<
nS‹
; i++)

283 
j
=0; j<
nS‹
; j++)

284 
cumul
[0][
i
][
j
] = (i==j ? 1 : 0);

286 
k
=0; k<
nSegm’t
; k++) {

287 
P
[
k
] = 
	`C»©eP
(k);

288 
i
=0; i<
nS‹
; i++)

289 
j
=0; j<
nS‹
; j++) {

290 
cumul
[
k
+1][
i
][
j
] = 0;

291 
l
=0;†<
nS‹
;†++)

292 
cumul
[
k
+1][
i
][
j
] +ğcumul[k][i][
l
]*
P
[k]->
	`G‘R
()[l][j];

295 
cumulUpd©ed
 = 
Œue
;

297 
	}
}

298 
vœtu®
 
EvŞutiÚSegm’‹dM©rix
* 
C»©eP
(
i
) = 0;

299 
vœtu®
 
RªdomT¿ns™iÚM©rix
* 
C»©eRoÙM©rix
() = 0;

301 
	$¥ecŸlUpd©e
() {

303 if(
·¿l
) {

304 #ifdeà
_OPENMP


307 
i
=0; i<
	`G‘N£gm’t
(); i++)

308 
P
[
i
]->
	`Upd©eM©rix
();

311 
i
=0; i<
	`G‘N£gm’t
(); i++)

312 
P
[
i
]->
	`Upd©eM©rix
();

314 
cumulUpd©ed
 = 
çl£
;

315 
	}
}

317 
vœtu®
 
	$upd©eCumul
() {

319 
k
=0; k<
nSegm’t
; k++) {

320 #ifdeà
_OPENMP


321 #´agm¨
omp
 
·¿Î–
 

323 
i
=0; i<
	`G‘N¡©e
(); i++) {

324 
j
=0; j<
	`G‘N¡©e
(); j++) {

325 
cumul
[
k
+1][
i
][
j
] = 0;

326 
h
 =0; h<
	`G‘N¡©e
(); h++) {

327 
cumul
[
k
+1][
i
][
j
] +ğcumul[k][i][
h
] * 
P
[k]->
	`G‘R
()[h][j];

333 
cumulUpd©ed
 = 
Œue
;

334 
	}
}

336 
RªdomBrownŸnP©h
* 
	$G‘Bridge
(è{  
bridge
;
	}
}

337 
T¿ns™iÚM©rix
* 
	$G‘P
(
i
è{  
P
[i]; 
	}
}

338 
EvŞutiÚSegm’‹dM©rix
** 
	$G‘P
(è{ 
P
;
	}
}

339 ** 
	$G‘Cumul
(
i
) {

340 if(!
cumulUpd©ed
)

341 
	`upd©eCumul
();

342  
cumul
[
i
];

343 
	}
}

344 
RªdomT¿ns™iÚM©rix
* 
	$G‘Glob®T¿nsM©rix
() {

346 if(!
cumulUpd©ed
)

347 
	`upd©eCumul
();

348  
glob®T¿nsM©rix
;

349 
	}
}

351 cÚ¡ * 
	$G‘StiÚ¬y
() {

352  
	`G‘Glob®T¿nsM©rix
()->
	`G‘StiÚ¬y
();

353 
	}
}

355 
boŞ
 
	$isRoÙ
(è{ !
P
;
	}
}

356 
	$G‘N¡©e
(è{ 
nS‹
;
	}
}

357 
	$G‘N£gm’t
(è{ 
nSegm’t
;
	}
}

359 
	$Compu‹NbOrd”s
(* 
b
) {

360 if(!
	`isRoÙ
()) {

361 
i
=0; i<
	`G‘N£gm’t
(); i++) {

362 
j
=0; j<11; j++) {

363 
b
[
j
] +ğ
P
[
i
]->
	`G‘NbOrd”
(j);

365 
P
[
i
]->
	`Re£tNbOrd”s
();

368 
	}
}

378 
şass
 
	gEvŞutiÚSegm’‹dProûss
 : 
public
 
B¿nchV®PŒT»e
<
EvŞutiÚSegm’‹dB¿nch
> {

380 
´Ùeùed
:

381 
BrownŸnProûss
 *
´oûss
;

382 *
	gnbOrd”s
;

383 
boŞ
 
	g·¿l
;

384 
	gpublic
 :

385 
EvŞutiÚSegm’‹dProûss
(
BrownŸnProûss
 *
š´oûss
, 
boŞ
 
š·¿l
) {

386 
S‘W™hRoÙ
(
Œue
);

387 
	g´oûss
 = 
š´oûss
;

388 
	gnbOrd”s
 = 
Ãw
 [11];

389 
	g·¿l
 = 
š·¿l
;

390 
	gi
=0; i<11; i++)

391 
	gnbOrd”s
[
i
] = 0;

395 
vœtu®
 
T»e
* 
G‘T»e
() {

396  
	g´oûss
->
G‘T»e
();

399 
Lšk
* 
G‘RoÙ
(è{  
G‘T»e
()->GetRoot(); }

401 
Compu‹NbOrd”s
() {

403 
	gi
=0; i<11; i++) {

404 
	gnbOrd”s
[
i
] = 0;

406 
Compu‹NbOrd”s
(
G‘RoÙ
());

409 
Compu‹NbOrd”s
(cÚ¡ 
Lšk
* 
äom
) {

411 cÚ¡ 
Lšk
* 
	glšk
 = 
äom
->
Next
();†šk!=äom;†šk = 
lšk
->Next()) {

412 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
Compu‹NbOrd”s
(
nbOrd”s
);

413 
Compu‹NbOrd”s
(
lšk
->
Out
());

418 *
G‘NbOrd”s
() {

420 
Compu‹NbOrd”s
();

421  
	gnbOrd”s
;

	@Exception.h

1 #iâdeà
EXCEPTION_H


2 
	#EXCEPTION_H


	)

5 şas 
	cExû±iÚ
 {};

7 şas 
	cCheckSumExû±iÚ
 : 
public
 
Exû±iÚ
 {

9 
public
:

10 
	$CheckSumExû±iÚ
(
š
è: 
	$checksum
(
š
) {}

12 
	$G‘CheckSum
() {

13  
checksum
;

14 
	}
}

16 
	g´iv©e
:

17 
checksum
;

	@GTRModel.h

1 #iâdeà
GTRMODEL_H


2 
	#GTRMODEL_H


	)

4 
	~"Ba£Ty³.h
"

5 
	~"RªdomTy³s.h
"

6 
	~"ProbMod–.h
"

7 
	~"IID.h
"

8 
	~"GTRSubM©rix.h
"

9 
	~"OÃM©rixPhyloProûss.h
"

10 
	~"Move.h
"

11 
	~"PhyloProûssMHMove.h
"

13 şas 
	cMHOÃM©rixPhyloProûss
 : 
public
 
OÃM©rixPhyloProûss
 {

15 
´Ùeùed
:

17 
public
:

19 
	$MHOÃM©rixPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
RªdomSubM©rix
* 
¿ndm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
) :

20 
	`OÃM©rixPhyloProûss
(
šŒ“
,
¿ndm©rix
,
šd©a
), 
	$´İm©rix
(0) {

24 
SubM©rix
* 
	$G‘Prİo§lM©rix
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

25 ià(! 
´İm©rix
) {

26 
	`C»©ePrİo§lM©rix
();

28  
´İm©rix
;

29 
	}
}

31 
	g´Ùeùed
:

33 
	$UnfŞd
() {

34 
PhyloProûss
::
	`UnfŞd
();

35 
	`S‘Prİo§lM©riûs
();

36 
	}
}

38 
	$C»©ePrİo§lM©rix
() {

39 
û¼
 << "create…roposal matrix\n";

40 
n¡©e
 = 
	`G‘M©rix
()->
	`G‘N¡©e
();

41 
¼
 = 
Ãw
 [
n¡©e
 * (nstate-1) / 2];

42 
¡©
 = 
Ãw
 [
n¡©e
];

43 
	`G‘D©a
()->
	`G‘EmpœiÿlF»q
(
¡©
);

44 
i
=0; i<
n¡©e
; i++) {

45 
û¼
 << 
¡©
[
i
] << '\t';

47 
û¼
 << '\n';

48 ià(
n¡©e
 =ğ
Nnuc
) {

50 
¼
[0] = 1;

51 
¼
[1] = 2;

52 
¼
[2] = 1;

53 
¼
[3] = 1;

54 
¼
[4] = 2;

55 
¼
[5] = 1;

56 
´İm©rix
 = 
Ãw
 
	`GTRSubM©rix
(
n¡©e
,
¼
,
¡©
,
	`G‘M©rix
()->
	`isNÜm®i£d
());

58 ià(
n¡©e
 =ğ
N¯
) {

59 
´İm©rix
 = 
Ãw
 
	`LGSubM©rix
(
¡©
,
	`G‘M©rix
()->
	`isNÜm®i£d
());

62 
û¼
 << "error in MHOneMatrixPhyloProcess: unrecognized‡lphabet\n";

63 
	`ex™
(1);

65 
´İm©rix
->
	`CÜru±M©rix
();

66 
´İm©rix
->
	`Upd©eM©rix
();

67 
	}
}

85 
SubM©rix
* 
	g´İm©rix
;

86 * 
	g¼
;

87 * 
	g¡©
;

90 şas 
	cMHOÃM©rixRASPhyloProûss
 : 
public
 
OÃM©rixRASPhyloProûss
 {

92 
´Ùeùed
:

94 
public
:

96 
MHOÃM©rixRASPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
V¬A¼ay
<
PosR—l
>* 
š¿‹
, 
RªdomSubM©rix
* 
¿ndm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
) :

97 
	$OÃM©rixRASPhyloProûss
(
šŒ“
,
š¿‹
,
¿ndm©rix
,
šd©a
) {

101 
SubM©rix
* 
	$G‘Prİo§lM©rix
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

102 ià(! 
´İm©rix
) {

103 
	`C»©ePrİo§lM©rix
();

105  
´İm©rix
;

106 
	}
}

108 
	g´Ùeùed
:

110 
	$UnfŞd
() {

111 
PhyloProûss
::
	`UnfŞd
();

112 
	`S‘Prİo§lM©riûs
();

113 
	}
}

115 
	$C»©ePrİo§lM©rix
() {

116 
û¼
 << "create…roposal matrix\n";

117 
n¡©e
 = 
	`G‘M©rix
()->
	`G‘N¡©e
();

118 
¼
 = 
Ãw
 [
n¡©e
 * (nstate-1) / 2];

119 
¡©
 = 
Ãw
 [
n¡©e
];

120 
	`G‘D©a
()->
	`G‘EmpœiÿlF»q
(
¡©
);

121 
i
=0; i<
n¡©e
; i++) {

122 
û¼
 << 
¡©
[
i
] << '\t';

124 
û¼
 << '\n';

125 ià(
n¡©e
 =ğ
Nnuc
) {

127 
¼
[0] = 1;

128 
¼
[1] = 2;

129 
¼
[2] = 1;

130 
¼
[3] = 1;

131 
¼
[4] = 2;

132 
¼
[5] = 1;

133 
´İm©rix
 = 
Ãw
 
	`GTRSubM©rix
(
n¡©e
,
¼
,
¡©
,
	`G‘M©rix
()->
	`isNÜm®i£d
());

135 ià(
n¡©e
 =ğ
N¯
) {

136 
´İm©rix
 = 
Ãw
 
	`LGSubM©rix
(
¡©
,
	`G‘M©rix
()->
	`isNÜm®i£d
());

139 
û¼
 << "error in MHOneMatrixPhyloProcess: unrecognized‡lphabet\n";

140 
	`ex™
(1);

142 
´İm©rix
->
	`CÜru±M©rix
();

143 
´İm©rix
->
	`Upd©eM©rix
();

144 
	}
}

146 
SubM©rix
* 
	g´İm©rix
;

147 * 
	g¼
;

148 * 
	g¡©
;

152 şas 
	cGTRMod–
 : 
public
 
ProbMod–
 {

161 
T»e
* 
Œ“
;

162 
Sequ’ûAlignm’t
* 
	md©a
;

163 
TaxÚS‘
* 
	mxÚ£t
;

166 
	mNs™e
;

168 
	mN¡©e
;

175 
	mDv¬
<
	mPosR—l
>* 
	mPriÜLambda
;

176 
ExpÚ’tŸl
* 
	mÏmbda
;

177 
	mDv¬
<
	mPosR—l
>* 
	mmu
;

178 
GammaT»e
* 
	mgamŒ“
;

181 
	mDv¬
<
	mPosR—l
>* 
	mPriÜM—nR–R©e
;

182 
IIDExp
* 
	m»Ì©e
;

185 
DœichËt
* 
	m¡©iÚ¬y
;

188 
GTRRªdomSubM©rix
* 
	mm©rix
;

190 
boŞ
 
	mmh
;

193 
	mDv¬
<
	mPosR—l
>* 
	mPriÜV¬R©e
;

194 
ExpÚ’tŸl
* 
	m®pha
;

195 
GammaIIDA¼ay
* 
	m¿‹
;

196 
PhyloProûss
* 
	mphylİroûss
;

200 
	mpublic
:

205 
	$GTRMod–
(
¡ršg
 
d©afe
, sŒšg 
Œ“fe
, 
boŞ
 
šmh
) {

207 
d©a
 = 
Ãw
 
	`FeSequ’ûAlignm’t
(
d©afe
);

208 
Ns™e
 = 
d©a
->
	`G‘Ns™e
();

209 
N¡©e
 = 
d©a
->
	`G‘N¡©e
();

211 
xÚ£t
 = 
d©a
->
	`G‘TaxÚS‘
();

214 
Œ“
 = 
Ãw
 
	`T»e
(
Œ“fe
);

217 
Œ“
->
	`Regi¡”W™h
(
xÚ£t
);

219 
û¼
 << "tree‡nd data ok\n";

225 
mh
 = 
šmh
;

229 
PriÜLambda
 = 
Ãw
 
CÚ¡
<
PosR—l
>(10);

230 
mu
 = 
Ãw
 
CÚ¡
<
PosR—l
>(1);

231 
Ïmbda
 = 
Ãw
 
	`ExpÚ’tŸl
(
PriÜLambda
,
ExpÚ’tŸl
::
MEAN
);

232 
gamŒ“
 = 
Ãw
 
	`GammaT»e
(
Œ“
,
mu
,
Ïmbda
);

240 
PriÜV¬R©e
 = 
Ãw
 
CÚ¡
<
PosR—l
>(
	`PosR—l
(1));

241 
®pha
 = 
Ãw
 
	`ExpÚ’tŸl
(
PriÜV¬R©e
,
ExpÚ’tŸl
::
MEAN
);

242 
¿‹
 = 
Ãw
 
	`GammaIIDA¼ay
(
Ns™e
,
®pha
,alpha);

257 
»Ì©e
 = 
Ãw
 
	`IIDExp
(
N¡©e
*(Nstate-1)/2);

258 
¡©iÚ¬y
 = 
Ãw
 
	`DœichËt
(
N¡©e
);

259 
m©rix
 = 
Ãw
 
	`GTRRªdomSubM©rix
(
»Ì©e
,
¡©iÚ¬y
);

282 
û¼
 << "create…hylo…rocess\n";

284 ià(
mh
) {

285 
phylİroûss
 = 
Ãw
 
	`MHOÃM©rixRASPhyloProûss
(
gamŒ“
,
¿‹
,
m©rix
,
d©a
);

289 
phylİroûss
 = 
Ãw
 
	`OÃM©rixRASPhyloProûss
(
gamŒ“
,
¿‹
,
m©rix
,
d©a
);

295 
û¼
 << "unfold\n";

296 
û¼
 << "one matrix model\n";

297 
phylİroûss
->
	`UnfŞd
();

303 
û¼
 << "register\n";

310 
	`RoÙRegi¡”
(
PriÜV¬R©e
);

311 
	`RoÙRegi¡”
(
PriÜLambda
);

312 
	`RoÙRegi¡”
(
mu
);

313 
	`RoÙRegi¡”
(
»Ì©e
);

314 
	`RoÙRegi¡”
(
¡©iÚ¬y
);

315 
	`Regi¡”
();

317 
û¼
 << "initialise\n";

318 
	`Sam¶e
();

319 
û¼
 << "ok\n";

320 
	`T¿û
(
û¼
);

322 
û¼
 << "update\n";

323 
	`Upd©e
();

324 
û¼
 << "update ok\n";

325 
û¼
 << "scheduler\n";

326 
	`MakeScheduËr
();

328 
û¼
 << "model created\n";

330 
phylİroûss
->
	`S‘Name
("phyloprocess");

331 
¿‹
->
	`S‘Name
("rate");

332 
®pha
->
	`S‘Name
("alpha");

333 
gamŒ“
->
	`S‘Name
("bl");

340 ~
	$GTRMod–
(è{
	}
}

344 
	$G‘LogProb
() {

345  
	`G‘LogPriÜ
(è+ 
	`G‘LogLik–ihood
();

346 
	}
}

347 
	$G‘LogPriÜ
() {

348 
tÙ®
 = 0;

349 
tÙ®
 +ğ
Ïmbda
->
	`G‘LogProb
();

350 
tÙ®
 +ğ
®pha
->
	`G‘LogProb
();

351 
tÙ®
 +ğ
¿‹
->
	`G‘LogProb
();

352 
tÙ®
 +ğ
gamŒ“
->
	`G‘LogProb
();

353 
tÙ®
 +ğ
¡©iÚ¬y
->
	`G‘LogProb
();

354 
tÙ®
 +ğ
»Ì©e
->
	`G‘LogProb
();

355  
tÙ®
;

356 
	}
}

358 
	$G‘LogLik–ihood
() {

359  
phylİroûss
->
	`G‘LogProb
();

360 
	}
}

369 
	$MakeScheduËr
() {

371 ià(
mh
) {

372 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`PhyloProûssMHMove
(
phylİroûss
,500,-1,-1),1,"mapping");

375 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
phylİroûss
,0.3),1,"mapping");

378 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
®pha
,1),10,"alpha");

379 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
®pha
,0.1),10,"alpha");

380 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
¿‹
,1),10,"rate");

381 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
¿‹
,0.1),10,"rate");

382 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
Ïmbda
,1),10,"lambda");

383 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
Ïmbda
,0.1),10,"lambda");

384 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
gamŒ“
,1),10,"branch†engths");

385 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
gamŒ“
,0.1),10,"branch†engths");

386 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
gamŒ“
,0.01),10,"branch†engths");

387 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
»Ì©e
,0.1),10,"relrates");

388 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
»Ì©e
,0.01),10,"relrates");

389 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`ProfeMove
(
¡©iÚ¬y
,1,2),10,"stat4");

390 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
¡©iÚ¬y
,0.1),10,"stat");

391 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
¡©iÚ¬y
,0.01),10,"stat");

393 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`MuÉliÿtiveCom³n§tÜyMove
(
gamŒ“
,
»Ì©e
,0.1),1,"lengthrelrate");

394 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`MuÉliÿtiveCom³n§tÜyMove
(
gamŒ“
,
¿‹
,0.1),1,"lengthrate");

395 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`MuÉliÿtiveCom³n§tÜyMove
(
gamŒ“
,
»Ì©e
,1),1,"lengthrelrate");

396 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`MuÉliÿtiveCom³n§tÜyMove
(
gamŒ“
,
¿‹
,1),1,"lengthrate");

397 
	}
}

399 
	$OldFashiÚedMove
(
tunšg
) {

400 
tÙ®2
 = 0;

401 
i
=0; i<10; i++) {

402 
j
=0; j<10; j++) {

403 
®pha
->
	`Move
(
tunšg
);

404 
¿‹
->
	`Move
(
tunšg
);

405 
Ïmbda
->
	`Move
(
tunšg
);

406 
tÙ®2
 +ğ
»Ì©e
->
	`Move
(
tunšg
/10);

409 
k
=0; k<2; k++) {

410 
¡©iÚ¬y
->
	`Move
(
tunšg
,1);

411 
¡©iÚ¬y
->
	`Move
(
tunšg
/10,1);

412 
¡©iÚ¬y
->
	`Move
(
tunšg
/50,2);

413 
¡©iÚ¬y
->
	`Move
(0.1*
tunšg
);

414 
¡©iÚ¬y
->
	`Move
(0.01*
tunšg
);

415 
¡©iÚ¬y
->
	`Move
(0.001*
tunšg
);

417 
gamŒ“
->
	`Move
(
tunšg
);

419 
phylİroûss
->
	`Move
(
tunšg
);

421 
	}
}

425 
	$d¿wSam¶e
() {

426 
û¼
 << "alpha\n";

427 
®pha
->
	`Sam¶e
();

428 
û¼
 << "rate\n";

429 
¿‹
->
	`Sam¶e
();

430 
û¼
 << "ok\n";

431 
Ïmbda
->
	`Sam¶e
();

432 
û¼
 << "gamtree\n";

433 
gamŒ“
->
	`Sam¶e
();

434 
¡©iÚ¬y
->
	`Sam¶e
();

435 
»Ì©e
->
	`Sam¶e
();

436 
û¼
 << "phyloprocess sample\n";

437 
phylİroûss
->
	`Sam¶e
();

438 
û¼
 << "ok\n";

439 
	}
}

444 
	$G‘M—nR©e
() {

445 
tÙ®
 = 0;

446 
i
=0; i<
Ns™e
; i++) {

447 
tÙ®
 +ğ(*
¿‹
)[
i
]->
	`v®
();

449 
tÙ®
 /ğ
Ns™e
;

450  
tÙ®
;

451 
	}
}

453 
	$G‘V¬R©e
() {

454 
m—n
 = 0;

455 
v¬
 = 0;

456 
i
=0; i<
Ns™e
; i++) {

457 
tmp
 = (*
¿‹
)[
i
]->
	`v®
();

458 
m—n
 +ğ
tmp
;

459 
v¬
 +ğ
tmp
 *mp;

461 
m—n
 /ğ
Ns™e
;

462 
v¬
 /ğ
Ns™e
;

463 
v¬
 -ğ
m—n
 * mean;

464  
v¬
;

465 
	}
}

467 
	$G‘L’gth
() {

468  
gamŒ“
->
	`G‘TÙ®L’gth
(è* 
m©rix
->
	`G‘R©e
(è* 
	`G‘M—nR©e
();

469 
	}
}

473 
	$T¿ûH—d”
(
o¡»am
& 
os
) {

474 
os
 << "#logprior\tlnL\tlength\tlambda\talpha\tmeanrate\tvarrate\tstatent\tmeanrr\trrent\n";

475 
	}
}

479 
	$T¿û
(
o¡»am
& 
os
) {

480 
os
 << 
	`G‘LogPriÜ
(è<< '\t' << 
	`G‘LogLik–ihood
(è<< '\t' << 
	`G‘L’gth
();

481 
os
 << '\t' << 
Ïmbda
->
	`v®
();

482 
os
 << '\t' << 
®pha
->
	`v®
();

483 
os
 << '\t' << 
	`G‘M—nR©e
();

484 
os
 << '\t' << 
	`G‘V¬R©e
();

485 
os
 << '\t' << 
¡©iÚ¬y
->
	`v®
().
	`G‘EÁrİy
();

486 
os
 << '\t' << 
»Ì©e
->
	`v®
().
	`G‘M—n
(è<< '\t' <<„–¿‹->v®().
	`G‘EÁrİy
();

487 
os
 << '\n';

488 
	}
}

490 
	$ToSŒ—m
(
o¡»am
& 
os
) {

491 
os
 << *
®pha
 << '\n';

492 
os
 << *
¿‹
 << '\n';

493 
os
 << *
Ïmbda
<< '\n';

494 
os
 << *
gamŒ“
 << '\n';

495 
os
 << *
¡©iÚ¬y
 << '\n';

496 
os
 << *
»Ì©e
 << '\n';

497 
	}
}

499 
	$FromSŒ—m
(
i¡»am
& 
is
) {

500 
is
 >> *
®pha
;

501 
is
 >> *
¿‹
;

502 
is
 >> *
Ïmbda
;

503 
is
 >> *
gamŒ“
;

504 
is
 >> *
¡©iÚ¬y
;

505 
is
 >> *
»Ì©e
;

506 
	}
}

510 
	$PrštT»e
(
o¡»am
& 
os
) {

512 
	}
}

514 
	$Po¡M­pšg
(
o¡»am
& 
os
, 
boŞ
 
»d
) {

515 
phylİroûss
->
	`Re§m¶eSub
();

516 
i
=0; i<
Ns™e
; i++) {

517 
phylİroûss
->
	`G‘S™eM­pšg
(
i
)->
	`Pršt
(
os
, 
»d
);

519 
	}
}

521 
	$Po¡M­pšg
(
s™e
, 
o¡»am
& 
os
, 
boŞ
 
»d
) {

522 
phylİroûss
->
	`Re§m¶eSub
(
s™e
);

523 
phylİroûss
->
	`G‘S™eM­pšg
(
s™e
)->
	`Pršt
(
os
, 
»d
);

524 
	}
}

526 
	$Po¡P»dM­pšg
(
o¡»am
& 
os
, 
boŞ
 
»d
) {

527 
phylİroûss
->
	`Po¡P»dSam¶e
();

528 
i
=0; i<
Ns™e
; i++) {

529 
phylİroûss
->
	`G‘S™eM­pšg
(
i
)->
	`Pršt
(
os
, 
»d
);

531 
	}
}

533 
	$Po¡P»dM­pšg
(
s™e
, 
o¡»am
& 
os
, 
boŞ
 
»d
) {

534 
phylİroûss
->
	`Po¡P»dSam¶e
(
s™e
);

535 
phylİroûss
->
	`G‘S™eM­pšg
(
s™e
)->
	`Pršt
(
os
, 
»d
);

536 
	}
}

	@GTRSubMatrix.cpp

2 
	~"GTRSubM©rix.h
"

3 
	~<io¡»am
>

4 
usšg
 
Çme¥aû
 
	g¡d
;

11 
	gGTRSubM©rix
::
	$GTRSubM©rix
(
šN¡©e
, cÚ¡ * 
¼
, cÚ¡ * 
¡©
, 
boŞ
 
šnÜm®i£
è: 
	$SubM©rix
(
šN¡©e
, 
šnÜm®i£
) {

13 
N¼
 = 
N¡©e
 * (Nstate-1) / 2;

14 
mR–©iveR©e
 = 
¼
;

15 ià(
¡©
) {

16 
	`CİyStiÚ¬y
(
¡©
);

18 
	}
}

20 
	gGTRSubM©rix
::
	$CİyStiÚ¬y
(cÚ¡ * 
š¡©
) {

21 
k
=0; k<
N¡©e
; k++) {

22 
mStiÚ¬y
[
k
] = 
š¡©
[k];

24 
	}
}

30 
	gGTRSubM©rix
::
	$Compu‹A¼ay
(
i
) {

32 ià(
mR–©iveR©e
) {

33 
tÙ®
 = 0;

34 
j
=0; j<
N¡©e
; j++) {

35 ià(
i
!=
j
) {

36 
Q
[
i
][
j
] = 
	`R–©iveR©e
(i,jè* 
mStiÚ¬y
[j];

37 
tÙ®
 +ğ
Q
[
i
][
j
];

43 
Q
[
i
][i] = - 
tÙ®
;

46 
j
=0; j<
N¡©e
; j++) {

47 
Q
[
i
][
j
] = 
mStiÚ¬y
[j];

49 
Q
[
i
][i] -= 1;

51 
	}
}

	@GTRSubMatrix.h

2 #iâdeà
GTRSUBMATRIX_H


3 
	#GTRSUBMATRIX_H


	)

5 
	~"RªdomSubM©rix.h
"

6 
	~"BiŞogiÿlSequ’ûs.h
"

8 şas 
	cGTRSubM©rix
 : 
public
 
vœtu®
 
SubM©rix
 {

10 
public
:

12 
GTRSubM©rix
(
n¡©e
, cÚ¡ * 
¼
, cÚ¡ * 
¡©
, 
boŞ
 
šnÜm®i£
 = 
çl£
);

13 ~
	$GTRSubM©rix
() {};

15 
	$G‘NR–©iveR©e
(è{ 
N¼
;
	}
}

16 
	$R–©iveR©e
(
i
, 
j
è{ 
mR–©iveR©e
[
	`¼šdex
(i,j,
	`G‘N¡©e
())];
	}
}

18 
	$¼šdex
(
i
, 
j
, 
n¡©e
) {

19  (
i
<
j
è? (2 * 
n¡©e
 - i - 1) * i / 2 + j - i - 1 : (2 *‚state - j - 1) * j / 2 + i - j - 1 ;

20 
	}
}

22 
	g´Ùeùed
:

25 
CİyStiÚ¬y
(cÚ¡ * 
š¡©
);

28 
	$S‘R–©iveR©e
(cÚ¡ * 
š»Ì©e
è{
mR–©iveR©e
 = iÄ–¿‹;
	}
}

30 
	g´Ùeùed
:

32 
Compu‹A¼ay
(
¡©e
);

33 
	$Compu‹StiÚ¬y
(è{
	}
}

36 cÚ¡ * 
	gmR–©iveR©e
;

37 
	gN¼
;

40 
şass
 
	gGTRRªdomSubM©rix
 : 
public
 
RªdomSubM©rix
,…ubliø
	gGTRSubM©rix
 {

42 
	gpublic
:

43 
GTRRªdomSubM©rix
(
V¬
<
PosR—lVeùÜ
>* 
š»Ì©e
, V¬<
Profe
>* 
š¡©
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
SubM©rix
(š¡©->
G‘Dim
(), iÂÜm®i£), 
RªdomSubM©rix
(š¡©->G‘Dim(), iÂÜm®i£è, 
GTRSubM©rix
(š¡©->G‘Dim(),š»Ì©e->
v®
().
G‘A¼ay
(),instat->val().GetArray(), innormalise) {

44 
	g»Ì©e
 = 
š»Ì©e
;

45 
	g¡©
 = 
š¡©
;

46 
Regi¡”
(
»Ì©e
);

47 
Regi¡”
(
¡©
);

48 
¥ecŸlUpd©e
();

51 
	gV¬
<
	gProfe
>* 
G‘RªdomStiÚ¬›s
(è{ 
	g¡©
;}

52 
	gV¬
<
	gPosR—lVeùÜ
>* 
G‘RªdomR–©iveR©es
(è{ 
	g»Ì©e
;}

54 
	g´Ùeùed
:

56 
S‘P¬am‘”s
() {

57 
S‘R–©iveR©e
(
»Ì©e
->
v®
().
G‘A¼ay
());

58 
CİyStiÚ¬y
(
¡©
->
v®
().
G‘A¼ay
());

61 
	g´iv©e
:

62 
V¬
<
PosR—lVeùÜ
>* 
»Ì©e
;

63 
	gV¬
<
	gProfe
>* 
	g¡©
;

66 
şass
 
	gGTRRªdomSubM©rixW™hNÜmR©es
 : 
public
 
RªdomSubM©rix
,…ubliø
	gGTRSubM©rix
 {

68 
	gpublic
:

69 
GTRRªdomSubM©rixW™hNÜmR©es
(
V¬
<
Profe
>* 
š»Ì©e
, V¬<Profe>* 
š¡©
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
SubM©rix
(š¡©->
G‘Dim
(), iÂÜm®i£), 
RªdomSubM©rix
(š¡©->G‘Dim(), iÂÜm®i£è, 
GTRSubM©rix
(š¡©->G‘Dim(),š»Ì©e->
v®
().
G‘A¼ay
(),instat->val().GetArray(), innormalise) {

70 
	g»Ì©e
 = 
š»Ì©e
;

71 
	g¡©
 = 
š¡©
;

72 
	g»sÿËd»Ì©e
 = 
Ãw
 [
»Ì©e
->
G‘Dim
()];

73 
Regi¡”
(
»Ì©e
);

74 
Regi¡”
(
¡©
);

75 
¥ecŸlUpd©e
();

78 ~
GTRRªdomSubM©rixW™hNÜmR©es
() {

79 
	gd–‘e
[] 
	g»sÿËd»Ì©e
;

87 
	g´Ùeùed
:

89 
S‘P¬am‘”s
() {

90 
i
=0; 
	gi
<
	g»Ì©e
->
G‘Dim
(); i++) {

92 
	g»sÿËd»Ì©e
[
i
] = (*
»Ì©e
)[i];

94 
S‘R–©iveR©e
(
»sÿËd»Ì©e
);

95 
CİyStiÚ¬y
(
¡©
->
v®
().
G‘A¼ay
());

98 
	g´iv©e
:

99 
V¬
<
Profe
>* 
»Ì©e
;

100 
	gV¬
<
	gProfe
>* 
	g¡©
;

101 * 
	g»sÿËd»Ì©e
;

104 cÚ¡ 
	gLG_RR
[] = {2.43501,0.386559,1.01598,0.248188,2.02114,0.35106,0.146574,0.524859,0.386747,1.09961,0.270803,1.15206,0.94882,0.415855,4.62446,2.09301,2.49251,0.176789,0.214201,0.0611966,0.00342322,1.08123,0.556892,0.626623,0.313658,0.0129776,0.581098,0.874258,0.517278,0.0737435,0.0829654,0.522935,2.72396,1.11863,1.91672,0.655562,1.1402,5.12993,0.0170374,0.826565,0.906972,0.010458,0.27681,0.014748,0.0249932,4.96585,0.385885,0.512014,0.121261,1.21333,0.416606,0.0371423,0.0292405,0.132172,0.0184023,0.341267,0.414673,0.0433031,1.7679,0.0681587,0.16996,0.529941,0.410296,4.03888,0.356061,0.598676,0.591407,0.23971,0.0761602,0.117429,0.0876389,0.667316,1.08855,0.0233983,2.53635,1.75976,0.0875798,0.0924114,0.035076,0.0515759,0.353957,0.161416,0.640457,2.40372,7.63435,0.304716,0.00851629,0.290191,0.0432987,0.136505,1.40641,0.192681,0.262136,0.381714,1.70218,0.127015,0.0750342,0.262657,0.0534908,0.106516,0.682111,0.358356,0.432853,4.41125,0.497794,4.70891,2.37387,0.968501,0.571566,0.116427,0.584078,5.19151,0.155611,4.055,4.18072,0.187342,0.0765801,0.0712711,0.124231,0.0627125,1.01127,10.4177,0.109234,0.22747,0.134512,0.642335,2.09847,0.381839,3.16401,6.1886,0.732413,1.11216,0.181177,0.048821,0.129065,6.17517,0.0669398,0.243648,0.5698,0.295289,0.178326,0.296353,1.66574,0.606165,0.293136,0.362942,0.0976794,1.63622,0.473613,0.339422,1.97647,1.85746,0.681046,0.470848,0.158271,1.6589,0.73554,3.92125,1.95721,0.081869,0.0443899,0.598725,0.610728,0.325308,1.30906,0.559051,0.290058,0.0930628,0.0876663,2.74689,1.19724,1.05666,0.205761,0.231066,0.251745,0.839504,0.566405,0.167174,0.580707,0.307606,6.33164,0.096231,0.243453,0.391844,2.14061,0.137765,0.240498,0.185392,0.243896,3.08335};

107 şas 
	cLGSubM©rix
 : 
public
 
GTRSubM©rix
 {

109 
public
:

111 
	$LGSubM©rix
(cÚ¡ * 
¡©
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
	`SubM©rix
(
N¯
,šnÜm®i£), 
	$GTRSubM©rix
(
N¯
,0,
¡©
,
šnÜm®i£
) {

112 
mR–©iveR©e
 = 
LG_RR
;

114 
	}
};

116 
şass
 
	gLGRªdomSubM©rix
 : 
public
 
RªdomSubM©rix
,…ubliø
	gLGSubM©rix
 {

118 
	gpublic
:

119 
LGRªdomSubM©rix
(
V¬
<
Profe
>* 
š¡©
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
SubM©rix
(š¡©->
G‘Dim
(), iÂÜm®i£), 
RªdomSubM©rix
(š¡©->G‘Dim(), iÂÜm®i£è, 
LGSubM©rix
(š¡©->
v®
().
G‘A¼ay
(), innormalise) {

120 
	g¡©
 = 
š¡©
;

121 
Regi¡”
(
¡©
);

122 
¥ecŸlUpd©e
();

125 
	g´Ùeùed
:

127 
S‘P¬am‘”s
() {

128 
CİyStiÚ¬y
(
¡©
->
v®
().
G‘A¼ay
());

131 
	g´iv©e
:

132 
V¬
<
Profe
>* 
¡©
;

	@GeneralConjugatePath.h

1 #iâdeà
CONJUGATEPATH_H


2 
	#CONJUGATEPATH_H


	)

4 
	~"RªdomB¿nchS™eP©h.h
"

5 
	~"CÚjug©e.h
"

6 
	~"RªdomSubM©rix.h
"

7 
	~"PhyloProûss.h
"

9 
	~<ut™y
>

10 
	~<m­
>

12 
	~"CodÚSubM©rix.h
"

13 
	~"G’”®T¿ns™iÚCÚjug©eP©h.h
"

15 
şass
 
	gP©hCÚjug©e
 : 
public
 
DSemiCÚjug©ePriÜ
<> {

17 
public
:

19 
P©hCÚjug©e
(
V¬
<
PosR—l
>* 
šËngth
, V¬<PosR—l>* 
š¿‹
, 
RªdomSubM©rix
* 
šm©rix
, V¬<
Profe
>* 
š¡©iÚ¬y
) {

21 
	gËngth
 = 
šËngth
;

22 
	g¿‹
 = 
š¿‹
;

23 
	gm©rix
 = 
šm©rix
;

24 
	g¡©iÚ¬y
 = 
š¡©iÚ¬y
;

25 ià((! 
	gm©rix
è&& (! 
	g¡©iÚ¬y
)) {

26 
	gû¼
 << "error in RandomBranchSitePath: should specify‡ matrix or‡ stationary\n";

27 
ex™
(1);

30 
Regi¡”
(
Ëngth
);

31 
Regi¡”
(
¿‹
);

32 
Regi¡”
(
m©rix
);

33 
Regi¡”
(
¡©iÚ¬y
);

35 
C»©eSuffSt
();

38 ~
P©hCÚjug©e
() {

39 
D–‘eSuffSt
();

42 
¥ecŸlUpd©e
() {

48 
	gV¬
<
	gPosR—l
>* 
G‘RªdomR©e
(è{ 
	g¿‹
;}

49 
	gV¬
<
	gPosR—l
>* 
G‘RªdomTime
(è{ 
	gËngth
;}

50 
RªdomSubM©rix
* 
G‘RªdomSubM©rix
(è{ 
	gm©rix
;}

51 
	gV¬
<
	gProfe
>* 
G‘RªdomStiÚ¬y
(è{ 
	g¡©iÚ¬y
;}

53 
vœtu®
 
SubM©rix
* 
G‘M©rix
(è{ 
	gm©rix
;}

54 
vœtu®
 
G‘R©e
(è{ 
	g¿‹
 ?((è¿‹->
v®
()) : 1;}

55 
vœtu®
 cÚ¡ * 
G‘StiÚ¬y
(è{ 
	g¡©iÚ¬y
 ? stiÚ¬y->
G‘A¼ay
(è: 
m©rix
->GetStationary();}

56 
vœtu®
 
G‘Time
(è{ 
	gËngth
 ? ((èËngth->
v®
()) : 0;}

58 
G‘N¡©e
(è{ 
	gm©rix
->GetNstate();}

66 
vœtu®
 
C»©eSuffSt
() {

69 
vœtu®
 
D–‘eSuffSt
() {

72 
vœtu®
 
Re£tSuffic›ÁSti¡ic
() {

73 
	groÙcouÁ
.
ş—r
();

74 
	g·œcouÁ
.
ş—r
();

75 
	gwa™šgtime
.
ş—r
();

78 
SaveSuffic›ÁSti¡ic
() {

79 
	gû¼
 << "save sufficient\n";

80 
ex™
(1);

83 
Re¡ÜeSuffic›ÁSti¡ic
() {

84 
	gû¼
 << "restore sufficient\n";

85 
ex™
(1);

88 
Inüem’tRoÙCouÁ
(
¡©e
) {

89 
	groÙcouÁ
[
¡©e
]++;

92 
AddRoÙCouÁ
(
¡©e
, 
couÁ
) {

93 
	groÙcouÁ
[
¡©e
] +ğ
couÁ
;

96 
AddWa™šgTime
(
¡©e
, 
time
) {

97 
	gwa™šgtime
[
¡©e
] +ğ
time
;

100 
Inüem’tPaœCouÁ
(
¡©e1
, 
¡©e2
) {

101 
	g·œcouÁ
[ 
·œ
<,>(
¡©e1
,
¡©e2
)]++;

104 
AddPaœCouÁ
(
¡©e1
, 
¡©e2
, 
couÁ
) {

105 
	g·œcouÁ
[ 
·œ
<,>(
¡©e1
,
¡©e2
)] +ğ
couÁ
;

108 
G‘PaœCouÁ
(
¡©e1
, 
¡©e2
) {

109  
	g·œcouÁ
[ 
·œ
<,>(
¡©e1
,
¡©e2
)];

112 
PrštSuffSt
(
o¡»am
& 
os
) {

115 ià(! 
G‘Time
()) {

116 
	gos
 << 
	groÙcouÁ
.
size
() << '\t';

117 
	gm­
<,>::
™”©Ü
 
i
 = 
roÙcouÁ
.
begš
(); 
	gi
!ğroÙcouÁ.
’d
(); i++) {

118 
	gos
 << 
	gi
->
	gfœ¡
 << '\t' << i->
	g£cÚd
 << '\t';

120 
	gos
 << '\t';

123 
	gos
 << 
	gwa™šgtime
.
size
() << '\t';

124 
	gm­
<,>::
™”©Ü
 
i
 = 
wa™šgtime
.
begš
(); 
	gi
!ğwa™šgtime.
’d
(); i++) {

125 
	gos
 << 
	gi
->
	gfœ¡
 << '\t' << i->
	g£cÚd
 << '\t';

127 
	gos
 << '\t';

128 
	gos
 << 
	g·œcouÁ
.
size
() << '\t';

129 
	gm­
<
	g·œ
<,>, >::
™”©Ü
 
i
 = 
·œcouÁ
.
begš
(); 
	gi
!ğ·œcouÁ.
’d
(); i++) {

130 
	gos
 << 
	gi
->
	gfœ¡
.fœ¡ << '\t' << i->fœ¡.
	g£cÚd
 << '\t' << i->second << '\t';

132 
	gos
 << '\t';

136 
AddSuffStFromSŒ—m
(
i¡»am
& 
is
) {

139 ià(! 
G‘Time
()) {

140 
	gn
;

141 
	gis
 >> 
	gn
;

142 
	gi
=0; i<
	gn
; i++) {

143 
	gf
, 
	gs
;

144 
	gis
 >> 
	gf
 >> 
	gs
;

145 
AddRoÙCouÁ
(
f
,
s
);

149 
	gn
;

150 
	gis
 >> 
	gn
;

151 
	gi
=0; i<
	gn
; i++) {

152 
	gf
;

153 
	gs
;

154 
	gis
 >> 
	gf
 >> 
	gs
;

155 
AddWa™šgTime
(
f
,
s
);

157 
	gis
 >> 
	gn
;

158 
	gi
=0; i<
	gn
; i++) {

159 
	gf
,
	gs
,
	gt
;

160 
	gis
 >> 
	gf
 >> 
	gs
 >> 
	gt
;

161 
AddPaœCouÁ
(
f
,
s
,
t
);

166 
vœtu®
 
SuffStLogProb
() {

167 
	gtÙ®
 = 0;

170 ià(! 
G‘Time
()) {

171 cÚ¡ * 
	groÙ¡©
 = 
G‘StiÚ¬y
();

172 
	gm­
<,>::
™”©Ü
 
i
 = 
roÙcouÁ
.
begš
(); 
	gi
!ğroÙcouÁ.
’d
(); i++) {

173 
	gtÙ®
 +ğ
i
->
£cÚd
 * 
log
(
roÙ¡©
[i->
fœ¡
]);

178 ià(
G‘Time
()) {

179 
	gtÙnsub
 = 0;

180 
	gtÙsÿË¡©
 = 0;

181 
	gSubM©rix
& 
	gm©
 = *
G‘M©rix
();

182 
	gm­
<,>::
™”©Ü
 
i
 = 
wa™šgtime
.
begš
(); 
	gi
!ğwa™šgtime.
’d
(); i++) {

183 
	gtÙsÿË¡©
 +ğ
i
->
£cÚd
 * 
m©
(i->
fœ¡
,i->first);

185 
	gm­
<
	g·œ
<,>, >::
™”©Ü
 
i
 = 
·œcouÁ
.
begš
(); 
	gi
!ğ·œcouÁ.
’d
(); i++) {

186 
	gtÙ®
 +ğ
i
->
£cÚd
 * 
log
(
m©
(i->
fœ¡
.first, i->first.second));

187 
	gtÙnsub
 +ğ
i
->
£cÚd
;

190 
	gtÙ®
 +ğ
G‘R©e
(è* 
G‘Time
(è* 
tÙsÿË¡©
;

191 ià(
	gtÙnsub
) {

192 
	gtÙ®
 +ğ
tÙnsub
 * 
log
(
G‘R©e
(è* 
G‘Time
());

195  
	gtÙ®
;

198 
logProb
() {

199 ià(
isAùive
()) {

200  
SuffStLogProb
();

205 
	g´Ùeùed
:

207 
m­
<,> 
	groÙcouÁ
;

208 
	gm­
< 
	g·œ
<,>, > 
	g·œcouÁ
;

209 
	gm­
<,> 
	gwa™šgtime
;

211 
	gV¬
<
	gPosR—l
>* 
	g¿‹
;

212 
	gV¬
<
	gPosR—l
>* 
	gËngth
;

213 
RªdomSubM©rix
* 
	gm©rix
;

214 
	gV¬
<
	gProfe
>* 
	g¡©iÚ¬y
;

218 
şass
 
	gCÚjug©eRªdomB¿nchS™eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomB¿nchS™eP©h
 {

220 
	gpublic
:

222 
CÚjug©eRªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
, 
P©hCÚjug©e
* 
š·thcÚj
è: 
RªdomB¿nchS™eP©h
(inprocess) {

224 
·thcÚj
 = 
š·thcÚj
;

226 ià(!
	g·thcÚj
) {

227 
	gû¼
 << "error in ConjugateRandomBranchSitePath\n";

228 
ex™
(1);

231 
	gËngth
 = 
·thcÚj
->
G‘RªdomTime
();

232 
	g¿‹
 = 
·thcÚj
->
G‘RªdomR©e
();

233 
	gm©rix
 = 
·thcÚj
->
G‘RªdomSubM©rix
();

234 
	g¡©iÚ¬y
 = 
·thcÚj
->
G‘RªdomStiÚ¬y
();

235 
	gaùive_æag
 = 
Œue
;

237 ià((! 
	gm©rix
è&& (! 
	g¡©iÚ¬y
)) {

238 
	gû¼
 << "error in RandomBranchSitePath: should specify‡ matrix or‡ stationary\n";

239 
ex™
(1);

242 
	gcÚjug©e_up
.
š£¹
(
·thcÚj
);

243 
Regi¡”
(
·thcÚj
);

246 
	g´Ùeùed
:

248 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

249 ià(
·»Á
 !ğ
·thcÚj
) {

250 
û¼
 << "error in ConjugateRandomBranchSitePath::AddSufficientStatistic\n";

251 
ex™
(1);

254 ià(
isRoÙ
()) {

255 
	g·thcÚj
->
Inüem’tRoÙCouÁ
(
In™
()->
G‘S‹
());

258 
Plšk
* 
	glšk
 = 
In™
();

259 
	glšk
) {

260 
	g¡©e
 = 
lšk
->
G‘S‹
();

261 
	g·thcÚj
->
AddWa™šgTime
(
¡©e
,
G‘R–©iveTime
(
lšk
));

262 ià(
	glšk
 !ğ
Ï¡
) {

263 
Ãw¡©e
 = 
lšk
->
Next
()->
G‘S‹
();

264 
	g·thcÚj
->
Inüem’tPaœCouÁ
(
¡©e
,
Ãw¡©e
);

266 
	glšk
 = 
lšk
->
Next
();

271 
	g´iv©e
:

273 
P©hCÚjug©e
* 
·thcÚj
;

277 
şass
 
	gP©hCÚjug©eT»e
 : 
public
 
B¿nchV®PŒT»e
<
P©hCÚjug©e
>,…ubliø
	gAb¡¿ùP©hCÚj
 {

279 
	gpublic
:

281 
P©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
) {

282 
	gËngthŒ“
 = 
šËngthŒ“
;

283 
	gd©a
 = 
šd©a
;

286 ~
P©hCÚjug©eT»e
() {

289 
L’gthT»e
* 
G‘L’gthT»e
(è{ 
	gËngthŒ“
;}

290 
Sequ’ûAlignm’t
* 
G‘D©a
(è{ 
	gd©a
;}

292 
T»e
* 
G‘T»e
(è{ 
	gËngthŒ“
->GetTree();}

294 
Re£tSuffic›ÁSti¡ic
() {

295 
Re£tSuffic›ÁSti¡ic
(
G‘RoÙ
());

298 
Aùiv©eSuffic›ÁSti¡ic
() {

299 
Aùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

302 
IÇùiv©eSuffic›ÁSti¡ic
() {

303 
IÇùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

306 
PrštSynNÚSyn
(
o¡»am
& 
os
, 
nuc1
 = -1, 
nuc2
 = -1) {

307 
RecursivePrštSynNÚSyn
(
os
,
G‘RoÙ
(), 
nuc1
, 
nuc2
);

308 
	gos
 << '\n';

311 
PrštSuffSt
(
o¡»am
& 
os
) {

312 
RecursivePrštSuffSt
(
os
,
G‘RoÙ
());

313 
	gos
 << '\n';

316 
G‘LogProb
() {

317  
RecursiveG‘LogProb
(
G‘RoÙ
());

320 
R—dFromFe
(
¡ršg
 
šfe
) {

321 
if¡»am
 
is
(
šfe
.
c_¡r
());

322 
Aùiv©eSuffic›ÁSti¡ic
();

323 
	gN
;

324 
	gis
 >> 
	gN
;

325 
	gi
=0; i<
	gN
; i++) {

326 
RecursiveAddSuffStFromSŒ—m
(
is
,
G‘RoÙ
());

334 
AddSuffStFromSŒ—m
(
i¡»am
& 
is
) {

335 
RecursiveAddSuffStFromSŒ—m
(
is
,
G‘RoÙ
());

338 
	g´Ùeùed
:

340 
RecursiveG‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

341 
tÙ®
 = 0;

342 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

343 
tÙ®
 +ğ
RecursiveG‘LogProb
(
lšk
->
Out
());

345 
	gtÙ®
 +ğ
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
logProb
();

346  
	gtÙ®
;

349 
RecursiveAddSuffStFromSŒ—m
(
i¡»am
& 
is
, cÚ¡ 
Lšk
* 
äom
) {

350 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

351 
RecursiveAddSuffStFromSŒ—m
(
is
,
lšk
->
Out
());

353 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
AddSuffStFromSŒ—m
(
is
);

356 
RecursivePrštSuffSt
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

357 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

358 
RecursivePrštSuffSt
(
os
,
lšk
->
Out
());

360 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
PrštSuffSt
(
os
);

363 
RecursivePrštSynNÚSyn
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
, 
nuc1
, 
nuc2
) {

365 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

366 
RecursivePrštSynNÚSyn
(
os
,
lšk
->
Out
(), 
nuc1
, 
nuc2
);

368 ià(! 
	gäom
->
isRoÙ
()) {

373 
P©hCÚjug©e
* 
G‘P©hCÚjug©e
(cÚ¡ 
B¿nch
* 
b¿nch
) {

374  
	gdyÇmic_ÿ¡
<
	gP©hCÚjug©e
*>(
G‘B¿nchV®
(
b¿nch
));

377 
Re£tSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

378 
G‘P©hCÚjug©e
(
äom
->
G‘B¿nch
())->
Re£tSuffic›ÁSti¡ic
();

379 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

380 
Re£tSuffic›ÁSti¡ic
(
lšk
->
Out
());

384 
Aùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

385 
G‘P©hCÚjug©e
(
äom
->
G‘B¿nch
())->
Aùiv©eSuffic›ÁSti¡ic
();

386 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

387 
Aùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

391 
IÇùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

392 
G‘P©hCÚjug©e
(
äom
->
G‘B¿nch
())->
IÇùiv©eSuffic›ÁSti¡ic
();

393 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

394 
IÇùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

398 
L’gthT»e
* 
	gËngthŒ“
;

399 
Sequ’ûAlignm’t
* 
	gd©a
;

403 şas 
	cB¿nchM©rixP©hCÚjug©eT»e
 : 
public
 
P©hCÚjug©eT»e
 {

405 
public
:

407 
B¿nchM©rixP©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
B¿nchV®PŒT»e
<
RªdomSubM©rix
>* 
šm©rixŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$P©hCÚjug©eT»e
(
šËngthŒ“
, 
šd©a
) {

408 
m©rixŒ“
 = 
šm©rixŒ“
;

409 
	`S‘W™hRoÙ
(
Œue
);

410 ià(! 
m©rixŒ“
->
	`W™hRoÙ
()) {

411 
û¼
 << "error in PathConjugateTree: matrixtree does‚ot have„oot value\n";

412 
	`ex™
(1);

414 
	`RecursiveC»©e
(
	`G‘RoÙ
());

417 ~
	$B¿nchM©rixP©hCÚjug©eT»e
() {

418 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

419 
	}
}

421 
	g´Ùeùed
:

423 
P©hCÚjug©e
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

424  
Ãw
 
	`P©hCÚjug©e
(
ËngthŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()), 0, 
m©rixŒ“
->GetBranchVal(link->GetBranch()), 0);

425 
	}
}

427 
	gB¿nchV®PŒT»e
<
	gRªdomSubM©rix
>* 
	gm©rixŒ“
;

431 şas 
	cOÃM©rixP©hCÚjug©eT»e
 : 
public
 
P©hCÚjug©eT»e
 {

433 
public
:

435 
	$OÃM©rixP©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
RªdomSubM©rix
* 
šm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$P©hCÚjug©eT»e
(
šËngthŒ“
, 
šd©a
) {

436 
m©rix
 = 
šm©rix
;

437 
	`S‘W™hRoÙ
(
Œue
);

438 
	`RecursiveC»©e
(
	`G‘RoÙ
());

441 ~
	$OÃM©rixP©hCÚjug©eT»e
() {

442 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

443 
	}
}

445 
	g´Ùeùed
:

447 
P©hCÚjug©e
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

448  
Ãw
 
	`P©hCÚjug©e
(
ËngthŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()), 0, 
m©rix
, 0);

449 
	}
}

451 
RªdomSubM©rix
* 
	gm©rix
;

455 şas 
	cP©hCÚjug©eProûss
 : 
public
 
Ab¡¿ùP©hCÚj
 {

457 
public
:

459 
	$P©hCÚjug©eProûss
(
L’gthT»e
* 
šËngthŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
) {

460 
ËngthŒ“
 = 
šËngthŒ“
;

461 
d©a
 = 
šd©a
;

464 ~
	$P©hCÚjug©eProûss
() {

465 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

466 
	}
}

468 
L’gthT»e
* 
	$G‘L’gthT»e
(è{ 
ËngthŒ“
;
	}
}

469 
Sequ’ûAlignm’t
* 
	$G‘D©a
(è{ 
d©a
;
	}
}

471 
	$G‘Ns™e
(è{ 
	`G‘D©a
()->
	`G‘Ns™e
();
	}
}

473 
T»e
* 
	$G‘T»e
(è{ 
ËngthŒ“
->
	`G‘T»e
();
	}
}

475 cÚ¡ 
Lšk
* 
	$G‘RoÙ
(è{ 
	`G‘T»e
()->
	`G‘RoÙ
();
	}
}

477 
	$Aùiv©eSuffic›ÁSti¡ic
() {

478 
	`Aùiv©eSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

479 
	}
}

481 
	$IÇùiv©eSuffic›ÁSti¡ic
() {

482 
	`IÇùiv©eSuffic›ÁSti¡ic
(
	`G‘RoÙ
());

483 
	}
}

485 
	$G‘LogProb
() {

486  
	`RecursiveG‘LogProb
(
	`G‘RoÙ
());

487 
	}
}

489 
vœtu®
 
P©hCÚjug©e
* 
C»©eP©hCÚjug©e
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) = 0;

491 
P©hCÚjug©e
* 
	$G‘P©hCÚjug©e
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

492  
·th
[
b¿nch
][
s™e
];

493 
	}
}

495 
	g´Ùeùed
:

497 
	$RecursiveC»©e
(cÚ¡ 
Lšk
* 
äom
) {

499 
·th
[
äom
->
	`G‘B¿nch
()] = 
Ãw
 
P©hCÚjug©e
*[
	`G‘Ns™e
()];

500 
i
=0; i<
	`G‘Ns™e
(); i++) {

501 
·th
[
äom
->
	`G‘B¿nch
()][
i
] = 
	`C»©eP©hCÚjug©e
(from,i);

504 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

505 
	`RecursiveC»©e
(
lšk
->
	`Out
());

507 
	}
}

509 
	$RecursiveD–‘e
(cÚ¡ 
Lšk
* 
äom
) {

511 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

512 
	`RecursiveD–‘e
(
lšk
->
	`Out
());

515 
i
=0; i<
	`G‘Ns™e
(); i++) {

516 
d–‘e
 
·th
[
äom
->
	`G‘B¿nch
()][
i
];

518 
d–‘e
[] 
·th
[
äom
->
	`G‘B¿nch
()];

519 
	}
}

521 
	$RecursiveG‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

522 
tÙ®
 = 0;

523 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

524 
tÙ®
 +ğ
	`RecursiveG‘LogProb
(
lšk
->
	`Out
());

526 
i
=0; i<
	`G‘Ns™e
(); i++) {

527 
tÙ®
 +ğ
	`G‘P©hCÚjug©e
(
äom
->
	`G‘B¿nch
(),
i
)->
	`logProb
();

529  
tÙ®
;

530 
	}
}

532 
	$Aùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

534 
i
=0; i<
	`G‘Ns™e
(); i++) {

535 
	`G‘P©hCÚjug©e
(
äom
->
	`G‘B¿nch
(),
i
)->
	`Aùiv©eSuffic›ÁSti¡ic
();

537 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

538 
	`Aùiv©eSuffic›ÁSti¡ic
(
lšk
->
	`Out
());

540 
	}
}

542 
	$IÇùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

544 
i
=0; i<
	`G‘Ns™e
(); i++) {

545 
	`G‘P©hCÚjug©e
(
äom
->
	`G‘B¿nch
(),
i
)->
	`IÇùiv©eSuffic›ÁSti¡ic
();

547 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

548 
	`IÇùiv©eSuffic›ÁSti¡ic
(
lšk
->
	`Out
());

550 
	}
}

552 
L’gthT»e
* 
	gËngthŒ“
;

553 
Sequ’ûAlignm’t
* 
	gd©a
;

554 
	gm­
<cÚ¡ 
	gB¿nch
*, 
	gP©hCÚjug©e
**> 
	g·th
;

558 şas 
	cS™eM©rixP©hCÚjug©eProûss
 : 
public
 
P©hCÚjug©eProûss
 {

561 
public
:

563 
	$S™eM©rixP©hCÚjug©eProûss
(
L’gthT»e
* 
šËngthŒ“
, 
RªdomSubM©rix
** 
šm©rix¬¿y
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$P©hCÚjug©eProûss
(
šËngthŒ“
, 
šd©a
) {

564 
m©rix¬¿y
 = 
šm©rix¬¿y
;

565 
	`RecursiveC»©e
(
	`G‘RoÙ
());

568 ~
	$S™eM©rixP©hCÚjug©eProûss
() {

569 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

570 
	}
}

572 
RªdomSubM©rix
* 
	$G‘M©rix
(
s™e
) {

573  
m©rix¬¿y
[
s™e
];

574 
	}
}

576 
	g´Ùeùed
:

578 
P©hCÚjug©e
* 
	$C»©eP©hCÚjug©e
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

579  
Ãw
 
	`P©hCÚjug©e
(
ËngthŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()), 0, 
m©rix¬¿y
[
s™e
], 0);

580 
	}
}

582 
RªdomSubM©rix
** 
	gm©rix¬¿y
;

586 şas 
	cP©hCÚjug©ePhyloProûss
 : 
public
 
PhyloProûss
 {

589 
´Ùeùed
:

591 
public
:

593 
	$P©hCÚjug©ePhyloProûss
(
P©hCÚjug©eT»e
* 
š·thcÚjŒ“
è: 
	`PhyloProûss
(š·thcÚjŒ“->
	`G‘L’gthT»e
(), iÅ©hcÚjŒ“->
	$G‘D©a
()) {

594 
·thcÚj´oûss
 = 0;

595 
·thcÚjŒ“
 = 
š·thcÚjŒ“
;

598 
	$P©hCÚjug©ePhyloProûss
(
P©hCÚjug©eProûss
* 
š·thcÚj´oûss
è: 
	`PhyloProûss
(š·thcÚj´oûss->
	`G‘L’gthT»e
(), iÅ©hcÚj´oûss->
	$G‘D©a
()) {

599 
·thcÚj´oûss
 = 
š·thcÚj´oûss
;

600 
·thcÚjŒ“
 = 0;

601 
	}
}

603 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

604 ià(
·thcÚjŒ“
) {

605 ià(! 
·thcÚjŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())) {

606 
û¼
 << "error in create branch val\n";

607 
	`ex™
(1);

609  
Ãw
 
	`CÚjug©eRªdomB¿nchS™eP©h
(
this
,
·thcÚjŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()));

611  
Ãw
 
	`CÚjug©eRªdomB¿nchS™eP©h
(
this
,
·thcÚj´oûss
->
	`G‘P©hCÚjug©e
(
lšk
->
	`G‘B¿nch
(),
s™e
));

612 
	}
}

614 
	g´Ùeùed
:

615 
P©hCÚjug©eT»e
* 
·thcÚjŒ“
;

616 
P©hCÚjug©eProûss
* 
	g·thcÚj´oûss
;

	@GeneralSegmentedConjugatePath.h

2 #iâdeà
GENERALSEGMENTEDCONJUGATEPATH_H


3 
	#GENERALSEGMENTEDCONJUGATEPATH_H


	)

6 
	~"RªdomSegm’‹dB¿nchS™eP©h.h
"

7 
	~"CÚjug©e.h
"

8 
	~"RªdomSubM©rix.h
"

9 
	~"PhyloProûss.h
"

10 
	~"BrownŸnMove.h
"

12 
	~<ut™y
>

13 
	~<m­
>

19 şas 
	cSegm’tPaœ
 {

20 
	mpublic
:

21 
fœ¡
;

22 
	m£cÚd
;

23 
	m£gm’t
;

24 
	$Segm’tPaœ
(
šfœ¡
, 
š£cÚd
, 
š£gm’t
è{
fœ¡
=šfœ¡; 
£cÚd
=š£cÚd;
£gm’t
=insegment;}

25 
boŞ
 
İ”©Ü
<(cÚ¡ 
Segm’tPaœ
 &
o
) const {

26  (
£gm’t
<
o
.segment)

27 || (
£gm’t
==
o
.£gm’ˆ&& (
fœ¡
 <o.first

28 || (
fœ¡
 =ğ
o
.fœ¡ && 
£cÚd
 < o.second)));

29 
	}
}

32 
şass
 
	gSegm’‹dP©hCÚjug©e
 : 
public
 
DSemiCÚjug©ePriÜ
<> {

34 
public
:

36 
Segm’‹dP©hCÚjug©e
(
V¬
<
PosR—l
>* 
šËngth
, 
EvŞutiÚSegm’‹dB¿nch
* 
ševŞ
, 
boŞ
 
ši¤oÙ
) {

37 
	gËngth
 = 
šËngth
;

38 
	gevŞ
 = 
ševŞ
;

39 
	gm©rix
 = 
evŞ
->
G‘P
();

40 
	gi¤oÙ
 = 
ši¤oÙ
;

41 
Regi¡”
(
evŞ
);

42 
Regi¡”
(
evŞ
->
G‘Glob®T¿nsM©rix
());

44 
Regi¡”
(
Ëngth
);

45 
C»©eSuffSt
();

48 ~
Segm’‹dP©hCÚjug©e
() {

49 
D–‘eSuffSt
();

52 
¥ecŸlUpd©e
() {

58 
EvŞutiÚSegm’‹dM©rix
** 
G‘RªdomM©rix
(è{ 
	gm©rix
;}

61 
G‘N¡©e
(è{ 
	gevŞ
->GetNstate();}

63 
vœtu®
 cÚ¡ * 
G‘StiÚ¬y
(è{ 
	gevŞ
->GetStationary();}

65 
vœtu®
 
C»©eSuffSt
() {

68 
vœtu®
 
D–‘eSuffSt
() {

71 
vœtu®
 
Re£tSuffic›ÁSti¡ic
() {

72 
	groÙcouÁ
.
ş—r
();

73 
	g·œcouÁ
.
ş—r
();

76 
SaveSuffic›ÁSti¡ic
() {

77 
	gû¼
 << "save sufficient\n";

78 
ex™
(1);

81 
Re¡ÜeSuffic›ÁSti¡ic
() {

82 
	gû¼
 << "restore sufficient\n";

83 
ex™
(1);

86 
Inüem’tRoÙCouÁ
(
¡©e
) {

87 
	groÙcouÁ
[
¡©e
]++;

90 
AddRoÙCouÁ
(
¡©e
, 
couÁ
) {

91 
	groÙcouÁ
[
¡©e
] +ğ
couÁ
;

94 
Inüem’tPaœCouÁ
(
¡©e1
, 
¡©e2
, 
£gm’t
) {

95 
	g·œcouÁ
[
Segm’tPaœ
(
¡©e1
,
¡©e2
,
£gm’t
)]++;

98 
AddPaœCouÁ
(
¡©e1
, 
¡©e2
, 
£gm’t
, 
couÁ
) {

99 
	g·œcouÁ
[
Segm’tPaœ
(
¡©e1
,
¡©e2
,
£gm’t
)] +ğ
couÁ
;

102 
G‘PaœCouÁ
(
¡©e1
, 
¡©e2
, 
£gm’t
) {

103  
	g·œcouÁ
[
Segm’tPaœ
(
¡©e1
,
¡©e2
,
£gm’t
)];

106 
PrštSuffSt
(
o¡»am
& 
os
) {

109 ià(
	gi¤oÙ
) {

110 
	gos
 << 
	groÙcouÁ
.
size
() << '\t';

111 
	gm­
<,>::
™”©Ü
 
i
 = 
roÙcouÁ
.
begš
(); 
	gi
!ğroÙcouÁ.
’d
(); i++) {

112 
	gos
 << 
	gi
->
	gfœ¡
 << '\t' << i->
	g£cÚd
 << '\t';

114 
	gos
 << '\t';

117 
	gos
 << 
	g·œcouÁ
.
size
() << '\t';

118 
	gm­
<
	gSegm’tPaœ
, >::
™”©Ü
 
i
 = 
·œcouÁ
.
begš
(); 
	gi
!ğ·œcouÁ.
’d
(); i++) {

119 
	gos
 << 
	gi
->
	gfœ¡
.fœ¡ << '\t' << i->fœ¡.
	g£cÚd
 << '\t' << i->fœ¡.
	g£gm’t
 << '\t' << i->second << '\t';

121 
	gos
 << '\t';

125 
AddSuffStFromSŒ—m
(
i¡»am
& 
is
) {

128 ià(
	gi¤oÙ
) {

129 
	gn
;

130 
	gis
 >> 
	gn
;

131 
	gi
=0; i<
	gn
; i++) {

132 
	gf
, 
	gs
;

133 
	gis
 >> 
	gf
 >> 
	gs
;

134 
AddRoÙCouÁ
(
f
,
s
);

138 
	gn
;

139 
	gis
 >> 
	gn
;

140 
	gi
=0; i<
	gn
; i++) {

141 
	gf
,
	gs
,
	g£g
,
	gt
;

142 
	gis
 >> 
	gf
 >> 
	gs
 >> 
	g£g
 >> 
	gt
;

143 
AddPaœCouÁ
(
f
,
s
,
£g
,
t
);

148 
vœtu®
 
SuffStLogProb
() {

150 
	gtÙ®
 = 0;

153 ià(
	gi¤oÙ
) {

154 cÚ¡ * 
	groÙ¡©
 = 
G‘StiÚ¬y
();

155 
	gm­
<,>::
™”©Ü
 
i
 = 
roÙcouÁ
.
begš
(); 
	gi
!ğroÙcouÁ.
’d
(); i++) {

156 
	gtÙ®
 +ğ
i
->
£cÚd
 * 
log
(
roÙ¡©
[i->
fœ¡
]);

161 ià(! 
	gi¤oÙ
) {

162 
	gtÙnsub
 = 0;

163 
	gm­
<
	gSegm’tPaœ
, >::
™”©Ü
 
i
 = 
·œcouÁ
.
begš
(); 
	gi
!ğ·œcouÁ.
’d
(); i++) {

164 
	gtÙ®
 +ğ
i
->
£cÚd
 * 
log
Ğ(*
m©rix
[i->
fœ¡
.
£gm’t
]) (i->first.first, i->first.second));

165 
	gtÙnsub
 +ğ
i
->
£cÚd
;

167 if(
i¢ª
(
tÙ®
è|| 
isšf
(total)) {

168 
	gû¼
 << "sufà¡©†og…rob : " << 
	gtÙ®
 << 
	g’dl
;

169 
ex™
(0);

174  
	gtÙ®
;

178 
logProb
() {

180 ià(
isAùive
()) {

181  
SuffStLogProb
();

182  
SuffStLogProb
();

187 
	gV¬
<
	gPosR—l
>* 
G‘L’gth
(è{ 
	gËngth
;}

188 
EvŞutiÚSegm’‹dB¿nch
* 
G‘EvŞ
(è{ 
	gevŞ
;}

191 
	g´Ùeùed
:

193 
m­
<,> 
	groÙcouÁ
;

194 
	gm­
<
	gSegm’tPaœ
, > 
	g·œcouÁ
;

196 
EvŞutiÚSegm’‹dB¿nch
* 
	gevŞ
;

197 
	gV¬
<
	gPosR—l
>* 
	gËngth
;

198 
EvŞutiÚSegm’‹dM©rix
** 
	gm©rix
;

199 
boŞ
 
	gi¤oÙ
;

203 
şass
 
	gSegm’‹dCÚjug©eRªdomB¿nchS™eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomSegm’‹dB¿nchS™eP©h
 {

205 
	gpublic
:

207 
Segm’‹dCÚjug©eRªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
, 
Segm’‹dP©hCÚjug©e
* 
š·thcÚj
è: 
RªdomSegm’‹dB¿nchS™eP©h
(inprocess) {

208 
evŞ
 = 
š·thcÚj
->
G‘EvŞ
();

210 
	gš‹r¡©e
 = 
Ãw
 [
G‘N£gm’t
()+1];

211 
	gbkš‹r¡©e
 = 
Ãw
 [
G‘N£gm’t
()+1];

212 
	gŒªs™iÚm©rix
 = 
evŞ
->
G‘Glob®T¿nsM©rix
();

213 
	g·thcÚj
 = 
š·thcÚj
;

215 ià(!
	g·thcÚj
) {

216 
	gû¼
 << "error in ConjugateRandomBranchSitePath\n";

217 
ex™
(1);

220 
	gËngth
 = 
·thcÚj
->
G‘L’gth
();

221 
	gaùive_æag
 = 
Œue
;

223 
	gcÚjug©e_up
.
š£¹
(
·thcÚj
);

224 
Regi¡”
(
·thcÚj
);

227 
	g´Ùeùed
:

229 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

230 ià(
·»Á
 !ğ
·thcÚj
) {

231 
û¼
 << "error in ConjugateRandomBranchSitePath::AddSufficientStatistic\n";

232 
ex™
(1);

235 ià(
isRoÙ
()) {

236 
	g·thcÚj
->
Inüem’tRoÙCouÁ
(
¡©eup
);

239 
	gi
=0; i<
G‘N£gm’t
(); i++)

240 
	g·thcÚj
->
Inüem’tPaœCouÁ
(
š‹r¡©e
[
i
],interstate[i+1], i);

244 
	g´iv©e
:

246 
Segm’‹dP©hCÚjug©e
* 
·thcÚj
;

250 
şass
 
	gSegm’‹dP©hCÚjug©eT»e
 : 
public
 
B¿nchV®PŒT»e
<
Segm’‹dP©hCÚjug©e
>,…ubliø
	gAb¡¿ùP©hCÚj
 {

252 
	gpublic
:

254 
Segm’‹dP©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
) {

255 
	gËngthŒ“
 = 
šËngthŒ“
;

256 
	gd©a
 = 
šd©a
;

259 ~
Segm’‹dP©hCÚjug©eT»e
() {

262 
L’gthT»e
* 
G‘L’gthT»e
(è{ 
	gËngthŒ“
;}

263 
Sequ’ûAlignm’t
* 
G‘D©a
(è{ 
	gd©a
;}

265 
T»e
* 
G‘T»e
(è{ 
	gËngthŒ“
->GetTree();}

267 
Aùiv©eSuffic›ÁSti¡ic
() {

268 
Aùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

271 
IÇùiv©eSuffic›ÁSti¡ic
() {

272 
IÇùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

275 
PrštSuffSt
(
o¡»am
& 
os
) {

276 
RecursivePrštSuffSt
(
os
,
G‘RoÙ
());

277 
	gos
 << '\n';

280 
G‘LogProb
() {

281  
RecursiveG‘LogProb
(
G‘RoÙ
());

284 
R—dFromFe
(
¡ršg
 
šfe
) {

285 
if¡»am
 
is
(
šfe
.
c_¡r
());

286 
Aùiv©eSuffic›ÁSti¡ic
();

287 
	gN
;

288 
	gis
 >> 
	gN
;

289 
	gi
=0; i<
	gN
; i++) {

290 
RecursiveAddSuffStFromSŒ—m
(
is
,
G‘RoÙ
());

298 
	g´Ùeùed
:

300 
RecursiveG‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

301 
tÙ®
 = 0;

302 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

303 
tÙ®
 +ğ
RecursiveG‘LogProb
(
lšk
->
Out
());

305 
	gtÙ®
 +ğ
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
logProb
();

306  
	gtÙ®
;

309 
RecursiveAddSuffStFromSŒ—m
(
i¡»am
& 
is
, cÚ¡ 
Lšk
* 
äom
) {

310 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

311 
RecursiveAddSuffStFromSŒ—m
(
is
,
lšk
->
Out
());

313 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
AddSuffStFromSŒ—m
(
is
);

316 
RecursivePrštSuffSt
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

317 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

318 
RecursivePrštSuffSt
(
os
,
lšk
->
Out
());

320 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
PrštSuffSt
(
os
);

323 
Segm’‹dP©hCÚjug©e
* 
G‘Segm’‹dP©hCÚjug©e
(cÚ¡ 
B¿nch
* 
b¿nch
) {

324  
	gdyÇmic_ÿ¡
<
	gSegm’‹dP©hCÚjug©e
*>(
G‘B¿nchV®
(
b¿nch
));

327 
Aùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

328 
G‘Segm’‹dP©hCÚjug©e
(
äom
->
G‘B¿nch
())->
Aùiv©eSuffic›ÁSti¡ic
();

329 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

330 
Aùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

334 
IÇùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

335 
G‘Segm’‹dP©hCÚjug©e
(
äom
->
G‘B¿nch
())->
IÇùiv©eSuffic›ÁSti¡ic
();

336 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

337 
IÇùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

341 
L’gthT»e
* 
	gËngthŒ“
;

342 
Sequ’ûAlignm’t
* 
	gd©a
;

346 şas 
	cB¿nchM©rixSegm’‹dP©hCÚjug©eT»e
 : 
public
 
Segm’‹dP©hCÚjug©eT»e
 {

348 
public
:

350 
	$B¿nchM©rixSegm’‹dP©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
EvŞutiÚSegm’‹dProûss
* 
ševŞŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$Segm’‹dP©hCÚjug©eT»e
(
šËngthŒ“
, 
šd©a
) {

351 
evŞŒ“
 = 
ševŞŒ“
;

352 
	`S‘W™hRoÙ
(
Œue
);

353 ià(! 
evŞŒ“
->
	`W™hRoÙ
()) {

354 
û¼
 << "error in SegmentedPathConjugateTree:ƒvoltree does‚ot have„oot value\n";

355 
	`ex™
(1);

357 
	`RecursiveC»©e
(
	`G‘RoÙ
());

360 ~
	$B¿nchM©rixSegm’‹dP©hCÚjug©eT»e
() {

361 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

362 
	}
}

364 
	g´Ùeùed
:

366 
Segm’‹dP©hCÚjug©e
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

367  
Ãw
 
	`Segm’‹dP©hCÚjug©e
(
ËngthŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()),
evŞŒ“
->G‘B¿nchV®Öšk->G‘B¿nch()),†šk->
	`isRoÙ
());

368 
	}
}

370 
EvŞutiÚSegm’‹dProûss
* 
	gevŞŒ“
;

374 şas 
	cSegm’‹dP©hCÚjug©ePhyloProûss
 : 
public
 
PhyloProûss
 {

377 
´Ùeùed
:

379 
public
:

381 
	$Segm’‹dP©hCÚjug©ePhyloProûss
(
Segm’‹dP©hCÚjug©eT»e
* 
š·thcÚjŒ“
è: 
	`PhyloProûss
(š·thcÚjŒ“->
	`G‘L’gthT»e
(), iÅ©hcÚjŒ“->
	`G‘D©a
(), 
çl£
) {

382 
·thcÚjŒ“
 = 
š·thcÚjŒ“
;

385 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

386 ià(! 
·thcÚjŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())) {

387 
û¼
 << "error in create branch val\n";

388 
	`ex™
(1);

390  
Ãw
 
	`Segm’‹dCÚjug©eRªdomB¿nchS™eP©h
(
this
,
·thcÚjŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()));

391 
	}
}

393 
	g´Ùeùed
:

394 
Segm’‹dP©hCÚjug©eT»e
* 
·thcÚjŒ“
;

	@GeneralTransitionConjugatePath.h

1 #iâdeà
CONJUGATETRANSPATH_H


2 
	#CONJUGATETRANSPATH_H


	)

4 
	~"RªdomB¿nchS™eP©h.h
"

5 
	~"CÚjug©e.h
"

6 
	~"RªdomSubM©rix.h
"

7 
	~"PhyloProûss.h
"

9 
	~<ut™y
>

10 
	~<m­
>

12 
	~"CodÚSubM©rix.h
"

14 şas 
	cAb¡¿ùP©hCÚj
 {

15 
	mpublic
:

16 
vœtu®
 
Aùiv©eSuffic›ÁSti¡ic
() = 0;

17 
vœtu®
 
IÇùiv©eSuffic›ÁSti¡ic
() = 0;

18 
	mvœtu®
 ~
	$Ab¡¿ùP©hCÚj
(){}

19 
	}
};

21 
şass
 
	gT¿ns™iÚP©hCÚjug©e
 : 
public
 
DSemiCÚjug©ePriÜ
<> {

23 
public
:

25 
T¿ns™iÚP©hCÚjug©e
(
V¬
<
PosR—l
>* 
šËngth
, 
RªdomT¿ns™iÚM©rix
* 
šm©rix
, 
boŞ
 
ši¤oÙ
) {

26 
	gËngth
 = 
šËngth
;

27 
	gm©rix
 = 
šm©rix
;

28 
	gi¤oÙ
 = 
ši¤oÙ
;

29 
Regi¡”
(
m©rix
);

30 
C»©eSuffSt
();

33 ~
T¿ns™iÚP©hCÚjug©e
() {

34 
D–‘eSuffSt
();

37 
¥ecŸlUpd©e
() {

43 
RªdomT¿ns™iÚM©rix
* 
G‘RªdomM©rix
(è{ 
	gm©rix
;}

45 
vœtu®
 
Ab¡¿ùT¿ns™iÚM©rix
* 
G‘M©rix
(è{ 
	gm©rix
;}

46 
G‘N¡©e
(è{ 
	gm©rix
->GetNstate();}

48 
vœtu®
 cÚ¡ * 
G‘StiÚ¬y
(è{ 
	gm©rix
->GetStationary();}

50 
vœtu®
 
C»©eSuffSt
() {

53 
vœtu®
 
D–‘eSuffSt
() {

56 
vœtu®
 
Re£tSuffic›ÁSti¡ic
() {

57 
	groÙcouÁ
.
ş—r
();

58 
	g·œcouÁ
.
ş—r
();

61 
SaveSuffic›ÁSti¡ic
() {

62 
	gû¼
 << "save sufficient\n";

63 
ex™
(1);

66 
Re¡ÜeSuffic›ÁSti¡ic
() {

67 
	gû¼
 << "restore sufficient\n";

68 
ex™
(1);

71 
Inüem’tRoÙCouÁ
(
¡©e
) {

72 
	groÙcouÁ
[
¡©e
]++;

75 
AddRoÙCouÁ
(
¡©e
, 
couÁ
) {

76 
	groÙcouÁ
[
¡©e
] +ğ
couÁ
;

79 
Inüem’tPaœCouÁ
(
¡©e1
, 
¡©e2
) {

80 
	g·œcouÁ
[ 
·œ
<,>(
¡©e1
,
¡©e2
)]++;

83 
AddPaœCouÁ
(
¡©e1
, 
¡©e2
, 
couÁ
) {

84 
	g·œcouÁ
[ 
·œ
<,>(
¡©e1
,
¡©e2
)] +ğ
couÁ
;

87 
G‘PaœCouÁ
(
¡©e1
, 
¡©e2
) {

88  
	g·œcouÁ
[ 
·œ
<,>(
¡©e1
,
¡©e2
)];

91 
PrštSuffSt
(
o¡»am
& 
os
) {

94 ià(
	gi¤oÙ
) {

95 
	gos
 << 
	groÙcouÁ
.
size
() << '\t';

96 
	gm­
<,>::
™”©Ü
 
i
 = 
roÙcouÁ
.
begš
(); 
	gi
!ğroÙcouÁ.
’d
(); i++) {

97 
	gos
 << 
	gi
->
	gfœ¡
 << '\t' << i->
	g£cÚd
 << '\t';

99 
	gos
 << '\t';

102 
	gos
 << 
	g·œcouÁ
.
size
() << '\t';

103 
	gm­
<
	g·œ
<,>, >::
™”©Ü
 
i
 = 
·œcouÁ
.
begš
(); 
	gi
!ğ·œcouÁ.
’d
(); i++) {

104 
	gos
 << 
	gi
->
	gfœ¡
.fœ¡ << '\t' << i->fœ¡.
	g£cÚd
 << '\t' << i->second << '\t';

106 
	gos
 << '\t';

110 
AddSuffStFromSŒ—m
(
i¡»am
& 
is
) {

113 ià(
	gi¤oÙ
) {

114 
	gn
;

115 
	gis
 >> 
	gn
;

116 
	gi
=0; i<
	gn
; i++) {

117 
	gf
, 
	gs
;

118 
	gis
 >> 
	gf
 >> 
	gs
;

119 
AddRoÙCouÁ
(
f
,
s
);

123 
	gn
;

124 
	gis
 >> 
	gn
;

125 
	gi
=0; i<
	gn
; i++) {

126 
	gf
,
	gs
,
	gt
;

127 
	gis
 >> 
	gf
 >> 
	gs
 >> 
	gt
;

128 
AddPaœCouÁ
(
f
,
s
,
t
);

133 
vœtu®
 
SuffStLogProb
() {

134 
	gtÙ®
 = 0;

137 ià(
	gi¤oÙ
) {

138 cÚ¡ * 
	groÙ¡©
 = 
G‘StiÚ¬y
();

139 
	gm­
<,>::
™”©Ü
 
i
 = 
roÙcouÁ
.
begš
(); 
	gi
!ğroÙcouÁ.
’d
(); i++) {

140 
	gtÙ®
 +ğ
i
->
£cÚd
 * 
log
(
roÙ¡©
[i->
fœ¡
]);

145 ià(! 
	gi¤oÙ
) {

146 
	gtÙnsub
 = 0;

147 
	gAb¡¿ùT¿ns™iÚM©rix
& 
	gm©
 = *
G‘M©rix
();

148 
	gm­
<
	g·œ
<,>, >::
™”©Ü
 
i
 = 
·œcouÁ
.
begš
(); 
	gi
!ğ·œcouÁ.
’d
(); i++) {

149 
	gtÙ®
 +ğ
i
->
£cÚd
 * 
log
(
m©
(i->
fœ¡
.first, i->first.second));

150 
	gtÙnsub
 +ğ
i
->
£cÚd
;

153  
	gtÙ®
;

156 
logProb
() {

157 ià(
isAùive
()) {

158  
SuffStLogProb
();

163 
	gV¬
<
	gPosR—l
>* 
G‘L’gth
(è{ 
	gËngth
;}

165 
	g´Ùeùed
:

167 
m­
<,> 
	groÙcouÁ
;

168 
	gm­
< 
	g·œ
<,>, > 
	g·œcouÁ
;

170 
	gV¬
<
	gPosR—l
>* 
	gËngth
;

171 
RªdomT¿ns™iÚM©rix
* 
	gm©rix
;

172 
boŞ
 
	gi¤oÙ
;

176 
şass
 
	gT¿ns™iÚCÚjug©eRªdomB¿nchS™eP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<>,…ubliøvœtu® 
	gRªdomB¿nchS™eP©h
 {

178 
	gpublic
:

180 
T¿ns™iÚCÚjug©eRªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
, 
T¿ns™iÚP©hCÚjug©e
* 
š·thcÚj
è: 
RªdomB¿nchS™eP©h
(inprocess) {

182 
·thcÚj
 = 
š·thcÚj
;

184 ià(!
	g·thcÚj
) {

185 
	gû¼
 << "error in ConjugateRandomBranchSitePath\n";

186 
ex™
(1);

189 
	gŒªs™iÚm©rix
 = 
·thcÚj
->
G‘RªdomM©rix
();

190 
	gËngth
 = 
·thcÚj
->
G‘L’gth
();

191 
	gaùive_æag
 = 
Œue
;

193 
	gcÚjug©e_up
.
š£¹
(
·thcÚj
);

194 
Regi¡”
(
·thcÚj
);

197 
	g´Ùeùed
:

199 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

200 ià(
·»Á
 !ğ
·thcÚj
) {

201 
û¼
 << "error in ConjugateRandomBranchSitePath::AddSufficientStatistic\n";

202 
ex™
(1);

205 ià(
isRoÙ
()) {

206 
	g·thcÚj
->
Inüem’tRoÙCouÁ
(
¡©eup
);

209 
	g·thcÚj
->
Inüem’tPaœCouÁ
(
¡©eup
,
¡©edown
);

213 
	g´iv©e
:

215 
T¿ns™iÚP©hCÚjug©e
* 
·thcÚj
;

219 
şass
 
	gT¿ns™iÚP©hCÚjug©eT»e
 : 
public
 
B¿nchV®PŒT»e
<
T¿ns™iÚP©hCÚjug©e
>,…ubliø
	gAb¡¿ùP©hCÚj
 {

221 
	gpublic
:

223 
T¿ns™iÚP©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
) {

224 
	gËngthŒ“
 = 
šËngthŒ“
;

225 
	gd©a
 = 
šd©a
;

228 ~
T¿ns™iÚP©hCÚjug©eT»e
() {

231 
L’gthT»e
* 
G‘L’gthT»e
(è{ 
	gËngthŒ“
;}

232 
Sequ’ûAlignm’t
* 
G‘D©a
(è{ 
	gd©a
;}

234 
T»e
* 
G‘T»e
(è{ 
	gËngthŒ“
->GetTree();}

236 
Aùiv©eSuffic›ÁSti¡ic
() {

237 
Aùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

240 
IÇùiv©eSuffic›ÁSti¡ic
() {

241 
IÇùiv©eSuffic›ÁSti¡ic
(
G‘RoÙ
());

244 
PrštSuffSt
(
o¡»am
& 
os
) {

245 
RecursivePrštSuffSt
(
os
,
G‘RoÙ
());

246 
	gos
 << '\n';

249 
G‘LogProb
() {

250  
RecursiveG‘LogProb
(
G‘RoÙ
());

253 
R—dFromFe
(
¡ršg
 
šfe
) {

254 
if¡»am
 
is
(
šfe
.
c_¡r
());

255 
Aùiv©eSuffic›ÁSti¡ic
();

256 
	gN
;

257 
	gis
 >> 
	gN
;

258 
	gi
=0; i<
	gN
; i++) {

259 
RecursiveAddSuffStFromSŒ—m
(
is
,
G‘RoÙ
());

267 
	g´Ùeùed
:

269 
RecursiveG‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

270 
tÙ®
 = 0;

271 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

272 
tÙ®
 +ğ
RecursiveG‘LogProb
(
lšk
->
Out
());

274 
	gtÙ®
 +ğ
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
logProb
();

275  
	gtÙ®
;

278 
RecursiveAddSuffStFromSŒ—m
(
i¡»am
& 
is
, cÚ¡ 
Lšk
* 
äom
) {

279 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

280 
RecursiveAddSuffStFromSŒ—m
(
is
,
lšk
->
Out
());

282 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
AddSuffStFromSŒ—m
(
is
);

285 
RecursivePrštSuffSt
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

286 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

287 
RecursivePrštSuffSt
(
os
,
lšk
->
Out
());

289 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
PrštSuffSt
(
os
);

292 
T¿ns™iÚP©hCÚjug©e
* 
G‘T¿ns™iÚP©hCÚjug©e
(cÚ¡ 
B¿nch
* 
b¿nch
) {

293  
	gdyÇmic_ÿ¡
<
	gT¿ns™iÚP©hCÚjug©e
*>(
G‘B¿nchV®
(
b¿nch
));

296 
Aùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

297 
G‘T¿ns™iÚP©hCÚjug©e
(
äom
->
G‘B¿nch
())->
Aùiv©eSuffic›ÁSti¡ic
();

298 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

299 
Aùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

303 
IÇùiv©eSuffic›ÁSti¡ic
(cÚ¡ 
Lšk
* 
äom
) {

304 
G‘T¿ns™iÚP©hCÚjug©e
(
äom
->
G‘B¿nch
())->
IÇùiv©eSuffic›ÁSti¡ic
();

305 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

306 
IÇùiv©eSuffic›ÁSti¡ic
(
lšk
->
Out
());

310 
L’gthT»e
* 
	gËngthŒ“
;

311 
Sequ’ûAlignm’t
* 
	gd©a
;

315 şas 
	cB¿nchM©rixT¿ns™iÚP©hCÚjug©eT»e
 : 
public
 
T¿ns™iÚP©hCÚjug©eT»e
 {

317 
public
:

319 
B¿nchM©rixT¿ns™iÚP©hCÚjug©eT»e
(
L’gthT»e
* 
šËngthŒ“
, 
B¿nchV®PŒT»e
<
RªdomT¿ns™iÚM©rix
>* 
šm©rixŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$T¿ns™iÚP©hCÚjug©eT»e
(
šËngthŒ“
, 
šd©a
) {

320 
m©rixŒ“
 = 
šm©rixŒ“
;

321 
	`S‘W™hRoÙ
(
Œue
);

322 ià(! 
m©rixŒ“
->
	`W™hRoÙ
()) {

323 
û¼
 << "error in TransitionPathConjugateTree: matrixtree does‚ot have„oot value\n";

324 
	`ex™
(1);

326 
	`RecursiveC»©e
(
	`G‘RoÙ
());

329 ~
	$B¿nchM©rixT¿ns™iÚP©hCÚjug©eT»e
() {

330 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

331 
	}
}

333 
	g´Ùeùed
:

335 
T¿ns™iÚP©hCÚjug©e
* 
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

336  
Ãw
 
	`T¿ns™iÚP©hCÚjug©e
(
ËngthŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()),
m©rixŒ“
->G‘B¿nchV®Öšk->G‘B¿nch()),†šk->
	`isRoÙ
());

337 
	}
}

339 
	gB¿nchV®PŒT»e
<
	gRªdomT¿ns™iÚM©rix
>* 
	gm©rixŒ“
;

343 şas 
	cT¿ns™iÚP©hCÚjug©ePhyloProûss
 : 
public
 
PhyloProûss
 {

346 
´Ùeùed
:

348 
public
:

350 
	$T¿ns™iÚP©hCÚjug©ePhyloProûss
(
T¿ns™iÚP©hCÚjug©eT»e
* 
š·thcÚjŒ“
è: 
	`PhyloProûss
(š·thcÚjŒ“->
	`G‘L’gthT»e
(), iÅ©hcÚjŒ“->
	`G‘D©a
(), 
çl£
) {

351 
·thcÚjŒ“
 = 
š·thcÚjŒ“
;

354 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

355 ià(! 
·thcÚjŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())) {

356 
û¼
 << "error in create branch val\n";

357 
	`ex™
(1);

359  
Ãw
 
	`T¿ns™iÚCÚjug©eRªdomB¿nchS™eP©h
(
this
,
·thcÚjŒ“
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()));

360 
	}
}

362 
	g´Ùeùed
:

363 
T¿ns™iÚP©hCÚjug©eT»e
* 
·thcÚjŒ“
;

367 
	g‹m¶©e
 <
şass
 
	gR
, cÏs 
	gD
> cÏs 
	cDSemiCÚjug©eMove
 : 
public
 
MCUpd©e
 {

369 
public
:

371 
	$DSemiCÚjug©eMove
(
R
* 
š¿ndom
, 
D
* 
šd£mi
, 
štunšg
, 
šn
è: 
	`¿ndom
(š¿ndom), 
	`d£mi
(šd£mi), 
	`tunšg
(štunšg), 
	$n
(
šn
) {}

373 
	$Move
(
tunšg_moduÏtÜ
 = 1) {

374 
d£mi
->
	`Aùiv©eSuffic›ÁSti¡ic
();

375 
tÙ®
 = 0;

376 
i
=0; i<
n
; i++) {

377 
tÙ®
 +ğ
¿ndom
->
	`Move
(
tunšg
* 
tunšg_moduÏtÜ
);

379 
tÙ®
 /ğ
n
;

380 
d£mi
->
	`IÇùiv©eSuffic›ÁSti¡ic
();

381  
tÙ®
;

382 
	}
}

384 
	g´Ùeùed
:

386 
R
* 
¿ndom
;

387 
D
* 
	gd£mi
;

388 
	gtunšg
;

389 
	gn
;

392 şas 
	cDSemiCÚjug©eM­pšgMove
 : 
public
 
MCUpd©e
 {

394 
public
:

396 
	$DSemiCÚjug©eM­pšgMove
(
PhyloProûss
* 
š´oûss
, 
Ab¡¿ùP©hCÚj
* 
š·thcÚj
, 
štunšg
 = 1è: 
	`´oûss
(š´oûss), 
	$·thcÚj
(
š·thcÚj
) {

397 
tunšg
 = 
štunšg
;

398 
š™Ÿlized
 = 0;

401 
	$Move
(
tunšg_moduÏtÜ
=1) {

402 
·thcÚj
->
	`IÇùiv©eSuffic›ÁSti¡ic
();

403 ià(! 
š™Ÿlized
) {

404 
´oûss
->
	`Move
(1.0);

405 
š™Ÿlized
 = 1;

408 
´oûss
->
	`Move
(
tunšg
);

410 
·thcÚj
->
	`Aùiv©eSuffic›ÁSti¡ic
();

412 
	}
}

414 
	g´Ùeùed
:

416 
PhyloProûss
* 
´oûss
;

417 
Ab¡¿ùP©hCÚj
* 
	g·thcÚj
;

418 
	gtunšg
;

419 
	gš™Ÿlized
;

	@GenericTimeLine.h

1 #iâdeà
GENERICTIMELINE_H


2 
	#GENERICTIMELINE_H


	)

4 
	~"SŒšgSŒ—mUts.h
"

5 
	~<io¡»am
>

6 
	~<m­
>

7 
	~<veùÜ
>

8 
usšg
 
Çme¥aû
 
	g¡d
;

10 şas 
	cG’”icTimeLše
 {

12 
	mpublic
:

13 
	$G’”icTimeLše
() {}

14 
vœtu®
 ~
	$G’”icTimeLše
(è{
	}
}

16 
vœtu®
 
G‘V®
(
ab¡ime
, 
TimeLšeIndex
) = 0;

17 
vœtu®
 
G‘Numb”OfTimeLšes
() = 0;

19 
	g´Ùeùed
:

20 
Numb”OfTimeLšes
;

28 şas 
	cLš—¾yIÁ”pŞ©edTimeLše
 : 
public
 
G’”icTimeLše
{

30 
public
:

31 
	$Lš—¾yIÁ”pŞ©edTimeLše
() {}

32 
vœtu®
 ~
	$Lš—¾yIÁ”pŞ©edTimeLše
(è{
	}
}

34 
	$G‘V®
(
ab¡ime
, 
TimeLšeIndex
) {

35 
TimeLšeIndex
 = TimeLineIndex - 1;

36 ià(
TimeLšeIndex
 > 
Numb”OfTimeLšes
) {

39 
m­
 < ,>::
™”©Ü
 
Young”
, 
Old”
;

40 
V®ueYoung”
, 
V®ueOld”
;

41 
Young”
 = 
TimesAndV®ues
[
TimeLšeIndex
].
	`low”_bound
(
ab¡ime
);

42 
Old”
 = 
TimesAndV®ues
[
TimeLšeIndex
].
	`uµ”_bound
(
ab¡ime
);

43 
V®ueYoung”
 = (*
Young”
).
£cÚd
;

44 ià((*
Young”
).
fœ¡
 =ğ
ab¡ime
) {

45  
V®ueYoung”
;

47 ià(
Young”
 =ğ
TimesAndV®ues
[
TimeLšeIndex
].
	`begš
()) {

48  
V®ueYoung”
;

50 ià(
Old”
 =ğ
TimesAndV®ues
[
TimeLšeIndex
].
	`’d
()) {

51 
Old”
--;

52  (*
Old”
).
£cÚd
;

54 ià(
Young”
 =ğ
Old”
) {

55 
Young”
--;

56 
V®ueYoung”
 = (*(
Young”
)).
£cÚd
;

57 
V®ueOld”
 = (*
Old”
).
£cÚd
;

59 ià(
ab¡ime
 > (*
TimesAndV®ues
[
TimeLšeIndex
].
	`rbegš
()).
fœ¡
) {

60  (*
Old”
).
£cÚd
;

63 
V®ueOld”
 = (*
Old”
).
£cÚd
;

65  
V®ueYoung”
 + (
V®ueOld”
 - V®ueYoung”è* ( 
ab¡ime
 - (*
Young”
).
fœ¡
è/ ((*
Old”
).first - (*Younger).first) ;

66 
	}
}

68 
	$G‘Numb”OfTimeLšes
() {

69  
Numb”OfTimeLšes
;

70 
	}
}

84 
	$ToSŒ—m
(
o¡»am
& 
os
) const {

85 
m­
 < , >::
™”©Ü
 
™
;

86 
m­
 < , > 
‹mp
;

87 
os
 << 
Numb”OfTimeLšes
 << 
’dl
;

88 
i
 = 0 ; i < 
TimesAndV®ues
.
	`size
() ; i++) {

89 
‹mp
 = 
TimesAndV®ues
[
i
];

90 
os
 << 
‹mp
.
	`size
(è<<
’dl
;

91  
™
 = 
‹mp
.
	`begš
(è; iˆ!ğ‹mp.
	`’d
(); it++ ) {

92 
os
 << (*
™
).
fœ¡
 << "\t" << (*™).
£cÚd
 << 
’dl
;

96 
	}
}

98 
	$FromSŒ—m
(
i¡»am
& 
is
) {

99 
Age
;

100 
V®ue
;

101 
Numb”OfV®ues
;

102 
·œ
 < , > 
ageV®ue
;

103 
m­
<, > 
TimeV®ueM­
;

104 
is
 >> 
Numb”OfTimeLšes
;

105 
i
=0; i < 
Numb”OfTimeLšes
; i++) {

106 
is
 >> 
Numb”OfV®ues
;

107 
TimesAndV®ues
.
	`push_back
(
TimeV®ueM­
);

108 
j
 = 0 ; j < 
Numb”OfV®ues
 ; j++ ) {

109 
is
 >> 
Age
 >> 
V®ue
 ;

110 
TimesAndV®ues
[
i
][
Age
] = 
V®ue
;

114 
	}
}

116 
	g´iv©e
:

117 
veùÜ
 < 
m­
 < , > > 
	gTimesAndV®ues
;

	@GlobalScalingFunction.h

1 #iâdeà
GLOBALSCALE_H


2 
	#GLOBALSCALE_H


	)

4 
şass
 
	gGlob®SÿlšgFunùiÚ
 : 
public
 
Dv¬
<> {

6 
public
:

8 
Glob®SÿlšgFunùiÚ
() {}

9 
vœtu®
 ~
Glob®SÿlšgFunùiÚ
() {}

11 
vœtu®
 
G‘SÿlšgFaùÜ
(
time1
, 
time2
) = 0;

15 şas 
	cBur¡SÿlšgFunùiÚ
 : 
public
 
Glob®SÿlšgFunùiÚ
 {

17 
public
:

19 
Bur¡SÿlšgFunùiÚ
(
V¬
<
PosR—l
>* 
št0
, V¬<PosR—l>* 
šçùÜ
, V¬<PosR—l>* 
š¿‹
) {

21 
	mt0
 = 
št0
;

22 
	mçùÜ
 = 
šçùÜ
;

23 
	m¿‹
 = 
š¿‹
;

24 
Regi¡”
(
t0
);

25 
Regi¡”
(
çùÜ
);

26 
Regi¡”
(
¿‹
);

29 
	$G‘SÿlšgFaùÜ
(
time1
, 
time2
) {

31 ià(
time1
 < 
time2
) {

32 
û¼
 << "”rÜ iÀg‘sÿlšgçùÜ:ime1 <ime2 : " << 
time1
 << '\t' << 
time2
 << '\n';

33 
	`ex™
(1);

36 
v
 = 
time1
 - 
time2
;

37 ià(
time2
 < 
t0
->
	`v®
()) {

38 
tmax
 = 
time1
 - 
t0
->
	`v®
();

39 ià(
time1
 > 
t0
->
	`v®
()) {

40 
tmax
 = 0;

42 
tmš
 = 
time2
 - 
t0
->
	`v®
();

44 
v
 +ğ
çùÜ
->
	`v®
(è/ 
¿‹
->v®(è* (
	`exp
Ô©e->v®(è* 
tmax
è-ƒxpÔ©e->v®(è* 
tmš
));

47  
v
 / (
time1
 - 
time2
);

48 
	}
}

50 
	$¥ecŸlUpd©e
() {

52 
	}
}

54 
	g´Ùeùed
:

56 
V¬
<
PosR—l
>* 
t0
;

57 
	gV¬
<
	gPosR—l
>* 
	gçùÜ
;

58 
	gV¬
<
	gPosR—l
>* 
	g¿‹
;

	@IID.h

1 #iâdeà
IID_H


2 
	#IID_H


	)

4 
	~<io¡»am
>

5 
	~<c¡dlib
>

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	~"RªdomTy³s.h
"

9 
	~"V®A¼ay.h
"

11 
	g‹m¶©e
 <
şass
 
	gV
> cÏs 
	gIIDA¼ay
 : 
public
 
V®PŒA¼ay
< 
Rv¬
<
V
> > {

13 
public
:

15 
IIDA¼ay
(
šsize
è: 
V®PŒA¼ay
<
Rv¬
<
V
> >(insize) {}

17 
Move
(
tunšg
) {

18 
tÙ®
 = 0;

19 
	gn
 = 0;

20 
	gi
=0; i<
	gthis
->
G‘Size
(); i++) {

21 ià(! 
	gthis
->
G‘V®
(
i
)->
isCÏm³d
()) {

22 
	gtmp
 = 
this
->
G‘V®
(
i
)->
Move
(
tunšg
);

23 
	gtÙ®
 +ğ
tmp
;

24 
	gn
++;

27 
	gacc
 = 
n
 ? 
tÙ®
 /‚ : 0;

28  
	gacc
;

31 
d¿wSam¶e
() {

32 
	gi
=0; i<
	gthis
->
G‘Size
(); i++) {

33 
	gthis
->
G‘V®
(
i
)->
Sam¶e
();

37 
G‘LogProb
() {

38 
	gtÙ®
 = 0;

39 
	gi
=0; i<
	gthis
->
G‘Size
(); i++) {

40 
	gtÙ®
 +ğ
this
->
G‘V®
(
i
)->
G‘LogProb
();

42  
	gtÙ®
 ;

45 
Regi¡”
(
DAGnode
* 
š
) {

46 
	gi
=0; i<
	gthis
->
G‘Size
(); i++) {

47 
	gthis
->
G‘V®
(
i
)->
Regi¡”
(
š
);

52 
şass
 
	gB‘aIIDA¼ay
 : 
public
 
IIDA¼ay
<
Un™R—l
> {

54 
public
:

55 
B‘aIIDA¼ay
(
šsize
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
è: 
IIDA¼ay
<
Un™R—l
>(insize) {

56 
®pha
 = 
š®pha
;

57 
	gb‘a
 = 
šb‘a
;

58 
C»©e
();

61 
G‘M—n
() {

62 
	gm—n
 = 0;

63 
	gi
=0; i<
G‘Size
(); i++) {

64 
	gm—n
 +ğ
G‘V®
(
i
)->
v®
();

66 
	gm—n
 /ğ
G‘Size
();

67  
	gm—n
;

70 
G‘V¬
() {

71 
	gm—n
 = 0;

72 
	gv¬
 = 0;

73 
	gi
=0; i<
G‘Size
(); i++) {

74 
	gtmp
 = 
G‘V®
(
i
)->
v®
();

75 
	gm—n
 +ğ
tmp
;

76 
	gv¬
 +ğ
tmp
 *mp;

78 
	gm—n
 /ğ
G‘Size
();

79 
	gv¬
 /ğ
G‘Size
();

80 
	gv¬
 -ğ
m—n
 * mean;

81  
	gv¬
;

84 
	g´Ùeùed
:

86 
Rv¬
<
Un™R—l
>* 
C»©eV®
(
s™e
) {

87  
Ãw
 
B‘a
(
®pha
, 
b‘a
);

90 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

91 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

94 
şass
 
	gPosUniIIDA¼ay
 : 
public
 
IIDA¼ay
<
PosR—l
> {

96 
public
:

97 
PosUniIIDA¼ay
(
šsize
, 
V¬
<
PosR—l
>* 
šroÙ
, 
šmax
è: 
IIDA¼ay
<PosReal>(insize) {

98 
roÙ
 = 
šroÙ
;

99 
	gmax
 = 
šmax
;

100 
C»©e
();

103 
	g´Ùeùed
:

105 
Rv¬
<
PosR—l
>* 
C»©eV®
(
s™e
) {

106  
Ãw
 
PosUnifÜm
(
roÙ
, 
max
);

109 
	gV¬
<
	gPosR—l
>* 
	groÙ
;

110 
	gmax
;

113 
şass
 
	gGammaIIDA¼ay
 : 
public
 
IIDA¼ay
<
PosR—l
> {

115 
public
:

116 
GammaIIDA¼ay
(
šsize
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
è: 
IIDA¼ay
<PosReal>(insize) {

117 
®pha
 = 
š®pha
;

118 
	gb‘a
 = 
šb‘a
;

119 
C»©e
();

122 * 
S‘V®s
(* 
±r
) {

123 
	gi
=0; i<
G‘Size
(); i++) {

124 
G‘V®
(
i
)->
£tv®
(*
±r
++);

126  
	g±r
;

129 * 
G‘V®s
(* 
±r
) {

130 
	gi
=0; i<
G‘Size
(); i++) {

131 (*
	g±r
++èğ
G‘V®
(
i
)->
v®
();

133  
	g±r
;

136 
	gV¬
<
	gPosR—l
>* 
G‘AÍha
() {

137  
	g®pha
;

140 
	gV¬
<
	gPosR—l
>* 
G‘B‘a
() {

141  
	gb‘a
;

144 
G‘M—n
() {

145 
	gm—n
 = 0;

146 
	gi
=0; i<
G‘Size
(); i++) {

147 
	gm—n
 +ğ
G‘V®
(
i
)->
v®
();

149 
	gm—n
 /ğ
G‘Size
();

150  
	gm—n
;

153 
G‘V¬
() {

154 
	gm—n
 = 0;

155 
	gv¬
 = 0;

156 
	gi
=0; i<
G‘Size
(); i++) {

157 
	gtmp
 = 
G‘V®
(
i
)->
v®
();

158 
	gm—n
 +ğ
tmp
;

159 
	gv¬
 +ğ
tmp
 *mp;

161 
	gm—n
 /ğ
G‘Size
();

162 
	gv¬
 /ğ
G‘Size
();

163 
	gv¬
 -ğ
m—n
 * mean;

164  
	gv¬
;

167 
	g´Ùeùed
:

169 
Rv¬
<
PosR—l
>* 
C»©eV®
(
s™e
) {

170  
Ãw
 
Gamma
(
®pha
, 
b‘a
);

173 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

174 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

177 
şass
 
	gDœichËtIIDA¼ay
 : 
public
 
IIDA¼ay
<
Profe
> {

179 
public
:

180 
DœichËtIIDA¼ay
(
šsize
, 
V¬
<
Profe
>* 
šûÁ”
, V¬<
PosR—l
>* 
šcÚûÁ¿tiÚ
è: 
IIDA¼ay
<Profile>(insize) {

181 
ûÁ”
 = 
šûÁ”
;

182 
	gcÚûÁ¿tiÚ
 = 
šcÚûÁ¿tiÚ
;

183 
C»©e
();

186 * 
S‘V®s
(* 
±r
) {

187 
	gi
=0; i<
G‘Size
(); i++) {

188 
	gk
=0; k<
G‘Dim
(); k++) {

189 (*
G‘V®
(
i
))[
k
] = (*
±r
++);

192  
	g±r
;

195 * 
G‘V®s
(* 
±r
) {

196 
	gi
=0; i<
G‘Size
(); i++) {

197 
	gk
=0; k<
G‘Dim
(); k++) {

198 (*
	g±r
++èğ(*
G‘V®
(
i
))[
k
];

201  
	g±r
;

204 
DœichËt
* 
G‘DœichËtV®
(
s™e
) {

205  
	gdyÇmic_ÿ¡
<
	gDœichËt
*>(
G‘V®
(
s™e
));

208 
G‘M—nEÁrİy
() {

209 
	gm—n
 = 0;

210 
	gi
=0; i<
G‘Size
(); i++) {

211 
	gm—n
 +ğ
G‘DœichËtV®
(
i
)->
G‘EÁrİy
();

213 
	gm—n
 /ğ
G‘Size
();

214  
	gm—n
;

217 
S‘UnifÜm
() {

218 
	gi
=0; i<
G‘Size
(); i++) {

219 
G‘DœichËtV®
(
i
)->
£tunifÜm
();

232 
G‘Dim
() {

233  
G‘V®
(0)->
G‘Dim
();

236 
	g´Ùeùed
:

238 
Rv¬
<
Profe
>* 
C»©eV®
(
s™e
) {

239  
Ãw
 
DœichËt
(
ûÁ”
,
cÚûÁ¿tiÚ
);

242 
	gV¬
<
	gProfe
>* 
	gûÁ”
;

243 
	gV¬
<
	gPosR—l
>* 
	gcÚûÁ¿tiÚ
;

246 şas 
	cDœichËtIIDA¼ayMove
 : 
public
 
MCUpd©e
 {

248 
public
:

250 
	$DœichËtIIDA¼ayMove
(
DœichËtIIDA¼ay
* 
š£Ëù¬¿y
, 
štunšg
, 
šm
è: 
	`£Ëù¬¿y
(š£Ëù¬¿y), 
	`tunšg
(štunšg), 
	$m
(
šm
) {}

252 
	$Move
(
tunšg_moduÏtÜ
) {

253 
tÙ®
 = 0;

255 #ifdeà
_OPENMP


256 #´agm¨
omp
 
·¿Î–
 

259 
i
=0; i<
£Ëù¬¿y
->
	`G‘Size
(); i++) {

260 
tÙ®
 +ğ
£Ëù¬¿y
->
	`G‘DœichËtV®
(
i
)->
	`Move
(
tunšg_moduÏtÜ
 * 
tunšg
,
m
);

264  
tÙ®
 / 
£Ëù¬¿y
->
	`G‘Size
();

265 
	}
}

267 
	g´iv©e
:

269 
DœichËtIIDA¼ay
* 
£Ëù¬¿y
;

270 
	gtunšg
;

271 
	gm
;

274 
şass
 
	gNÜm®IIDA¼ay
 : 
public
 
IIDA¼ay
<
R—l
> {

276 
public
:

277 
NÜm®IIDA¼ay
(
šsize
, 
V¬
<
R—l
>* 
šm—n
, V¬<
PosR—l
>* 
šv¬
è: 
IIDA¼ay
<Real>(insize) {

278 
m—n
 = 
šm—n
;

279 
	gv¬
 = 
šv¬
;

280 
C»©e
();

283 * 
S‘V®s
(* 
±r
) {

284 
	gi
=0; i<
G‘Size
(); i++) {

285 
G‘V®
(
i
)->
£tv®
(*
±r
++);

287  
	g±r
;

290 * 
G‘V®s
(* 
±r
) {

291 
	gi
=0; i<
G‘Size
(); i++) {

292 (*
	g±r
++èğ
G‘V®
(
i
)->
v®
();

294  
	g±r
;

297 
Re£t
() {

298 
	gi
=0; i<
G‘Size
(); i++) {

299 
G‘V®
(
i
)->
£tv®
(0);

303 
NÜm®
* 
G‘NÜm®
(
s™e
) {

304 
NÜm®
* 
	gn
 = 
dyÇmic_ÿ¡
<NÜm®*>(
G‘V®
(
s™e
));

305 ià(! 
	gn
) {

306 
	gû¼
 << "error in NormalIIDArray::GetNormal\n";

307 
ex™
(1);

309  
	gn
;

312 
	g´Ùeùed
:

314 
Rv¬
<
R—l
>* 
C»©eV®
(
s™e
) {

315  
Ãw
 
NÜm®
(
m—n
,
v¬
);

318 
	gV¬
<
	gR—l
>* 
	gm—n
;

319 
	gV¬
<
	gPosR—l
>* 
	gv¬
;

	@IIDConjugate.h

1 #iâdeà
IIDCONJUGATE_H


2 
	#IIDCONJUGATE_H


	)

4 
	~"Ba£Ty³.h
"

5 
	~"V¬.h
"

6 
	~"CÚjug©e.h
"

8 
şass
 
	gIIDPoissÚSemiCÚjug©e
: 
public
 
vœtu®
 
SemiCÚjug©ePriÜ
<
PosR—lVeùÜ
> {

10 
public
:

12 
IIDPoissÚSemiCÚjug©e
() {

13 ià(
G‘Dim
() == 0) {

14 
û¼
 << "error in IIDPoissonSemiConjugate\n";

15 
	gû¼
 << "classes diamond-inheriting from IIDPoissonSemiConjugate should FIRST inherit from‡ Rvar<PosRealVector>ype\n";

16 
	gû¼
 << "(order of declaration of inheritance matters here)\n";

17 
ex™
(1);

19 
	gsh­e¡©
 = 
Ãw
 [
G‘Dim
()];

20 
	gsÿË¡©
 = 
Ãw
 [
G‘Dim
()];

21 
	gbksh­e¡©
 = 
Ãw
 [
G‘Dim
()];

22 
	gbksÿË¡©
 = 
Ãw
 [
G‘Dim
()];

25 
	gvœtu®
 ~
IIDPoissÚSemiCÚjug©e
() {

26 
	gd–‘e
[] 
	gsh­e¡©
;

27 
	gd–‘e
[] 
	gsÿË¡©
;

28 
	gd–‘e
[] 
	gbksh­e¡©
;

29 
	gd–‘e
[] 
	gbksÿË¡©
;

32 
Re£tSuffic›ÁSti¡ic
() {

33 
	gi
=0; i<
G‘Dim
(); i++) {

34 
	gsh­e¡©
[
i
] = 0;

35 
	gsÿË¡©
[
i
] = 0;

39 
SaveSuffic›ÁSti¡ic
() {

40 
	gi
=0; i<
G‘Dim
(); i++) {

41 
	gbksh­e¡©
[
i
] = 
sh­e¡©
[i];

42 
	gbksÿË¡©
[
i
] = 
sÿË¡©
[i];

46 
Re¡ÜeSuffic›ÁSti¡ic
() {

47 
	gi
=0; i<
G‘Dim
(); i++) {

48 
	gsh­e¡©
[
i
] = 
bksh­e¡©
[i];

49 
	gsÿË¡©
[
i
] = 
bksÿË¡©
[i];

53 
AddToSh­e
(* 
š
) {

54 
	gi
=0; i<
G‘Dim
(); i++) {

55 
	gsh­e¡©
[
i
] +ğ
š
[i];

59 
AddToSÿË
(* 
š
) {

60 
	gi
=0; i<
G‘Dim
(); i++) {

61 
	gsÿË¡©
[
i
] +ğ
š
[i];

65 
SuffStLogProb
() {

66 
	gtÙ®
 = 0;

67 
	gi
=0; i<
G‘Dim
(); i++) {

68 
	gtÙ®
 +ğ
sh­e¡©
[
i
] * 
log
((*
this
)[i]è- 
sÿË¡©
[i] * (*this)[i];

70  
	gtÙ®
;

73 
	g´Ùeùed
:

75 * 
sh­e¡©
;

76 * 
	gsÿË¡©
;

77 * 
	gbksh­e¡©
;

78 * 
	gbksÿË¡©
;

82 
şass
 
	gIIDCÚjug©eGamma
 : 
public
 
IIDGamma
,…ubliø
	gCÚjug©ePriÜ
<
	gPosR—lVeùÜ
> , 
	gIIDPoissÚSemiCÚjug©e
 {

84 
	gpublic
:

86 
IIDCÚjug©eGamma
(
šdim
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
è: 
IIDGamma
(indim, inalpha, inbeta) {}

88 
IIDCÚjug©eGamma
(
šdim
è: 
IIDGamma
(indim) {}

90 
GibbsRe§m¶e
() {

91 
a
 = 
®pha
 ? (è®pha->
v®
() : 1.0;

92 
	gb
 = 
b‘a
 ? (èb‘a->
v®
() : 1.0;

93 
	gi
=0; i<
G‘Dim
(); i++) {

94 (*
	gthis
)[
i
] = 
Rªdom
::
Gamma
(
a
 + 
sh­e¡©
[i], 
b
 + 
sÿË¡©
[i]);

95 ià((*
	gthis
)[
i
] < 
	gGamma
::
GAMMAMIN
) {

96 (*
this
)[
i
] = 
Gamma
::
GAMMAMIN
;

101 
logProb
() {

102 ià(
isAùive
()) {

103 
	ga
 = 
®pha
 ? (è®pha->
v®
() : 1.0;

104 
	gb
 = 
b‘a
 ? (èb‘a->
v®
() : 1.0;

105 ià(
isIÁeg¿‹d
()) {

106 
	gtÙ®
 = 0;

107 
	gi
=0; i<
G‘Dim
(); i++) {

108 
	gtÙ®
 +ğ- 
Rªdom
::
logGamma
(
a
è+‡ * 
log
(
b
è+ Rªdom::logGamma× + 
sh­e¡©
[
i
]è- (¨+ sh­e¡©[i]è*†og(b + 
sÿË¡©
[i]);

110  
	gtÙ®
;

112 
	gtÙ®
 = 0;

113 
	gi
=0; i<
G‘Dim
(); i++) {

114 
	gtÙ®
 +ğ-
Rªdom
::
logGamma
(
a
è+‡ * 
log
(
b
è- (b + 
sÿË¡©
[
i
]è* (*
this
)[i] + (¨+ 
sh­e¡©
[i] - 1) *†og((*this)[i]);

116  
	gtÙ®
;

118  
	gIIDGamma
::
logProb
();

	@InverseWishartMatrix.h

1 #iâdeà
WISHART_H


2 
	#WISHART_H


	)

4 
	~"CovM©rix.h
"

5 
	~"T»e.h
"

6 
	~"V®A¼ay.h
"

8 
	~"G’”icTimeLše.h
"

10 
	~"Glob®SÿlšgFunùiÚ.h
"

12 şas 
	cSigmaZ”o
 : 
public
 
Dnode
{

14 
public
:

16 
SigmaZ”o
(
V¬
<
PosR—l
>** 
š¬¿y
, 
šdim
) {

17 
	mdŸg
 = 0;

18 
	mdim
 = 
šdim
;

19 
	m¬¿y
 = 
š¬¿y
;

20 
	mi
=0; i<
G‘Dim
(); i++){

21 
Regi¡”
(
¬¿y
[
i
]);

23 
¥ecŸlUpd©e
();

26 
SigmaZ”o
(
V¬A¼ay
<
PosR—l
>* 
šdŸg
){

27 
	g¬¿y
 = 0;

28 
	gdŸg
 = 
šdŸg
;

29 
	gdim
 = 
dŸg
->
G‘Size
();

30 
	gi
=0; i<
G‘Dim
(); i++){

31 
Regi¡”
(
dŸg
->
G‘V®
(
i
));

33 
¥ecŸlUpd©e
();

36 ~
	$SigmaZ”o
(){
	}
}

38 
	$v®
(
šdex
){

39 ià(
dŸg
) {

40  
dŸg
->
	`G‘V®
(
šdex
)->
	`v®
();

42  
¬¿y
[
šdex
]->
	`v®
();

43 
	}
}

47 
	$d¿wV®Inv
(* 
x
){

48 
i
=0; i<
	`G‘Dim
(); i++) {

49 
x
[
i
] = 
Rªdom
::
	`sNÜm®
(è/ 
	`sq¹
(
	`v®
(i));

51 
	}
}

53 
	$G‘Dim
(){

54  
dim
;

55 
	}
}

57 
	$G‘D‘”mšªt
(){

58 
p
 = 1;

59 
i
=0; i<
	`G‘Dim
(); i++){

60 
p
 *ğ
	`v®
(
i
);

62  
p
;

63 
	}
}

65 
	$G‘LogD‘”mšªt
(){

66 
logp
 = 0;

67 
i
=0; i<
	`G‘Dim
(); i++){

68 
logp
 +ğ
	`log
(
	`v®
(
i
));

70  
logp
;

71 
	}
}

73 
	$¥ecŸlUpd©e
(){
	}
}

75 
	g´iv©e
:

77 
dim
;

78 
	gV¬A¼ay
<
	gPosR—l
>* 
	gdŸg
;

79 
	gV¬
<
	gPosR—l
>** 
	g¬¿y
;

83 
şass
 
	gInv”£Wish¬tM©rix
 : 
public
 
vœtu®
 
Rv¬
<
CovM©rix
> {

85 
´Ùeùed
 :

87 
SigmaZ”o
* 
dŸgÚ®M©rix
;

88 
	gP
;

90 
	gpublic
 :

92 
SigmaZ”o
* 
G‘DŸgÚ®M©rix
() {

93  
dŸgÚ®M©rix
;

96 
G‘P
() {

97  
	gP
;

100 
Inv”£Wish¬tM©rix
(
SigmaZ”o
* 
šDŸgÚ®M©rix
, 
šP
è: 
Rv¬
<
CovM©rix
>(CovM©rix(šDŸgÚ®M©rix->
G‘Dim
())){

101 
dŸgÚ®M©rix
 = 
šDŸgÚ®M©rix
;

102 
	gP
 =
šP
;

103 
Regi¡”
(
dŸgÚ®M©rix
);

104 
Sam¶e
();

109 
d¿wSam¶e
(){

110 
	gcÚt
 = 1;

111 ** 
	gechªtlÚ
 = 
Ãw
 *[
P
];

112 
	gi
=0; i< 
	gP
 ; i++) {

113 
	gechªtlÚ
[
i
] = 
Ãw
 [
G‘Dim
()];

116 
	gcÚt
) {

118 
	gi
=0; i< 
	gP
 ; i++) {

119 
	gdŸgÚ®M©rix
->
d¿wV®Inv
(
echªtlÚ
[
i
]);

123 
Sÿ‰”izeOnZ”o
(
echªtlÚ
, 
P
);

125 
	gcÚt
 = 
Inv”t
();

154 
	gi
=0; i< 
	gP
 ; i++) {

155 
	gd–‘e
[] 
	gechªtlÚ
[
i
];

157 
	gd–‘e
[] 
	gechªtlÚ
;

160 
d¿wSam¶e
(
CovM©rix
* 
A
) {

163 * 
	gv
 = 
Ãw
 [
G‘Dim
()];

164 
	gi
=0; i<
G‘Dim
(); i++) {

165 
	gv
[
i
] = 
Rªdom
::
Gamma
(0.5*(
P
-i),0.5);

167 ** 
	gn
 = 
Ãw
 *[
G‘Dim
()];

168 ** 
	gb
 = 
Ãw
 *[
G‘Dim
()];

169 ** 
	ga
 = 
Ãw
 *[
G‘Dim
()];

170 
	gi
=0; i<
G‘Dim
(); i++) {

171 
	gn
[
i
] = 
Ãw
 [
G‘Dim
()];

172 
	gb
[
i
] = 
Ãw
 [
G‘Dim
()];

173 
	ga
[
i
] = 
Ãw
 [
G‘Dim
()];

176 
	gi
=0; i<
G‘Dim
(); i++) {

177 
	gj
=
i
+1; j<
G‘Dim
(); j++) {

178 
	gn
[
i
][
j
] = 
Rªdom
::
sNÜm®
();

181 
	gi
=0; i<
G‘Dim
(); i++) {

182 
	gb
[
i
][i] = 
v
[i];

183 
	gk
=0; k<
	gi
; k++) {

184 
	gb
[
i
][i] +ğ
n
[
k
][i] *‚[k][i];

187 
	gi
=0; i<
G‘Dim
(); i++) {

188 
	gj
=
i
+1; j<
G‘Dim
(); j++) {

189 
	gb
[
i
][
j
] = 
n
[i][j] * 
sq¹
(
v
[i]);

190 
	gk
=0; k<
	gi
; k++) {

191 
	gb
[
i
][
j
] +ğ
n
[
k
][i] *‚[k][j];

193 
	gb
[
j
][
i
] = 
b
[i][j];

197 
	gA
->
CÜru±DŸg
();

198 
	gA
->
DŸgÚ®i£
();

200 ** 
	gp
 = 
A
->
G‘Eig’Veù
();

201 ** 
	gšvp
 = 
A
->
G‘InvEig’Veù
();

202 * 
	gd
 = 
A
->
G‘Eig’V®
();

205 
	gi
=0; i<
G‘Dim
(); i++) {

206 
	gj
=0; j<
G‘Dim
(); j++) {

207 
	ga
[
i
][
j
] = 
p
[i][j] / 
sq¹
(
d
[j]);

211 
	gi
=0; i<
G‘Dim
(); i++) {

212 
	gj
=0; j<
G‘Dim
(); j++) {

213 
	gtmp
 = 0;

214 
	gk
=0; k<
G‘Dim
(); k++) {

215 
	gtmp
 +ğ
b
[
i
][
k
] * 
a
[
j
][k];

217 
	gn
[
i
][
j
] = 
tmp
;

221 
	gi
=0; i<
G‘Dim
(); i++) {

222 
	gj
=0; j<
G‘Dim
(); j++) {

223 
	gtmp
 = 0;

224 
	gk
=0; k<
G‘Dim
(); k++) {

225 
	gtmp
 +ğ
a
[
i
][
k
] * 
n
[k][
j
];

227 (*
	gthis
)[
i
][
j
] = 
tmp
;

231 
Inv”t
();

233 
	gi
=0; i<
G‘Dim
(); i++) {

234 
	gd–‘e
[] 
	gn
[
i
];

235 
	gd–‘e
[] 
	gb
[
i
];

236 
	gd–‘e
[] 
	ga
[
i
];

238 
	gd–‘e
[] 
	gn
;

239 
	gd–‘e
[] 
	gb
;

240 
	gd–‘e
[] 
	ga
;

241 
	gd–‘e
[] 
	gv
;

245 
d¿wSam¶eOld
(
CovM©rix
* 
A
){

246 ** 
	gechªtlÚ
 = 
Ãw
 *[
P
];

247 
	gi
=0; i< 
	gP
 ; i++) {

248 
	gechªtlÚ
[
i
] = 
Ãw
 [
G‘Dim
()];

249 
	gA
->
d¿wV®Inv
(
echªtlÚ
[
i
]);

251 
Sÿ‰”izeOnZ”o
(
echªtlÚ
, 
P
);

252 
	gi
=0; i< 
	gP
 ; i++) {

253 
	gd–‘e
[] 
	gechªtlÚ
[
i
];

255 
	gd–‘e
[] 
	gechªtlÚ
;

256 ià(
Inv”t
()) {

257 
	gû¼
 << "in draw sample cov matrix A\n";

258 
	gû¼
 << '\n' << *
	gA
 << '\n';

259 
	gû¼
 << "DF : " << 
	gP
 << '\n';

260 
ex™
(1);

264 
S‘AndCÏmpAtSigmaZ”o
(){

265 
	gi
=0; i<
G‘Dim
(); i++){

266 
	gv®ue
[
i
][i] = 
dŸgÚ®M©rix
->
v®
(i);

267 
	gj
=0; j<
	gi
; j++){

268 
	gv®ue
[
i
][
j
] = 0;

269 
	gv®ue
[
j
][
i
] = 0;

272 
CÏmp
();

275 
S‘AtSigmaZ”o
(){

276 
	gi
=0; i<
G‘Dim
(); i++){

277 
	gv®ue
[
i
][i] = 
dŸgÚ®M©rix
->
v®
(i);

278 
	gj
=0; j<
	gi
; j++){

279 
	gv®ue
[
i
][
j
] = 0;

281 
	gv®ue
[
j
][
i
] = 
v®ue
[i][j];

286 
loÿlRe¡Üe
(){

287 
	gRv¬
<
	gCovM©rix
>::
loÿlRe¡Üe
();

288 
	gdŸgæag
 = 
çl£
;

292 
loÿlCÜru±
(
boŞ
 
bk
){

293 
	gRv¬
<
	gCovM©rix
>::
loÿlCÜru±
(
bk
);

294 
	gdŸgæag
 = 
çl£
;

298 
logProb
(){

299 if(
isPos™iveDefše
()){

300 
	gsum
 = 0;

301 
	gi
=0; i<
G‘Dim
(); i++){

302 
	gsum
 +ğ
G‘InvM©rix
()[
i
][i] * 
dŸgÚ®M©rix
->
v®
(i);

304 
	gd
 = - ((
G‘LogD‘”mšªt
(è* (
G‘Dim
(è+ 
P
 + 1)è+ 
sum
) * 0.5;

305 
	gd
 +ğ
dŸgÚ®M©rix
->
G‘LogD‘”mšªt
(è* 
P
 * 0.5;

306  
	gd
;

314 
M¬gš®LogProb
(
CovM©rix
& 
sÿË¡©
, 
sh­e¡©
) {

316 
	gi
=0; i<
	gdim
; i++){

317 
	gsÿË¡©
[
i
][i] +ğ
dŸgÚ®M©rix
->
v®
(i);

319 
CovM©rix
* 
	gpo¡sÿË
 = 
Ãw
 CovM©rix(
sÿË¡©
);

320 
	gpo¡sh­e
 = 
P
 + 
sh­e¡©
;

321 
	gl
 = 
dŸgÚ®M©rix
->
G‘LogD‘”mšªt
(è* 
P
 * 0.5 - 
po¡sÿË
->G‘LogD‘”mšªt(è* 
po¡sh­e
 * 0.5;

322 
d–‘e
 
	gpo¡sÿË
;

323 
	gi
=0; i<
	gdim
; i++){

324 
	gsÿË¡©
[
i
][i] -ğ
dŸgÚ®M©rix
->
v®
(i);

326  
	gl
;

329 
GibbsRe§m¶e
(
CovM©rix
& 
sÿË¡©
, 
sh­e¡©
) {

331 
	gi
=0; i<
	gdim
; i++){

332 
	gsÿË¡©
[
i
][i] +ğ
dŸgÚ®M©rix
->
v®
(i);

334 
	gP
 +ğ
sh­e¡©
;

335 
	gsÿË¡©
.
DŸgÚ®i£
();

336 
d¿wSam¶e
(&
sÿË¡©
);

337 
	gi
=0; i<
G‘Dim
(); i++){

338 
	gsÿË¡©
[
i
][i] -ğ
dŸgÚ®M©rix
->
v®
(i);

340 
	gP
 -ğ
sh­e¡©
;

343 
LeáRightMuÉly
(** 
P
) {

345 ** 
	gaux
 = 
Ãw
 *[
G‘Dim
()];

346 
	gi
=0; i<
G‘Dim
(); i++) {

347 
	gaux
[
i
] = 
Ãw
 [
G‘Dim
()];

350 
	gi
=0; i<
G‘Dim
(); i++) {

351 
	gj
=0; j<
G‘Dim
(); j++) {

352 
	gtmp
 = 0;

353 
	gk
=0; k<
G‘Dim
(); k++) {

354 
	gtmp
 +ğ(*
this
)[
i
][
k
] * 
P
[
j
][k];

356 
	gaux
[
i
][
j
] = 
tmp
;

360 
	gi
=0; i<
G‘Dim
(); i++) {

361 
	gj
=0; j<
G‘Dim
(); j++) {

362 
	gtmp
 = 0;

363 
	gk
=0; k<
G‘Dim
(); k++) {

364 
	gtmp
 +ğ
P
[
i
][
k
] * 
aux
[k][
j
];

366 (*
	gthis
)[
i
][
j
] = 
tmp
;

370 
	gi
=0; i<
G‘Dim
(); i++) {

371 
	gd–‘e
[] 
	gaux
[
i
];

373 
	gd–‘e
[] 
	gaux
;

379 
şass
 
	gDŸgÚ®CovM©rix
 : 
public
 
vœtu®
 
Rv¬
<
CovM©rix
> {

381 
´Ùeùed
 :

383 
SigmaZ”o
* 
dŸgÚ®M©rix
;

384 
	gP
;

386 
	gpublic
 :

388 
DŸgÚ®CovM©rix
(
SigmaZ”o
* 
šDŸgÚ®M©rix
, 
šP
è: 
Rv¬
<
CovM©rix
>(CovM©rix(šDŸgÚ®M©rix->
G‘Dim
())){

389 
dŸgÚ®M©rix
 = 
šDŸgÚ®M©rix
;

390 
	gP
 = 
šP
;

391 
Regi¡”
(
dŸgÚ®M©rix
);

393 
Sam¶e
();

396 
d¿wSam¶e
(){

398 
	gi
=0; i<
G‘Dim
(); i++) {

399 
	g®pha
 = 0.5 * (
P
 + 
G‘Dim
() - 1);

401 
	gb‘a
 = 0.5 * 
dŸgÚ®M©rix
->
v®
(
i
);

402 
	gtmp
 = 
Rªdom
::
Gamma
(
®pha
,
b‘a
);

403 
	gv®ue
[
i
][i] = 1.0 / 
tmp
;

405 
	gdŸgæag
 = 
çl£
;

408 
S‘AndCÏmpAtSigmaZ”o
(){

409 
S‘AtSigmaZ”o
();

410 
CÏmp
();

413 
S‘AtSigmaZ”o
(){

414 
	gi
=0; i<
G‘Dim
(); i++){

415 
	gv®ue
[
i
][i] = 
dŸgÚ®M©rix
->
v®
(i);

416 
	gbkv®ue
[
i
][i] = 
dŸgÚ®M©rix
->
v®
(i);

417 
	gj
=0; j<
	gi
; j++){

418 
	gv®ue
[
i
][
j
] = 0;

419 
	gbkv®ue
[
i
][
j
] = 0;

420 
	gv®ue
[
j
][
i
] = 0;

421 
	gbkv®ue
[
j
][
i
] = 0;

426 
G‘LogD‘”mšªt
() {

427 
	gtÙ®
 = 0;

428 
	gi
=0; i<
G‘Dim
(); i++) {

429 
	gtÙ®
 +ğ
log
(
dŸgÚ®M©rix
->
v®
(
i
));

431  
	gtÙ®
;

434 
G‘D‘”mšªt
() {

435 
	gtÙ®
 = 1;

436 
	gi
=0; i<
G‘Dim
(); i++) {

437 
	gtÙ®
 *ğ
dŸgÚ®M©rix
->
v®
(
i
);

439  
	gtÙ®
;

442 
loÿlRe¡Üe
(){

443 
	gRv¬
<
	gCovM©rix
>::
loÿlRe¡Üe
();

444 
	gdŸgæag
 = 
çl£
;

448 
loÿlCÜru±
(
boŞ
 
bk
){

449 
	gRv¬
<
	gCovM©rix
>::
loÿlCÜru±
(
bk
);

450 
	gdŸgæag
 = 
çl£
;

453 
Prİo£Move
(
tunšg
) {

455 
	gk
 = (è(
G‘Dim
(è* 
Rªdom
::
UnifÜm
());

456 
	gh
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

457 
	ge
 = 
exp
(
h
);

458 
	gv®ue
[
k
][k] *ğ
e
;

459  
	gh
;

462 
logProb
(){

463 
	gsum
 = 0;

464 
	gi
=0; i<
G‘Dim
(); i++){

465 
	g®pha
 = 0.5 * (
P
 + 
G‘Dim
() - 1);

467 
	gb‘a
 = 0.5 * 
dŸgÚ®M©rix
->
v®
(
i
);

468 
	gsum
 +ğ
®pha
 * 
log
(
b‘a
è- (®ph¨+ 1è*†og(
v®ue
[
i
][i]è- b‘¨/ v®ue[i][i] - 
Rªdom
::
logGamma
(alpha);

470  
	gsum
;

475 şas 
	cBoundFÜMuÉiNÜm®
 {

477 
	mpublic
:

478 
	$BoundFÜMuÉiNÜm®
(è: 
	`x1
(""), 
	`x2
(""), 
	`low”bound
(-1), 
	`uµ”bound
(-1), 
	`šdex
(-1) {}

480 
	$BoundFÜMuÉiNÜm®
(
¡ršg
 
šx1
, sŒšg 
šx2
, 
ššdex
, 
šlow”bound
, 
šuµ”bound
è: 
	`x1
(šx1), 
	`x2
(šx2), 
	`low”bound
(šlow”bound), 
	`uµ”bound
(šuµ”bound), 
	$šdex
(
ššdex
è{
	}
}

482 ~
	$BoundFÜMuÉiNÜm®
(è{
	}
}

484 
	$G‘Uµ”Bound
(ècÚ¡ { 
uµ”bound
;
	}
}

485 
	$G‘Low”Bound
(ècÚ¡ { 
low”bound
;
	}
}

487 
	$G‘Index
(ècÚ¡ { 
šdex
;
	}
}

489 
¡ršg
 
	$G‘TaxÚ1
(ècÚ¡ { 
x1
;
	}
}

490 
¡ršg
 
	$G‘TaxÚ2
(ècÚ¡ { 
x2
;
	}
}

492 
	$ToSŒ—m
(
o¡»am
& 
os
) const {

493 
os
 << 
x1
 << '\t' << 
x2
 << '\t' << 
šdex
 << '\t' << 
low”bound
 << '\t' << 
uµ”bound
 << '\n';

494 
	}
}

496 
	$FromSŒ—m
(
i¡»am
& 
is
) {

497 
is
 >> 
x1
 >> 
x2
 >> 
šdex
 >> 
low”bound
 >> 
uµ”bound
;

498 
û¼
 << 
šdex
 << '\n';

499 
	}
}

501 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, cÚ¡ 
	gBoundFÜMuÉiNÜm®
& 
	gÿl
) {

502 
	gÿl
.
ToSŒ—m
(
os
);

503  
	gos
;

506 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gBoundFÜMuÉiNÜm®
& 
	gÿl
) {

507 
	gÿl
.
FromSŒ—m
(
is
);

508  
	gis
;

511 
	g´iv©e
:

512 
¡ršg
 
x1
;

513 
¡ršg
 
	gx2
;

514 
	glow”bound
;

515 
	guµ”bound
;

516 
	gšdex
;

520 şas 
	cBoundS‘
 {

522 
	mpublic
:

524 
	$BoundS‘
(
T»e
* 
šŒ“
è: 
	$Œ“
(
šŒ“
) {}

526 
	$ToSŒ—m
(
o¡»am
& 
os
) const {

527 
Nÿlib
 = 0;

528 
m­
<cÚ¡ 
Node
*,
BoundFÜMuÉiNÜm®
>::
cÚ¡_™”©Ü
 
i
 = 
nodem­
.
	`begš
(); i!òodem­.
	`’d
(); i++) {

529 
Nÿlib
++;

531 
os
 << 
Nÿlib
 << '\n';

532 
m­
<cÚ¡ 
Node
*,
BoundFÜMuÉiNÜm®
>::
cÚ¡_™”©Ü
 
i
 = 
nodem­
.
	`begš
(); i!òodem­.
	`’d
(); i++) {

533 
os
 << 
i
->
£cÚd
 << '\n';

535 
	}
}

537 
	$FromSŒ—m
(
i¡»am
& 
is
) {

538 
Nÿlib
;

539 
is
 >> 
Nÿlib
;

540 
i
=0; i<
Nÿlib
; i++) {

541 
BoundFÜMuÉiNÜm®
 
bound
;

542 
is
 >> 
bound
;

543 cÚ¡ 
Lšk
* 
lšk
ğ
Œ“
->
	`G‘LCA
(
bound
.
	`G‘TaxÚ1
(),bound.
	`G‘TaxÚ2
());

544 ià(! 
lšk
) {

545 
û¼
 << "”rÜ iÀÿlib¿tiÚ s‘: did‚Ù fšd commÚ‡nû¡Ü oà" << 
bound
 << '\n';

546 
	`ex™
(1);

548 
nodem­
[
lšk
->
	`G‘Node
()] = 
bound
;

550 
	}
}

552 cÚ¡ 
	gm­
<cÚ¡ 
	gNode
*,
	gBoundFÜMuÉiNÜm®
>& 
	$G‘NodeM­
(ècÚ¡ { 
nodem­
;
	}
}

554 
	g´iv©e
:

556 
m­
<cÚ¡ 
Node
*,
	gBoundFÜMuÉiNÜm®
> 
	gnodem­
;

557 
T»e
* 
	gŒ“
;

560 şas 
	cFeBoundS‘
 : 
public
 
BoundS‘
 {

562 
public
:

564 
	$FeBoundS‘
(
¡ršg
 
f’ame
, 
T»e
* 
šŒ“
è: 
	$BoundS‘
(
šŒ“
) {

565 
if¡»am
 
	`is
(
f’ame
.
	`c_¡r
());

566 
	`FromSŒ—m
(
is
);

568 
	}
};

574 
şass
 
	gMuÉiNÜm®
 : 
public
 
vœtu®
 
Rv¬
<
R—lVeùÜ
>{

576 
public
:

578 
MuÉiNÜm®
(
V¬
<
CovM©rix
>* 
šsigma
, V¬<
R—lVeùÜ
>* 
šup
, V¬<
PosR—l
>* 
štime
, V¬<PosR—l>* 
šd©e
, V¬<PosR—l>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
) {

580 
	gsÿË
 = 0;

581 
	gdriá
 = 0;

582 
	gdriáphi
 = 0;

583 
	gdriá2
 = 0;

584 
	gdriáphi2
 = 0;

585 
	gtim–še
 = 0;

586 
	g®pha
 = 0;

587 
	groÙm—n
 = 0;

588 
	groÙv¬
 = 0;

590 
	gsigma
 = 
šsigma
;

591 
	gup
 = 
šup
;

592 
	gtime
 = 
štime
;

593 
	gd©e
 = 
šd©e
;

594 
	gagesÿË
 = 
šagesÿË
;

595 
	gsÿËfunùiÚ
 = 
šsÿËfunùiÚ
;

597 
Regi¡”
(
sigma
);

598 
Regi¡”
(
up
);

599 
Regi¡”
(
time
);

600 
Regi¡”
(
d©e
);

601 
Regi¡”
(
agesÿË
);

602 
Regi¡”
(
sÿËfunùiÚ
);

604 
£tv®
(
R—lVeùÜ
(
šsigma
->
G‘Dim
()));

605 
	gCÏmpVeùÜ
 = 
Ãw
 
boŞ
[
G‘Dim
()];

606 
	ghasuµ”bound
 = 
Ãw
 
boŞ
[
G‘Dim
()];

607 
	gha¦ow”bound
 = 
Ãw
 
boŞ
[
G‘Dim
()];

608 
	guµ”bound
 = 
Ãw
 [
G‘Dim
()];

609 
	glow”bound
 = 
Ãw
 [
G‘Dim
()];

610 
	gi
=0; i <
G‘Dim
(); i++){

611 
	ghasuµ”bound
[
i
] = 
çl£
;

612 
	gha¦ow”bound
[
i
] = 
çl£
;

614 
	ghasbounds
 = 
çl£
;

615 
	groÙmax
 = 1000;

616  
	gi
=0; i <
G‘Dim
(); i++){

617 
UnCÏmp
(
i
);

619 
Sam¶e
();

622 
MuÉiNÜm®
(
unu£d
, 
V¬
<
CovM©rix
>* 
šsigma
, V¬<
R—lVeùÜ
>* 
šroÙm—n
, V¬<
PosR—lVeùÜ
>* 
šroÙv¬
) {

624 
	gsÿËfunùiÚ
 = 0;

626 
	gsigma
 = 
šsigma
;

627 
	gup
 = 0;

628 
	gtime
 = 0;

629 
	gsÿË
 = 0;

630 
	gdriá
 = 0;

631 
	gdriáphi
 = 0;

632 
	gdriá2
 = 0;

633 
	gdriáphi2
 = 0;

634 
	gd©e
 = 0;

635 
	gtim–še
 = 0;

636 
	g®pha
 = 0;

638 
	groÙm—n
 = 
šroÙm—n
;

639 
	groÙv¬
 = 
šroÙv¬
;

640 
Regi¡”
(
sigma
);

641 ià(
	groÙm—n
) {

642 
Regi¡”
(
roÙm—n
);

644 ià(
	groÙv¬
) {

645 
Regi¡”
(
roÙv¬
);

648 
£tv®
(
R—lVeùÜ
(
šsigma
->
G‘Dim
()));

649 
	gCÏmpVeùÜ
 = 
Ãw
 
boŞ
[
G‘Dim
()];

650 
	ghasuµ”bound
 = 
Ãw
 
boŞ
[
G‘Dim
()];

651 
	gha¦ow”bound
 = 
Ãw
 
boŞ
[
G‘Dim
()];

652 
	guµ”bound
 = 
Ãw
 [
G‘Dim
()];

653 
	glow”bound
 = 
Ãw
 [
G‘Dim
()];

654 
	gi
=0; i <
G‘Dim
(); i++){

655 
	ghasuµ”bound
[
i
] = 
çl£
;

656 
	gha¦ow”bound
[
i
] = 
çl£
;

658 
	ghasbounds
 = 
çl£
;

659 
	groÙmax
 = 1000;

660  
	gi
=0; i <
G‘Dim
(); i++){

661 
UnCÏmp
(
i
);

663 
Sam¶e
();

666 
MuÉiNÜm®
(
V¬
<
CovM©rix
>* 
šsigma
, V¬<
R—lVeùÜ
>* 
šup
 = 0, V¬<
PosR—l
>* 
štime
 = 0, V¬<PosR—l>* 
šsÿË
 = 0, V¬<R—lVeùÜ>* 
šdriá
 = 0, V¬<PosR—l>* 
šdriáphi
 = 0, V¬<PosR—l>* 
šd©e
 = 0, V¬<R—lVeùÜ>* 
šdriá2
 = 0, V¬<PosR—l>* 
šdriáphi2
 = 0, V¬<PosR—l>* 
šagesÿË
 = 0, 
škt
 = 0, 
G’”icTimeLše
* 
štim–še
 = 0, V¬<
R—l
>* 
š®pha
 = 0) {

668 
sÿËfunùiÚ
 = 0;

670 
	groÙm—n
 = 0;

671 
	groÙv¬
 = 0;

673 
	gsigma
 = 
šsigma
;

674 
	gup
 = 
šup
;

675 
	gtime
 = 
štime
;

676 
	gsÿË
 = 
šsÿË
;

677 
	gdriá
 = 
šdriá
;

678 
	gdriáphi
 = 
šdriáphi
;

679 
	gdriá2
 = 
šdriá2
;

680 
	gdriáphi2
 = 
šdriáphi2
;

681 
	gd©e
 = 
šd©e
;

682 
	gagesÿË
 = 
šagesÿË
;

683 
	gkt
 = 
škt
;

684 
	gtim–še
 = 
štim–še
;

685 
	g®pha
 = 
š®pha
;

686 
£tv®
(
R—lVeùÜ
(
šsigma
->
G‘Dim
()));

687 
	gCÏmpVeùÜ
 = 
Ãw
 
boŞ
[
G‘Dim
()];

688 
	ghasuµ”bound
 = 
Ãw
 
boŞ
[
G‘Dim
()];

689 
	gha¦ow”bound
 = 
Ãw
 
boŞ
[
G‘Dim
()];

690 
	guµ”bound
 = 
Ãw
 [
G‘Dim
()];

691 
	glow”bound
 = 
Ãw
 [
G‘Dim
()];

692 
	gi
=0; i <
G‘Dim
(); i++){

693 
	ghasuµ”bound
[
i
] = 
çl£
;

694 
	gha¦ow”bound
[
i
] = 
çl£
;

696 
	ghasbounds
 = 
çl£
;

697 
	groÙmax
 = 1000;

698 if(
isRoÙ
()){

702 
Regi¡”
(
up
);

703 
Regi¡”
(
time
);

705 
Regi¡”
(
sigma
);

706 ià(
	g®pha
) {

707 
Regi¡”
(
®pha
);

709 ià(
	gsÿË
) {

710 
Regi¡”
(
sÿË
);

712 ià(
	gdriá
) {

713 
Regi¡”
(
driá
);

715 ià(
	gdriáphi
) {

716 
Regi¡”
(
driáphi
);

717 ià(! 
	gd©e
) {

718 
	gû¼
 << "error in MultiNormal::MultiNormal:‚ull date\n";

719 
ex™
(1);

721 
Regi¡”
(
d©e
);

723 ià(
	gdriá2
) {

724 
Regi¡”
(
driá2
);

726 ià(
	gdriáphi2
) {

727 
Regi¡”
(
driáphi2
);

729 ià(
	gagesÿË
) {

730 
Regi¡”
(
agesÿË
);

732  
	gi
=0; i <
G‘Dim
(); i++){

733 
UnCÏmp
(
i
);

735 
Sam¶e
();

738 ~
MuÉiNÜm®
(){

739 
	gd–‘e
[] 
	gCÏmpVeùÜ
;

740 
	gd–‘e
[] 
	ghasuµ”bound
;

741 
	gd–‘e
[] 
	gha¦ow”bound
;

742 
	gd–‘e
[] 
	guµ”bound
;

743 
	gd–‘e
[] 
	glow”bound
;

746 
boŞ
 
HasBounds
(è{ 
	ghasbounds
;}

748 
S‘Bound
(cÚ¡ 
BoundFÜMuÉiNÜm®
& 
bound
, 
off£t
) {

749 
	ghasbounds
 = 
Œue
;

750 
	gšdex
 = 
bound
.
G‘Index
(è+ 
off£t
;

751 
	guµ”
 = 
bound
.
G‘Uµ”Bound
();

752 
	gû¼
 << 
	gbound
.
G‘Index
(è<< '\t' << 
	goff£t
 << '\t' << 
	gšdex
 << '\t' << 
	guµ”
 << '\n';

753 ià(
	guµ”
 != -1) {

754 ià(
uµ”
 <= 0) {

755 
û¼
 << "”rÜ :‚eg©ivuµ” bound : " << 
uµ”
 << '\n';

756 
ex™
(1);

758 
S‘Uµ”Bound
(
šdex
,
log
(
uµ”
));

760 
	glow”
 = 
bound
.
G‘Low”Bound
();

761 ià(
	glow”
 != -1) {

762 ià(
low”
 <= 0) {

763 
û¼
 << "”rÜ :‚eg©ivlow” bound : " << 
low”
 << '\n';

764 
ex™
(1);

766 
S‘Low”Bound
(
šdex
,
log
(
low”
));

770 
S‘Uµ”Bound
(
i
, 
š
) {

771 
	ghasuµ”bound
[
i
] = 
Œue
;

772 
	guµ”bound
[
i
] = 
š
;

775 
S‘Low”Bound
(
i
, 
š
) {

776 
	gha¦ow”bound
[
i
] = 
Œue
;

777 
	glow”bound
[
i
] = 
š
;

780 
CheckBounds
() {

781 
	gi
=0; i<
G‘Dim
(); i++) {

782 ià(
	gha¦ow”bound
[
i
] && 
	ghasuµ”bound
[i]) {

783 (
v®
()[
i
] > 
	ghasuµ”bound
[i]è&& (v®()[i] < 
	gha¦ow”bound
[i])) {

784 ià(
v®
()[
i
] > 
	guµ”bound
[i]) {

785 
v®
()[
i
] = 2 * 
uµ”bound
[i] - val()[i];

787 ià(
v®
()[
i
] < 
	glow”bound
[i]) {

788 
v®
()[
i
] = 2 * 
low”bound
[i] - val()[i];

792 ià(
	gha¦ow”bound
[
i
]) {

793 ià(
v®
()[
i
] < 
	glow”bound
[i]) {

794 
v®
()[
i
] = 2 * 
low”bound
[i] - val()[i];

797 ià(
	ghasuµ”bound
[
i
]) {

798 ià(
v®
()[
i
] > 
	guµ”bound
[i]) {

799 
v®
()[
i
] = 2 * 
uµ”bound
[i] - val()[i];

805 
G‘RoÙMax
() {

806  
	groÙmax
;

809 
S‘RoÙMax
(
d
) {

810 
	groÙmax
 = 
d
;

813 
d¿wSam¶eUnşam³d
(){

814 ià(
HasBounds
()) {

815 
	gû¼
 << "error:„esampling‡ multinormal with bounds\n";

816 
ex™
(1);

818 if(
isRoÙ
()){

819 ià(
	groÙm—n
) {

820  
	gi
=0; i <
G‘Dim
(); i++){

821 ià((*
	groÙv¬
)[
i
]) {

822 
v®
()[
i
] = 
Rªdom
::
sNÜm®
(è* 
sq¹
((*
roÙv¬
)[i]è+ (*
roÙm—n
)[i];

827  
	gi
=0; i <
G‘Dim
(); i++){

828 
v®
()[
i
] = 0;

834 * 
	gt
 = 
Ãw
 [
G‘Dim
()];

835 
	gsigma
->
d¿wV®
(
t
);

837  
	gi
=0; i <
G‘Dim
(); i++){

839 
	g‰
 = 
time
->
v®
();

840 ià(
	gsÿËfunùiÚ
) {

841 
	gt2
 = 
d©e
->
v®
(è* 
agesÿË
->val();

842 
	gt1
 = (
d©e
->
v®
(è+ 
time
->v®()è* 
agesÿË
->val();

843 
	gsÿËçùÜ
 = 
sÿËfunùiÚ
->
G‘SÿlšgFaùÜ
(
t1
,
t2
);

844 
	g‰
 *ğ
sÿËçùÜ
;

846 ià(
	gsÿË
) {

847 
	g‰
 *ğ
sÿË
->
v®
();

849 ià(
	gdriá
) {

850 ià(
	gdriáphi
 && 
	gdriáphi2
) {

852 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ 
up
->val()[i];

854 ià(
	gdriáphi
) {

855 
	gu
 = 
time
->
v®
();

856 ià(
	gdriáphi
->
v®
() > 1e-10) {

857 
	gu
 = 
exp
(-
driáphi
->
v®
(è* 
d©e
->v®()è* (1 -ƒxp(-driáphi->v®(è* 
time
->val())) / driftphi->val();

859 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ (*
driá
)[i] * 
u
 + 
up
->val()[i];

862 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ (*
driá
)[i] *ˆ+ 
up
->val()[i];

866 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ 
up
->val()[i];

869 
	gd–‘e
[] 
	gt
;

873 
d¿wSam¶e
(){

874 ià(
HasBounds
()) {

875 
	gû¼
 << "error:„esampling‡ multinormal with bounds\n";

876 
ex™
(1);

878 if(
isRoÙ
()){

879 ià(
	groÙm—n
) {

880  
	gi
=0; i <
G‘Dim
(); i++){

881 if(!
	gCÏmpVeùÜ
[
i
]){

882 ià((*
	groÙv¬
)[
i
]) {

883 
v®
()[
i
] = 
Rªdom
::
sNÜm®
(è* 
sq¹
((*
roÙv¬
)[i]è+ (*
roÙm—n
)[i];

889  
	gi
=0; i <
G‘Dim
(); i++){

890 if(!
	gCÏmpVeùÜ
[
i
]){

891 
v®
()[
i
] = 0;

898 * 
	gt
 = 
Ãw
 [
G‘Dim
()];

899 
	gsigma
->
d¿wV®
(
t
);

900  
	gi
=0; i <
G‘Dim
(); i++){

901 if(!
	gCÏmpVeùÜ
[
i
]){

902 
	g‰
 = 
time
->
v®
();

903 ià(
	gsÿËfunùiÚ
) {

904 
	gt2
 = 
d©e
->
v®
(è* 
agesÿË
->val();

905 
	gt1
 = (
d©e
->
v®
(è+ 
time
->v®()è* 
agesÿË
->val();

906 
	gsÿËçùÜ
 = 
sÿËfunùiÚ
->
G‘SÿlšgFaùÜ
(
t1
,
t2
);

907 
	g‰
 *ğ
sÿËçùÜ
;

909 ià(
	gsÿË
) {

910 
	g‰
 *ğ
sÿË
->
v®
();

912 ià(
	gdriá
) {

913 ià(
	gdriáphi
 && 
	gdriáphi2
) {

915 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ 
up
->val()[i];

917 ià(
	gdriáphi
) {

918 
	gu
 = 
time
->
v®
();

919 ià(
	gdriáphi
->
v®
() > 1e-10) {

920 
	gu
 = 
exp
(-
driáphi
->
v®
(è* 
d©e
->v®()è* (1 -ƒxp(-driáphi->v®(è* 
time
->val())) / driftphi->val();

922 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ (*
driá
)[i] * 
u
 + 
up
->val()[i];

925 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ (*
driá
)[i] *ˆ+ 
up
->val()[i];

929 
v®
()[
i
] = 
t
[i] * 
sq¹
(
‰
è+ 
up
->val()[i];

933 
	gd–‘e
[] 
	gt
;

937 
D¿wNÜm®FromP»cisiÚ
(** 
m—n
, 
CovM©rix
* 
cov
, 
off£t
 = 0) {

939 
k
 = 
cov
->
G‘Dim
();

946 * 
	gt
 = 
Ãw
 [
k
];

947 
	gcov
->
d¿wV®Inv
(
t
);

948  
	gi
=0; i <
	gk
; i++){

949 ià(
	gCÏmpVeùÜ
[
i
+
off£t
]) {

950 
	gû¼
 << "error in MultiNormal::DrawNormal: clamped\n";

951 
ex™
(1);

953 
v®
()[
i
+
off£t
] = 
t
[i] + 
m—n
[i][0];

955 
	gd–‘e
[] 
	gt
;

958 
CÚd™iÚ®D¿wNÜm®FromP»cisiÚ
(** 
m—n
, 
CovM©rix
* 
cov
, * 
šdex
, 
k
) {

960 * 
	gt
 = 
Ãw
 [
k
];

961 
	gcov
->
d¿wV®Inv
(
t
);

962  
	gi
=0; i <
	gk
; i++){

963 ià(
	gCÏmpVeùÜ
[
šdex
[
i
]]) {

964 
	gû¼
 << "error in MultiNormal::DrawNormal: clamped\n";

965 
ex™
(1);

967 
v®
()[
šdex
[
i
]] = 
t
[i] + 
m—n
[i][0];

969 
	gd–‘e
[] 
	gt
;

972 
D¿wNÜm®FromP»cisiÚW™hCÚ¡¿št
(** 
m—n
, 
CovM©rix
* 
cov
) {

974 
	gK
 = 0;

975 
	gi
=0; i<
G‘Dim
(); i++) {

976 ià(!
	gCÏmpVeùÜ
[
i
]) {

977 
	gK
++;

980 
	gL
 = 
G‘Dim
(è- 
K
;

981 * 
	gšdex1
 = 
Ãw
 [
K
];

982 * 
	gšdex2
 = 
Ãw
 [
L
];

983 * 
	gm—n1
 = 
Ãw
 [
K
];

984 * 
	gm—n2
 = 
Ãw
 [
L
];

985 
	gk
 = 0;

986 
	gl
 = 0;

988 
	gi
=0; i<
G‘Dim
(); i++) {

989 ià(
	gCÏmpVeùÜ
[
i
]) {

990 
	gm—n2
[
l
] = 
m—n
[
i
][0] - (*
this
)[i];

991 
	gšdex2
[
l
] = 
i
;

992 
	gl
++;

995 
	gm—n1
[
k
] = 
m—n
[
i
][0];

996 
	gšdex1
[
k
] = 
i
;

997 
	gk
++;

1001 
CovM©rix
* 
	gCov11
 = 
Ãw
 CovM©rix(
K
);

1002 ** 
	gcov11
 = 
Cov11
->
G‘M©rix
();

1003 
	gi
=0; i<
	gK
; i++) {

1004 
	gj
=0; j<
	gK
; j++) {

1005 
	gcov11
[
i
][
j
] = (*
cov
)[
šdex1
[i]][index1[j]];

1008 
	gCov11
->
CÜru±DŸg
();

1009 
	gCov11
->
DŸgÚ®i£
();

1010 ** 
	gšvcov11
 = 
Cov11
->
G‘InvM©rix
();

1012 ** 
	gcov12
 = 
Ãw
 *[
K
];

1013 
	gi
=0; i<
	gK
; i++) {

1014 
	gcov12
[
i
] = 
Ãw
 [
L
];

1015 
	gj
=0; j<
	gL
; j++) {

1016 
	gcov12
[
i
][
j
] = (*
cov
)[
šdex1
[i]][
šdex2
[j]];

1019 * 
	gtmp
 = 
Ãw
 [
K
];

1020 
	gi
=0; i<
	gK
; i++) {

1021 
	gtmp
[
i
] = 0;

1022 
	gj
=0; j<
	gL
; j++) {

1023 
	gtmp
[
i
] +ğ
cov12
[i][
j
] * 
m—n2
[j];

1026 
	gi
=0; i<
	gK
; i++) {

1027 
	g‹mp
 = 0;

1028 
	gj
=0; j<
	gK
; j++) {

1029 
	g‹mp
 +ğ
švcov11
[
i
][
j
] * 
tmp
[j];

1031 
	gm—n1
[
i
] +ğ
‹mp
;

1033 
	gCov11
->
d¿wV®Inv
(
tmp
);

1034 
	gi
=0; i<
	gK
; i++){

1035 (*
	gthis
)[
šdex1
[
i
]] = 
m—n1
[i] + 
tmp
[i];

1038 
	gi
=0; i<
	gK
; i++) {

1039 
	gd–‘e
[] 
	gcov12
[
i
];

1041 
	gd–‘e
[] 
	gcov12
;

1042 
d–‘e
 
	gcov11
;

1043 
	gd–‘e
[] 
	gtmp
;

1044 
	gd–‘e
[] 
	gšdex1
;

1045 
	gd–‘e
[] 
	gšdex2
;

1046 
	gd–‘e
[] 
	gm—n1
;

1047 
	gd–‘e
[] 
	gm—n2
;

1050 
LeáMuÉly
(** 
P
) {

1052 * 
	gaux
 = 
Ãw
 [
G‘Dim
()];

1053 
	gi
=0; i<
G‘Dim
(); i++) {

1054 
	gtmp
 = 0;

1055 
	gj
=0; j<
G‘Dim
(); j++) {

1056 
	gtmp
 +ğ
P
[
i
][
j
] * (*
this
)[j];

1058 
	gaux
[
i
] = 
tmp
;

1060 
	gi
=0; i<
G‘Dim
(); i++) {

1061 (*
	gthis
)[
i
] = 
aux
[i];

1063 
	gd–‘e
[] 
	gaux
;

1066 
boŞ
 
CheckId’t™y
() {

1067 ià(
G‘Dim
(è!ğ
bkv®ue
.GetDim()) {

1068 
û¼
 << "nÚ m©chšg dim’siÚ : " << 
G‘Dim
(è<< '\t' << 
bkv®ue
.GetDim() << '\n';

1069 
ex™
(1);

1071 
boŞ
 
	gok
 = 
Œue
;

1072 
	gi
=0; i<
G‘Dim
(); i++) {

1073 
	gok
 &ğ(
çbs
((*
this
)[
i
] - (
bkv®ue
)[i]) < 1e-8);

1075 if(!
	gok
){

1076 
	gi
=0; i<
G‘Dim
(); i++) {

1077 
	gû¼
 << (*
	gthis
)[
i
] << '\t' << (
	gbkv®ue
)[i] << '\n';

1080  
	gok
;

1083 
Segm’tMove
(
tunšg
, 
imš
, 
size
) {

1084 
CÜru±
(
Œue
);

1085 
	glogHa¡šgs
 = 
Prİo£Segm’tMove
(
tunšg
,
imš
,
size
);

1086 
	gd–LogProb
 = 
Upd©e
();

1087 
	glogR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

1088 
boŞ
 
	gacû±ed
 = (
log
(
Rªdom
::
UnifÜm
()è< 
logR©io
);

1089 ià(! 
	gacû±ed
) {

1090 
CÜru±
(
çl£
);

1091 
Re¡Üe
();

1097 
P›ûwi£T¿n¦©iÚMove
(
tunšg
, 
šdex
, 
n
) {

1098 ià(! 
isCÏm³d
()) {

1099 
CÜru±
(
Œue
);

1100 
	glogHa¡šgs
 = 
Prİo£P›ûwi£T¿n¦©iÚMove
(
tunšg
,
šdex
,
n
);

1101 
	gd–LogProb
 = 
Upd©e
();

1102 
	glogR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

1103 
boŞ
 
	gacû±ed
 = (
log
(
Rªdom
::
UnifÜm
()è< 
logR©io
);

1104 ià(! 
	gacû±ed
) {

1105 
CÜru±
(
çl£
);

1106 
Re¡Üe
();

1113 
Prİo£P›ûwi£T¿n¦©iÚMove
(
tunšg
, 
šdex
, 
n
) {

1114 
	gu
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1115  
P›ûwi£T¿n¦©iÚ
(
u
,
šdex
,
n
);

1118 
P›ûwi£T¿n¦©iÚ
(
u
, 
šdex
, 
n
) {

1119  
	gi
=0; i <
	gn
; i++){

1120 ià(
	gi
+
	gšdex
 >ğ
G‘Dim
()) {

1121 
û¼
 << "”rÜ iÀMuÉiNÜm®::P›ûwi£T¿n¦©iÚMov: " << 
šdex
 << '\t' << 
n
 << '\t' << 
G‘Dim
() << "\n";

1122 
ex™
(1);

1124 ià((! 
isCÏm³d
()è&& (!
	gCÏmpVeùÜ
[
šdex
+
i
])) {

1125 (*
	gthis
)[
šdex
 + 
i
] +ğ
u
;

1149 
Shiá
(* 
d–
, 
f
=1) {

1150  
i
=0; 
	gi
 <
G‘Dim
(); i++){

1151 if(!
	gCÏmpVeùÜ
[
i
]){

1152 
v®
()[
i
] +ğ
f
 * 
d–
[i];

1157 
vœtu®
 
Prİo£Move
(
tunšg
){

1158 ià(
HasBounds
()) {

1159  
Sim¶ePrİo£Move
(
tunšg
);

1162 ià((! 
isRoÙ
()è&& 
	gRªdom
::
UnifÜm
() < 0.5) {

1163  
M©rixBa£dPrİo£Move
(
tunšg
);

1166  
Sim¶ePrİo£Move
(
tunšg
);

1171 
M©rixBa£dPrİo£Move
(
tunšg
) {

1172 * 
	gt
 = 
Ãw
 [
G‘Dim
()];

1173 
	gsigma
->
d¿wV®
(
t
);

1174  
	gi
=0; i <
G‘Dim
(); i++){

1175 if(!
	gCÏmpVeùÜ
[
i
]){

1176 
	g‰
 = 
time
->
v®
();

1177 ià(
	gsÿË
) {

1178 
	g‰
 *ğ
sÿË
->
v®
();

1180 
v®
()[
i
] +ğ
tunšg
 * 
t
[i] * 
sq¹
(
‰
);

1183 
	gd–‘e
[] 
	gt
;

1187 
Prİo£Segm’tMove
(
tunšg
, 
imš
, 
size
) {

1188 ià((
	gimš
 < 0è|| (imš + 
	gsize
 >ğ
G‘Dim
())) {

1189 
û¼
 << "error in…ropose segment move: overflow\n";

1190 
	gû¼
 << 
	gimš
 << '\t' << 
	gsize
 << '\t' << 
G‘Dim
() << '\n';

1191 
ex™
(1);

1194 
	gchoo£
 = (è(3 * 
Rªdom
::
UnifÜm
());

1195 ià(
	gchoo£
==0) {

1196  
i
=
imš
; 
	gi
 <
	gimš
 + 
	gsize
; i++){

1197 if(!
	gCÏmpVeùÜ
[
i
]){

1198 
v®
()[
i
] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1202 ià(
	gchoo£
==1) {

1203 
u
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1204  
	gi
=
imš
; i <
	gimš
 + 
	gsize
; i++){

1205 if(!
	gCÏmpVeùÜ
[
i
]){

1206 
v®
()[
i
] +ğ
u
;

1211 
	gi
 = (è(
size
 * 
Rªdom
::
UnifÜm
()è+ 
imš
;

1212 if(!
	gCÏmpVeùÜ
[
i
]){

1213 
v®
()[
i
] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1216 
CheckBounds
();

1220 
Sim¶ePrİo£Move
(
tunšg
) {

1221 
	gchoo£
 = (è(3 * 
Rªdom
::
UnifÜm
());

1222 ià(
	gchoo£
==0) {

1223  
i
=0; 
	gi
 <
G‘Dim
(); i++){

1224 if(!
	gCÏmpVeùÜ
[
i
]){

1225 
v®
()[
i
] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1229 ià(
	gchoo£
==1) {

1230 
u
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1231  
	gi
=0; i <
G‘Dim
(); i++){

1232 if(!
	gCÏmpVeùÜ
[
i
]){

1233 
v®
()[
i
] +ğ
u
;

1238 
	gi
 = (è(
G‘Dim
(è* 
Rªdom
::
UnifÜm
());

1239 if(!
	gCÏmpVeùÜ
[
i
]){

1240 
v®
()[
i
] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1243 
CheckBounds
();

1248 
boŞ
 
isRoÙ
(){

1249 (
	gthis
->
	gup
 == 0);

1258 
CÏmp
(
šdex
){

1259 
	gCÏmpVeùÜ
[
šdex
] = 
Œue
;

1262 
CÏmpAt
(
šv®
, 
šdex
){

1263 
v®
()[
šdex
] = 
šv®
;

1264 
	gCÏmpVeùÜ
[
šdex
] = 
Œue
;

1267 
CÏmpAtZ”o
(){

1268 
	gi
=0; i<
G‘Dim
(); i++) {

1269 
v®
()[
i
] = 0;

1270 
	gCÏmpVeùÜ
[
i
] = 
Œue
;

1274 
UnCÏmp
(
šdex
){

1275 
	gCÏmpVeùÜ
[
šdex
] = 
çl£
;

1278 
G‘T»nd
(
t
, 
šdex
) {

1279 ià(
	gdriá2
) {

1280 ià(
	gt
 > 
	gkt
) {

1283  (*
	gdriá
)[
šdex
] * 
exp
(-
driáphi
->
v®
(è* 
t
è+ (*
	gdriá2
)[šdex] * (1 -ƒxp(-
driáphi2
->v®(è* (
kt
 -)));

1285  (*
	gdriá
)[
šdex
] * 
exp
(-
driáphi
->
v®
(è* 
t
);

1289 
logProb
() {

1290 if(
isRoÙ
()){

1291 
	gtÙ®
 = 0;

1292 ià(
	groÙm—n
) {

1293  
	gi
=0; i <
G‘Dim
(); i++){

1294 ià((*
	groÙv¬
)[
i
]) {

1295 
	gtmp
 = 
v®
()[
i
] - (*
roÙm—n
)[i];

1296 
	gtÙ®
 +ğ- 0.5 * (
log
((*
roÙv¬
)[
i
]è+ 
tmp
 *mp / (*rootvar)[i]);

1299 ià(
çbs
(
v®
()[
i
]è< 
	groÙmax
) {

1300 
	gtÙ®
 -ğ
log
(2 * 
roÙmax
);

1303 
	gtÙ®
 -= 100;

1309 
	gi
=0; i<
G‘Dim
(); i++) {

1310 ià(
çbs
(
v®
()[
i
]è< 
	groÙmax
) {

1311 
	gtÙ®
 -ğ
log
(2 * 
roÙmax
);

1314 
	gtÙ®
 -= 100;

1318  
	gtÙ®
;

1322 
	gtXSX
 = 0;

1323 * 
	gdv®
 = 
Ãw
 [
G‘Dim
()];

1324 
	g‰
 = 
time
->
v®
();

1325 ià(
	gsÿËfunùiÚ
) {

1326 
	gt2
 = 
d©e
->
v®
(è* 
agesÿË
->val();

1327 
	gt1
 = (
d©e
->
v®
(è+ 
time
->v®()è* 
agesÿË
->val();

1328 
	gsÿËçùÜ
 = 
sÿËfunùiÚ
->
G‘SÿlšgFaùÜ
(
t1
,
t2
);

1329 
	g‰
 *ğ
sÿËçùÜ
;

1331 ià(
	gsÿË
) {

1332 
	g‰
 *ğ
sÿË
->
v®
();

1334 
	groÙt
 = 
sq¹
(
‰
);

1335 ià(
	gdriá
) {

1336 ià(
	gtim–še
) {

1337 
	gt2
 = 
d©e
->
v®
(è* 
agesÿË
->val();

1338 
	gt1
 = (
d©e
->
v®
(è+ 
time
->v®()è* 
agesÿË
->val();

1339 
	gi
=0; i<
G‘Dim
() ; i++) {

1340 
	gf1
 = 
tim–še
->
G‘V®
(
t1
, 
i
);

1341 
	gf2
 = 
tim–še
->
G‘V®
(
t2
, 
i
);

1342 
	gdv®
[
i
] = ((
v®
()[i] - 
up
->v®()[i]è- 
®pha
->v®(è* (
f2
 - 
f1
)è/ 
roÙt
;

1345 ià(
	gdriáphi2
) {

1346 
	gt2
 = 
d©e
->
v®
(è* 
agesÿË
->val();

1347 
	gt1
 = (
d©e
->
v®
(è+ 
time
->v®()è* 
agesÿË
->val();

1348 ià((
	gt1
 < 0è|| (t1 > 2000è|| (
	gt2
 < 0) || (t2 > 2000)) {

1349 
	gû¼
 << "error inimeline2\n";

1350 
	gû¼
 << 
	gt1
 << '\t' << 
	gt2
 << '\n';

1351 
ex™
(1);

1353 
	gi
=0; i<
G‘Dim
() ; i++) {

1354 
	gf1
 = 
G‘T»nd
(
t1
,
i
);

1355 
	gf2
 = 
G‘T»nd
(
t2
,
i
);

1356 
	gdv®
[
i
] = ((
v®
()[i] - 
up
->v®()[i]è- (
f2
 - 
f1
)è/ 
roÙt
;

1359 ià(
	gdriáphi
) {

1360 
	gt2
 = 
d©e
->
v®
();

1361 
	gt1
 = (
d©e
->
v®
(è+ 
time
->val());

1362 
	gi
=0; i<
G‘Dim
() ; i++) {

1363 
	gf1
 = 
G‘T»nd
(
t1
,
i
);

1364 
	gf2
 = 
G‘T»nd
(
t2
,
i
);

1365 
	gdv®
[
i
] = ((
v®
()[i] - 
up
->v®()[i]è- (
f2
 - 
f1
)è/ 
roÙt
;

1369 
	gi
=0; i<
G‘Dim
() ; i++) {

1370 
	gdv®
[
i
] = (
v®
()[i] - 
up
->v®()[i] - 
‰
 * (*
driá
)[i])/
roÙt
;

1375 
	gi
=0; i<
G‘Dim
() ; i++) {

1376 
	gdv®
[
i
] = (
v®
()[i] - 
up
->v®()[i])/
roÙt
;

1379 
	gi
=0; i<
G‘Dim
() ; i++) {

1380 
	gtXSX
 +ğ
sigma
->
G‘InvM©rix
()[
i
][i] * 
dv®
[i] * dval[i];

1381 
	gj
=0; j<
	gi
 ; j++) {

1382 
	gtXSX
 +ğ2 * 
sigma
->
G‘InvM©rix
()[
i
][
j
] * 
dv®
[j] * dval[i];

1385 
	gd
 = -0.5 * (
sigma
->
G‘LogD‘”mšªt
(è+ 
tXSX
 + 
G‘Dim
(è* 2 * 
log
(
roÙt
));

1386 
	gd–‘e
[] 
	gdv®
;

1387  
	gd
;

1392 
boŞ
* 
	gCÏmpVeùÜ
;

1394 
	g´Ùeùed
:

1396 
boŞ
 
hasbounds
;

1397 
boŞ
* 
	ghasuµ”bound
;

1398 
boŞ
* 
	gha¦ow”bound
;

1399 * 
	guµ”bound
;

1400 * 
	glow”bound
;

1401 
	gV¬
<
	gPosR—l
>* 
	gsÿË
;

1402 
	gV¬
<
	gPosR—l
>* 
	gtime
;

1403 
	gV¬
<
	gR—lVeùÜ
>* 
	gup
;

1404 
	gV¬
<
	gCovM©rix
>* 
	gsigma
;

1405 
	gV¬
<
	gR—lVeùÜ
>* 
	gdriá
;

1406 
	gV¬
<
	gPosR—l
>* 
	gdriáphi
;

1407 
	gV¬
<
	gR—lVeùÜ
>* 
	gdriá2
;

1408 
	gV¬
<
	gPosR—l
>* 
	gdriáphi2
;

1409 
	gV¬
<
	gPosR—l
>* 
	gd©e
;

1410 
	gV¬
<
	gPosR—l
>* 
	gagesÿË
;

1411 
	gkt
;

1413 
	gV¬
<
	gR—lVeùÜ
>* 
	groÙm—n
;

1414 
	gV¬
<
	gPosR—lVeùÜ
>* 
	groÙv¬
;

1416 
G’”icTimeLše
* 
	gtim–še
;

1417 
	gV¬
<
	gR—l
>* 
	g®pha
;

1419 
Glob®SÿlšgFunùiÚ
* 
	gsÿËfunùiÚ
;

1421 
	groÙmax
;

1425 
şass
 
	gMuÉiv¬Ÿ‹NÜm®
 : 
public
 
vœtu®
 
Rv¬
<
R—lVeùÜ
>{

1427 
public
:

1429 
MuÉiv¬Ÿ‹NÜm®
(
V¬
<
CovM©rix
>* 
šsigma
) {

1430 
sigma
 = 
šsigma
;

1431 
£tv®
(
R—lVeùÜ
(
šsigma
->
G‘Dim
()));

1432 
Regi¡”
(
sigma
);

1433 
Sam¶e
();

1436 ~
MuÉiv¬Ÿ‹NÜm®
(){

1439 
d¿wSam¶e
(){

1440 
	gsigma
->
d¿wV®
(
v®
().
G‘A¼ay
());

1443 
Prİo£Move
(
tunšg
){

1444 ià(
	gRªdom
::
UnifÜm
() < 0.3) {

1445  
i
=0; 
	gi
 <
G‘Dim
(); i++){

1446 
v®
()[
i
] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1449 ià(
	gRªdom
::
UnifÜm
() < 0.6) {

1450 
u
 = 
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1451  
	gi
=0; i <
G‘Dim
(); i++){

1452 
v®
()[
i
] +ğ
u
;

1456 
	gi
 = (è(
G‘Dim
(è* 
Rªdom
::
UnifÜm
());

1457 
v®
()[
i
] +ğ
tunšg
 * (
Rªdom
::
UnifÜm
() - 0.5);

1463 
logProb
() {

1464 
	gtXSX
 = 0;

1465 
	gi
=0; i<
G‘Dim
() ; i++) {

1466 
	gtXSX
 +ğ
sigma
->
G‘InvM©rix
()[
i
][i] * 
v®
()[i] * val()[i];

1467 
	gj
=0; j<
	gi
 ; j++) {

1468 
	gtXSX
 +ğ2 * 
sigma
->
G‘InvM©rix
()[
i
][
j
] * 
v®
()[i] * val()[j];

1471 
	gd
 = -0.5 * (
sigma
->
G‘LogD‘”mšªt
(è+ 
tXSX
);

1472  
	gd
;

1475 
	g´Ùeùed
:

1477 
V¬
<
CovM©rix
>* 
sigma
;

	@Jeffreys.h

1 #iâdeà
JEFF_H


2 
	#JEFF_H


	)

4 
	~"IID.h
"

6 
	~"V®A¼ay.h
"

8 
şass
 
	gJefäeys
: 
public
 
Rv¬
<
PosR—l
> {

10 
public
:

12 
Jefäeys
(
šmš
, 
šmax
, 
DAGnode
* 
šroÙ
 = 0) {

13 
mš
 = 
šmš
;

14 
	gmax
 = 
šmax
;

15 
	groÙ
 = 
šroÙ
;

16 ià(
	groÙ
) {

17 
Regi¡”
(
roÙ
);

19 
Sam¶e
();

22 
G‘Mš
(è{ 
	gmš
;}

23 
G‘Max
(è{ 
	gmax
;}

25 
logProb
() {

26 ià(
v®
(è< 
	gmš
) {

29 ià(
v®
(è> 
	gmax
) {

32  -
log
(
v®
());

35 
d¿wSam¶e
() {

36 
£tv®
(
mš
 * 
exp
(
Rªdom
::
UnifÜm
(è* (
log
(
max
) -†og(min))));

39 
	g´Ùeùed
:

41 
mš
;

42 
	gmax
;

43 
DAGnode
* 
	groÙ
;

46 
şass
 
	gUnifÜm
: 
public
 
Rv¬
<
R—l
> {

48 
public
:

50 
UnifÜm
(
šmš
, 
šmax
, 
DAGnode
* 
šroÙ
 = 0) {

51 
mš
 = 
šmš
;

52 
	gmax
 = 
šmax
;

53 
	groÙ
 = 
šroÙ
;

54 ià(
	groÙ
) {

55 
Regi¡”
(
roÙ
);

57 
Sam¶e
();

60 
logProb
() {

61 ià(
v®
(è< 
	gmš
) {

64 ià(
v®
(è> 
	gmax
) {

70 
d¿wSam¶e
() {

71 
£tv®
(
mš
 +
Rªdom
::
UnifÜm
(è* (
max
 - min));

74 
	g´Ùeùed
:

76 
mš
;

77 
	gmax
;

78 
DAGnode
* 
	groÙ
;

81 
şass
 
	gJefäeysIIDA¼ay
 : 
public
 
IIDA¼ay
<
PosR—l
> {

83 
public
:

84 
JefäeysIIDA¼ay
(
šsize
, 
šmš
, 
šmax
, 
DAGnode
* 
šroÙ
è: 
IIDA¼ay
<
PosR—l
>(insize) {

85 
mš
 = 
šmš
;

86 
	gmax
 = 
šmax
;

87 
	groÙ
 = 
šroÙ
;

88 
C»©e
();

91 
Jefäeys
* 
G‘Jefäeys
(
i
) {

92 
Jefäeys
* 
	gtmp
 = 
dyÇmic_ÿ¡
<Jefäeys*>(
G‘V®
(
i
));

93  
	gtmp
;

96 
vœtu®
 
CÏmpAt
(
š
) {

97 
	gi
=0; i<
	gthis
->
G‘Size
(); i++) {

98 
	gthis
->
G‘V®
(
i
)->
CÏmpAt
(
š
);

102 
vœtu®
 
CÏmpAt
(
š
, 
i
) {

103 
	gthis
->
G‘V®
(
i
)->
CÏmpAt
(
š
);

106 
vœtu®
 
£tv®
(
š
) {

107 
	gi
=0; i<
	gthis
->
G‘Size
(); i++) {

108 
	gthis
->
G‘V®
(
i
)->
£tv®
(
š
);

111 
	g´Ùeùed
:

113 
Rv¬
<
PosR—l
>* 
C»©eV®
(
s™e
) {

114  
Ãw
 
Jefäeys
(
mš
,
max
,
roÙ
);

117 
	gmš
;

118 
	gmax
;

119 
DAGnode
* 
	groÙ
;

	@MCMC.h

1 #iâdeà
MCMC_H


2 
	#MCMC_H


	)

4 
	~"Exû±iÚ.h
"

13 
	~<io¡»am
>

14 
usšg
 
Çme¥aû
 
	g¡d
;

17 şas 
	cMCMC
 {

19 
	mpublic
:

21 cÚ¡ 
MAXDIFF
;

23 
	$MCMC
(è: 
	$şamp
(
çl£
) {}

25 
vœtu®
 ~
	$MCMC
(è{
	}
}

29 
vœtu®
 
Move
() = 0;

34 
vœtu®
 
	$Sam¶e
() {

35 ià(! 
	`isCÏm³d
()) {

36 
	`d¿wSam¶e
();

38 
	}
}

40 
vœtu®
 
d¿wSam¶e
() = 0;

42 
boŞ
 
	$isCÏm³d
(è{ 
şamp
;
	}
}

43 
	$CÏmp
(è{
şamp
 = 
Œue
;
	}
}

44 
	$Unşamp
(è{
şamp
 = 
çl£
;
	}
}

47 
vœtu®
 
G‘LogProb
() = 0;

50 
	g´iv©e
:

51 
boŞ
 
şamp
;

58 şas 
	cMH
 : 
public
 
MCMC
 {

60 
public
:

61 
vœtu®
 ~
	$MH
() {}

63 
vœtu®
 
	`Prİo£Move
(
tunšg
 = 1) = 0;

64 
´Ùeùed
:

65 
vœtu®
 
	`Re¡Üe
() = 0;

67 
	}
};

	@MG3OmegaCodonSubMatrix.cpp

2 
	~"MG3OmegaCodÚSubM©rix.h
"

5 
	gMG3CodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

7 
tÙ®
 = 0;

8 
j
=0; j<
	`G‘N¡©e
(); j++) {

9 ià(
i
!=
j
) {

10 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

11 ià((
pos
 != -1) && (pos != 3)) {

12 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

13 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

14 
Q
[
i
][
j
] = (*
	`G‘NucM©rix
(
pos
))(
a
,
b
);

15 
tÙ®
 +ğ
Q
[
i
][
j
];

18 
Q
[
i
][
j
] = 0;

22 
Q
[
i
][i] = -
tÙ®
;

23 
	}
}

25 
	gMG3CodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

28 
tÙ®
 = 0;

29 
i
=0; i<
	`G‘N¡©e
(); i++) {

30 
mStiÚ¬y
[
i
] = 
	`G‘NucM©rix
(0)->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)) * GetNucMatrix(1)->Stationary(GetCodonPosition(1,i)) * GetNucMatrix(2)->Stationary(GetCodonPosition(2,i));

31 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

35 
i
=0; i<
	`G‘N¡©e
(); i++) {

36 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

38 
	}
}

40 
	gMG3OmegaCodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

42 
tÙ®
 = 0;

43 
j
=0; j<
	`G‘N¡©e
(); j++) {

44 ià(
i
!=
j
) {

45 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

46 ià((
pos
 != -1) && (pos != 3)) {

47 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

48 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

49 ià(
a
 =ğ
b
) {

50 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

51 
û¼
 << 
pos
 << '\n';

52 
	`ex™
(1);

54 
Q
[
i
][
j
] = (*
	`G‘NucM©rix
(
pos
))(
a
,
b
);

55 ià(! 
	`SynÚymous
(
i
,
j
)) {

56 
Q
[
i
][
j
] *ğ
	`G‘Omega
();

60 
Q
[
i
][
j
] = 0;

62 
tÙ®
 +ğ
Q
[
i
][
j
];

65 
Q
[
i
][i] = -
tÙ®
;

66 ià(
tÙ®
 <0) {

67 
û¼
 << "negative„ate‡way\n";

68 
	`ex™
(1);

70 
	}
}

	@MG3OmegaCodonSubMatrix.h

2 #iâdeà
GC3CODON


3 
	#GC3CODON


	)

5 
	~"CodÚSubM©rix.h
"

11 şas 
	cNuc3CodÚSubM©rix
 : 
public
 
CodÚSubM©rix
 {

13 
public
:

15 
	$Nuc3CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix1
, SubM©rix* 
šNucM©rix2
, SubM©rix* 
šNucM©rix3
, 
boŞ
 
šnÜm®i£
) :

16 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

17 
	$CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
){

19 
	`S‘NucM©rix1
(
šNucM©rix1
);

20 
	`S‘NucM©rix2
(
šNucM©rix2
);

21 
	`S‘NucM©rix3
(
šNucM©rix3
);

24 
SubM©rix
* 
	$G‘NucM©rix
(
pos
) {

25 ià(
pos
 == 0) {

26  
NucM©rix1
;

28 ià(
pos
 == 1) {

29  
NucM©rix2
;

31 ià(
pos
 == 2) {

32  
NucM©rix3
;

34 
û¼
 << "”rÜ iÀNuc3CodÚSubM©rix: " << 
pos
 << '\n';

35 
	`ex™
(1);

37 
	}
}

39 
	g´Ùeùed
:

41 
	$S‘NucM©rix1
(
SubM©rix
* 
šm©rix
) {

42 
NucM©rix1
 = 
šm©rix
;

43 ià(
NucM©rix1
->
	`G‘N¡©e
(è!ğ
Nnuc
) {

44 
û¼
 << "error in CodonSubMatrix: underyling mutation…rocess should be‡ 4x4 matrix\n";

45 
throw
;

47 
	}
}

49 
	$S‘NucM©rix2
(
SubM©rix
* 
šm©rix
) {

50 
NucM©rix2
 = 
šm©rix
;

51 ià(
NucM©rix2
->
	`G‘N¡©e
(è!ğ
Nnuc
) {

52 
û¼
 << "error in CodonSubMatrix: underyling mutation…rocess should be‡ 4x4 matrix\n";

53 
throw
;

55 
	}
}

57 
	$S‘NucM©rix3
(
SubM©rix
* 
šm©rix
) {

58 
NucM©rix3
 = 
šm©rix
;

59 ià(
NucM©rix3
->
	`G‘N¡©e
(è!ğ
Nnuc
) {

60 
û¼
 << "error in CodonSubMatrix: underyling mutation…rocess should be‡ 4x4 matrix\n";

61 
throw
;

63 
	}
}

65 
SubM©rix
* 
	gNucM©rix1
;

66 
SubM©rix
* 
	gNucM©rix2
;

67 
SubM©rix
* 
	gNucM©rix3
;

71 şas 
	cMG3CodÚSubM©rix
 : 
public
 
Nuc3CodÚSubM©rix
 {

73 
public
:

75 
	$MG3CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix1
, SubM©rix* 
šNucM©rix2
, SubM©rix* 
šNucM©rix3
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

76 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

77 
	$Nuc3CodÚSubM©rix
(
š¡©e¥aû
,
šNucM©rix1
, 
šNucM©rix2
, 
šNucM©rix3
, 
šnÜm®i£
) {}

79 
´Ùeùed
:

82 
	`Compu‹A¼ay
(
¡©e
);

83 
	`Compu‹StiÚ¬y
();

85 
	}
};

90 şas 
	cMG3OmegaCodÚSubM©rix
 : 
public
 
MG3CodÚSubM©rix
 {

92 
public
:

94 
	$MG3OmegaCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix1
, SubM©rix* 
šNucM©rix2
, SubM©rix* 
šNucM©rix3
, 
šomega
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

95 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

96 
	`MG3CodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix1
, 
šNucM©rix2
, 
šNucM©rix3
, 
šnÜm®i£
) ,

97 
	$omega
(
šomega
) {}

100 
	$G‘Omega
(è{ 
omega
;
	}
}

102 
	g´Ùeùed
:

105 
Compu‹A¼ay
(
¡©e
);

106 
	$S‘Omega
(
šomega
è{
omega
 = inomega;
	}
}

110 
	gomega
;

113 
şass
 
	gRªdomMG3OmegaCodÚSubM©rix
 : 
public
 
MG3OmegaCodÚSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

115 
	gpublic
:

117 
RªdomMG3OmegaCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix1
, RªdomSubM©rix* 
šm©rix2
, RªdomSubM©rix* 
šm©rix3
, 
V¬
<
PosR—l
>* 
šRªdomOmega
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

118 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

119 
CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

120 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

121 
MG3OmegaCodÚSubM©rix
(
š¡©e¥aû
,
šm©rix1
,
šm©rix2
,
šm©rix3
,
šRªdomOmega
->
v®
(), 
šnÜm®i£
) ,

122 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

123 
m©rix1
(
šm©rix1
),

124 
m©rix2
(
šm©rix2
),

125 
m©rix3
(
šm©rix3
),

126 
RªdomOmega
(
šRªdomOmega
) {

128 
Regi¡”
(
m©rix1
);

129 
Regi¡”
(
m©rix2
);

130 
Regi¡”
(
m©rix3
);

131 
Regi¡”
(
RªdomOmega
);

132 
¥ecŸlUpd©e
();

140 
S‘P¬am‘”s
() {

141 
S‘NucM©rix1
(
m©rix1
);

142 
S‘NucM©rix2
(
m©rix2
);

143 
S‘NucM©rix3
(
m©rix3
);

144 
S‘Omega
(
RªdomOmega
->
v®
());

147 
	g´Ùeùed
:

149 
RªdomSubM©rix
* 
m©rix1
;

150 
RªdomSubM©rix
* 
	gm©rix2
;

151 
RªdomSubM©rix
* 
	gm©rix3
;

152 
	gV¬
<
	gPosR—l
>* 
	gRªdomOmega
;

	@MGAAProfileMutSelCodonSubMatrix.cpp

1 
	~"MGAAProfeMutS–CodÚSubM©rix.h
"

4 
	gMGAAProfeMutS–CodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

7 
tÙ®
 = 0;

8 
i
=0; i<
	`G‘N¡©e
(); i++) {

9 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)) *

10 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(1,
i
)) *

11 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(2,
i
)) *

12 
	`exp
(
Neff
->
	`v®
(è* 
	`log
Ğ(*
AAProfe
)[
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
)] ));

13 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

16 
i
=0; i<
	`G‘N¡©e
(); i++) {

17 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

19 
	}
}

22 
	gMGAAProfeMutS–CodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

24 
tÙ®
 = 0;

25 
j
=0; j<
	`G‘N¡©e
(); j++) {

26 ià(
i
!=
j
) {

27 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

28 ià((
pos
 != -1) && (pos != 3)) {

29 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

30 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

31 ià(
a
 =ğ
b
) {

32 
û¼
 << "identical states\n";

33 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

34 
û¼
 << 
pos
 << '\n';

35 
	`ex™
(1);

37 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

38 ià(! 
	`SynÚymous
(
i
,
j
)) {

39 
NeffD–F
 = 
Neff
->
	`v®
(è* 
	`log
((*
AAProfe
)[
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
j
)] / (*AAProfe)[G‘CodÚS‹S·û()->T¿n¦©iÚ(
i
)]);

40 ià(
	`çbs
(
NeffD–F
è< 
TOOSMALL
) {

41 
Q
[
i
][
j
] /ğĞ1.0 - (
NeffD–F
 / 2) );

50 
Q
[
i
][
j
] *ğ(
NeffD–F
)/(1.0 - 
	`exp
(-NeffDeltaF));

55 
Q
[
i
][
j
] = 0;

57 
tÙ®
 +ğ
Q
[
i
][
j
];

59 ià(
Q
[
i
][
j
] < 0) {

60 
û¼
 << "negativeƒntry in matrix\n";

61 
	`ex™
(1);

63 ià(
	`isšf
(
Q
[
i
][
j
])) {

64 
û¼
 << "inf Q[i][j]\n";

65 
	`ex™
(1);

67 ià(
	`i¢ª
(
Q
[
i
][
j
])) {

68 
û¼
 << "nan Q[i][j]\n";

69 
	`ex™
(1);

74 
Q
[
i
][i] = -
tÙ®
;

75 ià(
tÙ®
 <0) {

76 
û¼
 << "negative„ate‡way\n";

77 
	`ex™
(1);

79 
	}
}

	@MGAAProfileMutSelCodonSubMatrix.h

2 #iâdeà
MGAAPROFILEMUTSELCODONSUBMATRIX_H


3 
	#MGAAPROFILEMUTSELCODONSUBMATRIX_H


	)

5 
	~"CodÚSubM©rix.h
"

7 
	~"V¬.h
"

9 şas 
	cMGAAProfeMutS–CodÚSubM©rix
 : 
public
 
NucCodÚSubM©rix
 {

11 
public
:

13 
MGAAProfeMutS–CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
V¬
<
Profe
>* 
šAAProfe
, V¬<
PosR—l
>* 
šNeff
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

14 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

15 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

16 
NucCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

17 
AAProfe
(
šAAProfe
),

18 
	$Neff
(
šNeff
) {}

20 
V¬
<
Profe
>* 
	$G‘AAProfe
(è{ 
AAProfe
;
	}
}

22 
	g´Ùeùed
:

24 
Compu‹A¼ay
(
¡©e
);

25 
Compu‹StiÚ¬y
();

26 
S‘AAProfe
(
V¬
<
Profe
>* 
šAAProfe
è{
	gAAProfe
 = inAAProfile;}

27 
S‘Neff
(
V¬
<
PosR—l
>* 
šNeff
è{
	gNeff
 = inNeff;}

31 
	gV¬
<
	gProfe
>* 
	gAAProfe
;

32 
	gV¬
<
	gPosR—l
>* 
	gNeff
;

33 
cÚ¡ex´
 
	gTOOSMALL
 = 1e-20;

34 
cÚ¡ex´
 
	gTOOLARGE
 = 50;

35 
cÚ¡ex´
 
	gTOOLARGENEGATIVE
 = -50;

39 
şass
 
	gRªdomMGAAProfeMutS–CodÚSubM©rix
 : 
public
 
MGAAProfeMutS–CodÚSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

41 
	gpublic
:

43 
RªdomMGAAProfeMutS–CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šAAProfe
, V¬<
PosR—l
>* 
šNeff
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

44 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

45 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

46 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

47 
MGAAProfeMutS–CodÚSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šAAProfe
, 
šNeff
, 
šnÜm®i£
) ,

48 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

49 
m©rix
(
šm©rix
) ,

50 
RªdomAAProfe
(
šAAProfe
),

51 
RªdomNeff
(
šNeff
) {

53 
Regi¡”
(
m©rix
);

54 
Regi¡”
(
RªdomAAProfe
);

55 
Regi¡”
(
RªdomNeff
);

56 
¥ecŸlUpd©e
();

60 
S‘P¬am‘”s
() {

61 
S‘NucM©rix
(
m©rix
);

62 
S‘AAProfe
(
RªdomAAProfe
);

63 
S‘Neff
(
RªdomNeff
);

66 
ToSŒ—m
(
o¡»am
& 
os
) {

67 
	gMGAAProfeMutS–CodÚSubM©rix
::
ToSŒ—m
(
os
);

68 
	gos
 << *
	gRªdomNeff
 << '\n';

71 
	g´Ùeùed
:

73 
RªdomSubM©rix
* 
m©rix
;

74 
	gV¬
<
	gProfe
>* 
	gRªdomAAProfe
;

75 
	gV¬
<
	gPosR—l
>* 
	gRªdomNeff
;

	@MGCodonAAProfileMutSelCodonSubMatrix.cpp

1 
	~"MGCodÚAAProfeMutS–CodÚSubM©rix.h
"

4 
	gMGCodÚAAProfeMutS–CodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

7 
tÙ®
 = 0;

8 
i
=0; i<
	`G‘N¡©e
(); i++) {

9 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)) *

10 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(1,
i
)) *

11 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(2,
i
)) *

12 
	`exp
(
Neff
->
	`v®
(è* 
	`log
Ğ(*
CodÚProfe
)[
i
] )) *

13 
	`exp
(
Neff
->
	`v®
(è* 
	`log
Ğ(*
AAProfe
)[
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
)] ));

14 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

17 
i
=0; i<
	`G‘N¡©e
(); i++) {

18 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

20 
	}
}

23 
	gMGCodÚAAProfeMutS–CodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

25 
tÙ®
 = 0;

26 
j
=0; j<
	`G‘N¡©e
(); j++) {

27 ià(
i
!=
j
) {

28 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

29 ià((
pos
 != -1) && (pos != 3)) {

30 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

31 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

32 ià(
a
 =ğ
b
) {

33 
û¼
 << "identical states\n";

34 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

35 
û¼
 << 
pos
 << '\n';

36 
	`ex™
(1);

38 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

39 ià(! 
	`SynÚymous
(
i
,
j
)) {

40 
NeffD–F
 = 
Neff
->
	`v®
() *

41 Ğ
	`log
((*
CodÚProfe
)[
j
] / (*CodÚProfe)[
i
]) +

42 
	`log
((*
AAProfe
)[
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
j
)] / (*AAProfe)[G‘CodÚS‹S·û()->T¿n¦©iÚ(
i
)])

44 ià(
	`çbs
(
NeffD–F
è< 
TOOSMALL
) {

45 
Q
[
i
][
j
] /ğĞ1.0 - (
NeffD–F
 / 2) );

50 ià(
NeffD–F
 > 
TOOLARGE
) {

51 
Q
[
i
][
j
] *ğ
NeffD–F
;

56 ià(
NeffD–F
 < 
TOOLARGENEGATIVE
) {

57 
Q
[
i
][
j
] = 0;

64 
Q
[
i
][
j
] *ğ(
NeffD–F
)/(1.0 - 
	`exp
(-NeffDeltaF));

68 
NeffD–F
 = 
Neff
->
	`v®
(è* 
	`log
Ğ(*
CodÚProfe
)[
j
] / (*CodÚProfe)[
i
] );

69 ià(
	`çbs
(
NeffD–F
è< 
TOOSMALL
) {

70 
Q
[
i
][
j
] /ğĞ1.0 - (
NeffD–F
 / 2) );

75 ià(
NeffD–F
 > 
TOOLARGE
) {

76 
Q
[
i
][
j
] *ğ
NeffD–F
;

81 ià(
NeffD–F
 < 
TOOLARGENEGATIVE
) {

82 
Q
[
i
][
j
] = 0;

89 
Q
[
i
][
j
] *ğ(
NeffD–F
)/(1.0 - 
	`exp
(-NeffDeltaF));

95 
Q
[
i
][
j
] = 0;

97 
tÙ®
 +ğ
Q
[
i
][
j
];

99 ià(
Q
[
i
][
j
] < 0) {

100 
û¼
 << "negativeƒntry in matrix\n";

101 
	`ex™
(1);

103 ià(
	`isšf
(
Q
[
i
][
j
])) {

104 
û¼
 << "inf Q[i][j]\n";

105 
	`ex™
(1);

107 ià(
	`i¢ª
(
Q
[
i
][
j
])) {

108 
û¼
 << "nan Q[i][j]\n";

109 
	`ex™
(1);

114 
Q
[
i
][i] = -
tÙ®
;

115 ià(
tÙ®
 <0) {

116 
û¼
 << "negative„ate‡way\n";

117 
	`ex™
(1);

119 
	}
}

	@MGCodonAAProfileMutSelCodonSubMatrix.h

2 #iâdeà
MGCODONAAPROFILEMUTSELCODONSUBMATRIX_H


3 
	#MGCODONAAPROFILEMUTSELCODONSUBMATRIX_H


	)

5 
	~"CodÚSubM©rix.h
"

7 
	~"V¬.h
"

9 şas 
	cMGCodÚAAProfeMutS–CodÚSubM©rix
 : 
public
 
vœtu®
 
NucCodÚSubM©rix
 {

11 
public
:

13 
MGCodÚAAProfeMutS–CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
V¬
<
Profe
>* 
šAAProfe
, V¬<Profe>* 
šCodÚProfe
, V¬<
PosR—l
>* 
šNeff
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

14 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

15 
CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
),

16 
NucCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

17 
CodÚProfe
(
šCodÚProfe
),

18 
AAProfe
(
šAAProfe
),

19 
	$Neff
(
šNeff
) {}

21 
V¬
<
Profe
>* 
	$G‘CodÚProfe
(è{ 
CodÚProfe
;
	}
}

22 
	gV¬
<
	gProfe
>* 
	$G‘AAProfe
(è{ 
AAProfe
;
	}
}

24 
	g´Ùeùed
:

26 
Compu‹A¼ay
(
¡©e
);

27 
Compu‹StiÚ¬y
();

28 
S‘CodÚProfe
(
V¬
<
Profe
>* 
šCodÚProfe
è{
	gCodÚProfe
 = inCodonProfile;}

29 
S‘AAProfe
(
V¬
<
Profe
>* 
šAAProfe
è{
	gAAProfe
 = inAAProfile;}

30 
S‘Neff
(
V¬
<
PosR—l
>* 
šNeff
è{
	gNeff
 = inNeff;}

34 
	gV¬
<
	gProfe
>* 
	gCodÚProfe
;

35 
	gV¬
<
	gProfe
>* 
	gAAProfe
;

36 
	gV¬
<
	gPosR—l
>* 
	gNeff
;

37 
cÚ¡ex´
 
	gTOOSMALL
 = 1e-9;

38 
cÚ¡ex´
 
	gTOOLARGE
 = 50;

39 
cÚ¡ex´
 
	gTOOLARGENEGATIVE
 = -50;

43 
şass
 
	gRªdomMGCodÚAAProfeMutS–CodÚSubM©rix
 : 
public
 
vœtu®
 
MGCodÚAAProfeMutS–CodÚSubM©rix
,…ubliøvœtu® 
	gRªdomCodÚSubM©rix
 {

45 
	gpublic
:

47 
RªdomMGCodÚAAProfeMutS–CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šAAProfe
, V¬<Profe>* 
šCodÚProfe
, V¬<
PosR—l
>* 
šNeff
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

48 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

49 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

50 
NucCodÚSubM©rix
(
š¡©e¥aû
, 
šm©rix
, 
šnÜm®i£
),

51 
MGCodÚAAProfeMutS–CodÚSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šAAProfe
,
šCodÚProfe
,
šNeff
,
šnÜm®i£
),

52 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

53 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

54 
m©rix
(
šm©rix
) ,

55 
RªdomCodÚProfe
(
šCodÚProfe
),

56 
RªdomAAProfe
(
šAAProfe
),

57 
RªdomNeff
(
šNeff
) {

59 
Regi¡”
(
m©rix
);

60 
Regi¡”
(
RªdomCodÚProfe
);

61 
Regi¡”
(
RªdomAAProfe
);

62 
Regi¡”
(
RªdomNeff
);

63 
¥ecŸlUpd©e
();

67 
S‘P¬am‘”s
() {

68 
S‘NucM©rix
(
m©rix
);

69 
S‘CodÚProfe
(
RªdomCodÚProfe
);

70 
S‘AAProfe
(
RªdomAAProfe
);

71 
S‘Neff
(
RªdomNeff
);

74 
ToSŒ—m
(
o¡»am
& 
os
) {

75 
	gMGCodÚAAProfeMutS–CodÚSubM©rix
::
ToSŒ—m
(
os
);

76 
	gos
 << *
	gRªdomNeff
 << '\n';

79 
	g´Ùeùed
:

81 
RªdomSubM©rix
* 
m©rix
;

82 
	gV¬
<
	gProfe
>* 
	gRªdomCodÚProfe
;

83 
	gV¬
<
	gProfe
>* 
	gRªdomAAProfe
;

84 
	gV¬
<
	gPosR—l
>* 
	gRªdomNeff
;

	@MGCodonProfileMutSelCodonSubMatrix.cpp

1 
	~"MGCodÚProfeMutS–CodÚSubM©rix.h
"

4 
	gMGCodÚProfeMutS–CodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

7 
tÙ®
 = 0;

8 
i
=0; i<
	`G‘N¡©e
(); i++) {

9 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)) *

10 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(1,
i
)) *

11 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(2,
i
)) *

12 
	`exp
(
Neff
->
	`v®
(è* 
	`log
Ğ(*
CodÚProfe
)[
i
] ));

13 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

16 
i
=0; i<
	`G‘N¡©e
(); i++) {

17 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

19 
	}
}

22 
	gMGCodÚProfeMutS–CodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

24 
tÙ®
 = 0;

25 
j
=0; j<
	`G‘N¡©e
(); j++) {

26 ià(
i
!=
j
) {

27 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

28 ià((
pos
 != -1) && (pos != 3)) {

29 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

30 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

31 ià(
a
 =ğ
b
) {

32 
û¼
 << "identical states\n";

33 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

34 
û¼
 << 
pos
 << '\n';

35 
	`ex™
(1);

37 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

39 
NeffD–F
 = 
Neff
->
	`v®
(è* 
	`log
((*
CodÚProfe
)[
j
] / (*CodÚProfe)[
i
]);

40 ià(
	`çbs
(
NeffD–F
è< 
TOOSMALL
) {

41 
Q
[
i
][
j
] /ğĞ1.0 - (
NeffD–F
 / 2) );

46 ià(
NeffD–F
 > 
TOOLARGE
) {

47 
Q
[
i
][
j
] *ğ
NeffD–F
;

52 ià(
NeffD–F
 < 
TOOLARGENEGATIVE
) {

53 
Q
[
i
][
j
] = 0;

60 
Q
[
i
][
j
] *ğ(
NeffD–F
)/(1.0 - 
	`exp
(-NeffDeltaF));

65 
Q
[
i
][
j
] = 0;

67 
tÙ®
 +ğ
Q
[
i
][
j
];

69 ià(
Q
[
i
][
j
] < 0) {

70 
û¼
 << "negativeƒntry in matrix\n";

71 
	`ex™
(1);

73 ià(
	`isšf
(
Q
[
i
][
j
])) {

74 
û¼
 << "inf Q[i][j]\n";

75 
	`ex™
(1);

77 ià(
	`i¢ª
(
Q
[
i
][
j
])) {

78 
û¼
 << "nan Q[i][j]\n";

79 
	`ex™
(1);

84 
Q
[
i
][i] = -
tÙ®
;

85 ià(
tÙ®
 <0) {

86 
û¼
 << "negative„ate‡way\n";

87 
	`ex™
(1);

89 
	}
}

	@MGCodonProfileMutSelCodonSubMatrix.h

2 #iâdeà
MGCODONPROFILEMUTSELCODONSUBMATRIX_H


3 
	#MGCODONPROFILEMUTSELCODONSUBMATRIX_H


	)

5 
	~"CodÚSubM©rix.h
"

6 
	~"V¬.h
"

8 şas 
	cMGCodÚProfeMutS–CodÚSubM©rix
 : 
public
 
NucCodÚSubM©rix
 {

10 
public
:

12 
MGCodÚProfeMutS–CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, 
V¬
<
Profe
>* 
šCodÚProfe
, V¬<
PosR—l
>* 
šNeff
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

13 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

14 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

15 
NucCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

16 
CodÚProfe
(
šCodÚProfe
),

17 
	$Neff
(
šNeff
) {}

19 
V¬
<
Profe
>* 
	$G‘CodÚProfe
(è{ 
CodÚProfe
;
	}
}

21 
	g´Ùeùed
:

23 
Compu‹A¼ay
(
¡©e
);

24 
Compu‹StiÚ¬y
();

25 
S‘CodÚProfe
(
V¬
<
Profe
>* 
šCodÚProfe
è{
	gCodÚProfe
 = inCodonProfile;}

26 
S‘Neff
(
V¬
<
PosR—l
>* 
šNeff
è{
	gNeff
 = inNeff;}

30 
	gV¬
<
	gProfe
>* 
	gCodÚProfe
;

31 
	gV¬
<
	gPosR—l
>* 
	gNeff
;

32 
cÚ¡ex´
 
	gTOOSMALL
 = 1e-9;

33 
cÚ¡ex´
 
	gTOOLARGE
 = 50;

34 
cÚ¡ex´
 
	gTOOLARGENEGATIVE
 = -50;

38 
şass
 
	gRªdomMGCodÚProfeMutS–CodÚSubM©rix
 : 
public
 
MGCodÚProfeMutS–CodÚSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

40 
	gpublic
:

42 
RªdomMGCodÚProfeMutS–CodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šCodÚProfe
, V¬<
PosR—l
>* 
šNeff
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

43 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

44 
CodÚSubM©rix
(
š¡©e¥aû
,
šnÜm®i£
) ,

45 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(),
šnÜm®i£
),

46 
MGCodÚProfeMutS–CodÚSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šCodÚProfe
, 
šNeff
, 
šnÜm®i£
) ,

47 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

48 
m©rix
(
šm©rix
) ,

49 
RªdomCodÚProfe
(
šCodÚProfe
),

50 
RªdomNeff
(
šNeff
) {

52 
Regi¡”
(
m©rix
);

53 
Regi¡”
(
RªdomCodÚProfe
);

54 
Regi¡”
(
RªdomNeff
);

55 
¥ecŸlUpd©e
();

59 
S‘P¬am‘”s
() {

60 
S‘NucM©rix
(
m©rix
);

61 
S‘CodÚProfe
(
RªdomCodÚProfe
);

62 
S‘Neff
(
RªdomNeff
);

65 
ToSŒ—m
(
o¡»am
& 
os
) {

66 
	gMGCodÚProfeMutS–CodÚSubM©rix
::
ToSŒ—m
(
os
);

67 
	gos
 << *
	gRªdomNeff
 << '\n';

70 
	g´Ùeùed
:

72 
RªdomSubM©rix
* 
m©rix
;

73 
	gV¬
<
	gProfe
>* 
	gRªdomCodÚProfe
;

74 
	gV¬
<
	gPosR—l
>* 
	gRªdomNeff
;

	@MGCodonTransitionMatrix.h

1 #iâdeà
MGCODONTRANSITIONMATRIX_H


2 
	#MGCODONTRANSITIONMATRIX_H


	)

4 
	~"SubM©rix.h
"

5 
	~"CodÚS‹S·û.h
"

6 
	~"GTRSubM©rix.h
"

8 #ifdeà
_OPENMP


9 
	~<omp.h
>

12 
şass
 
	gMGCodÚT¿ns™iÚM©rix
 : 
public
 
T¿ns™iÚM©rix
,…ubliø
	gRªdomT¿ns™iÚM©rix
 {

14 
	gpublic
 :

15 
MGCodÚT¿ns™iÚM©rix
(
GTRRªdomSubM©rixW™hNÜmR©es
 *
šnucM©rix
, 
CodÚS‹S·û
 *
š¡©eS·û
è: 
T¿ns™iÚM©rix
(š¡©eS·û->
G‘N¡©e
()) {

16 
nucM©rix
 = 
šnucM©rix
;

17 
	g¡©eS·û
 = 
š¡©eS·û
;

19 
Regi¡”
(
nucM©rix
);

21 
	gsyn
 = 
Ãw
 
boŞ
*[
G‘N¡©e
()];

22 
	gi
=0; i<
G‘N¡©e
(); i++) {

23 
	gsyn
[
i
] = 
Ãw
 
boŞ
[
G‘N¡©e
()];

24 
	gj
=0; j<
G‘N¡©e
(); j++) {

25 
	gsyn
[
i
][
j
] = 
¡©eS·û
->
SynÚymous
(i,j);

26 
	gR
[
i
][
j
] = 0;

31 
vœtu®
 
Compu‹A¼ay
() {

32 
	gi
=0; i<
G‘N¡©e
(); i++) {

33 
	gj
=0; j<
G‘N¡©e
(); j++) {

34 if(
	gi
!=
j
) {

35 
diff
 = 
¡©eS·û
->
G‘DifãršgPos™iÚ
(
i
, 
j
);

36 if(
	gdiff
 < 3)

37 
	gR
[
i
][
j
] = 
nucM©rix
->
G‘Row
(
¡©eS·û
->
G‘CodÚPos™iÚ
(
diff
, i))[stateSpace->GetCodonPosition(diff, j)];

43 
vœtu®
 
Compu‹StiÚ¬y
() {

44 
	gtÙ
 = 0;

45 
	gi
=0; i<
G‘N¡©e
(); i++) {

46 
	g¡©iÚ¬y
[
i
] = 
nucM©rix
->
G‘StiÚ¬y
()[
¡©eS·û
->
G‘CodÚPos™iÚ
(0, i)]*
	gnucM©rix
->GetStationary()[stateSpace->GetCodonPosition(1, i)]*nucMatrix->GetStationary()[stateSpace->GetCodonPosition(2, i)];

47 
	gtÙ
+=
¡©iÚ¬y
[
i
];

49 
	gi
=0; i<
G‘N¡©e
(); i++) {

50 
	g¡©iÚ¬y
[
i
] /ğ
tÙ
;

54 
boŞ
 
isSyn
(
i
, 
j
) {

55  
	gsyn
[
i
][
j
];

58 
vœtu®
 
S‘P¬am‘”s
() {

62 
CodÚS‹S·û
* 
G‘S‹S·û
() {

63  
	g¡©eS·û
;

66 
SubM©rix
* 
G‘NucM©rix
() {

67  
	gnucM©rix
;

71 
	g´Ùeùed
 :

72 
GTRRªdomSubM©rixW™hNÜmR©es
* 
nucM©rix
;

73 
CodÚS‹S·û
 *
	g¡©eS·û
;

75 
boŞ
** 
	gsyn
;

80 şas 
	cMGOmegaCodÚT¿ns™iÚM©rix
 : 
public
 
MGCodÚT¿ns™iÚM©rix
 {

82 
public
 :

83 
	$MGOmegaCodÚT¿ns™iÚM©rix
(
GTRRªdomSubM©rixW™hNÜmR©es
 *
šnucM©rix
, 
CodÚS‹S·û
 *
š¡©eS·û
è: 
	$MGCodÚT¿ns™iÚM©rix
(
šnucM©rix
, 
š¡©eS·û
) {

84 
rows
 = 
Ãw
 [
nV®
];

85 
cŞumns
 = 
Ãw
 [
nV®
];

87 
k
=0;

88 
i
=0; i<
	`G‘N¡©e
(); i++) {

89 
j
=0; j<
	`G‘N¡©e
(); j++) {

90 if(
i
==
j
 || 
¡©eS·û
->
	`G‘DifãršgPos™iÚ
(i,j)<3) {

91 
rows
[
k
] = 
i
;

92 
cŞumns
[
k
] = 
j
;

93 
k
++;

99 
ki
 = 
Ãw
 [
nFaùÜ
];

100 
kj
 = 
Ãw
 [
nFaùÜ
];

101 
k
 = 0;

103 
i
 = 0; i<
nV®
; i++) {

104 
j
=0; j<
nV®
; j++) {

105 if(
cŞumns
[
i
] =ğ
rows
[
j
]) {

106 
ki
[
k
] = 
i
;

107 
kj
[
k
] = 
j
;

108 
k
++;

118 
vœtu®
 
	$Compu‹V®ues
(** 
b
, 
r
, 
omega
) {

120 
cu¼’Œow
 = 0;

121 
tÙ
 = 0;

123 
k
 = 0; k < 
nV®
; k++) {

124 
i
 = 
rows
[
k
], 
j
 = 
cŞumns
[k];

125 if(
i
!=
cu¼’Œow
) {

126 
b
[
cu¼’Œow
][cu¼’Œow] = -
tÙ
;

127 
tÙ
=0;

128 
cu¼’Œow
 = 
i
;

130 if(
rows
[
k
]!=
cŞumns
[k]) {

131 if(
	`isSyn
(
i
, 
j
)) {

132 
b
[
i
][
j
] = 
r
*
R
[i][j];

135 
b
[
i
][
j
] = 
r
*
omega
*
R
[i][j];

136 
tÙ
 +ğ
b
[
i
][
j
];

139 
b
[
cu¼’Œow
][cu¼’Œow] = -
tÙ
;

142 
	}
}

145 
	$squ¬e
(** 
šput
, ** 
ouut
) {

147 
i
=0; i<
	`G‘N¡©e
(); i++) {

148 
j
=0; j<
	`G‘N¡©e
(); j++) {

149 
ouut
[
i
][
j
] = 0;

152 
k
 = 0; k <
nFaùÜ
; k++) {

153 
ouut
[
rows
[
ki
[
k
]]][
cŞumns
[
kj
[k]]] +ğ
šput
[rows[ki[k]]][columns[ki[k]]]*input[rows[kj[k]]][columns[kj[k]]];

155 
	}
}

157 
	g´Ùeùed
 :

159 *
rows
, *
	gcŞumns
;

160 *
	gki
, *
	gkj
;

162 cÚ¡ 
	gnV®
 = 587;

163 cÚ¡ 
	gnFaùÜ
 = 5673;

169 şas 
	cMGOmegaCodÚT¿ns™iÚM©rix_OMP
 : 
public
 
MGOmegaCodÚT¿ns™iÚM©rix
 {

171 
public
 :

172 
	$MGOmegaCodÚT¿ns™iÚM©rix_OMP
(
GTRRªdomSubM©rixW™hNÜmR©es
 *
šnucM©rix
, 
CodÚS‹S·û
 *
š¡©eS·û
, 
šnTh»ads
è: 
	$MGOmegaCodÚT¿ns™iÚM©rix
(
šnucM©rix
, 
š¡©eS·û
) {

173 
nTh»ads
 = 
šnTh»ads
;

175 
pSyn
 = 
Ãw
 **[
nTh»ads
];

176 
pR
 = 
Ãw
 **[
nTh»ads
];

177 
²V®
 = 
Ãw
 [
nTh»ads
];

178 
pRows
 = 
Ãw
 *[
nTh»ads
];

179 
pCŞumns
 = 
Ãw
 *[
nTh»ads
];

181 
k
=0; k<
nTh»ads
; k++) {

182 
pSyn
[
k
] = 
Ãw
 *[
	`G‘N¡©e
()];

183 
pR
[
k
] = 
Ãw
 *[
	`G‘N¡©e
()];

184 
²V®
[
k
] = 
nV®
;

185 
pRows
[
k
] = 
Ãw
 [
nV®
];

186 
pCŞumns
[
k
] = 
Ãw
 [
nV®
];

188 
i
=0; i<
	`G‘N¡©e
(); i++) {

189 
pSyn
[
k
][
i
] = 
Ãw
 [
	`G‘N¡©e
()];

190 
pR
[
k
][
i
] = 
Ãw
 [
	`G‘N¡©e
()];

191 
j
=0; j<
	`G‘N¡©e
(); j++) {

192 
pSyn
[
k
][
i
][
j
] = 
syn
[i][j];

193 
pR
[
k
][
i
][
j
] = 
R
[i][j];

197 
i
=0; i<
nV®
; i++) {

198 
pRows
[
k
][
i
] = 
rows
[i];

199 
pCŞumns
[
k
][
i
] = 
cŞumns
[i];

205 
vœtu®
 
	$Compu‹V®ues
(** 
b
, 
r
, 
omega
) {

207 
thr
 = 1;

211 
cu¼’Œow
 = 0;

212 
tÙ
 = 0;

214 
k
 = 0; k < 
²V®
[
thr
]; k++) {

215 
i
 = 
pRows
[
thr
][
k
], 
j
 = 
pCŞumns
[thr][k];

216 if(
i
!=
cu¼’Œow
) {

217 
b
[
cu¼’Œow
][cu¼’Œow] = -
tÙ
;

218 
tÙ
=0;

219 
cu¼’Œow
 = 
i
;

221 if(
pRows
[
thr
][
k
]!=
pCŞumns
[thr][k]) {

222 if(
pSyn
[
thr
][
i
][
j
]) {

223 
b
[
i
][
j
] = 
r
*
pR
[
thr
][i][j];

226 
b
[
i
][
j
] = 
r
*
omega
*
pR
[
thr
][i][j];

227 
tÙ
 +ğ
b
[
i
][
j
];

229 
b
[
cu¼’Œow
][cu¼’Œow] = -
tÙ
;

232 
	}
}

234 
	$upd©•R
() {

235 
k
=0; k<
nTh»ads
; k++) {

236 
i
=0; i<
	`G‘N¡©e
(); i++) {

237 
j
=0; j<
	`G‘N¡©e
(); j++) {

238 
pR
[
k
][
i
][
j
] = 
R
[i][j];

243 
	}
}

245 
vœtu®
 
	$Compu‹A¼ay
() {

246 
MGCodÚT¿ns™iÚM©rix
::
	`Compu‹A¼ay
();

247 
k
=0; k<
nTh»ads
; k++) {

248 
i
=0; i<
	`G‘N¡©e
(); i++) {

249 
j
=0; j<
	`G‘N¡©e
(); j++) {

250 
pR
[
k
][
i
][
j
] = 
R
[i][j];

254 
	}
}

258 
	g´Ùeùed
 :

259 
nTh»ads
;

260 *** 
	gpSyn
;

261 *** 
	gpR
;

262 * 
	g²V®
;

263 ** 
	gpRows
, **
	gpCŞumns
;

	@MSCodonSubMatrix.cpp

1 
	~"MSCodÚSubM©rix.h
"

4 
	gMGF™ÃssCodÚSubM©rix
::
	$Compu‹StiÚ¬y
() {

7 
tÙ®
 = 0;

8 
i
=0; i<
	`G‘N¡©e
(); i++) {

9 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i));

10 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

14 
i
=0; i<
	`G‘N¡©e
(); i++) {

15 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

17 
	}
}

20 
	gMGF™ÃssCodÚSubM©rix
::
	$Compu‹A¼ay
(
i
) {

22 
tÙ®
 = 0;

23 
j
=0; j<
	`G‘N¡©e
(); j++) {

24 ià(
i
!=
j
) {

25 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

26 ià((
pos
 != -1) && (pos != 3)) {

27 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

28 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

29 ià(
a
 =ğ
b
) {

30 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

31 
û¼
 << 
pos
 << '\n';

32 
	`ex™
(1);

34 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

35 ià(! 
	`SynÚymous
(
i
,
j
)) {

36 
Q
[
i
][
j
] *ğ
	`sq¹
((
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(j)))/(GetFitness(GetCodonStateSpace()->Translation(i))));

40 
Q
[
i
][
j
] = 0;

42 
tÙ®
 +ğ
Q
[
i
][
j
];

45 
Q
[
i
][i] = -
tÙ®
;

46 ià(
tÙ®
 <0) {

47 
û¼
 << "negative„ate‡way\n";

48 
	`ex™
(1);

50 
	}
}

56 
	gMGF™ÃssCodÚU§geSubM©rix
::
	$Compu‹StiÚ¬y
() {

59 
tÙ®
 = 0;

60 
i
=0; i<
	`G‘N¡©e
(); i++) {

61 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`G‘CodÚU§geS–eùiÚ
(i);

62 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

66 
i
=0; i<
	`G‘N¡©e
(); i++) {

67 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

69 
	}
}

72 
	gMGF™ÃssCodÚU§geSubM©rix
::
	$Compu‹A¼ay
(
i
) {

74 
tÙ®
 = 0;

75 
j
=0; j<
	`G‘N¡©e
(); j++) {

76 ià(
i
!=
j
) {

77 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

78 ià((
pos
 != -1) && (pos != 3)) {

79 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

80 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

81 ià(
a
 =ğ
b
) {

82 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

83 
û¼
 << 
pos
 << '\n';

84 
	`ex™
(1);

86 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
è* 
	`sq¹
(
	`G‘CodÚU§geS–eùiÚ
(j)/GetCodonUsageSelection(i)) ;

87 ià(! 
	`SynÚymous
(
i
,
j
)) {

88 
Q
[
i
][
j
] *ğ
	`sq¹
(((
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(j)))/(GetFitness(GetCodonStateSpace()->Translation(i)))));

93 
Q
[
i
][
j
] = 0;

95 
tÙ®
 +ğ
Q
[
i
][
j
];

99 
Q
[
i
][i] = -
tÙ®
;

100 ià(
tÙ®
 <0) {

101 
û¼
 << "negative„ate‡way\n";

102 
	`ex™
(1);

104 
	}
}

111 
	gMGSRF™ÃssNÜm®CodÚU§geSubM©rix
::
	$Compu‹StiÚ¬y
() {

114 
tÙ®
 = 0;

115 
i
=0; i<
	`G‘N¡©e
(); i++) {

116 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`exp
(
	`G‘CodÚU§geS–eùiÚ
(i));

118 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

121 
i
=0; i<
	`G‘N¡©e
(); i++) {

122 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

125 
	}
}

128 
	gMGSRF™ÃssNÜm®CodÚU§geSubM©rix
::
	$Compu‹A¼ay
(
i
) {

130 
tÙ®
 = 0;

131 
j
=0; j<
	`G‘N¡©e
(); j++) {

132 ià(
i
!=
j
) {

133 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

134 ià((
pos
 != -1) && (pos != 3)) {

135 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

136 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

137 ià(
a
 =ğ
b
) {

138 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

139 
û¼
 << 
pos
 << '\n';

140 
	`ex™
(1);

142 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
è* 
	`sq¹
(
	`exp
(
	`G‘CodÚU§geS–eùiÚ
(j)-GetCodonUsageSelection(i))) ;

143 ià(! 
	`SynÚymous
(
i
,
j
)) {

144 
Q
[
i
][
j
] *ğ
	`sq¹
(((
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(j)))/(GetFitness(GetCodonStateSpace()->Translation(i)))));

148 
Q
[
i
][
j
] = 0;

150 
tÙ®
 +ğ
Q
[
i
][
j
];

154 
Q
[
i
][i] = -
tÙ®
;

155 ià(
tÙ®
 <0) {

156 
û¼
 << "negative„ate‡way\n";

157 
	`ex™
(1);

159 
	}
}

163 
	gMGMSF™ÃssNÜm®CodÚU§geSubM©rix
::
	$Compu‹StiÚ¬y
() {

166 
tÙ®
 = 0;

167 
i
=0; i<
	`G‘N¡©e
(); i++) {

168 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`G‘CodÚU§geS–eùiÚ
(i);

170 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

173 
i
=0; i<
	`G‘N¡©e
(); i++) {

174 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

177 
	}
}

180 
	gMGMSF™ÃssNÜm®CodÚU§geSubM©rix
::
	$Compu‹A¼ay
(
i
) {

182 
tÙ®
 = 0;

183 
j
=0; j<
	`G‘N¡©e
(); j++) {

184 ià(
i
!=
j
) {

185 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

186 ià((
pos
 != -1) && (pos != 3)) {

187 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

188 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

189 ià(
a
 =ğ
b
) {

190 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

191 
û¼
 << 
pos
 << '\n';

192 
	`ex™
(1);

194 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

197 
d–S
;

198 ià(! 
	`SynÚymous
(
i
,
j
)) {

199 
d–S
 = 
	`log
((
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
j
)))/(G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
i
)))è+†og(
	`G‘CodÚU§geS–eùiÚ
(j)/GetCodonUsageSelection(i));

202 
d–S
 = 
	`log
(
	`G‘CodÚU§geS–eùiÚ
(
j
)/G‘CodÚU§geS–eùiÚ(
i
));

205 ià((
	`çbs
(
d–S
)) < 1e-10) {

206 
Q
[
i
][
j
] *ğ1 / (1-(
d–S
/2));

218 
Q
[
i
][
j
] *ğ(
d–S
)/(1.0 - 
	`exp
(-deltaS));

220 if(
	`isšf
(
Q
[
i
][
j
])) {

221 
û¼
 << "Q m©rix infš™e: " << 
Q
[
i
][
j
] << '\n';

222 
û¼
 << 
d–S
 << '\t' << 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
)è<< '\t' << G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
j
)) << '\n';

223 
	`ex™
(1);

228 
Q
[
i
][
j
] = 0;

230 
tÙ®
 +ğ
Q
[
i
][
j
];

232 if(
	`isšf
(
Q
[
i
][
j
])) {

233 
û¼
 << "Q m©rix infš™e: " << 
Q
[
i
][
j
] << '\n';

234 
	`ex™
(1);

237 if(
Q
[
i
][
j
] < 0) {

238 
û¼
 << "Q m©rix‚eg©ive: " << 
Q
[
i
][
j
] << '\n';

239 
	`ex™
(1);

245 
Q
[
i
][i] = -
tÙ®
;

246 ià(
tÙ®
 <0) {

247 
û¼
 << "negative„ate‡way\n";

248 
	`ex™
(1);

250 
	}
}

258 
	gMGSRF™ÃssCodÚU§geSubM©rix
::
	$Compu‹StiÚ¬y
() {

261 
tÙ®
 = 0;

262 
i
=0; i<
	`G‘N¡©e
(); i++) {

263 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`G‘CodÚU§geS–eùiÚ
(i);

264 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

268 
i
=0; i<
	`G‘N¡©e
(); i++) {

269 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

271 
	}
}

274 
	gMGSRF™ÃssCodÚU§geSubM©rix
::
	$Compu‹A¼ay
(
i
) {

276 
tÙ®
 = 0;

277 
j
=0; j<
	`G‘N¡©e
(); j++) {

278 ià(
i
!=
j
) {

279 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

280 ià((
pos
 != -1) && (pos != 3)) {

281 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

282 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

283 ià(
a
 =ğ
b
) {

284 
û¼
 << 
	`G‘CodÚS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << G‘CodÚS‹S·û()->G‘S‹(
j
) << '\n';

285 
û¼
 << 
pos
 << '\n';

286 
	`ex™
(1);

288 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
è* 
	`sq¹
(
	`G‘CodÚU§geS–eùiÚ
(j)/GetCodonUsageSelection(i)) ;

289 ià(! 
	`SynÚymous
(
i
,
j
)) {

290 
Q
[
i
][
j
] *ğ
	`sq¹
(((
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(j)))/(GetFitness(GetCodonStateSpace()->Translation(i)))));

295 
Q
[
i
][
j
] = 0;

297 
tÙ®
 +ğ
Q
[
i
][
j
];

301 
Q
[
i
][i] = -
tÙ®
;

302 ià(
tÙ®
 <0) {

303 
û¼
 << "negative„ate‡way\n";

304 
	`ex™
(1);

306 
	}
}

311 
	gMGMSF™ÃssCodÚU§geSubM©rix
::
	$Compu‹StiÚ¬y
() {

314 
tÙ®
 = 0;

315 
i
=0; i<
	`G‘N¡©e
(); i++) {

316 
mStiÚ¬y
[
i
] = 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`G‘CodÚU§geS–eùiÚ
(i);

317 
tÙ®
 +ğ
mStiÚ¬y
[
i
];

322 
i
=0; i<
	`G‘N¡©e
(); i++) {

323 
mStiÚ¬y
[
i
] /ğ
tÙ®
;

335 
	}
}

338 
	gMGMSF™ÃssCodÚU§geSubM©rix
::
	$Compu‹A¼ay
(
i
) {

340 
tÙ®
 = 0;

341 
j
=0; j<
	`G‘N¡©e
(); j++) {

342 ià(
i
!=
j
) {

343 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

344 ià((
pos
 != -1) && (pos != 3)) {

345 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

346 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

348 
Q
[
i
][
j
] = (*
NucM©rix
)(
a
,
b
);

350 
d–S
;

351 ià(! 
	`SynÚymous
(
i
,
j
)) {

352 
d–S
 = ( 
	`log
(
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
j
))è-†og(G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
i
))èè+ (†og(
	`G‘CodÚU§geS–eùiÚ
(j)) -†og(GetCodonUsageSelection(i)) );

355 
d–S
 = 
	`log
(
	`G‘CodÚU§geS–eùiÚ
(
j
)è-†og(G‘CodÚU§geS–eùiÚ(
i
));

357 ià((
	`çbs
(
d–S
)) < 1e-30) {

358 
Q
[
i
][
j
] *ğ1+
d–S
/2;

360 ià(
d–S
 > 50) {

361 
Q
[
i
][
j
] *ğ
d–S
;

363 ià(
d–S
 < -50) {

364 
Q
[
i
][
j
] = 0;

366 ià(
d–S
 != 0) {

368 
Q
[
i
][
j
] *ğ
d–S
/(1.0 - 
	`exp
(-deltaS));

370 if(
	`isšf
(
Q
[
i
][
j
])) {

371 
û¼
 << "Q m©rix infš™e: " << 
Q
[
i
][
j
] << '\n';

372 
û¼
 << 
d–S
 << '\t' << 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
)è<< '\t' << G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
j
)) << '\n';

373 
û¼
 << 
d–S
 << '\t' << 
	`log
(
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
))è<< '\t' <<†og(G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
j
))) << '\n';

374 
û¼
 << 
	`log
(
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
))è-†og(G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
j
))) << '\n';

375 
û¼
 << 
	`G‘CodÚU§geS–eùiÚ
(
i
è<< '\t' << G‘CodÚU§geS–eùiÚ(
j
) << '\n';

376 
	`ex™
(1);

380 
Q
[
i
][
j
] = 0;

382 
tÙ®
 +ğ
Q
[
i
][
j
];

384 if(
	`isšf
(
Q
[
i
][
j
])) {

385 
û¼
 << "Q m©rix infš™e: " << 
Q
[
i
][
j
] << '\n';

386 
	`ex™
(1);

389 if(
Q
[
i
][
j
] < 0) {

390 
û¼
 << "Q m©rix‚eg©ive: " << 
Q
[
i
][
j
] << '\n';

391 
	`ex™
(1);

398 
Q
[
i
][i] = -
tÙ®
;

400 ià(
tÙ®
 <0) {

401 
û¼
 << "negative„ate‡way\n";

402 
	`ex™
(1);

404 
	}
}

	@MSCodonSubMatrix.h

2 #iâdeà
MSCODONSUBMATRIX_H


3 
	#MSCODONSUBMATRIX_H


	)

5 
	~"CodÚSubM©rix.h
"

10 şas 
	cMGF™ÃssCodÚSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

12 
public
:

14 
	$MGF™ÃssCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, * 
šf™Ãss
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

15 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

16 
	`CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

17 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

18 
	$f™Ãss
(
šf™Ãss
) {}

21 
	$G‘F™Ãss
(
¯¡©e
) {

22  
f™Ãss
[
¯¡©e
] + 1e-10;

23 
	}
}

25 
	g´Ùeùed
:

28 
Compu‹A¼ay
(
¡©e
);

29 
Compu‹StiÚ¬y
();

30 
	$S‘F™ÃssProfe
(* 
šf™Ãss
è{
f™Ãss
 = inf™Ãss;
	}
}

34 * 
	gf™Ãss
;

37 
şass
 
	gRªdomMGF™ÃssCodÚSubM©rix
 : 
public
 
MGF™ÃssCodÚSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

39 
	gpublic
:

41 
RªdomMGF™ÃssCodÚSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šRªdomF™ÃssProfe
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

42 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

43 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

44 
MGF™ÃssCodÚSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomF™ÃssProfe
->
G‘A¼ay
(), 
šnÜm®i£
) ,

45 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

46 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

47 
m©rix
(
šm©rix
),

48 
RªdomF™ÃssProfe
(
šRªdomF™ÃssProfe
) {

50 
Regi¡”
(
m©rix
);

51 
Regi¡”
(
RªdomF™ÃssProfe
);

52 
¥ecŸlUpd©e
();

60 
S‘P¬am‘”s
() {

61 
S‘NucM©rix
(
m©rix
);

62 
S‘F™ÃssProfe
(
RªdomF™ÃssProfe
->
G‘A¼ay
());

65 
	g´Ùeùed
:

67 
RªdomSubM©rix
* 
m©rix
;

68 
	gV¬
<
	gProfe
>* 
	gRªdomF™ÃssProfe
;

73 şas 
	cMGF™ÃssCodÚU§geSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

75 
public
:

77 
	$MGF™ÃssCodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, * 
šf™Ãss
, * 
šcodÚu§ge£ËùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

78 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

79 
	`CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

80 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

81 
	`f™Ãss
(
šf™Ãss
),

82 
	$codÚu§ge£ËùiÚ
(
šcodÚu§ge£ËùiÚ
) {}

85 
	$G‘F™Ãss
(
¯¡©e
) {

86  
f™Ãss
[
¯¡©e
] + 1e-10;

87 
	}
}

89 
	$G‘CodÚU§geS–eùiÚ
(
codÚ¡©e
) {

90  
codÚu§ge£ËùiÚ
[
codÚ¡©e
];

91 
	}
}

94 
	g´Ùeùed
:

97 
Compu‹A¼ay
(
¡©e
);

98 
Compu‹StiÚ¬y
();

100 
	$S‘F™ÃssProfe
(* 
šf™Ãss
è{
f™Ãss
 = inf™Ãss;
	}
}

101 
	$S‘CodÚU§geS–eùiÚ
(* 
šcodÚu§ge£ËùiÚ
è{
codÚu§ge£ËùiÚ
 = incodÚu§ge£ËùiÚ;
	}
}

104 * 
	gf™Ãss
;

105 * 
	gcodÚu§ge£ËùiÚ
;

111 
şass
 
	gRªdomMGF™ÃssCodÚU§geSubM©rix
 : 
public
 
MGF™ÃssCodÚU§geSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

113 
	gpublic
:

115 
RªdomMGF™ÃssCodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šRªdomF™ÃssProfe
, V¬<Profe>* 
šRªdomCodÚU§geS–eùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

116 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

117 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

118 
MGF™ÃssCodÚU§geSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomF™ÃssProfe
->
G‘A¼ay
(), 
šRªdomCodÚU§geS–eùiÚ
->G‘A¼ay(), 
šnÜm®i£
),

119 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

120 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

121 
m©rix
(
šm©rix
),

122 
RªdomF™ÃssProfe
(
šRªdomF™ÃssProfe
),

123 
RªdomCodÚU§geS–eùiÚ
(
šRªdomCodÚU§geS–eùiÚ
) {

125 
Regi¡”
(
m©rix
);

126 
Regi¡”
(
RªdomF™ÃssProfe
);

127 
Regi¡”
(
RªdomCodÚU§geS–eùiÚ
);

129 
¥ecŸlUpd©e
();

133 
CodÚS‹S·û
* 
G‘CodÚS‹S·û
(è{ 
	gRªdomCodÚSubM©rix
::GetCodonStateSpace();}

139 
S‘P¬am‘”s
() {

140 
S‘NucM©rix
(
m©rix
);

141 
S‘F™ÃssProfe
(
RªdomF™ÃssProfe
->
G‘A¼ay
());

142 
S‘CodÚU§geS–eùiÚ
(
RªdomCodÚU§geS–eùiÚ
->
G‘A¼ay
());

145 
	g´Ùeùed
:

147 
RªdomSubM©rix
* 
m©rix
;

148 
	gV¬
<
	gProfe
>* 
	gRªdomF™ÃssProfe
;

149 
	gV¬
<
	gProfe
>* 
	gRªdomCodÚU§geS–eùiÚ
;

155 şas 
	cMGSRF™ÃssNÜm®CodÚU§geSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

157 
public
:

159 
	$MGSRF™ÃssNÜm®CodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, * 
šf™Ãss
, * 
šcodÚu§ge£ËùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

160 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

161 
	`CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

162 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

163 
	`f™Ãss
(
šf™Ãss
),

164 
	$codÚu§ge£ËùiÚ
(
šcodÚu§ge£ËùiÚ
) {}

167 
	$G‘F™Ãss
(
¯¡©e
) {

168  
f™Ãss
[
¯¡©e
] + 1e-10;

169 
	}
}

171 
	$G‘CodÚU§geS–eùiÚ
(
codÚ¡©e
) {

172  
codÚu§ge£ËùiÚ
[
codÚ¡©e
];

173 
	}
}

176 
	g´Ùeùed
:

179 
Compu‹A¼ay
(
¡©e
);

180 
Compu‹StiÚ¬y
();

181 
	$S‘F™ÃssProfe
(* 
šf™Ãss
è{
f™Ãss
 = inf™Ãss;
	}
}

182 
	$S‘CodÚU§geS–eùiÚ
(* 
šcodÚu§ge£ËùiÚ
è{
codÚu§ge£ËùiÚ
 = incodÚu§ge£ËùiÚ;
	}
}

185 * 
	gf™Ãss
;

186 * 
	gcodÚu§ge£ËùiÚ
;

190 
şass
 
	gRªdomMGSRF™ÃssNÜm®CodÚU§geSubM©rix
 : 
public
 
MGSRF™ÃssNÜm®CodÚU§geSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

192 
	gpublic
:

194 
RªdomMGSRF™ÃssNÜm®CodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
R—lVeùÜ
>* 
šRªdomF™ÃssProfe
, V¬<R—lVeùÜ>* 
šRªdomCodÚU§geS–eùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

195 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

196 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

197 
MGSRF™ÃssNÜm®CodÚU§geSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomF™ÃssProfe
->
G‘A¼ay
(), 
šRªdomCodÚU§geS–eùiÚ
->G‘A¼ay(), 
šnÜm®i£
),

198 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

199 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

200 
m©rix
(
šm©rix
),

201 
RªdomF™ÃssProfe
(
šRªdomF™ÃssProfe
),

202 
RªdomCodÚU§geS–eùiÚ
(
šRªdomCodÚU§geS–eùiÚ
) {

204 
Regi¡”
(
m©rix
);

205 
Regi¡”
(
RªdomF™ÃssProfe
);

206 
Regi¡”
(
RªdomCodÚU§geS–eùiÚ
);

207 
¥ecŸlUpd©e
();

217 
CodÚS‹S·û
* 
G‘CodÚS‹S·û
(è{ 
	gRªdomCodÚSubM©rix
::GetCodonStateSpace();}

223 
S‘P¬am‘”s
() {

224 
S‘NucM©rix
(
m©rix
);

225 
S‘F™ÃssProfe
(
RªdomF™ÃssProfe
->
G‘A¼ay
());

226 
S‘CodÚU§geS–eùiÚ
(
RªdomCodÚU§geS–eùiÚ
->
G‘A¼ay
());

229 
	g´Ùeùed
:

231 
RªdomSubM©rix
* 
m©rix
;

232 
	gV¬
<
	gR—lVeùÜ
>* 
	gRªdomF™ÃssProfe
;

233 
	gV¬
<
	gR—lVeùÜ
>* 
	gRªdomCodÚU§geS–eùiÚ
;

241 şas 
	cMGMSF™ÃssNÜm®CodÚU§geSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

243 
public
:

245 
	$MGMSF™ÃssNÜm®CodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, * 
šf™Ãss
, * 
šcodÚu§ge£ËùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

246 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

247 
	`CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

248 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

249 
	`f™Ãss
(
šf™Ãss
),

250 
	$codÚu§ge£ËùiÚ
(
šcodÚu§ge£ËùiÚ
) {}

253 
	$G‘F™Ãss
(
¯¡©e
) {

254  
f™Ãss
[
¯¡©e
];

255 
	}
}

257 
	$G‘CodÚU§geS–eùiÚ
(
codÚ¡©e
) {

258  
codÚu§ge£ËùiÚ
[
codÚ¡©e
];

259 
	}
}

261 
	g´Ùeùed
:

264 
Compu‹A¼ay
(
¡©e
);

265 
Compu‹StiÚ¬y
();

266 
	$S‘F™ÃssProfe
(* 
šf™Ãss
è{
f™Ãss
 = inf™Ãss;
	}
}

267 
	$S‘CodÚU§geS–eùiÚ
(* 
šcodÚu§ge£ËùiÚ
è{
codÚu§ge£ËùiÚ
 = incodÚu§ge£ËùiÚ;
	}
}

270 * 
	gf™Ãss
;

271 * 
	gcodÚu§ge£ËùiÚ
;

275 
şass
 
	gRªdomMGMSF™ÃssNÜm®CodÚU§geSubM©rix
 : 
public
 
MGMSF™ÃssNÜm®CodÚU§geSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

277 
	gpublic
:

279 
RªdomMGMSF™ÃssNÜm®CodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
R—lVeùÜ
>* 
šRªdomF™ÃssProfe
, V¬<R—lVeùÜ>* 
šRªdomCodÚU§geS–eùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

280 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

281 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

282 
MGMSF™ÃssNÜm®CodÚU§geSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomF™ÃssProfe
->
G‘A¼ay
(), 
šRªdomCodÚU§geS–eùiÚ
->G‘A¼ay(), 
šnÜm®i£
),

283 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

284 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

285 
m©rix
(
šm©rix
),

286 
RªdomF™ÃssProfe
(
šRªdomF™ÃssProfe
),

287 
RªdomCodÚU§geS–eùiÚ
(
šRªdomCodÚU§geS–eùiÚ
) {

289 
Regi¡”
(
m©rix
);

290 
Regi¡”
(
RªdomF™ÃssProfe
);

291 
Regi¡”
(
RªdomCodÚU§geS–eùiÚ
);

292 
¥ecŸlUpd©e
();

302 
CodÚS‹S·û
* 
G‘CodÚS‹S·û
(è{ 
	gRªdomCodÚSubM©rix
::GetCodonStateSpace();}

308 
S‘P¬am‘”s
() {

309 
S‘NucM©rix
(
m©rix
);

310 
S‘F™ÃssProfe
(
RªdomF™ÃssProfe
->
G‘A¼ay
());

311 
S‘CodÚU§geS–eùiÚ
(
RªdomCodÚU§geS–eùiÚ
->
G‘A¼ay
());

314 
	g´Ùeùed
:

316 
RªdomSubM©rix
* 
m©rix
;

317 
	gV¬
<
	gR—lVeùÜ
>* 
	gRªdomF™ÃssProfe
;

318 
	gV¬
<
	gR—lVeùÜ
>* 
	gRªdomCodÚU§geS–eùiÚ
;

325 şas 
	cMGSRF™ÃssCodÚU§geSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

327 
public
:

329 
	$MGSRF™ÃssCodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, * 
šf™Ãss
, * 
šcodÚu§ge£ËùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

330 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

331 
	`CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

332 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

333 
	`f™Ãss
(
šf™Ãss
),

334 
	$codÚu§ge£ËùiÚ
(
šcodÚu§ge£ËùiÚ
) {}

337 
	$G‘F™Ãss
(
¯¡©e
) {

338  
f™Ãss
[
¯¡©e
] + 1e-6;

339 
	}
}

341 
	$G‘CodÚU§geS–eùiÚ
(
codÚ¡©e
) {

342  
codÚu§ge£ËùiÚ
[
codÚ¡©e
];

343 
	}
}

346 
	g´Ùeùed
:

350 
Compu‹A¼ay
(
¡©e
);

351 
Compu‹StiÚ¬y
();

352 
	$S‘F™ÃssProfe
(* 
šf™Ãss
è{
f™Ãss
 = inf™Ãss;
	}
}

353 
	$S‘CodÚU§geS–eùiÚ
(* 
šcodÚu§ge£ËùiÚ
è{
codÚu§ge£ËùiÚ
 = incodÚu§ge£ËùiÚ;
	}
}

356 * 
	gf™Ãss
;

357 * 
	gcodÚu§ge£ËùiÚ
;

363 
şass
 
	gRªdomMGSRF™ÃssCodÚU§geSubM©rix
 : 
public
 
MGSRF™ÃssCodÚU§geSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

365 
	gpublic
:

367 
RªdomMGSRF™ÃssCodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šRªdomF™ÃssProfe
, V¬<Profe>* 
šRªdomCodÚU§geS–eùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

368 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

369 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

370 
MGSRF™ÃssCodÚU§geSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomF™ÃssProfe
->
G‘A¼ay
(), 
šRªdomCodÚU§geS–eùiÚ
->G‘A¼ay(), 
šnÜm®i£
),

371 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

372 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

373 
m©rix
(
šm©rix
),

374 
RªdomF™ÃssProfe
(
šRªdomF™ÃssProfe
),

375 
RªdomCodÚU§geS–eùiÚ
(
šRªdomCodÚU§geS–eùiÚ
) {

377 
Regi¡”
(
m©rix
);

378 
Regi¡”
(
RªdomF™ÃssProfe
);

379 
Regi¡”
(
RªdomCodÚU§geS–eùiÚ
);

381 
¥ecŸlUpd©e
();

385 
CodÚS‹S·û
* 
G‘CodÚS‹S·û
(è{ 
	gRªdomCodÚSubM©rix
::GetCodonStateSpace();}

391 
S‘P¬am‘”s
() {

392 
S‘NucM©rix
(
m©rix
);

393 
S‘F™ÃssProfe
(
RªdomF™ÃssProfe
->
G‘A¼ay
());

394 
S‘CodÚU§geS–eùiÚ
(
RªdomCodÚU§geS–eùiÚ
->
G‘A¼ay
());

397 
	g´Ùeùed
:

399 
RªdomSubM©rix
* 
m©rix
;

400 
	gV¬
<
	gProfe
>* 
	gRªdomF™ÃssProfe
;

401 
	gV¬
<
	gProfe
>* 
	gRªdomCodÚU§geS–eùiÚ
;

408 şas 
	cMGMSF™ÃssCodÚU§geSubM©rix
 : 
public
 
MGCodÚSubM©rix
 {

410 
public
:

412 
	$MGMSF™ÃssCodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
SubM©rix
* 
šNucM©rix
, * 
šf™Ãss
, * 
šcodÚu§ge£ËùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

413 
	`SubM©rix
(
š¡©e¥aû
->
	`G‘N¡©e
(), 
šnÜm®i£
),

414 
	`CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

415 
	`MGCodÚSubM©rix
(
š¡©e¥aû
, 
šNucM©rix
, 
šnÜm®i£
),

416 
	`f™Ãss
(
šf™Ãss
),

417 
	$codÚu§ge£ËùiÚ
(
šcodÚu§ge£ËùiÚ
) {}

420 
	$G‘F™Ãss
(
¯¡©e
) {

421  
f™Ãss
[
¯¡©e
] + 1e-6;

422 
	}
}

424 
	$G‘CodÚU§geS–eùiÚ
(
codÚ¡©e
) {

425  
codÚu§ge£ËùiÚ
[
codÚ¡©e
];

426 
	}
}

429 
	g´Ùeùed
:

433 
Compu‹A¼ay
(
¡©e
);

434 
Compu‹StiÚ¬y
();

435 
	$S‘F™ÃssProfe
(* 
šf™Ãss
è{
f™Ãss
 = inf™Ãss;
	}
}

436 
	$S‘CodÚU§geS–eùiÚ
(* 
šcodÚu§ge£ËùiÚ
è{
codÚu§ge£ËùiÚ
 = incodÚu§ge£ËùiÚ;
	}
}

438 
	$ToSŒ—m
(
o¡»am
& 
os
) {

439 
û¼
 << "nucmatrix : \n";

440 
NucM©rix
->
	`CheckRev”sib™y
();

441 
û¼
 << '\n';

442 
NucM©rix
->
	`CÜru±M©rix
();

443 
NucM©rix
->
	`Upd©eM©rix
();

444 
NucM©rix
->
	`ToSŒ—m
(
û¼
);

445 
û¼
 << '\n';

446 
NucM©rix
->
	`CheckRev”sib™y
();

447 
û¼
 << '\n';

449 
i
=0; i<
N¯
; i++) {

450 
û¼
 << 
f™Ãss
[
i
] << '\t';

452 
û¼
 << '\n';

453 
û¼
 << '\n';

454 
tÙ®
 = 0;

455 
i
=0; i<
	`G‘N¡©e
(); i++) {

456 
tÙ®
 +ğ
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,
i
)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`G‘CodÚU§geS–eùiÚ
(i);

458 
i
=0; i<
	`G‘N¡©e
(); i++) {

459 
û¼
 << 
i
 << '\t' << 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,i));

460 
û¼
 << '\t' << 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(1,
i
));

461 
û¼
 << '\t' << 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(2,
i
));

462 
û¼
 << '\t' << 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
i
));

463 
û¼
 << '\t' << 
	`G‘CodÚU§geS–eùiÚ
(
i
);

464 
û¼
 << '\t' << 
NucM©rix
->
	`StiÚ¬y
(
	`G‘CodÚPos™iÚ
(0,
i
)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(1,i)è* NucM©rix->StiÚ¬y(G‘CodÚPos™iÚ(2,i)è* 
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(i)è* 
	`G‘CodÚU§geS–eùiÚ
(iè/ 
tÙ®
;

465 
û¼
 << '\n';

467 
û¼
 << '\n';

468 
i
=0; i<
	`G‘N¡©e
(); i++) {

469 
j
=0; j<
	`G‘N¡©e
(); j++) {

470 ià(
i
!=
j
) {

471 
pos
 = 
	`G‘DifãršgPos™iÚ
(
i
,
j
);

472 ià((
pos
 != -1) && (pos != 3)) {

473 
a
 = 
	`G‘CodÚPos™iÚ
(
pos
,
i
);

474 
b
 = 
	`G‘CodÚPos™iÚ
(
pos
,
j
);

476 
mut
 = (*
NucM©rix
)(
a
,
b
);

478 
d–S
;

479 ià(! 
	`SynÚymous
(
i
,
j
)) {

480 
d–S
 = ( 
	`log
(
	`G‘F™Ãss
(
	`G‘CodÚS‹S·û
()->
	`T¿n¦©iÚ
(
j
))è-†og(G‘F™Ãss(G‘CodÚS‹S·û()->T¿n¦©iÚ(
i
))èè+ (†og(
	`G‘CodÚU§geS–eùiÚ
(j)) -†og(GetCodonUsageSelection(i)) );

483 
d–S
 = 
	`log
(
	`G‘CodÚU§geS–eùiÚ
(
j
)è-†og(G‘CodÚU§geS–eùiÚ(
i
));

485 
fix
 = 1;

486 ià(
d–S
 != 0) {

487 
fix
 = 
d–S
/(1.0 - 
	`exp
(-deltaS));

489 
û¼
 << 
i
 << '\t' << 
j
 << '\t' << 
mut
 << '\t' << 
d–S
 << '\t' << 
fix
 << '\t' << mut*fix << '\t' << 
Q
[i][j] << '\n';

494 
	}
}

497 * 
	gf™Ãss
;

498 * 
	gcodÚu§ge£ËùiÚ
;

504 
şass
 
	gRªdomMGMSF™ÃssCodÚU§geSubM©rix
 : 
public
 
MGMSF™ÃssCodÚU§geSubM©rix
,…ubliø
	gRªdomCodÚSubM©rix
 {

506 
	gpublic
:

508 
RªdomMGMSF™ÃssCodÚU§geSubM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
, 
RªdomSubM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
šRªdomF™ÃssProfe
, V¬<Profe>* 
šRªdomCodÚU§geS–eùiÚ
, 
boŞ
 
šnÜm®i£
 = 
çl£
) :

509 
SubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

510 
CodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

511 
MGMSF™ÃssCodÚU§geSubM©rix
(
š¡©e¥aû
,
šm©rix
,
šRªdomF™ÃssProfe
->
G‘A¼ay
(), 
šRªdomCodÚU§geS–eùiÚ
->G‘A¼ay(), 
šnÜm®i£
),

512 
RªdomSubM©rix
(
š¡©e¥aû
->
G‘N¡©e
(), 
šnÜm®i£
),

513 
RªdomCodÚSubM©rix
(
š¡©e¥aû
, 
šnÜm®i£
),

514 
m©rix
(
šm©rix
),

515 
RªdomF™ÃssProfe
(
šRªdomF™ÃssProfe
),

516 
RªdomCodÚU§geS–eùiÚ
(
šRªdomCodÚU§geS–eùiÚ
) {

518 
Regi¡”
(
m©rix
);

519 
Regi¡”
(
RªdomF™ÃssProfe
);

520 
Regi¡”
(
RªdomCodÚU§geS–eùiÚ
);

522 
¥ecŸlUpd©e
();

526 
CodÚS‹S·û
* 
G‘CodÚS‹S·û
(è{ 
	gRªdomCodÚSubM©rix
::GetCodonStateSpace();}

532 
S‘P¬am‘”s
() {

533 
S‘NucM©rix
(
m©rix
);

534 
S‘F™ÃssProfe
(
RªdomF™ÃssProfe
->
G‘A¼ay
());

535 
S‘CodÚU§geS–eùiÚ
(
RªdomCodÚU§geS–eùiÚ
->
G‘A¼ay
());

538 
	g´Ùeùed
:

540 
RªdomSubM©rix
* 
m©rix
;

541 
	gV¬
<
	gProfe
>* 
	gRªdomF™ÃssProfe
;

542 
	gV¬
<
	gProfe
>* 
	gRªdomCodÚU§geS–eùiÚ
;

	@MatrixAlgebra.h

2 #iâdeà
MATAL_H


3 
	#MATAL_H


	)

5 
	~"CovM©rix.h
"

7 şas 
	cM©rixAlgeb¿
 {

9 
	mpublic
:

11 
	$M©rixAlgeb¿
() {}

12 ~
	$M©rixAlgeb¿
(è{
	}
}

14 
´Ùeùed
:

16 ** 
	$M©rixC»©e
(
m
, 
n
) {

17 ** 
tmp
 = 
Ãw
 *[
m
];

18 
i
=0; i<
m
; i++) {

19 
tmp
[
i
] = 
Ãw
 [
n
];

21  
tmp
;

22 
	}
}

24 
	$M©rixD–‘e
(** 
p
, 
m
) {

25 
i
=0; i<
m
; i++) {

26 
d–‘e
[] 
p
[
i
];

28 
d–‘e
[] 
p
;

29 
	}
}

31 
	$M©rixProduù
(** 
p
, ** 
q
, ** 
r
, 
l
, 
m
, 
n
) {

32 
i
=0; i<
l
; i++) {

33 
j
=0; j<
n
; j++) {

34 
tmp
 = 0;

35 
k
=0; k<
m
; k++) {

36 
tmp
 +ğ
p
[
i
][
k
] * 
q
[k][
j
];

38 
r
[
i
][
j
] = 
tmp
;

41 
	}
}

43 
	$M©rixSum
(** 
p
, ** 
q
, ** 
r
, 
m
, 
n
) {

44 
i
=0; i<
m
; i++) {

45 
j
=0; j<
n
; j++) {

46 
r
[
i
][
j
] = 
p
[i][j] + 
q
[i][j];

49 
	}
}

51 
	$M©rixAdd
(** 
p
, ** 
q
, 
m
, 
n
) {

52 
i
=0; i<
m
; i++) {

53 
j
=0; j<
n
; j++) {

54 
p
[
i
][
j
] +ğ
q
[i][j];

57 
	}
}

59 
	$M©rixS‘
(** 
p
, ** 
q
, 
m
, 
n
, 
off£tm
 = 0, 
off£Š
=0) {

60 
i
=0; i<
m
; i++) {

61 
j
=0; j<
n
; j++) {

62 ià(
q
) {

63 
p
[
i
][
j
] = 
q
[i+
off£tm
][j+
off£Š
];

66 
p
[
i
][
j
] = 0;

70 
	}
}

72 
	$M©rixS‘Id’t™y
(** 
p
, 
m
) {

73 
i
=0; i<
m
; i++) {

74 
j
=0; j<
m
; j++) {

75 
p
[
i
][
j
] = (i==j);

78 
	}
}

80 
	$M©rixSÿÏrProduù
(** 
p
, 
Ïmbda
, 
m
, 
n
) {

81 
i
=0; i<
m
; i++) {

82 
j
=0; j<
n
; j++) {

83 
p
[
i
][
j
] *ğ
Ïmbda
;

86 
	}
}

	@Move.cpp

2 
	~"Move.h
"

3 
	~"ChrÚo.h
"

4 
	~"Rªdom.h
"

5 
	~"ProbMod–.h
"

7 
	~<io¡»am
>

11 
	gMCScheduËr
::
	$Re£t
() {

13 
size
 = 
upd©e
.
	`size
();

14 
time
 = 
veùÜ
<>(
size
);

15 
sucûss
 = 
veùÜ
<>(
size
);

16 
nÿÎ
 = 
veùÜ
<>(
size
);

18 
tÙ®weight
 = 0;

19 
i
=0; i<
size
; i++) {

20 
tÙ®weight
 +ğ
weight
[
i
];

21 
time
[
i
] = 0;

22 
sucûss
[
i
] = 0;

24 
tÙ®time
 = 0;

25 
ncyşe
 = 0;

26 
şo£d
 = 
Œue
;

28 
	}
}

30 
	gMCScheduËr
::
	$Regi¡”
(
MCUpd©e
* 
šupd©e
, 
šweight
, 
¡ršg
 
šÇme
) {

32 ià(
şo£d
) {

33 
û¼
 << "error in MCScheduler::Register:„egistration of‚ew updates is closed\n";

34 
throw
;

36 
upd©e
.
	`push_back
(
šupd©e
);

37 
weight
.
	`push_back
(
šweight
);

38 
Çme
.
	`push_back
(
šÇme
);

40 
o¡ršg¡»am
 
oss
;

41 
oss
 << (
upd©e
.
	`size
()-1) << ",";

42 
commªd
 +ğ
oss
.
	`¡r
();

44 
	}
}

46 
	gMCScheduËr
::
	$Cyşe
(
tunšg_moduÏtÜ
, 
Ä•
, 
boŞ
 
v”bo£
, boŞ 
check
) {

48 ià(! 
şo£d
è
	`Re£t
();

50 
»p
 = 0;„•<
Ä•
;„ep++) {

51 
n
=0;

52 
veùÜ
<> 
moves
 = 
	`R—dCommªd
(
n
);

54 if(
n
!=
commªd
.
	`size
()) {

55 
û¼
 << "E¼Ü iÀscheduË¸commªd†š: " << 
’dl
 << 
commªd
 <<ƒndl;

56 
	`ex™
(1);

59 
i
=0; i<
moves
.
	`size
(); i++) {

60 
	`Move
(
tunšg_moduÏtÜ
,
moves
[
i
],
v”bo£
,
check
,
weight
[moves[i]]);

66 
ncyşe
+=
Ä•
;

69 
	}
}

71 
	gveùÜ
<> 
	gMCScheduËr
::
	$R—dCommªd
(&
n
) {

72 
veùÜ
<> 
v
;

73 
n
<
commªd
.
	`size
() && command[n]!=')') {

74 if(
commªd
[
n
]=='(') {

75 
n2
 = 
commªd
.
	`fšd
(":", 
n
+1);

82 
x
ğ
	`©oi
(
commªd
.
	`sub¡r
(
n
+1, 
n2
).
	`c_¡r
());

83 
n
 = 
n2
+1;

84 
veùÜ
<> 
vv
 = 
	`R—dCommªd
(
n
);

85 if(
commªd
[
n
] != ')') {

86 
û¼
 << "E¼Ü iÀscheduË¸commªd†š: " << 
’dl
 << 
commªd
 <<ƒndl;

87 
	`ex™
(1);

90 
i
 = 0; i<
x
; i++)

91 
j
=0; j<
vv
.
	`size
(); j++)

92 
v
.
	`push_back
(
vv
[
j
]);

93 
n
++;

96 
n2
 = 
commªd
.
	`fšd
(",", 
n
+1);

103 
x
ğ
	`©oi
(
commªd
.
	`sub¡r
(
n
, 
n2
).
	`c_¡r
());

104 
v
.
	`push_back
(
x
);

105 
n
 = 
n2
+1;

108  
v
;

109 
	}
}

112 
	gMCScheduËr
::
	$Move
(
tunšg_moduÏtÜ
, 
i
, 
boŞ
 
v”bo£
, boŞ 
check
, 
Ä•
) {

114 
ChrÚo
 
chrÚo
;

115 
chrÚo
.
	`Re£t
();

116 
chrÚo
.
	`S¹
();

117 
m—nsucûss
 = 0;

118 ià(
v”bo£
) {

119 
û¼
 << 
i
 << ' ' << 
Çme
[i] << '\n';

121 
k
=0; k<
Ä•
; k++) {

122 
m—nsucûss
 +ğ
upd©e
[
i
]->
	`Move
(
tunšg_moduÏtÜ
);

124 
chrÚo
.
	`Stİ
();

125 
tÙ®time
 +ğ
chrÚo
.
	`G‘Time
() / 1000;

126 
time
[
i
] +ğ
chrÚo
.
	`G‘Time
() / 1000;

127 
nÿÎ
[
i
] +ğ
Ä•
;

128 
sucûss
[
i
] +ğ
m—nsucûss
;

130 ià(
v”bo£
) {

131 
û¼
 << "sucûs " << 
m—nsucûss
 << '\n';

133 ià(
check
) {

134 
Œy
 {

135 ià(
v”bo£
) {

136 
û¼
 << "check\n";

145 
tmp
 = 
mod–
->
	`Upd©e
(
Œue
);

147 ià(
	`çbs
(
tmp
è> 
MCMC
::
MAXDIFF
) {

148 
û¼
 << "total is wrong\n";

149 
throw
 
	`CheckSumExû±iÚ
(
tmp
);

152 ià(
v”bo£
) {

153 
û¼
 << "check ok\n";

156 
	`ÿtch
(
CheckSumExû±iÚ
 
e
) {

157 
û¼
 << "NON ZERO CHECKSUM. Aá” " << 
Çme
[
i
] << " : " << 
e
.
	`G‘CheckSum
() << '\n';

159 
throw
 
e
;

162 
	}
}

164 
	gMCScheduËr
::
	$RªdomCyşe
(
tunšg_moduÏtÜ
, 
Ä•
, 
boŞ
 
v”bo£
, boŞ 
check
) {

166 ià(! 
şo£d
è
	`Re£t
();

168 
N
 = (è(
Ä•
 * 
tÙ®weight
);

169 
»p
 = 0;„•<
N
;„ep++) {

171 
q
 = 
tÙ®weight
 * 
Rªdom
::
	`UnifÜm
();

172 
tÙ®
 = 
weight
[0];

173 
choo£
 = 0;

174 (
choo£
 < 
size
è&& (
q
 > 
tÙ®
)) {

175 
choo£
++;

176 
tÙ®
 +ğ
weight
[
choo£
];

178 ià(
choo£
 =ğ
size
) {

179 
û¼
 << "error in MCScheduler::RandomCycle: overflow\n";

180 
	`ex™
(1);

182 
	`Move
(
tunšg_moduÏtÜ
, 
choo£
,
v”bo£
,
check
,1);

184 
ncyşe
+=
Ä•
;

185 
	}
}

187 
	gMCScheduËr
::
	$ToSŒ—m
(
o¡»am
& 
os
, o¡»am& 
osd‘a
) {

189 
os
 << '\n';

190 
os
 << "tÙ®‚umb” oàcyşe : " << 
ncyşe
 << '\n';

191 
os
 << "tÙ®im(s) : " << 
tÙ®time
 << '\n';

192 
os
 << "tim³¸cyş(s) : " << 
tÙ®time
 / 
ncyşe
 << '\n';

193 
os
 << '\n';

194 
os
 << "#\t\%time\tsuccess\tname\n";

195 
os
 << '\n';

196 
i
=0; i<
size
; i++) {

198 
os
 << 
i
+1 << '\t' << ((è(è(
time
[i]/ 
tÙ®time
 * 1000)è/ 10 << '\t' << ((è(100 * 
sucûss
[i]/
nÿÎ
[i])è<< '\t' << 
Çme
[i] << '\n';

200 
os
 << '\n';

202 
i
=0; i<
size
; i++)

203 
upd©e
[
i
]->
	`ToSŒ—m
(
osd‘a
);

205 
	}
}

207 
	gR—lVeùÜCompÚ’twi£Com³n§tÜyMove
::
R—lVeùÜCompÚ’twi£Com³n§tÜyMove
(
Rv¬
<
R—lVeùÜ
>* 
ša1
, Rv¬<R—lVeùÜ>* 
ša2
, 
štunšg
è: 
a1
(ša1), 
a2
(ša2), 
	$tunšg
(
štunšg
) {

209 
û¼
 << "error in comp move\n";

210 
û¼
 << "register should behe other way‡round\n";

211 
	`ex™
(1);

213 
	`Regi¡”
(
a1
);

214 
	`Regi¡”
(
a2
);

215 
	}
}

217 
	gR—lVeùÜCompÚ’twi£Com³n§tÜyMove
::
	$Move
(
tunšg_moduÏtÜ
) {

219 
	`CÜru±
(
Œue
);

221 
dim
 = 
a1
->
	`G‘Dim
();

222 
i
=0; i<
dim
; i++) {

223 
h
 = 
tunšg_moduÏtÜ
 * 
tunšg
 * (
Rªdom
::
	`UnifÜm
() - 0.5);

224 (*
a1
)[
i
] +ğ
h
;

225 (*
a2
)[
i
] -ğ
h
;

228 
log¿tio
 = 
	`Upd©e
();

229 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
);

231 ià(! 
acû±ed
) {

232 
	`CÜru±
(
çl£
);

233 
	`Re¡Üe
();

236  (è
acû±ed
;

237 
	}
}

273 
	gR—lVeùÜMove
::
R—lVeùÜMove
(
Rv¬
<
R—lVeùÜ
>* 
šv¬
, 
štunšg
, 
šm
è: 
v¬
(šv¬), 
tunšg
(štunšg), 
	$m
(
šm
è{
	}
}

275 
	gR—lVeùÜMove
::
	$Move
(
tunšg_moduÏtÜ
) {

276 ià(! 
v¬
->
	`isCÏm³d
()) {

277 
v¬
->
	`CÜru±
(
Œue
);

278 
logHa¡šgs
 = 
v¬
->
R—lVeùÜ
::
	`Prİo£Move
(
tunšg
 * 
tunšg_moduÏtÜ
,
m
);

279 
d–LogProb
 = 
v¬
->
	`Upd©e
();

280 
logR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

281 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
logR©io
);

282 ià(! 
acû±ed
) {

283 
v¬
->
	`CÜru±
(
çl£
);

284 
v¬
->
	`Re¡Üe
();

286  (è
acû±ed
;

289 
	}
}

291 
	gR—lVeùÜT¿n¦©iÚMove
::
R—lVeùÜT¿n¦©iÚMove
(
Rv¬
<
R—lVeùÜ
>* 
šv¬
, 
štunšg
è: 
v¬
(šv¬), 
	$tunšg
(
štunšg
è{
	}
}

293 
	gR—lVeùÜT¿n¦©iÚMove
::
	$Move
(
tunšg_moduÏtÜ
) {

294 ià(! 
v¬
->
	`isCÏm³d
()) {

295 
v¬
->
	`CÜru±
(
Œue
);

296 
logHa¡šgs
 = 
v¬
->
R—lVeùÜ
::
	`SÿÏrAdd™iÚ
(
tunšg
 * 
tunšg_moduÏtÜ
);

297 
d–LogProb
 = 
v¬
->
	`Upd©e
();

298 
logR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

299 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
logR©io
);

300 ià(! 
acû±ed
) {

301 
v¬
->
	`CÜru±
(
çl£
);

302 
v¬
->
	`Re¡Üe
();

304  (è
acû±ed
;

307 
	}
}

310 
	gProfeMove
::
ProfeMove
(
Rv¬
<
Profe
>* 
šv¬
, 
štunšg
, 
šn
è: 
v¬
(šv¬), 
tunšg
(štunšg), 
	$n
(
šn
è{
	}
}

312 
	gProfeMove
::
	$Move
(
tunšg_moduÏtÜ
) {

314 ià(! 
v¬
->
	`isCÏm³d
()) {

315 
v¬
->
	`CÜru±
(
Œue
);

316 
logHa¡šgs
 = 
v¬
->
Profe
::
	`Prİo£Move
(
tunšg
 * 
tunšg_moduÏtÜ
, 
n
);

317 
d–LogProb
 = 
v¬
->
	`Upd©e
();

318 
logR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

319 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
logR©io
);

320 ià(! 
acû±ed
) {

321 
v¬
->
	`CÜru±
(
çl£
);

322 
v¬
->
	`Re¡Üe
();

324  (è
acû±ed
;

327 
	}
}

329 
	gMuÉliÿtiveCom³n§tÜyMove
::
	$MuÉliÿtiveCom³n§tÜyMove
(
MuÉliÿtive
* 
šm1
, MuÉliÿtive* 
šm2
, 
štunšg
è: 
	`m1
(šm1), 
	`m2
(šm2), 
	$tunšg
(
štunšg
) {

331 ià(
m1
) {

332 
m1
->
	`Regi¡”
(
this
);

334 ià(
m2
) {

335 
m2
->
	`Regi¡”
(
this
);

337 
	}
}

339 
	gMuÉliÿtiveCom³n§tÜyMove
::
	$Move
(
tunšg_moduÏtÜ
) {

342 
	`CÜru±
(
Œue
);

343 
h
 = 
tunšg_moduÏtÜ
 * 
tunšg
 * (
Rªdom
::
	`UnifÜm
() - 0.5);

344 
e
 = 
	`exp
(
h
);

345 
logha¡šgs
 = 0;

346 ià(
m1
) {

347 
logha¡šgs
 +ğ
h
 * 
m1
->
	`SÿÏrMuÉliÿtiÚ
(
e
);

349 ià(
m2
) {

350 
logha¡šgs
 -ğ
h
 * 
m2
->
	`SÿÏrMuÉliÿtiÚ
(1.0/
e
);

353 
log¿tio
 = 
	`Upd©e
();

354 
log¿tio
 +ğ
logha¡šgs
;

355 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
);

356 ià(! 
acû±ed
) {

357 
	`CÜru±
(
çl£
);

358 
	`Re¡Üe
();

360  (è
acû±ed
;

363 
	}
}

365 
	gJoštSim¶eMove
::
	$JoštSim¶eMove
(
Rnode
* 
ša1
, Rnode* 
ša2
, 
štunšg
è: 
	`a1
(ša1), 
	`a2
(ša2), 
	$tunšg
(
štunšg
) {

367 
a1
->
	`Regi¡”
(
this
);

368 
a2
->
	`Regi¡”
(
this
);

369 
	}
}

371 
	gJoštSim¶eMove
::
	$Move
(
tunšg_moduÏtÜ
) {

373 ià((! 
a1
->
	`isCÏm³d
()è&& (! 
a2
->isClamped())) {

375 
	`CÜru±
(
Œue
);

377 
logHa¡šgs
 = 0;

378 
logHa¡šgs
 +ğ
a1
->
	`Prİo£Move
(
tunšg
*
tunšg_moduÏtÜ
);

379 
logHa¡šgs
 +ğ
a2
->
	`Prİo£Move
(
tunšg
*
tunšg_moduÏtÜ
);

381 
log¿tio
 = 
	`Upd©e
(è+ 
logHa¡šgs
;

382 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
);

384 ià(! 
acû±ed
) {

385 
	`CÜru±
(
çl£
);

386 
	`Re¡Üe
();

389  (è
acû±ed
;

392 
	}
}

394 
	gAdd™iveCom³n§tÜyMove
::
	$Add™iveCom³n§tÜyMove
(
Add™ive
* 
ša1
, Add™ive* 
ša2
, 
štunšg
è: 
	`a1
(ša1), 
	`a2
(ša2), 
	$tunšg
(
štunšg
) {

396 
a1
->
	`Regi¡”
(
this
);

397 
a2
->
	`Regi¡”
(
this
);

398 
	}
}

400 
	gAdd™iveCom³n§tÜyMove
::
	$Move
(
tunšg_moduÏtÜ
) {

404 
	`CÜru±
(
Œue
);

406 
h
 = 
tunšg_moduÏtÜ
 * 
tunšg
 * (
Rªdom
::
	`UnifÜm
() - 0.5);

407 
a1
->
	`SÿÏrAdd™iÚ
(
h
);

408 
a2
->
	`SÿÏrAdd™iÚ
(-
h
);

410 
log¿tio
 = 
	`Upd©e
();

411 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
);

413 ià(! 
acû±ed
) {

414 
	`CÜru±
(
çl£
);

415 
	`Re¡Üe
();

418  (è
acû±ed
;

421 
	}
}

423 
	gAdd™iveAÁiCom³n§tÜyMove
::
	$Add™iveAÁiCom³n§tÜyMove
(
Add™ive
* 
ša1
, Add™ive* 
ša2
, 
štunšg
è: 
	`a1
(ša1), 
	`a2
(ša2), 
	$tunšg
(
štunšg
) {

425 
a1
->
	`Regi¡”
(
this
);

426 
a2
->
	`Regi¡”
(
this
);

427 
	}
}

429 
	gAdd™iveAÁiCom³n§tÜyMove
::
	$Move
(
tunšg_moduÏtÜ
) {

433 
	`CÜru±
(
Œue
);

435 
h
 = 
tunšg_moduÏtÜ
 * 
tunšg
 * (
Rªdom
::
	`UnifÜm
() - 0.5);

437 
a1
->
	`SÿÏrAdd™iÚ
(
h
);

438 
a2
->
	`SÿÏrAdd™iÚ
(
h
);

440 
log¿tio
 = 
	`Upd©e
();

441 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
);

443 ià(! 
acû±ed
) {

444 
	`CÜru±
(
çl£
);

445 
	`Re¡Üe
();

450  (è
acû±ed
;

453 
	}
}

	@Move.h

3 #iâdeà
MOVE_H


4 
	#MOVE_H


	)

6 
	~"MCMC.h
"

7 
	~<veùÜ
>

9 
	~"DAGnode.h
"

10 
	~"RªdomTy³s.h
"

14 
şass
 
	gProbMod–
;

41 şas 
	cMCUpd©e
 {

43 
	mpublic
:

45 
vœtu®
 ~
	$MCUpd©e
() {}

47 
vœtu®
 
	`Move
(
tunšg_moduÏtÜ
 = 1) = 0;

49 
vœtu®
 
	$ToSŒ—m
(
o¡»am
& 
os
è{
	}
}

57 şas 
	cMCScheduËr
 : 
public
 
MCUpd©e
 {

59 
public
:

61 
	$MCScheduËr
(
ProbMod–
* 
šmod–
è: 
	`mod–
(šmod–), 
	`şo£d
(
çl£
è, 
	$¿ndom
(
çl£
) {}

63 
vœtu®
 
	`Cyşe
(
tunšg_moduÏtÜ
, 
Ä•
, 
boŞ
 
v”bo£
, boŞ 
check
);

64 
	`RªdomCyşe
(
tunšg_moduÏtÜ
, 
Ä•
, 
boŞ
 
v”bo£
, boŞ 
check
);

65 
	`Move
(
tunšg_moduÏtÜ
, 
i
, 
boŞ
 
v”bo£
, boŞ 
check
, 
Ä•
);

67 
	$Move
(
tunšg_moduÏtÜ
 = 1) {

68 ià(
¿ndom
) {

69 
	`RªdomCyşe
(
tunšg_moduÏtÜ
,1,
çl£
,false);

72 
	`Cyşe
(
tunšg_moduÏtÜ
,1,
çl£
,false);

75 
	}
}

77 
	$S‘Rªdom
(
boŞ
 
š¿nd
) {

78 
¿ndom
 = 
š¿nd
;

79 
	}
}

80 
Regi¡”
(
MCUpd©e
* 
šupd©e
, 
šweight
 = 1, 
¡ršg
 
šÇme
 = "");

81 
Re£t
();

83 
	$G‘TÙ®Time
(è{ 
tÙ®time
;
	}
}

84 
	$G‘M—nTimeP”Cyşe
(è{ 
ncyşe
 ? 
tÙ®time
 /‚cyş: 0;
	}
}

85 
	$G‘TÙ®CyşeNumb”
(è{ 
ncyşe
;
	}
}

87 
ToSŒ—m
(
o¡»am
& 
os
, o¡»am& 
osd‘a
);

89 
	$O³nLoİ
(
n
) {

90 
o¡ršg¡»am
 
oss
;

91 
oss
 << '(' << 
n
 << ":";

92 
commªd
 +ğ
oss
.
	`¡r
();

93 
	}
}

94 
	$Clo£Loİ
() {

95 
commªd
 += ')';

96 
	}
}

97 
	gveùÜ
<> 
R—dCommªd
(&
n
);

100 
	g´Ùeùed
:

102 
veùÜ
<
MCUpd©e
*> 
upd©e
;

104 
	gveùÜ
<> 
	gweight
;

105 
	gveùÜ
<> 
	gtime
;

106 
	gveùÜ
<> 
	gsucûss
;

107 
	gveùÜ
<
	g¡ršg
> 
	gÇme
;

108 
	gveùÜ
<> 
	gnÿÎ
;

110 
	gtÙ®weight
;

111 
	gtÙ®time
;

112 
	gncyşe
;

113 
	gsize
;

115 
¡ršg
 
	gcommªd
;

117 
ProbMod–
* 
	gmod–
;

119 
boŞ
 
	gşo£d
;

120 
boŞ
 
	g¿ndom
;

128 şas 
	cSim¶eMove
 : 
public
 
MCUpd©e
 {

130 
public
:

132 
	$Sim¶eMove
(
MCMC
* 
šv¬
, 
štunšg
è: 
	`v¬
(šv¬), 
	$tunšg
(
štunšg
) {}

134 
	$Move
(
tunšg_moduÏtÜ
 = 1) {

135  
v¬
->
	`Move
(
tunšg
 * 
tunšg_moduÏtÜ
);

136 
	}
}

138 
	g´Ùeùed
:

140 
MCMC
* 
v¬
;

141 
	gtunšg
;

145 
şass
 
	gJoštSim¶eMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

147 
	gpublic
:

149 
JoštSim¶eMove
(
Rnode
* 
ša1
, Rnode* 
ša2
, 
štunšg
);

151 
Move
(
tunšg_moduÏtÜ
 = 1);

153 
	g´iv©e
:

155 
Rnode
* 
a1
;

156 
Rnode
* 
	ga2
;

157 
	gtunšg
;

161 
	g‹m¶©e
 <
şass
 
	gP
, cÏs 
	gS
> cÏs 
	cSemiCÚjug©eMove
 : 
public
 
MCUpd©e
 {

163 
public
:

165 
	$SemiCÚjug©eMove
(
P
* 
š´iÜ
, 
S
* 
š§m¶šg
, 
štunšg´iÜ
, 
šÅriÜ
, 
štunšg§m¶šg
, 
šn§m¶šg
è: 
	`´iÜ
(š´iÜ), 
	`§m¶šg
(š§m¶šg), 
	`tunšg´iÜ
(štunšg´iÜ), 
	`ÅriÜ
(šÅriÜ), 
	`tunšg§m¶šg
(štunšg§m¶šg), 
	$n§m¶šg
(
šn§m¶šg
) {}

167 
	$Move
(
tunšg_moduÏtÜ
 = 1) {

168 
´iÜ
->
	`Aùiv©eSuffic›ÁSti¡ic
();

169 
tÙ®
 = 0;

170 
i
=0; i<
ÅriÜ
; i++) {

171 
tÙ®
 +ğ
´iÜ
->
	`Move
(
tunšg´iÜ
 * 
tunšg_moduÏtÜ
);

173 
i
=0; i<
n§m¶šg
; i++) {

174 
tÙ®
 +ğ
§m¶šg
->
	`Move
(
tunšg§m¶šg
 * 
tunšg_moduÏtÜ
);

176 
tÙ®
 /ğ
n§m¶šg
 + 
ÅriÜ
;

177 
´iÜ
->
	`IÇùiv©eSuffic›ÁSti¡ic
();

178  
tÙ®
;

179 
	}
}

181 
	g´Ùeùed
:

183 
P
* 
´iÜ
;

184 
S
* 
	g§m¶šg
;

185 
	gtunšg´iÜ
;

186 
	gÅriÜ
;

187 
	gtunšg§m¶šg
;

188 
	gn§m¶šg
;

191 
	g‹m¶©e
 <
şass
 
	gP
, cÏs 
	gS
> cÏs 
	cCÚjug©eMove
 : 
public
 
MCUpd©e
 {

193 
public
:

195 
	$CÚjug©eMove
(
P
* 
š´iÜ
, 
S
* 
š§m¶šg
, 
štunšg
, 
šn
è: 
	`´iÜ
(š´iÜ), 
	`§m¶šg
(š§m¶šg), 
	`tunšg
(štunšg), 
	$n
(
šn
) {}

197 
	$Move
(
tunšg_moduÏtÜ
 = 1) {

198 
´iÜ
->
	`IÁeg¿‹
();

199 
tÙ®
 = 0;

200 
i
=0; i<
n
; i++) {

201 
tÙ®
 +ğ
§m¶šg
->
	`Move
(
tunšg
 * 
tunšg_moduÏtÜ
);

203 
tÙ®
 /ğ
n
;

204 
´iÜ
->
	`Re§m¶e
();

205  
tÙ®
;

206 
	}
}

208 
	g´Ùeùed
:

210 
P
* 
´iÜ
;

211 
S
* 
	g§m¶šg
;

212 
	gtunšg
;

213 
	gn
;

218 
şass
 
	gMuÉliÿtiveCom³n§tÜyMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

220 
	gpublic
:

222 
MuÉliÿtiveCom³n§tÜyMove
(
MuÉliÿtive
* 
šm1
, MuÉliÿtive* 
šm2
, 
štunšg
);

224 
Move
(
tunšg_moduÏtÜ
 = 1);

226 
	g´iv©e
:

228 
MuÉliÿtive
* 
m1
;

229 
MuÉliÿtive
* 
	gm2
;

230 
	gtunšg
;

235 
şass
 
	gAdd™iveCom³n§tÜyMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

237 
	gpublic
:

239 
Add™iveCom³n§tÜyMove
(
Add™ive
* 
ša1
, Add™ive* 
ša2
, 
štunšg
);

241 
Move
(
tunšg_moduÏtÜ
 = 1);

243 
	g´iv©e
:

245 
Add™ive
* 
a1
;

246 
Add™ive
* 
	ga2
;

247 
	gtunšg
;

252 
şass
 
	gAdd™iveAÁiCom³n§tÜyMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

254 
	gpublic
:

256 
Add™iveAÁiCom³n§tÜyMove
(
Add™ive
* 
ša1
, Add™ive* 
ša2
, 
štunšg
);

258 
Move
(
tunšg_moduÏtÜ
 = 1);

260 
	g´iv©e
:

262 
Add™ive
* 
a1
;

263 
Add™ive
* 
	ga2
;

264 
	gtunšg
;

268 şas 
	cR—lVeùÜMove
 : 
public
 
MCUpd©e
 {

270 
public
:

272 
R—lVeùÜMove
(
Rv¬
<
R—lVeùÜ
>* 
šv¬
, 
štunšg
, 
šm
);

274 
Move
(
tunšg_moduÏtÜ
 = 1);

276 
	m´iv©e
:

278 
Rv¬
<
R—lVeùÜ
>* 
v¬
;

279 
	mtunšg
;

280 
	mm
;

283 şas 
	cR—lVeùÜT¿n¦©iÚMove
 : 
public
 
MCUpd©e
 {

285 
public
:

287 
R—lVeùÜT¿n¦©iÚMove
(
Rv¬
<
R—lVeùÜ
>* 
šv¬
, 
štunšg
);

289 
Move
(
tunšg_moduÏtÜ
 = 1);

291 
	m´iv©e
:

293 
Rv¬
<
R—lVeùÜ
>* 
v¬
;

294 
	mtunšg
;

297 
şass
 
	gR—lVeùÜCompÚ’twi£Com³n§tÜyMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

299 
	gpublic
:

301 
R—lVeùÜCompÚ’twi£Com³n§tÜyMove
(
Rv¬
<
R—lVeùÜ
>* 
ša1
, Rv¬<R—lVeùÜ>* 
ša2
, 
štunšg
);

303 
Move
(
tunšg_moduÏtÜ
 = 1);

305 
	g´iv©e
 :

307 
Rv¬
<
R—lVeùÜ
>* 
a1
;

308 
	gRv¬
<
	gR—lVeùÜ
>* 
	ga2
;

309 
	gtunšg
;

332 şas 
	cProfeMove
 : 
public
 
MCUpd©e
 {

334 
public
:

336 
ProfeMove
(
Rv¬
<
Profe
>* 
šv¬
, 
štunšg
, 
šn
);

338 
Move
(
tunšg_moduÏtÜ
 = 1);

340 
	m´iv©e
:

342 
Rv¬
<
Profe
>* 
v¬
;

343 
	mtunšg
;

344 
	mn
;

	@MultiVariateTreeProcess.h

1 #iâdeà
MULTIVARIATETREEPROCESS


2 
	#MULTIVARIATETREEPROCESS


	)

4 
	~"Inv”£Wish¬tM©rix.h
"

5 
	~"V®T»e.h
"

6 
	~"CÚtšuousD©a.h
"

7 
	~"Anû¡¿lD©a.h
"

8 
	~"M©rixAlgeb¿.h
"

12 
şass
 
	gMuÉiV¬Ÿ‹T»eProûss
 : 
public
 
MCMC
 ,…ubliø
	gNodeV®PŒT»e
<
	gRv¬
<
	gR—lVeùÜ
> > {

14 
	g´Ùeùed
:

16 
V¬
<
CovM©rix
>* 
sigma
;

17 
L’gthT»e
* 
	gŒ“
;

18 
L’gthT»e
* 
	gsÿËŒ“
;

19 
	gV¬
<
	gR—lVeùÜ
>* 
	gdriá
;

20 
	gV¬
<
	gR—lVeùÜ
>* 
	groÙm—n
;

21 
	gV¬
<
	gPosR—lVeùÜ
>* 
	groÙv¬
;

23 
	gV¬
<
	gPosR—l
>* 
	gagesÿË
;

24 
	gNodeB¿nchV¬T»e
<
	gPosR—l
,PosR—l>* 
	gchrÚo
;

25 
Glob®SÿlšgFunùiÚ
* 
	gsÿËfunùiÚ
;

27 
	gpublic
:

30 
MuÉiV¬Ÿ‹T»eProûss
() {

31 
sÿËŒ“
 = 0;

32 
	gdriá
 = 0;

33 
	gsÿËfunùiÚ
 = 0;

37 
MuÉiV¬Ÿ‹T»eProûss
(
V¬
<
CovM©rix
>* 
šsigma
, 
L’gthT»e
* 
šŒ“
, L’gthT»e* 
šsÿËŒ“
 = 0, V¬<
R—lVeùÜ
>* 
šdriá
 = 0, V¬<R—lVeùÜ>* 
šroÙm—n
 = 0, V¬<
PosR—lVeùÜ
>* 
šroÙv¬
 = 0){

38 
sigma
 = 
šsigma
;

39 
	gŒ“
 = 
šŒ“
;

40 
	gsÿËŒ“
 = 
šsÿËŒ“
;

41 
	gdriá
 = 
šdriá
;

42 
	groÙm—n
 = 
šroÙm—n
;

43 
	groÙv¬
 = 
šroÙv¬
;

44 
	gsÿËfunùiÚ
 = 0;

45 
RecursiveC»©e
(
G‘RoÙ
());

48 
MuÉiV¬Ÿ‹T»eProûss
(
V¬
<
CovM©rix
>* 
šsigma
, 
NodeB¿nchV¬T»e
<
PosR—l
,PosR—l>* 
šchrÚo
, V¬<PosR—l>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
, V¬<
R—lVeùÜ
>* 
šroÙm—n
 = 0, V¬<
PosR—lVeùÜ
>* 
šroÙv¬
 = 0){

49 
sigma
 = 
šsigma
;

50 
	gŒ“
 = 
šchrÚo
;

51 
	gchrÚo
 = 
šchrÚo
;

52 
	gsÿËŒ“
 = 0;

53 
	gdriá
 = 0;

54 
	groÙm—n
 = 
šroÙm—n
;

55 
	groÙv¬
 = 
šroÙv¬
;

56 
	gsÿËfunùiÚ
 = 
šsÿËfunùiÚ
;

57 
	gagesÿË
 = 
šagesÿË
;

58 
RecursiveC»©e
(
G‘RoÙ
());

61 ~
MuÉiV¬Ÿ‹T»eProûss
(){

62 
RecursiveD–‘e
(
G‘RoÙ
());

66 
T»e
* 
G‘T»e
(){

67  
	gŒ“
->
G‘T»e
();

70 
L’gthT»e
* 
G‘L’gthT»e
(){

71  
	gŒ“
;

74 
G‘B¿nchL’gth
(cÚ¡ 
B¿nch
* 
b¿nch
) {

75 ià(! 
	gb¿nch
) {

78  
	gŒ“
->
G‘B¿nchV®
(
b¿nch
)->
v®
();

81 
S‘Bounds
(cÚ¡ 
BoundS‘
& 
šbound£t
, 
off£t
) {

82 
	gm­
<cÚ¡ 
	gNode
*,
	gBoundFÜMuÉiNÜm®
>::
cÚ¡_™”©Ü
 
i
 = 
šbound£t
.
G‘NodeM­
().
begš
(); 
	gi
!=šbound£t.G‘NodeM­().
’d
(); i++) {

83 
G‘MuÉiNÜm®
(
i
->
fœ¡
)->
S‘Bound
(i->
£cÚd
,
off£t
);

85 
BoundCutOff
();

88 
MuÉiNÜm®
* 
G‘MuÉiNÜm®
(cÚ¡ 
Lšk
* 
lšk
) {

89 
MuÉiNÜm®
* 
	gm
 = 
dyÇmic_ÿ¡
<MuÉiNÜm®*> (
G‘NodeV®
(
lšk
->
G‘Node
()));

90  
	gm
;

93 
MuÉiNÜm®
* 
G‘MuÉiNÜm®
(cÚ¡ 
Node
* 
node
) {

94 
MuÉiNÜm®
* 
	gm
 = 
dyÇmic_ÿ¡
<MuÉiNÜm®*> (
G‘NodeV®
(
node
));

95  
	gm
;

98 
G‘ExpV®
(cÚ¡ 
Lšk
* 
lšk
, 
šdex
) {

99  
exp
((*
G‘NodeV®
(
lšk
->
G‘Node
()))[
šdex
]);

102 
G‘V®
(cÚ¡ 
Lšk
* 
lšk
, 
šdex
) {

103  (*
G‘NodeV®
(
lšk
->
G‘Node
()))[
šdex
];

106 
vœtu®
 
G‘Dim
(){

107  
	gsigma
->
G‘Dim
();

111 
d¿wSam¶e
() {

112 
Recursived¿wSam¶e
(
this
->
G‘RoÙ
());

115 
G‘Nnode
() {

116  
G‘T»e
()->
G‘Nnode
();

119 
G‘Nš‹º®Node
() {

120  
G‘T»e
()->
G‘Nš‹º®Node
();

123 
Regi¡”Node
(
DAGnode
* 
node
) {

124 
RecursiveRegi¡”
(
node
,
G‘RoÙ
());

127 * 
G‘NodeV®s
(* 
±r
) {

128  
G‘NodeV®s
(
G‘RoÙ
(),
±r
);

131 * 
G‘NodeV®s
(cÚ¡ 
Lšk
* 
äom
, * 
±r
) {

132 
	gi
=0; i<
G‘Dim
(); i++) {

133 *
	g±r
 = 
G‘NodeV®
(
äom
->
G‘Node
())->
v®
()[
i
];

134 
	g±r
++;

136 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

137 
±r
 = 
G‘NodeV®s
(
lšk
->
Out
(),…tr);

139  
	g±r
;

142 * 
S‘NodeV®s
(* 
±r
) {

143  
S‘NodeV®s
(
G‘RoÙ
(),
±r
);

146 * 
S‘NodeV®s
(cÚ¡ 
Lšk
* 
äom
, * 
±r
) {

147 
	gi
=0; i<
G‘Dim
(); i++) {

148 
G‘NodeV®
(
äom
->
G‘Node
())->
v®
()[
i
] = *
±r
;

149 
	g±r
++;

151 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

152 
±r
 = 
S‘NodeV®s
(
lšk
->
Out
(),…tr);

154  
	g±r
;

157 
G‘Mš
(
šdex
) {

158 
	gcu¼’t
 = (*
G‘NodeV®
(
G‘RoÙ
()->
G‘Node
()))[
šdex
];

159 
	gmš
 = 
RecursiveG‘Mš
(
G‘RoÙ
(),
šdex
,
cu¼’t
);

160  
	gmš
;

163 
RecursiveG‘Mš
(cÚ¡ 
Lšk
* 
äom
, 
šdex
, 
cu¼’t
) {

164 
	gtmp
 = (*
G‘NodeV®
(
äom
->
G‘Node
()))[
šdex
];

165 ià(
	gcu¼’t
 > 
	gtmp
) {

166 
	gcu¼’t
 = 
tmp
;

168 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

169 
tmp
 = 
RecursiveG‘Mš
(
lšk
->
Out
(),
šdex
,
cu¼’t
);

170 ià(
	gcu¼’t
 > 
	gtmp
) {

171 
	gcu¼’t
 = 
tmp
;

174  
	gcu¼’t
;

177 
G‘Max
(
šdex
) {

178 
	gcu¼’t
 = (*
G‘NodeV®
(
G‘RoÙ
()->
G‘Node
()))[
šdex
];

179 
	gmax
 = 
RecursiveG‘Max
(
G‘RoÙ
(),
šdex
,
cu¼’t
);

180  
	gmax
;

183 
RecursiveG‘Max
(cÚ¡ 
Lšk
* 
äom
, 
šdex
, 
cu¼’t
) {

184 
	gtmp
 = (*
G‘NodeV®
(
äom
->
G‘Node
()))[
šdex
];

185 ià(
	gcu¼’t
 < 
	gtmp
) {

186 
	gcu¼’t
 = 
tmp
;

188 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

189 
tmp
 = 
RecursiveG‘Max
(
lšk
->
Out
(),
šdex
,
cu¼’t
);

190 ià(
	gcu¼’t
 < 
	gtmp
) {

191 
	gcu¼’t
 = 
tmp
;

194  
	gcu¼’t
;

197 
G‘EmpœiÿlCov¬Ÿnû
(** 
cov
) {

199 
	gi
=0; i<
G‘Dim
(); i++) {

200 
	gj
=0; j<
G‘Dim
(); j++) {

201 
	gcov
[
i
][
j
] =0;

204 
	gn
 = 0;

205 
RecursiveG‘EmpœiÿlCov¬Ÿnû
(
G‘RoÙ
(),
cov
,
n
);

206 
	gi
=0; i<
G‘Dim
(); i++) {

207 
	gj
=0; j<
G‘Dim
(); j++) {

208 
	gcov
[
i
][
j
] /ğ
n
;

213 
RecursiveG‘EmpœiÿlCov¬Ÿnû
(cÚ¡ 
Lšk
* 
äom
, ** 
cov
, & 
n
) {

214 ià(! 
	gäom
->
isRoÙ
()) {

215 
	g‹mp
[
G‘Dim
()];

216 
	gi
=0; i<
G‘Dim
(); i++) {

217 
	g‹mp
[
i
] = ((*
G‘NodeV®
(
äom
->
G‘Node
()))[i] - (*G‘NodeV®(äom->
Out
()->G‘Node()))[i]è/ 
sq¹
(
G‘B¿nchL’gth
(äom->
G‘B¿nch
()));

218 
	gi
=0; i<
G‘Dim
(); i++) {

219 
	gj
=0; j<
G‘Dim
(); j++) {

220 
	gcov
[
i
][
j
] +ğ
‹mp
[i] *emp[j];

224 
	gn
++;

226 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

227 
RecursiveG‘EmpœiÿlCov¬Ÿnû
(
lšk
->
Out
(),
cov
,
n
);

231 
Sam¶eFixRoÙ
() {

232 
RecursiveSam¶eFixRoÙ
(
this
->
G‘RoÙ
());

235 
CÏmpL—ves
(
šdex
) {

236 
RecursiveCÏmpL—ves
(
G‘RoÙ
(),
šdex
);

239 
RecursiveCÏmpL—ves
(cÚ¡ 
Lšk
* 
äom
, 
šdex
) {

240 ià(
	gäom
->
isL—f
()) {

241 
MuÉiNÜm®
* 
	gm
 = 
G‘MuÉiNÜm®
(
äom
);

242 
	gm
->
CÏmp
(
šdex
);

245 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

246 
RecursiveCÏmpL—ves
(
lšk
->
Out
(),
šdex
);

251 
CÏmpT¿nsv”§l
(
šdex
, 
d
) {

252 
RecursiveCÏmpT¿nsv”§l
(
G‘RoÙ
(),
šdex
,
d
);

255 
RecursiveCÏmpT¿nsv”§l
(cÚ¡ 
Lšk
* 
äom
, 
šdex
, 
d
) {

256 
MuÉiNÜm®
* 
	gm
 = 
G‘MuÉiNÜm®
(
äom
);

257 (*
	gm
)[
šdex
] = 
d
;

258 
	gm
->
CÏmp
(
šdex
);

259 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

260 
RecursiveCÏmpT¿nsv”§l
(
lšk
->
Out
(),
šdex
,
d
);

264 
BoundCutOff
() {

265 
RecursiveBoundCutOff
(
G‘RoÙ
());

268 
RecursiveBoundCutOff
(cÚ¡ 
Lšk
* 
äom
) {

269 
G‘MuÉiNÜm®
(
äom
)->
CheckBounds
();

270 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

271 
RecursiveBoundCutOff
(
lšk
->
Out
());

275 
Low”CutOff
(
cutoff
, 
šdex
) {

276 
RecursiveLow”CutOff
(
G‘RoÙ
(),
cutoff
,
šdex
);

279 
RecursiveLow”CutOff
(cÚ¡ 
Lšk
* 
äom
, 
cutoff
, 
šdex
) {

280 ià((! 
G‘MuÉiNÜm®
(
äom
)->
	gCÏmpVeùÜ
[
šdex
]è&& ((*
G‘NodeV®
(äom->
G‘Node
()))[šdex] < 
	gcutoff
)) {

281 (*
G‘NodeV®
(
äom
->
G‘Node
()))[
šdex
] = 
cutoff
;

283 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

284 
RecursiveLow”CutOff
(
lšk
->
Out
(),
cutoff
,
šdex
);

288 
CutOff
(
cutoff
, 
šdex
) {

289 
RecursiveCutOff
(
G‘RoÙ
(),
cutoff
,
šdex
);

292 
RecursiveCutOff
(cÚ¡ 
Lšk
* 
äom
, 
cutoff
, 
šdex
) {

293 ià((! 
G‘MuÉiNÜm®
(
äom
)->
	gCÏmpVeùÜ
[
šdex
]è&& (
çbs
((*
G‘NodeV®
(äom->
G‘Node
()))[šdex]è> 
	gcutoff
)) {

294 (*
G‘NodeV®
(
äom
->
G‘Node
()))[
šdex
] = 
cutoff
;

296 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

297 
RecursiveCutOff
(
lšk
->
Out
(),
cutoff
,
šdex
);

301 
G‘L—fD©a
(
CÚtšuousD©a
* 
d©a
, 
off£t
) {

302 
RecursiveG‘L—fD©a
(
G‘RoÙ
(),
d©a
,
off£t
);

305 
RecursiveG‘L—fD©a
(cÚ¡ 
Lšk
* 
äom
, 
CÚtšuousD©a
* 
d©a
, 
off£t
) {

306 ià(
	gäom
->
isL—f
()) {

307 
	gi
=0; i<
	gd©a
->
G‘Ns™e
(); i++) {

308 ià(
	gd©a
->
	gD©a
[
d©a
->
G‘TaxÚS‘
()->
G‘TaxÚIndex
(
äom
->
G‘Node
()->
G‘Name
())][
i
] != -1) {

309 
d©a
->
D©a
[d©a->
G‘TaxÚS‘
()->
G‘TaxÚIndex
(
äom
->
G‘Node
()->
G‘Name
())][
i
] = 
exp
(
G‘V®
(äom,i+
off£t
));

313 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

314 
RecursiveG‘L—fD©a
(
lšk
->
Out
(),
d©a
,
off£t
);

318 
G‘AncD©a
(
Anû¡¿lD©a
* 
d©a
, 
off£t
) {

319 
RecursiveG‘AncD©a
(
G‘RoÙ
(),
d©a
,
off£t
);

322 
RecursiveG‘AncD©a
(cÚ¡ 
Lšk
* 
äom
, 
Anû¡¿lD©a
* 
d©a
, 
off£t
) {

323 ià(
	gd©a
->
Exi¡s
(
äom
)) {

324 
	gi
=0; i<
	gd©a
->
G‘Ns™e
(); i++) {

325 
	gpos
 = 
i
+
off£t
;

326 
	gtmp
 = 
G‘MuÉiNÜm®
(
äom
)->
v®
()[
pos
];

327 ià(
	gd©a
->
G‘S‹
(
äom
,
i
) != -1) {

328 
d©a
->
S‘S‹
(
äom
, 
i
, 
exp
(
tmp
));

333 
	gû¼
 << "did‚Ù fšd : " << 
G‘T»e
()->
G‘LeáMo¡
(
äom
è<< '\t' << G‘T»e()->
G‘RightMo¡
(from) << '\n';

334 
ex™
(1);

336 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

337 
RecursiveG‘AncD©a
(
lšk
->
Out
(),
d©a
,
off£t
);

341 
P›ûwi£T¿n¦©iÚMove
(
tunšg
, 
šdex
, 
k
){

342 
	gn
 = 0;

343 
	gtÙ
 = 
RecursiveP›ûwi£T¿n¦©iÚMove
(
this
->
G‘RoÙ
(),
tunšg
,
šdex
,
k
,
n
);

344  
	gtÙ
 / 
	gn
;

347 
P›ûwi£T¿n¦©iÚ
(
u
, 
šdex
, 
k
){

348  
RecursiveP›ûwi£T¿n¦©iÚ
(
this
->
G‘RoÙ
(),
u
,
šdex
,
k
);

351 
RecursiveP›ûwi£T¿n¦©iÚ
(cÚ¡ 
Lšk
* 
äom
, 
u
, 
šdex
, 
k
) {

352 
	gtÙ®
 = 
G‘MuÉiNÜm®
(
äom
)->
P›ûwi£T¿n¦©iÚ
(
u
, 
šdex
, 
k
);

353 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

354 
tÙ®
 +ğ
RecursiveP›ûwi£T¿n¦©iÚ
(
lšk
->
Out
(),
u
,
šdex
,
k
);

356  
	gtÙ®
;

359 
RoÙNeighbÜP›ûwi£T¿n¦©iÚ
(
u
, 
šdex
, 
k
) {

360 cÚ¡ 
Lšk
* 
	gäom
 = 
G‘RoÙ
();

361 
G‘MuÉiNÜm®
(
äom
)->
P›ûwi£T¿n¦©iÚ
(
u
, 
šdex
, 
k
);

362 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

363 
G‘MuÉiNÜm®
(
lšk
->
Out
())->
P›ûwi£T¿n¦©iÚ
(
u
, 
šdex
, 
k
);

367 
Move
(
tunšg
){

368 
	gn
 = 0;

369 
	gtÙ
 = 
RecursiveMove
(
this
->
G‘RoÙ
(),
tunšg
,
n
);

370  
	gtÙ
 / 
	gn
;

373 
Segm’tMove
(
tunšg
, 
imš
, 
size
){

374 
	gn
 = 0;

375 
	gtÙ
 = 
RecursiveSegm’tMove
(
this
->
G‘RoÙ
(),
tunšg
,
imš
,
size
,
n
);

376  
	gtÙ
 / 
	gn
;

379 
G‘LogProb
() {

380  
RecursiveG‘LogProb
(
this
->
G‘RoÙ
());

384 
G‘M—n
(
šdex
) {

385 
	gn
 = 0;

386 
	gtmp
 = 
RecursiveG‘M—n
(
G‘RoÙ
(),
šdex
,
n
);

387  
	gtmp
 / 
	gn
;

390 
G‘L—fM—n
(
šdex
) {

391 
	gn
 = 0;

392 
	gtmp
 = 
RecursiveG‘L—fM—n
(
G‘RoÙ
(),
šdex
,
n
);

393  
	gtmp
 / 
	gn
;

396 
G‘M—nExp
(
šdex
) {

397 
	gn
 = 0;

398 
	gtmp
 = 
RecursiveG‘M—nExp
(
G‘RoÙ
(),
šdex
,
n
);

399  
	gtmp
 / 
	gn
;

404 
S‘AndCÏmp
(
CÚtšuousD©a
* 
d©a
, 
pos
, 
šdex
 = 0, 
ty³
 = 0){

405 
k
 = 0;

406 
	gn
 = 0;

407 
RecursiveS‘AndCÏmp
(
G‘RoÙ
(), 
d©a
, 
pos
, 
šdex
, 
ty³
, 
k
, 
n
);

408 
	gû¼
 << 
	gd©a
->
G‘Ch¬aù”Name
(
šdex
è<< " : " << 
	gn
-
	gk
 << " out of " <<‚ << " missing\n";

411 
S‘AndCÏmp
(
Anû¡¿lD©a
* 
d©a
, 
off£t
 = 0, 
ty³
 = 0){

412 
RecursiveS‘AndCÏmp
(
G‘RoÙ
(), 
d©a
, 
off£t
, 
ty³
);

415 
S‘L—fS‹s
(
NÜm®
*** 
Ëaf¡©es
, 
CÚtšuousD©a
* 
d©a
, 
V¬
<
PosR—l
>* 
v¬Ÿnû
, 
pos
, 
šdex
=0, 
ty³
 = 0){

416 
RecursiveS‘L—fS‹s
(
G‘RoÙ
(), 
Ëaf¡©es
, 
d©a
, 
v¬Ÿnû
, 
pos
, 
šdex
, 
ty³
);

419 
CÏmpRoÙ
() {

420 
G‘NodeV®
(
G‘RoÙ
()->
G‘Node
())->
S‘AtZ”o
();

421 
G‘NodeV®
(
G‘RoÙ
()->
G‘Node
())->
CÏmp
();

424 
CÏmpAÎ
() {

425 
RecursiveCÏmpAÎ
(
G‘RoÙ
());

428 
RecursiveCÏmpAÎ
(cÚ¡ 
Lšk
* 
äom
) {

429 
G‘NodeV®
(
äom
->
G‘Node
())->
CÏmp
();

430 
	gi
=0; i<
G‘Dim
(); i++) {

431 
G‘MuÉiNÜm®
(
äom
->
G‘Node
())->
CÏmp
(
i
);

434 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

435 
RecursiveCÏmpAÎ
(
lšk
->
Out
());

439 
¡ršg
 
CÚ¡ruù
(){

440  
RecursiveCÚ¡ruù
(
G‘RoÙ
());

443 
Re£t
() {

444 
RecursiveRe£t
(
G‘RoÙ
());

447 
Add
(
MuÉiV¬Ÿ‹T»eProûss
* 
š´oûss
) {

448 
RecursiveAdd
(
š´oûss
,
G‘RoÙ
());

451 
SÿÏrMuÉliÿtiÚ
(
šsÿl
) {

452 
RecursiveSÿÏrMuÉliÿtiÚ
(
šsÿl
,
G‘RoÙ
());

455 
RecursiveRegi¡”
(
DAGnode
* 
node
, cÚ¡ 
Lšk
* 
äom
) {

456 
G‘MuÉiNÜm®
(
äom
)->
Regi¡”
(
node
);

457 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

458 
RecursiveRegi¡”
(
node
,
lšk
->
Out
());

462 
RecursiveD”egi¡”
(
DAGnode
* 
node
, cÚ¡ 
Lšk
* 
äom
) {

463 
G‘MuÉiNÜm®
(
äom
)->
D”egi¡”From
(
node
);

464 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

465 
RecursiveD”egi¡”
(
node
,
lšk
->
Out
());

469 
CheckId’t™y
() {

470 
CheckId’t™y
(
G‘RoÙ
());

473 
CheckId’t™y
(cÚ¡ 
Lšk
* 
äom
) {

474 ià(!
G‘MuÉiNÜm®
(
äom
)->
CheckId’t™y
()) {

475 ià(
	gäom
->
Out
()->
isL—f
()) {

476 
	gû¼
 << "link out is†eaf\n";

478 ià(
	gäom
->
isRoÙ
()) {

479 
	gû¼
 << "link is„oot\n";

481 
ex™
(1);

483 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

484 
CheckId’t™y
(
lšk
->
Out
());

489 
Unşamp
(
šdex
) {

490 
RecursiveUnşamp
(
G‘RoÙ
(),
šdex
);

493 
ML
(
šdex
) {

494 
MLBackw¬d
(
G‘RoÙ
(),
šdex
);

495 
MLFÜw¬d
(
G‘RoÙ
(),0,
šdex
);

498 
	g´Ùeùed
 :

500 
Recursived¿wSam¶e
(cÚ¡ 
Lšk
* 
äom
) {

501 
G‘MuÉiNÜm®
(
äom
)->
Sam¶e
();

502 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

503 
Recursived¿wSam¶e
(
lšk
->
Out
());

507 
RecursiveSam¶eFixRoÙ
(cÚ¡ 
Lšk
* 
äom
) {

508 ià(! 
	gäom
->
isRoÙ
()) {

509 
G‘MuÉiNÜm®
(
äom
)->
d¿wSam¶eUnşam³d
();

511 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

512 
RecursiveSam¶eFixRoÙ
(
lšk
->
Out
());

516 
RecursiveRe£t
(cÚ¡ 
Lšk
* 
äom
) {

517 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

518 
RecursiveRe£t
(
lšk
->
Out
());

520 
G‘MuÉiNÜm®
(
äom
)->
S‘AtZ”o
();

523 
RecursiveAdd
(
MuÉiV¬Ÿ‹T»eProûss
* 
š´oûss
, cÚ¡ 
Lšk
* 
äom
) {

524 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

525 
RecursiveAdd
(
š´oûss
,
lšk
->
Out
());

527 
G‘MuÉiNÜm®
(
äom
)->
Add
(*(
š´oûss
->GetMultiNormal(from)));

530 
RecursiveSÿÏrMuÉliÿtiÚ
(
šsÿl
, cÚ¡ 
Lšk
* 
äom
) {

531 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

532 
RecursiveSÿÏrMuÉliÿtiÚ
(
šsÿl
,
lšk
->
Out
());

534 
G‘MuÉiNÜm®
(
äom
)->
SÿÏrMuÉliÿtiÚ
(
šsÿl
);

537 
RecursiveMove
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
, & 
couÁ
) {

538 
	gtÙ®
 = 
G‘MuÉiNÜm®
(
äom
)->
Move
(
tunšg
);

539 
	gcouÁ
++;

540 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

541 
tÙ®
 +ğ
RecursiveMove
(
lšk
->
Out
(),
tunšg
,
couÁ
);

543  
	gtÙ®
;

546 
RecursiveSegm’tMove
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
, 
imš
, 
size
, & 
couÁ
) {

547 
	gtÙ®
 = 
G‘MuÉiNÜm®
(
äom
)->
Segm’tMove
(
tunšg
,
imš
,
size
);

548 
	gcouÁ
++;

549 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

550 
tÙ®
 +ğ
RecursiveSegm’tMove
(
lšk
->
Out
(),
tunšg
,
imš
,
size
,
couÁ
);

552  
	gtÙ®
;

555 
RecursiveP›ûwi£T¿n¦©iÚMove
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
, 
šdex
, 
k
, & 
couÁ
) {

556 
	gtÙ®
 = 
G‘MuÉiNÜm®
(
äom
)->
P›ûwi£T¿n¦©iÚMove
(
tunšg
, 
šdex
, 
k
);

557 
	gcouÁ
++;

558 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

559 
tÙ®
 +ğ
RecursiveP›ûwi£T¿n¦©iÚMove
(
lšk
->
Out
(),
tunšg
,
šdex
,
k
,
couÁ
);

561  
	gtÙ®
;

564 
RecursiveG‘LogProb
(cÚ¡ 
Lšk
* 
äom
) {

565 
	gtÙ®
 = 
G‘MuÉiNÜm®
(
äom
)->
G‘LogProb
();

566 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

567 
tÙ®
 +ğ
RecursiveG‘LogProb
(
lšk
->
Out
());

569  
	gtÙ®
;

572 
RecursiveG‘M—n
(cÚ¡ 
Lšk
* 
äom
, 
šdex
, & 
tÙ
) {

573 
	gtÙ®
 = (*
G‘MuÉiNÜm®
(
äom
))[
šdex
];

574 
	gtÙ
++;

575 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

576 
tÙ®
 +ğ
RecursiveG‘M—n
(
lšk
->
Out
(), 
šdex
, 
tÙ
);

578  
	gtÙ®
;

581 
RecursiveG‘L—fM—n
(cÚ¡ 
Lšk
* 
äom
, 
šdex
, & 
tÙ
) {

582 
	gtÙ®
 = 0;

583 ià(
	gäom
->
isL—f
()) {

584 
	gtÙ®
 +ğ(*
G‘MuÉiNÜm®
(
äom
))[
šdex
];

585 
	gtÙ
++;

587 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

588 
tÙ®
 +ğ
RecursiveG‘L—fM—n
(
lšk
->
Out
(), 
šdex
, 
tÙ
);

590  
	gtÙ®
;

593 
RecursiveG‘M—nExp
(cÚ¡ 
Lšk
* 
äom
, 
šdex
, & 
tÙ
) {

594 
	gtÙ®
 = 
exp
((*
G‘MuÉiNÜm®
(
äom
))[
šdex
]);

595 
	gtÙ
++;

596 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

597 
tÙ®
 +ğ
RecursiveG‘M—nExp
(
lšk
->
Out
(), 
šdex
, 
tÙ
);

599  
	gtÙ®
;

603 
RecursiveUnşamp
(cÚ¡ 
Lšk
* 
äom
, 
šdex
){

604 ià(
	gäom
->
isL—f
()) {

605 
G‘MuÉiNÜm®
(
äom
)->
UnCÏmp
(
šdex
);

607 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

608 
RecursiveUnşamp
(
lšk
->
Out
(), 
šdex
);

612 
RecursiveS‘L—fS‹s
(cÚ¡ 
Lšk
* 
äom
, 
NÜm®
*** 
Ëaf¡©es
, 
CÚtšuousD©a
* 
d©a
, 
V¬
<
PosR—l
>* 
v¬Ÿnû
, 
pos
, 
šdex
, 
ty³
) {

614 ià(
	gäom
->
isL—f
()) {

615 
	gx
 = 
d©a
->
G‘TaxÚS‘
()->
G‘TaxÚIndex
(
äom
->
G‘Node
()->
G‘Name
());

616 ià(
	gx
 != -1) {

617 
tmp
 = 
d©a
->
G‘S‹
(
x
, 
šdex
);

618 ià(
	gtmp
 != -1) {

619 
MuÉiNÜm®
* 
m
 = 
G‘MuÉiNÜm®
(
äom
);

620 
	gËaf¡©es
[
x
][
šdex
] = 
Ãw
 
NÜm®
(
m
,
v¬Ÿnû
,
pos
);

621 
	gtmp
 = 
d©a
->
G‘S‹
(
x
, 
šdex
);

622 ià(
	gty³
 == 1) {

623 ià((
tmp
 <= 0) || (tmp >= 1)) {

624 
û¼
 << "error in„ecursive clamp‡t: cont data‚ot between 0‡nd 1\n";

625 
ex™
(1);

627 
	gËaf¡©es
[
x
][
šdex
]->
CÏmpAt
(
log
(
tmp
 / (1 -mp)));

628 
	gm
->
v®
()[
pos
] = 
log
(
tmp
/(1-tmp)è+ 0.01 * 
Rªdom
::
sNÜm®
();

630 ià(
	gty³
 == 2) {

631 
Ëaf¡©es
[
x
][
šdex
]->
CÏmpAt
(
tmp
);

632 
	gm
->
v®
()[
pos
] = 
tmp
 + 0.01 * 
Rªdom
::
sNÜm®
();

635 ià(
	gtmp
 <= 0) {

636 
û¼
 << "error in„ecursive clamp‡t:‚egative cont data\n";

637 
ex™
(1);

639 
	gËaf¡©es
[
x
][
šdex
]->
CÏmpAt
(
log
(
tmp
));

640 
	gm
->
v®
()[
pos
] = 
log
(
tmp
è+ 0.01 * 
Rªdom
::
sNÜm®
();

644 
	gËaf¡©es
[
x
][
šdex
] = 0;

648 
	gû¼
 << "£ˆËaà¡©es: " << 
	gäom
->
G‘Node
()->
G‘Name
() << "‚ot found\n";

652 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

653 
RecursiveS‘L—fS‹s
(
lšk
->
Out
(), 
Ëaf¡©es
, 
d©a
, 
v¬Ÿnû
, 
pos
, 
šdex
, 
ty³
);

657 
RecursiveS‘AndCÏmp
(cÚ¡ 
Lšk
* 
äom
, 
CÚtšuousD©a
* 
d©a
, 
pos
, 
šdex
, 
ty³
, & 
k
, & 
n
){

658 if(
	gäom
->
isL—f
()){

659 
	gn
++;

660 
	gx
 = 
d©a
->
G‘TaxÚS‘
()->
G‘TaxÚIndex
(
äom
->
G‘Node
()->
G‘Name
());

664 ià(
	gx
 != -1) {

665 
tmp
 = 
d©a
->
G‘S‹
(
x
, 
šdex
);

667 ià(
	gtmp
 != -1) {

668 
k
++;

669 
MuÉiNÜm®
* 
	gm
 = 
G‘MuÉiNÜm®
(
äom
);

670 ià(
	gty³
 == 2) {

671 
m
->
v®
()[
pos
] = 
tmp
;

673 ià(
	gty³
 == 1) {

674 ià((
tmp
 <= 0) || (tmp >= 1)) {

675 
û¼
 << "error in„ecursive clamp‡t: cont data‚ot between 0‡nd 1\n";

676 
ex™
(1);

678 
	gm
->
v®
()[
pos
] = 
log
(
tmp
 / (1 -mp));

681 ià(
	gtmp
 <= 0) {

682 
û¼
 << "error in„ecursive clamp‡t:‚egative cont data\n";

683 
ex™
(1);

685 
	gm
->
v®
()[
pos
] = 
log
(
tmp
);

687 
	gm
->
CÏmp
(
pos
);

692 
	gû¼
 << "£ˆªd cÏm°: " << 
	gäom
->
G‘Node
()->
G‘Name
() << "‚ot found\n";

695 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

696 
RecursiveS‘AndCÏmp
(
lšk
->
Out
(), 
d©a
, 
pos
, 
šdex
, 
ty³
,
k
,
n
);

700 
RecursiveS‘AndCÏmp
(cÚ¡ 
Lšk
* 
äom
, 
Anû¡¿lD©a
* 
d©a
, 
off£t
, 
ty³
){

701 ià(
	gd©a
->
Exi¡s
(
äom
)) {

702 
	gi
=0; i<
	gd©a
->
G‘Ns™e
(); i++) {

703 
	gpos
 = 
i
+
off£t
;

704 
	gtmp
 = 
d©a
->
G‘S‹
(
äom
, 
i
);

705 
MuÉiNÜm®
* 
	gm
 = 
G‘MuÉiNÜm®
(
äom
);

706 ià(
	gty³
 == 2) {

707 
m
->
v®
()[
pos
] = 
tmp
;

709 ià(
	gty³
 == 1) {

710 ià(
tmp
 <= 0) {

711 
û¼
 << "error in„ecursive clamp‡t:‚egative cont data\n";

712 
ex™
(1);

714 
	gm
->
v®
()[
pos
] = 
log
(
tmp
 / (1 -mp));

717 ià(
	gtmp
 <= 0) {

718 
û¼
 << "error in„ecursive clamp‡t:‚egative cont data\n";

719 
ex™
(1);

721 
	gm
->
v®
()[
pos
] = 
log
(
tmp
);

723 
	gm
->
CÏmp
(
pos
);

727 
	gû¼
 << "did‚Ù fšd : " << 
G‘T»e
()->
G‘LeáMo¡
(
äom
è<< '\t' << G‘T»e()->
G‘RightMo¡
(from) << '\n';

729 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

730 
RecursiveS‘AndCÏmp
(
lšk
->
Out
(), 
d©a
, 
off£t
, 
ty³
);

745 
MLBackw¬d
(cÚ¡ 
Lšk
* 
äom
, 
šdex
) {

747 
	gnu
 = 1.0 / 
G‘B¿nchL’gth
(
äom
->
G‘B¿nch
());

749 ià(
	gäom
->
isL—f
()) {

750 ià(
G‘MuÉiNÜm®
(
äom
)->
	gCÏmpVeùÜ
[
šdex
]) {

751 
	gMLmu
[
äom
] = (*
G‘MuÉiNÜm®
(äom))[
šdex
];

752 
	gMLk
[
äom
] = 0;

753 
	gMLm
[
äom
] = 
nu
;

756 
	gMLmu
[
äom
] = 0;

757 
	gMLk
[
äom
] = 0;

758 
	gMLm
[
äom
] = 0;

762 
	gk0
 = 0;

763 
	gmu0
 = 0;

764 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

765 
MLBackw¬d
(
lšk
->
Out
(), 
šdex
);

766 
	gk0
 +ğ
MLm
[
lšk
->
Out
()];

767 
	gmu0
 +ğ
MLm
[
lšk
->
Out
()] * 
MLmu
[link->Out()];

769 
	gmu0
 /ğ
k0
;

770 
	gMLmu
[
äom
] = 
mu0
;

771 
	gMLk
[
äom
] = 
k0
;

773 ià(! 
	gäom
->
isRoÙ
()) {

774 
	gm
 = 
nu
 * 
k0
 / (nu + k0);

775 
	gMLm
[
äom
] = 
m
;

778 
	gMLm
[
äom
] = 0;

784 
MLFÜw¬d
(cÚ¡ 
Lšk
* 
äom
, cÚ¡ Lšk* 
·»Á
, 
šdex
) {

785 ià(
	gäom
->
isRoÙ
()) {

786 ià(! 
G‘MuÉiNÜm®
(
äom
)->
	gCÏmpVeùÜ
[
šdex
]) {

787 (*
G‘MuÉiNÜm®
(
äom
))[
šdex
] = 
MLmu
[from];

788 
G‘MuÉiNÜm®
(
äom
)->
CÏmp
(
šdex
);

792 
	gx0
 = (*
G‘MuÉiNÜm®
(
·»Á
))[
šdex
];

793 
	gk
 = 
MLk
[
äom
];

794 
	gmu
 = 
MLmu
[
äom
];

795 
	gnu
 = 1.0 / 
G‘B¿nchL’gth
(
äom
->
G‘B¿nch
());

796 
	g®pha
 = (
k
*
mu
 + 
nu
*
x0
) / (k +‚u);

797 ià(! 
G‘MuÉiNÜm®
(
äom
)->
	gCÏmpVeùÜ
[
šdex
]) {

798 (*
G‘MuÉiNÜm®
(
äom
))[
šdex
] = 
®pha
;

799 
G‘MuÉiNÜm®
(
äom
)->
CÏmp
(
šdex
);

803 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

804 
MLFÜw¬d
(
lšk
->
Out
(), 
äom
, 
šdex
);

808 
	gm­
<cÚ¡ 
	gLšk
*, > 
	gMLmu
;

809 
	gm­
<cÚ¡ 
	gLšk
*, > 
	gMLk
;

810 
	gm­
<cÚ¡ 
	gLšk
*, > 
	gMLm
;

814 
¡ršg
 
RecursiveCÚ¡ruù
(
Lšk
* 
äom
){

815 
o¡ršg¡»am
 
	g»tour
;

816 if(!
	gäom
->
isL—f
()){

817 
	g»tour
 << "(";

818 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()){

819 
»tour
 << 
RecursiveCÚ¡ruù
(
lšk
->
Out
());

820 if(
	glšk
->
Next
(è!ğ
äom
){

821 
»tour
 << ",";

825 
	g»tour
 << ")" << 
	gäom
->
G‘Node
()->
G‘Name
();

826 
	gi
=0; i<
G‘Dim
(); i++){

827 
	g»tour
 << "_" << 
exp
(
G‘MuÉiNÜm®
(
äom
)->
v®
()[
i
]);

829 if(
	gäom
->
isRoÙ
()){

830 
	g»tour
 << ";";

832  
	g»tour
.
¡r
();

838 
	gRv¬
<
	gR—lVeùÜ
>* 
C»©eNodeV®
(cÚ¡ 
Lšk
* 
lšk
){

839 if(!
	glšk
->
isRoÙ
()){

840 ià(
	gsÿËfunùiÚ
) {

841  
Ãw
 
MuÉiNÜm®
(
sigma
, 
G‘MuÉiNÜm®
(
lšk
->
Out
()), 
Œ“
->
G‘B¿nchV®
Öšk->
G‘B¿nch
()), 
chrÚo
->
G‘NodeV®
Öšk->
G‘Node
()), 
agesÿË
, 
sÿËfunùiÚ
);

843  
Ãw
 
MuÉiNÜm®
(
sigma
, 
G‘MuÉiNÜm®
(
lšk
->
Out
()), 
Œ“
->
G‘B¿nchV®
Öšk->
G‘B¿nch
()), 
sÿËŒ“
 ? sÿËŒ“->G‘B¿nchV®Öšk->G‘B¿nch()): 0, 
driá
);

847  
Ãw
 
MuÉiNÜm®
(0,
sigma
,
roÙm—n
,
roÙv¬
);

853 şas 
	cMuÉiV¬Ÿ‹Segm’tMove
 : 
public
 
MCUpd©e
 {

855 
MuÉiV¬Ÿ‹T»eProûss
* 
Œ“
;

856 
	mtunšg
;

857 
	mimš
;

858 
	msize
;

860 
	mpublic
:

862 
	$MuÉiV¬Ÿ‹Segm’tMove
(
MuÉiV¬Ÿ‹T»eProûss
* 
šŒ“
, 
štunšg
, 
šimš
, 
šsize
){

863 
Œ“
 = 
šŒ“
;

864 
tunšg
 = 
štunšg
;

865 
imš
 = 
šimš
;

866 
size
 = 
šsize
;

869 
	$Move
(
tunšg_moduÏtÜ
){

870  
Œ“
->
	`Segm’tMove
(
tunšg
,
imš
,
size
);

871 
	}
}

874 
şass
 
	gMuÉiV¬Ÿ‹WhŞeT»eP›ûwi£T¿n¦©iÚMove
 : 
public
 
MCUpd©e
,…ubliø
	gMnode
 {

876 
MuÉiV¬Ÿ‹T»eProûss
* 
	gŒ“
;

877 
	gtunšg
;

878 
	gšdex
;

879 
	gk
;

881 
	gpublic
:

883 
MuÉiV¬Ÿ‹WhŞeT»eP›ûwi£T¿n¦©iÚMove
(
MuÉiV¬Ÿ‹T»eProûss
* 
šŒ“
, 
štunšg
, 
ššdex
, 
šk
){

884 
	gŒ“
 = 
šŒ“
;

885 
	gtunšg
 = 
štunšg
;

886 
	gšdex
 = 
ššdex
;

887 
	gk
 = 
šk
;

888 
	gŒ“
->
RecursiveRegi¡”
(
this
,
Œ“
->
G‘RoÙ
());

891 
Move
(
tunšg_moduÏtÜ
){

892 
CÜru±
(
Œue
);

893 
	gu
 = 
tunšg
 * 
tunšg_moduÏtÜ
 * (
Rªdom
::
UnifÜm
() - 0.5);

894 
	gŒ“
->
P›ûwi£T¿n¦©iÚ
(
u
,
šdex
,
k
);

895 
	glog¿tio
 = 
Upd©e
();

897 
boŞ
 
	gacû±ed
 = (
log
(
Rªdom
::
UnifÜm
()è< 
log¿tio
);

898 ià(! 
	gacû±ed
) {

899 
CÜru±
(
çl£
);

900 
Re¡Üe
();

902  (è
	gacû±ed
;

	@OneMatrixPhyloProcess.h

2 #iâdeà
ONEMATRIXPHYLOPROCESS_H


3 
	#ONEMATRIXPHYLOPROCESS_H


	)

5 
	~"PhyloProûss.h
"

6 
	~"RªdomSubM©rix.h
"

7 
	~"GTRSubM©rix.h
"

8 
	~"RªdomTy³s.h
"

9 
	~"V®A¼ay.h
"

13 şas 
	cOÃM©rixPhyloProûss
 : 
public
 
PhyloProûss
 {

15 
´Ùeùed
:

17 
public
:

19 
	$OÃM©rixPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
RªdomSubM©rix
* 
¿ndm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$PhyloProûss
(
šŒ“
,
šd©a
) {

20 
m©rix
 = 
¿ndm©rix
;

27 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

28  
Ãw
 
	`RªdomB¿nchS™eP©h
(
this
,
Œ“
->
	`G‘B¿nchL’gth
(
lšk
->
	`G‘B¿nch
()),0,
	`G‘M©rix
(),0);

29 
	}
}

31 
RªdomSubM©rix
* 
	$G‘M©rix
(è{ 
m©rix
;
	}
}

33 
	g´Ùeùed
:

34 
RªdomSubM©rix
* 
m©rix
;

37 şas 
	cS™eM©rixPhyloProûss
 : 
public
 
PhyloProûss
 {

39 
´Ùeùed
:

41 
public
:

43 
	$S™eM©rixPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
RªdomSubM©rix
** 
¿ndm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$PhyloProûss
(
šŒ“
,
šd©a
) {

44 
m©rix
 = 
¿ndm©rix
;

51 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

52  
Ãw
 
	`RªdomB¿nchS™eP©h
(
this
,
Œ“
->
	`G‘B¿nchL’gth
(
lšk
->
	`G‘B¿nch
()),0,
	`G‘M©rix
(
s™e
),0);

53 
	}
}

55 
RªdomSubM©rix
* 
	$G‘M©rix
(
s™e
è{ 
m©rix
[s™e];
	}
}

57 
	g´Ùeùed
:

58 
RªdomSubM©rix
** 
m©rix
;

61 şas 
	cOÃM©rixRASPhyloProûss
 : 
public
 
OÃM©rixPhyloProûss
 {

63 
´Ùeùed
:

65 
public
:

67 
OÃM©rixRASPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
V¬A¼ay
<
PosR—l
>* 
š¿‹
, 
RªdomSubM©rix
* 
¿ndm©rix
, 
Sequ’ûAlignm’t
* 
šd©a
è: 
	$OÃM©rixPhyloProûss
(
šŒ“
,
¿ndm©rix
,
šd©a
) {

68 
¿‹
 = 
š¿‹
;

71 
vœtu®
 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

72  
Ãw
 
	`RªdomB¿nchS™eP©h
(
this
, 
Œ“
->
	`G‘B¿nchL’gth
(
lšk
->
	`G‘B¿nch
()), 
	`G‘R©e
(
s™e
), 
m©rix
, 0);

73 
	}
}

75 
	gV¬
<
	gPosR—l
>* 
	$G‘R©e
(
s™e
) {

76 ià(! 
¿‹
) {

79  
¿‹
->
	`G‘V®
(
s™e
);

80 
	}
}

82 
	g´Ùeùed
:

84 
V¬A¼ay
<
PosR—l
>* 
¿‹
;

	@PhyloProcess.cpp

2 
	~"PhyloProûss.h
"

4 
	gPhyloProûss
::
	$G‘MaxN¡©e
() {

5 ià(!
MaxN¡©e
) {

6 
MaxN¡©e
 = 0;

7 
i
=0; i<
	`G‘Ns™e
(); i++) {

8 ià(
MaxN¡©e
 < 
	`G‘N¡©e
(
i
)) {

9 
MaxN¡©e
 = 
	`G‘N¡©e
(
i
);

13  
MaxN¡©e
;

14 
	}
}

16 
	gPhyloProûss
::
	$S‘Name
(
¡ršg
 
šÇme
) {

17 
	`RecursiveS‘Name
(
	`G‘RoÙ
(), 
šÇme
);

18 
	}
}

20 
	gPhyloProûss
::
	$RecursiveS‘Name
(cÚ¡ 
Lšk
* 
äom
, 
¡ršg
 
šÇme
) {

21 
¡ršg
 
Çme
 = (
äom
->
	`isRoÙ
()) ? "„oot " : "‚on„oot ";

22 
i
=0; i<
	`G‘Ns™e
(); i++) {

23 ià(! 
	`isMissšg
(
äom
,
i
)) {

24 
	`G‘P©h
(0,
i
)->
	`S‘Name
(
šÇme
 + 
Çme
);

27 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

28 
	`RecursiveS‘Name
(
lšk
->
	`Out
(),
šÇme
);

30 
	}
}

32 
	gPhyloProûss
::
	$C»©eMissšgM­
() {

33 
	`RecursiveC»©eMissšgM­
(
	`G‘RoÙ
());

34 
i
=0; i<
	`G‘Ns™e
(); i++) {

35 
	`FlMissšgM­
(
	`G‘RoÙ
(), 
i
);

37 
	`Compu‹TÙ®MissšgP”S™e
(
	`G‘RoÙ
());

38 
	}
}

40 
	gPhyloProûss
::
	$RecursiveC»©eMissšgM­
(cÚ¡ 
Lšk
* 
äom
) {

41 
boŞ
* 
¬¿y
 = 
Ãw
 boŞ[
	`G‘Ns™e
()];

42 
missšgm­
[
äom
->
	`G‘Node
()] = 
¬¿y
;

43 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

44 
	`RecursiveC»©eMissšgM­
(
lšk
->
	`Out
());

46 
	}
}

48 
	gPhyloProûss
::
	$Compu‹TÙ®MissšgP”S™e
(cÚ¡ 
Lšk
* 
äom
) {

49 
tÙ
 = 0;

50 
i
=0; i<
	`G‘Ns™e
(); i++) {

51 ià(
	`isMissšg
(
äom
,
i
)) {

52 
tÙ
++;

55 
tÙmissšgm­
[
äom
->
	`G‘Node
()] = 
tÙ
;

56 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

57 
	`Compu‹TÙ®MissšgP”S™e
(
lšk
->
	`Out
());

59 
	}
}

61 
boŞ
 
	gPhyloProûss
::
	$FlMissšgM­
(cÚ¡ 
Lšk
* 
äom
, 
i
) {

62 ià(
äom
->
	`isL—f
()) {

63 
missšgm­
[
äom
->
	`G‘Node
()][
i
] = 
d©a
->
	`isMissšg
(äom->G‘Node()->
	`G‘Index
(),i);

64  
missšgm­
[
äom
->
	`G‘Node
()][
i
];

66 
boŞ
 
®lmiss
 = 
Œue
;

67 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

68 
®lmiss
 &ğ
	`FlMissšgM­
(
lšk
->
	`Out
(),
i
);

70 
missšgm­
[
äom
->
	`G‘Node
()][
i
] = 
®lmiss
;

71  
®lmiss
;

72 
	}
}

74 
	gPhyloProûss
::
	$S‘S‹S·û
() {

75 
	`RecursiveS‘S‹S·û
(
	`G‘RoÙ
());

76 
	}
}

78 
	gPhyloProûss
::
	$RecursiveS‘S‹S·û
(cÚ¡ 
Lšk
* 
äom
) {

79 
i
=0; i<
	`G‘Ns™e
(); i++) {

80 ià(! 
	`isMissšg
(
äom
,
i
)) {

81 
	`G‘P©h
(
äom
->
	`G‘B¿nch
(),
i
)->
	`S‘S‹S·û
(
	`G‘S‹S·û
());

84 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

85 
	`RecursiveS‘S‹S·û
(
lšk
->
	`Out
());

87 
	}
}

89 
	gPhyloProûss
::
	$RecursiveC»©e
(cÚ¡ 
Lšk
* 
äom
) {

90 * 
¡©e
 = 
Ãw
 [
	`G‘Ns™e
()];

91 
RªdomB¿nchS™eP©h
** 
·th
 = 
	`C»©eRªdomB¿nchS™eP©h
(
äom
);

92 
·thm­
[
äom
->
	`G‘B¿nch
()] = 
·th
;

93 
¡©em­
[
äom
->
	`G‘Node
()] = 
¡©e
;

94 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

95 
	`RecursiveC»©e
(
lšk
->
	`Out
());

97 
	}
}

99 
RªdomB¿nchS™eP©h
** 
	gPhyloProûss
::
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
) {

100 
RªdomB¿nchS™eP©h
** 
¬¿y
 = 
Ãw
 RªdomB¿nchS™eP©h*[
	`G‘Ns™e
()];

101 
i
=0; i<
	`G‘Ns™e
(); i++) {

102 ià(! 
	`isMissšg
(
lšk
,
i
)) {

103 
¬¿y
[
i
] = 
	`C»©eRªdomB¿nchS™eP©h
(
lšk
,i);

106 
¬¿y
[
i
] = 0;

109  
¬¿y
;

110 
	}
}

112 
	gPhyloProûss
::
	$RecursiveD–‘e
(cÚ¡ 
Lšk
* 
äom
) {

113 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

114 
	`RecursiveD–‘e
(
lšk
->
	`Out
());

116 
	`D–‘eP©h
(
äom
);

117 
d–‘e
[] 
¡©em­
[
äom
->
	`G‘Node
()];

118 
	}
}

120 
	gPhyloProûss
::
	$D–‘eP©h
(cÚ¡ 
Lšk
* 
lšk
) {

121 
RªdomB¿nchS™eP©h
** 
·th
 = 
·thm­
[
lšk
->
	`G‘B¿nch
()];

122 
i
=0; i<
	`G‘Ns™e
(); i++) {

123 
d–‘e
 
·th
[
i
];

125 
d–‘e
[] 
·th
;

126 
	}
}

128 
	gPhyloProûss
::
	$PhyloProûss
(
L’gthT»e
* 
šŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
, 
boŞ
 
šb¿nchm­
) {

129 
b¿nchm­
 = 
šb¿nchm­
;

130 
MaxN¡©e
 = 0;

131 
Œ“
 = 
šŒ“
;

132 
d©a
 = 
šd©a
;

133 
maxŒŸl
 = 
DEFAULTMAXTRIAL
;

134 
	}
}

136 
	gPhyloProûss
::
	$S‘D©a
(
Sequ’ûAlignm’t
* 
šd©a
) {

137 
d©a
 = 
šd©a
;

138 
	}
}

140 
	gPhyloProûss
::
	$UnfŞd
() {

142 
s™—¼ay
 = 
Ãw
 [
	`G‘Ns™e
()];

143 
s™–nL
 = 
Ãw
 [
	`G‘Ns™e
()];

144 
i
=0; i<
	`G‘Ns™e
(); i++) {

145 
s™—¼ay
[
i
] = 1;

148 
	`C»©eMissšgM­
();

149 
	`Re£tFÏgM­
(
	`G‘RoÙ
(),
Œue
);

150 
	`RecursiveC»©e
(
	`G‘RoÙ
());

151 
	`RecursiveC»©eTBL
(
	`G‘RoÙ
(),
	`G‘MaxN¡©e
());

152 
s™em­pšg
 = 
Ãw
 
PhyloProûssS™eM­pšg
*[
	`G‘Ns™e
()];

153 
i
=0; i<
	`G‘Ns™e
(); i++) {

154 
s™em­pšg
[
i
] = 
Ãw
 
	`PhyloProûssS™eM­pšg
(
this
,i);

156 
	`CÏmpD©a
();

157 
	`S‘S‹S·û
();

158 
	}
}

160 
	gPhyloProûss
::
	$CËªup
() {

161 
	`RecursiveD–‘eTBL
(
	`G‘RoÙ
());

162 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

163 
d–‘e
[] 
s™—¼ay
;

164 
d–‘e
[] 
s™–nL
;

165 
	}
}

167 
	gPhyloProûss
::
	$RecursiveC»©eTBL
(cÚ¡ 
Lšk
* 
äom
, 
šn¡©e
) {

168 
cÚdlm­
[
äom
] = 
Ãw
 [
šn¡©e
+1];

169 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

170 
cÚdlm­
[
lšk
] = 
Ãw
 [
šn¡©e
+1];

171 
	`RecursiveC»©eTBL
(
lšk
->
	`Out
(), 
šn¡©e
);

173 
	}
}

175 
	gPhyloProûss
::
	$RecursiveD–‘eTBL
(cÚ¡ 
Lšk
* 
äom
) {

176 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

177 
	`RecursiveD–‘eTBL
(
lšk
->
	`Out
());

178 
d–‘e
[] 
cÚdlm­
[
lšk
];

180 
d–‘e
[] 
cÚdlm­
[
äom
];

181 
	}
}

183 
	gPhyloProûss
::~
	$PhyloProûss
() {

184 
	`CËªup
();

185 
	}
}

187 
	gPhyloProûss
::
	$S™eLogLik–ihood
(
s™e
) {

188 ià(
	`isMissšg
(
	`G‘RoÙ
(),
s™e
)) {

191 
	`Prunšg
(
	`G‘RoÙ
(),
s™e
);

192 
»t
 = 0;

193 * 
t
 = 
	`G‘CÚdLik–ihood
(
	`G‘RoÙ
());

194 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

196 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

197 
»t
 +ğ
t
[
k
] * 
¡©
[k];

199 ià(
»t
 == 0) {

200 
û¼
 << "pruning : 0 \n";

201 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

202 
û¼
 << 
t
[
k
] << '\t' << 
¡©
[k] << '\n';

204 
	`ex™
(1);

206  
	`log
(
»t
è+ 
t
[
	`G‘N¡©e
(
s™e
)];

207 
	}
}

209 
	gPhyloProûss
::
	$Fa¡S™eLogLik–ihood
(
s™e
) {

210 ià(
	`isMissšg
(
	`G‘RoÙ
(),
s™e
)) {

214 
»t
 = 0;

215 * 
t
 = 
	`G‘CÚdLik–ihood
(
	`G‘RoÙ
());

216 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

218 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

219 
»t
 +ğ
t
[
k
] * 
¡©
[k];

221 ià(
»t
 == 0) {

222 
û¼
 << "pruning : 0 \n";

223 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

224 
û¼
 << 
t
[
k
] << '\t' << 
¡©
[k] << '\n';

226 
	`ex™
(1);

228 
s™–nL
[
s™e
] = 
	`log
(
»t
è+ 
t
[
	`G‘N¡©e
(site)];

229  
s™–nL
[
s™e
];

230 
	}
}

232 
	gPhyloProûss
::
	$G‘Fa¡LogProb
() {

233 
tÙ®
 = 0;

234 
i
=0; i<
	`G‘Ns™e
(); i++) {

241 
tÙ®
 +ğ
s™–nL
[
i
];

243  
tÙ®
;

244 
	}
}

246 
	gPhyloProûss
::
	$G‘LogProb
() {

248 
tÙ®
 = 0;

249 
i
=0; i<
	`G‘Ns™e
(); i++) {

257 
tÙ®
 +ğ
	`S™eLogLik–ihood
(
i
);

259  
tÙ®
;

260 
	}
}

262 
	gPhyloProûss
::
	$G‘P©hLogProb
() {

263 
tÙ®
 = 0;

264 
i
=0; i<
	`G‘Ns™e
(); i++) {

265 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
i
)) {

266 
tÙ®
 +ğ
	`G‘P©hLogProb
(
	`G‘RoÙ
(),
i
);

269  
tÙ®
;

270 
	}
}

272 
	gPhyloProûss
::
	$G‘P©hLogProb
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

273 
tÙ®
 = 
	`G‘P©h
(
äom
->
	`G‘B¿nch
(),
s™e
)->
	`G‘Fa¡LogProb
();

282 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

283 ià(! 
	`isMissšg
(
lšk
->
	`Out
()->
	`G‘Node
(),
s™e
)) {

284 
tÙ®
 +ğ
	`G‘P©hLogProb
(
lšk
->
	`Out
(),
s™e
);

287  
tÙ®
;

288 
	}
}

290 
	gPhyloProûss
::
	$Prunšg
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

292 * 
t
 = 
	`G‘CÚdLik–ihood
(
äom
);

293 ià(! 
æagm­
[
äom
->
	`G‘Node
()]) {

294 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

295 
t
[
k
] = 0;

297 
t
[
	`G‘N¡©e
(
s™e
)] = 0;

298 
t
[
	`G‘S‹
(
äom
->
	`G‘Node
(),
s™e
)] = 1;

301 ià(
äom
->
	`isL—f
()) {

302 
tÙcomp
 = 0;

303 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

304 ià(
	`isD©aCom·tibË
(
äom
->
	`G‘Node
()->
	`G‘Index
(),
s™e
,
k
)) {

305 
t
[
k
] = 1;

306 
tÙcomp
 ++;

309 
t
[
k
] = 0;

312 ià(! 
tÙcomp
) {

313 
û¼
 << "error :‚o compatibility\n";

314 
û¼
 << 
	`G‘D©a
(
äom
->
	`G‘Node
()->
	`G‘Index
(),
s™e
) << '\n';

315 
	`ex™
(1);

318 
t
[
	`G‘N¡©e
(
s™e
)] = 0;

321 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

322 
t
[
k
] = 1.0;

324 
t
[
	`G‘N¡©e
(
s™e
)] = 0;

325 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

326 ià(! 
	`isMissšg
(
lšk
->
	`G‘B¿nch
(),
s™e
)) {

327 * 
tbl
 = 
	`G‘CÚdLik–ihood
(
lšk
);

328 
	`Prunšg
(
lšk
->
	`Out
(),
s™e
);

329 
	`G‘P©h
(
lšk
->
	`G‘B¿nch
(),
s™e
)->
	`Backw¬dPrİag©e
(
	`G‘CÚdLik–ihood
Öšk->
	`Out
()),GetCondLikelihood(link));

330 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

331 
t
[
k
] *ğ
tbl
[k];

333 
t
[
	`G‘N¡©e
(
s™e
)] +ğ
tbl
[GetNstate(site)];

336 
max
 = 0;

337 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

338 ià(
t
[
k
] <0) {

343 
t
[
k
] = 0;

345 ià(
max
 < 
t
[
k
]) {

346 
max
 = 
t
[
k
];

349 ià(
max
 == 0) {

350 
û¼
 << "max = 0\n";

351 
û¼
 << "error in…runing:‚ull†ikelihood\n";

352 ià(
äom
->
	`isRoÙ
()) {

353 
û¼
 << "is„oot\n";

358 
û¼
 << '\n';

365 
	`ex™
(1);

366 
max
 = 1e-20;

368 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

369 
t
[
k
] /ğ
max
;

371 
t
[
	`G‘N¡©e
(
s™e
)] +ğ
	`log
(
max
);

374 
	}
}

376 
	gPhyloProûss
::
	$BackupNodeS‹s
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

378 
bk¡©em­
[
äom
->
	`G‘Node
()] = 
¡©em­
[äom->G‘Node()][
s™e
];

379 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

380 
	`BackupNodeS‹s
(
lšk
->
	`Out
(),
s™e
);

382 
	}
}

384 
	gPhyloProûss
::
	$Re¡ÜeNodeS‹s
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

386 
¡©em­
[
äom
->
	`G‘Node
()][
s™e
] = 
bk¡©em­
[from->GetNode()];

387 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

388 
	`Re¡ÜeNodeS‹s
(
lšk
->
	`Out
(),
s™e
);

390 
	}
}

392 
	gPhyloProûss
::
	$PrunšgAnû¡¿l
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

393 ià(! 
æagm­
[
äom
->
	`G‘Node
()]) {

394 
û¼
 << "error in…runing‡ncestral: flag map‚ot set up correctly\n";

395 
	`ex™
(1);

397 & 
¡©e
 = 
	`G‘S‹
(
äom
->
	`G‘Node
(),
s™e
);

398 ià(
äom
->
	`isRoÙ
()) {

399 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

400 * 
cumuÏux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

401 
Œy
 {

402 * 
tbl
 = 
	`G‘CÚdLik–ihood
(
äom
);

403 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

405 
tÙ
 = 0;

406 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

407 
aux
[
k
] = 
¡©
[k] * 
tbl
[k];

408 
tÙ
 +ğ
aux
[
k
];

409 
cumuÏux
[
k
] = 
tÙ
;

411 
u
 = 
tÙ
 * 
Rªdom
::
	`UnifÜm
();

412 
s
 = 0;

413 (
s
 < 
	`G‘N¡©e
(
s™e
)è&& (
cumuÏux
[s] < 
u
)) {

414 
s
 ++;

416 ià(
s
 =ğ
	`G‘N¡©e
(
s™e
)) {

417 
û¼
 << "error in…runing‡ncestral: overflow\n";

418 
	`ex™
(1);

420 
¡©e
 = 
s
;

422 
	`ÿtch
(...) {

423 
û¼
 << "in„oot::PruningAncestral\n";

424 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

425 
û¼
 << 
aux
[
k
] << '\n';

427 
	`ex™
(1);

428 
throw
;

430 
d–‘e
[] 
aux
;

431 
d–‘e
[] 
cumuÏux
;

433 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

434 ià((
æagm­
[
lšk
->
	`Out
()->
	`G‘Node
()]è&& (!
	`isMissšg
Öšk->Out()->G‘Node(),
s™e
))) {

435 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

436 * 
cumuÏux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

437 
Œy
 {

438 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

439 
aux
[
k
] = 1;

441 
	`G‘P©h
(
lšk
->
	`G‘B¿nch
(),
s™e
)->
	`G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
,
aux
);

443 * 
tbl
 = 
	`G‘CÚdLik–ihood
(
lšk
->
	`Out
());

444 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

445 
aux
[
k
] *ğ
tbl
[k];

449 
max
 = 0;

450 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

451 ià(
aux
[
k
] <0) {

452 
aux
[
k
] = 0;

454 ià(
max
 < 
aux
[
k
]) {

455 
max
 = 
aux
[
k
];

458 ià(
max
 == 0) {

459 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

461 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

462 
aux
[
k
] = 
¡©
[k];

466 
tÙ
 = 0;

467 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

468 
tÙ
 +ğ
aux
[
k
];

469 
cumuÏux
[
k
] = 
tÙ
;

471 
u
 = 
tÙ
 * 
Rªdom
::
	`UnifÜm
();

472 
s
 = 0;

473 (
s
 < 
	`G‘N¡©e
(
s™e
)è&& (
cumuÏux
[s] < 
u
)) {

474 
s
 ++;

476 ià(
s
 =ğ
	`G‘N¡©e
(
s™e
)) {

477 
û¼
 << "error in…runing‡ncestral: overflow\n";

478 
	`ex™
(1);

480 & 
node¡©e
 = 
	`G‘S‹
(
lšk
->
	`Out
()->
	`G‘Node
(),
s™e
);

481 
node¡©e
 = 
s
;

483 
	`ÿtch
(...) {

484 
û¼
 << "in internal†eave::PruningAncestral\n";

485 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

486 
û¼
 << 
aux
[
k
] << '\n';

488 
	`ex™
(1);

489 
throw
;

491 
d–‘e
[] 
aux
;

492 
d–‘e
[] 
cumuÏux
;

493 
	`PrunšgAnû¡¿l
(
lšk
->
	`Out
(),
s™e
);

496 
	}
}

498 
	gPhyloProûss
::
	$RecÜdPrunšgAnû¡¿lLogProb
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

499 
tÙ®
 = 0;

500 ià(! 
æagm­
[
äom
->
	`G‘Node
()]) {

501 
û¼
 << "error in…runing‡ncestral: flag map‚ot set up correctly\n";

502 
	`ex™
(1);

504 & 
¡©e
 = 
	`G‘S‹
(
äom
->
	`G‘Node
(),
s™e
);

505 ià(
äom
->
	`isRoÙ
()) {

506 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

507 
Œy
 {

508 * 
tbl
 = 
	`G‘CÚdLik–ihood
(
äom
);

509 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

511 
tÙ
 = 0;

512 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

513 
aux
[
k
] = 
¡©
[k] * 
tbl
[k];

514 
tÙ
 +ğ
aux
[
k
];

516 
tÙ®
 +ğ
	`log
(
aux
[
¡©e
] / 
tÙ
);

518 
	`ÿtch
(...) {

519 
û¼
 << "in„oot::PruningAncestral\n";

520 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

521 
û¼
 << 
aux
[
k
] << '\n';

523 
	`ex™
(1);

524 
throw
;

526 
d–‘e
[] 
aux
;

528 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

529 ià((
æagm­
[
lšk
->
	`Out
()->
	`G‘Node
()]è&& (!
	`isMissšg
Öšk->Out()->G‘Node(),
s™e
))) {

530 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

531 
Œy
 {

532 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

533 
aux
[
k
] = 1;

535 
	`G‘P©h
(
lšk
->
	`G‘B¿nch
(),
s™e
)->
	`G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
,
aux
);

537 * 
tbl
 = 
	`G‘CÚdLik–ihood
(
lšk
->
	`Out
());

538 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

539 
aux
[
k
] *ğ
tbl
[k];

543 
max
 = 0;

544 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

545 ià(
aux
[
k
] <0) {

546 
aux
[
k
] = 0;

548 ià(
max
 < 
aux
[
k
]) {

549 
max
 = 
aux
[
k
];

552 ià(
max
 == 0) {

553 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

555 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

556 
aux
[
k
] = 
¡©
[k];

560 
tÙ
 = 0;

561 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

562 
tÙ
 +ğ
aux
[
k
];

564 & 
node¡©e
 = 
	`G‘S‹
(
lšk
->
	`Out
()->
	`G‘Node
(),
s™e
);

565 
tÙ®
 +ğ
	`log
(
aux
[
node¡©e
] / 
tÙ
);

567 
	`ÿtch
(...) {

568 
û¼
 << "in internal†eave::PruningAncestral\n";

569 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

570 
û¼
 << 
aux
[
k
] << '\n';

572 
	`ex™
(1);

573 
throw
;

575 
d–‘e
[] 
aux
;

576 
tÙ®
 +ğ
	`RecÜdPrunšgAnû¡¿lLogProb
(
lšk
->
	`Out
(),
s™e
);

579  
tÙ®
;

580 
	}
}

582 
	gPhyloProûss
::
	$d¿wSam¶e
() {

583 ià(
şampd©a
) {

584 
û¼
 << "mapping substitutions\n";

585 
	`Re§m¶eSub
();

586 
û¼
 << "ok\n";

587 
û¼
 << '\n';

590 
û¼
 << "mapping substitutions\n";

591 
û¼
 << '\n';

592 
	`PriÜSam¶e
();

595 
	}
}

597 
	gPhyloProûss
::
	$RoÙPo¡”iÜD¿w
(
s™e
) {

598 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
(
s™e
)];

599 * 
tbl
 = 
	`G‘CÚdLik–ihood
(
	`G‘RoÙ
());

600 cÚ¡ * 
¡©
 = 
	`G‘P©h
(0,
s™e
)->
	`G‘StiÚ¬y
();

602 
k
=0; k<
	`G‘N¡©e
(
s™e
); k++) {

603 
aux
[
k
] = 
¡©
[k] * 
tbl
[k];

605 
	`G‘S‹
(
	`G‘RoÙ
()->
	`G‘Node
(),
s™e
èğ
Rªdom
::
	`D¿wFromDisü‘eDi¡ributiÚ
(
aux
,
	`G‘N¡©e
(site));

606 
d–‘e
[] 
aux
;

607 
	}
}

609 
	gPhyloProûss
::
	$PriÜSam¶e
(cÚ¡ 
Lšk
* 
äom
, 
s™e
, 
boŞ
 
roÙ´iÜ
) {

610 & 
¡©e
 = 
	`G‘S‹
(
äom
->
	`G‘Node
(),
s™e
);

611 ià(
äom
->
	`isRoÙ
()) {

612 ià(
roÙ´iÜ
) {

613 
¡©e
 = 
	`G‘P©h
(0,
s™e
)->
	`D¿wStiÚ¬y
();

617 
	`RoÙPo¡”iÜD¿w
(
s™e
);

620 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

621 ià(!
	`isMissšg
(
lšk
->
	`G‘B¿nch
(),
s™e
)) {

622 
	`G‘S‹
(
lšk
->
	`Out
()->
	`G‘Node
(),
s™e
èğ
	`G‘P©h
Öšk->
	`G‘B¿nch
(),s™e)->
	`D¿wFš™eTime
(
¡©e
);

624 
	`PriÜSam¶e
(
lšk
->
	`Out
(),
s™e
,
roÙ´iÜ
);

627 
	}
}

629 
	gPhyloProûss
::
	$Re§m¶eS‹
() {

630 
i
=0; i<
	`G‘Ns™e
(); i++) {

631 
	`Re§m¶eS‹
(
i
);

633 
	}
}

635 
	gPhyloProûss
::
	$Re§m¶eS‹
(
s™e
) {

636 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
s™e
)) {

637 
	`Prunšg
(
	`G‘RoÙ
(),
s™e
);

639 
	`PrunšgAnû¡¿l
(
	`G‘RoÙ
(),
s™e
);

641 
	}
}

643 
	gPhyloProûss
::
	$Re§m¶eSub
() {

645 
´unšgchrÚo
.
	`S¹
();

646 
i
=0; i<
	`G‘Ns™e
(); i++) {

647 ià(
s™—¼ay
[
i
]) {

648 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
i
)) {

649 
	`Re§m¶eS‹
(
i
);

653 
´unšgchrÚo
.
	`Stİ
();

655 
»§m¶echrÚo
.
	`S¹
();

656 
i
=0; i<
	`G‘Ns™e
(); i++) {

657 ià(
s™—¼ay
[
i
]) {

658 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
i
)) {

659 
	`Re§m¶eSub
(
	`G‘RoÙ
(),
i
);

663 
»§m¶echrÚo
.
	`Stİ
();

664 
	}
}

666 
	gPhyloProûss
::
	$Re§m¶eSub
(
s™e
) {

667 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
s™e
)) {

668 
	`Re§m¶eS‹
(
s™e
);

669 
	`Re§m¶eSub
(
	`G‘RoÙ
(),
s™e
);

671 
	}
}

673 
	gPhyloProûss
::
	$Re§m¶eSub
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

674 ià(
äom
->
	`isRoÙ
()) {

675 
	`G‘P©h
(0,
s™e
)->
	`Re§m¶eRoÙ
(
	`G‘S‹
(
äom
->
	`G‘Node
(),site));

677 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

678 ià(! 
	`isMissšg
(
lšk
->
	`Out
(),
s™e
)) {

679 
	`G‘P©h
(
lšk
->
	`G‘B¿nch
(),
s™e
)->
	`Re§m¶e
(
	`G‘S‹
Öšk->
	`G‘Node
(),s™e),G‘S‹Öšk->
	`Out
()->GetNode(),site));

688 
	`Re§m¶eSub
(
lšk
->
	`Out
(),
s™e
);

691 
	}
}

697 
	gPhyloProûss
::
	$S‘Prİo§lM©riûs
() {

698 
	`RecursiveS‘Prİo§lM©riûs
(
	`G‘RoÙ
());

699 
	}
}

701 
	gPhyloProûss
::
	$RecursiveS‘Prİo§lM©riûs
(cÚ¡ 
Lšk
* 
äom
) {

703 
i
=0; i<
	`G‘Ns™e
(); i++) {

704 ià(! 
	`isMissšg
(
äom
,
i
)) {

705 
	`G‘P©h
(
äom
->
	`G‘B¿nch
(),
i
)->
	`S‘Prİo§lM©rix
(
	`G‘Prİo§lM©rix
(from->GetBranch(),i));

708 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

709 
	`RecursiveS‘Prİo§lM©riûs
(
lšk
->
	`Out
());

711 
	}
}

713 
	gPhyloProûss
::
	$RecursiveRegi¡”
(cÚ¡ 
Lšk
* 
äom
, 
s™e
, 
Mnode
* 
mnode
) {

715 ià(! 
	`isMissšg
(
äom
->
	`G‘B¿nch
(),
s™e
)) {

716 
	`G‘P©h
(
äom
->
	`G‘B¿nch
(),
s™e
)->
	`Regi¡”
(
mnode
);

717 ià(
æagm­
[
äom
->
	`G‘Node
()]) {

718 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

719 
	`RecursiveRegi¡”
(
lšk
->
	`Out
(),
s™e
,
mnode
);

723 
	}
}

725 
	gPhyloProûss
::
	$Sw­M©riûs
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

727 ià(! 
	`isMissšg
(
äom
->
	`G‘B¿nch
(),
s™e
)) {

728 
	`G‘P©h
(
äom
->
	`G‘B¿nch
(),
s™e
)->
	`Sw­M©riûs
();

729 ià(
æagm­
[
äom
->
	`G‘Node
()]) {

730 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

731 
	`Sw­M©riûs
(
lšk
->
	`Out
(),
s™e
);

735 
	}
}

737 
	gPhyloProûss
::
	$Prİo£Re§m¶eSub
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

739 ià(! 
	`isMissšg
(
äom
->
	`G‘B¿nch
(),
s™e
)) {

740 
tÙ
 = 0;

741 ià(
äom
->
	`isRoÙ
()) {

742 
tÙ
 = 
	`G‘P©h
(
äom
->
	`G‘B¿nch
(),
s™e
)->
	`Prİo£MoveRoÙ
(
	`G‘S‹
(äom->
	`G‘Node
(),site));

744 ià(
æagm­
[
äom
->
	`G‘Node
()]) {

745 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

746 ià(! 
	`isMissšg
(
lšk
->
	`Out
(),
s™e
)) {

747 
tÙ
 +ğ
	`G‘P©h
(
lšk
->
	`G‘B¿nch
(),
s™e
)->
	`Prİo£Move
(
	`G‘S‹
Öšk->
	`G‘Node
(),s™e),G‘S‹Öšk->
	`Out
()->GetNode(),site));

748 
tÙ
 +ğ
	`Prİo£Re§m¶eSub
(
lšk
->
	`Out
(),
s™e
);

752  
tÙ
;

755 
	}
}

757 
	gPhyloProûss
::
	$MHMove
(
Ä•
, 
s01
, 
s10
) {

759 
Çcc
 = 0;

760 
»p
=0;„•<
Ä•
;„ep++) {

763 
s™e
 = (è(
	`G‘Ns™e
(è* 
Rªdom
::
	`UnifÜm
());

764 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
s™e
)) {

765 
s™e
 = (è(
	`G‘Ns™e
(è* 
Rªdom
::
	`UnifÜm
());

768 cÚ¡ 
Lšk
* 
roÙlšk
;

769 ià(
s01
 == -1) {

770 
	`Re£tFÏgM­
(
	`G‘RoÙ
(),
Œue
);

771 
roÙlšk
 = 
	`G‘RoÙ
();

774 
	`Re£tFÏgM­
(
	`G‘RoÙ
(),
çl£
);

775 
sw
 = 0;

776 
roÙlšk
 = 
	`Choo£NodeS‘
(
	`G‘RoÙ
(),
s01
,
s10
,
sw
);

780 
Mnode
* 
mnode
 = 
Ãw
 Mnode;

781 
	`RecursiveRegi¡”
(
roÙlšk
,
s™e
,
mnode
);

783 
mnode
->
	`CÜru±
(
Œue
);

785 
	`BackupNodeS‹s
(
roÙlšk
,
s™e
);

787 
	`Sw­M©riûs
(
roÙlšk
,
s™e
);

789 
	`Prunšg
(
roÙlšk
,
s™e
);

794 
	`PrunšgAnû¡¿l
(
roÙlšk
,
s™e
);

798 
logha¡šgs
 = 
	`Prİo£Re§m¶eSub
(
roÙlšk
,
s™e
);

800 
	`Sw­M©riûs
(
roÙlšk
,
s™e
);

802 
log¿tio
 = 
mnode
->
	`Upd©e
(è+ 
logha¡šgs
;

804 
boŞ
 
acû±ed
 = (
	`log
(
Rªdom
::
	`UnifÜm
()è< 
log¿tio
);

805 ià(
acû±ed
) {

806 
Çcc
++;

809 
	`Re¡ÜeNodeS‹s
(
roÙlšk
,
s™e
);

810 
mnode
->
	`CÜru±
(
çl£
);

811 
mnode
->
	`Re¡Üe
();

813 
d–‘e
 
mnode
;

815  ((è
Çcc
è/ 
Ä•
;

816 
	}
}

818 
	gPhyloProûss
::
	$Re£tFÏgM­
(cÚ¡ 
Lšk
* 
äom
, 
boŞ
 
š
) {

819 
æagm­
[
äom
->
	`G‘Node
()] = 
š
;

820 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

821 
	`Re£tFÏgM­
(
lšk
->
	`Out
(),
š
);

823 
	}
}

825 cÚ¡ 
Lšk
* 
	gPhyloProûss
::
	$Choo£NodeS‘
(cÚ¡ 
Lšk
* 
äom
, 
s01
, 
s10
, 
sw
) {

827 cÚ¡ 
Lšk
* 
»t
 = 0;

828 ià(
sw
 == 0) {

829 ià(
Rªdom
::
	`UnifÜm
(è< 
s01
) {

830 
sw
 = 1;

831 
»t
 = 
äom
;

832 
æagm­
[
äom
->
	`G‘Node
()] = 
Œue
;

835 ià(
sw
 == 1) {

836 ià(
Rªdom
::
	`UnifÜm
(è< 
s10
) {

837 
sw
 = 2;

840 ià(
sw
 < 2) {

841 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

842 cÚ¡ 
Lšk
* 
tmp
 = 
	`Choo£NodeS‘
(
lšk
->
	`Out
(),
s01
,
s10
,
sw
);

843 ià(! 
»t
 && 
tmp
) {

844 
»t
 = 
tmp
;

848  
»t
;

849 
	}
}

852 
	gPhyloProûss
::
	$PriÜSam¶e
() {

854 
i
=0; i<
	`G‘Ns™e
(); i++) {

855 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
i
)) {

856 
	`PriÜSam¶e
(
	`G‘RoÙ
(),
i
,
Œue
);

859 
	}
}

861 
	gPhyloProûss
::
	$Po¡P»dSam¶e
(
boŞ
 
roÙ´iÜ
) {

862 
i
=0; i<
	`G‘Ns™e
(); i++) {

863 
	`Po¡P»dSam¶e
(
i
,
roÙ´iÜ
);

865 
	}
}

867 
	gPhyloProûss
::
	$Po¡P»dSam¶e
(
s™e
, 
boŞ
 
roÙ´iÜ
) {

869 ià(! 
	`isMissšg
(
	`G‘RoÙ
()->
	`G‘Node
(),
s™e
)) {

870 
	`Prunšg
(
	`G‘RoÙ
(),
s™e
);

871 
	`PriÜSam¶e
(
	`G‘RoÙ
(),
s™e
,
roÙ´iÜ
);

873 
	}
}

875 
	gPhyloProûss
::
	$Move
(
tunšg
) {

876 
i
=0; i<
	`G‘Ns™e
(); i++) {

877 
s™—¼ay
[
i
] = (
Rªdom
::
	`UnifÜm
(è< 
tunšg
);

879 
	`Re§m¶eSub
();

881 
	}
}

883 
	gPhyloProûss
::
	$G‘L—fD©a
(
Sequ’ûAlignm’t
* 
d©a
) {

884 
	`RecursiveG‘L—fD©a
(
	`G‘RoÙ
(),
d©a
);

885 
	}
}

887 
	gPhyloProûss
::
	$RecursiveG‘L—fD©a
(cÚ¡ 
Lšk
* 
äom
, 
Sequ’ûAlignm’t
* 
d©a
) {

889 ià(
äom
->
	`isL—f
()) {

890 
s™e
=0; s™e<
	`G‘Ns™e
(); site++) {

891 
¡©e
 = 
	`G‘S‹
(
äom
->
	`G‘Node
(),
s™e
);

892 
obs¡©e
 = 
	`G‘D©a
(
äom
->
	`G‘Node
()->
	`G‘Index
(),
s™e
);

893 ià(
obs¡©e
 !ğ
unknown
) {

894 
d©a
->
	`S‘S‹
(
äom
->
	`G‘Node
()->
	`G‘Index
(),
s™e
,
¡©e
);

897 
d©a
->
	`S‘S‹
(
äom
->
	`G‘Node
()->
	`G‘Index
(),
s™e
,
unknown
);

901 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

902 
	`RecursiveG‘L—fD©a
(
lšk
->
	`Out
(),
d©a
);

904 
	}
}

907 
	gPhyloProûss
::
	$G‘L—fF»qs
(cÚ¡ 
Lšk
* 
äom
, ** 
xäeq
) {

909 ià(
äom
->
	`isL—f
()) {

910 
s™e
=0; s™e<
	`G‘Ns™e
(); site++) {

911 
¡©e
 = 
	`G‘S‹
(
äom
->
	`G‘Node
(),
s™e
);

912 
obs¡©e
 = 
	`G‘D©a
(
äom
->
	`G‘Node
()->
	`G‘Index
(),
s™e
);

913 ià(
obs¡©e
 !ğ
unknown
) {

914 
xäeq
[
äom
->
	`G‘Node
()->
	`G‘Index
()][
¡©e
]++;

918 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

919 
	`G‘L—fF»qs
(
lšk
->
	`Out
(),
xäeq
);

921 
	}
}

923 
	gPhyloProûss
::
	$Compos™iÚ®H‘”og’e™yIndex
(
o¡»am
& 
os
) {

925 ** 
xäeq
 = 
Ãw
 *[
	`G‘Nxa
()];

926 
j
=0; j<
	`G‘Nxa
(); j++) {

927 
xäeq
[
j
] = 
Ãw
 [
	`G‘MaxN¡©e
()];

928 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

929 
xäeq
[
j
][
k
] = 0;

934 
	`G‘L—fF»qs
(
	`G‘RoÙ
(),
xäeq
);

937 * 
glob®äeq
 = 
Ãw
 [
	`G‘MaxN¡©e
()];

938 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

939 
glob®äeq
[
k
] = 0;

940 
j
=0; j<
	`G‘Nxa
(); j++) {

941 
glob®äeq
[
k
] +ğ
xäeq
[
j
][k];

946 
tÙ®
 = 0;

947 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

948 
tÙ®
 +ğ
glob®äeq
[
k
];

950 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

951 
glob®äeq
[
k
] /ğ
tÙ®
;

953 
j
=0; j<
	`G‘Nxa
(); j++) {

954 
tÙ®
 = 0;

955 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

956 
tÙ®
 +ğ
xäeq
[
j
][
k
];

958 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

959 
xäeq
[
j
][
k
] /ğ
tÙ®
;

960 
os
 << 
xäeq
[
j
][
k
] << '\t';

962 
os
 << '\n';

964 
os
 << '\n';

967 
maxdi¡
 = 0;

968 
j
=0; j<
	`G‘Nxa
(); j++) {

969 
di¡
 = 0;

970 
k
=0; k<
	`G‘MaxN¡©e
(); k++) {

971 
tmp
 = (
xäeq
[
j
][
k
] - 
glob®äeq
[k]);

972 
di¡
 +ğ
tmp
 *mp;

974 ià(
maxdi¡
 < 
di¡
) {

975 
maxdi¡
 = 
di¡
;

978  
maxdi¡
;

979 
	}
}

	@PhyloProcess.h

2 #iâdeà
PHYLOPROCESS_H


3 
	#PHYLOPROCESS_H


	)

5 
	~"MCMC.h
"

6 
	~"B¿nchProûss.h
"

7 
	~"S™eM­pšg.h
"

8 
	~"RªdomB¿nchS™eP©h.h
"

9 
	~"Sequ’ûAlignm’t.h
"

10 
	~"B¿nchS™eSub¡™utiÚProûss.h
"

11 
	~<m­
>

13 
	~"ChrÚo.h
"

45 şas 
	cPhyloProûss
 : 
public
 
MCMC
 {

47 
ä›nd
 
şass
 
ProbMod–
;

49 
	mpublic
:

52 
vœtu®
 
RªdomB¿nchS™eP©h
* 
C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) = 0;

55 
PhyloProûss
(
L’gthT»e
* 
šŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
, 
boŞ
 
šb¿nchm­
 = 
Œue
);

56 
	mvœtu®
 ~
PhyloProûss
();

58 
G‘LogProb
();

59 
G‘Fa¡LogProb
();

60 
G‘P©hLogProb
();

61 
G‘P©hLogProb
(cÚ¡ 
Lšk
* 
äom
, 
s™e
);

62 
S™eLogLik–ihood
(
s™e
);

63 
Fa¡S™eLogLik–ihood
(
s™e
);

65 
d¿wSam¶e
();

66 
Move
(
tunšg
);

68 
S‹S·û
* 
	$G‘S‹S·û
(è{ 
d©a
->
	`G‘S‹S·û
();}

69 
	`S‘S‹S·û
();

70 
	`RecursiveS‘S‹S·û
(cÚ¡ 
Lšk
* 
äom
);

71 
Sequ’ûAlignm’t
* 
	$G‘D©a
(è{ 
d©a
;
	}
}

73 
PrštRoÙLik–ihood
(
o¡»am
& 
os
);

75 
G‘Ns™e
();

76 
G‘Nxa
();

77 
G‘N¡©e
(
s™e
);

78 
G‘MaxN¡©e
();

80 
	$G‘MaxTrŸl
(è{  
maxŒŸl
;
	}
}

81 
	$S‘MaxTrŸl
(
i
è{ 
maxŒŸl
 = i;
	}
}

83 
Re§m¶eSub
();

84 
Re§m¶eSub
(
s™e
);

86 
Po¡P»dSam¶e
(
boŞ
 
roÙ´iÜ
 = 
çl£
);

87 
Po¡P»dSam¶e
(
s™e
, 
boŞ
 
roÙ´iÜ
 = 
çl£
);

94 
Compos™iÚ®H‘”og’e™yIndex
(
o¡»am
& 
os
);

95 
G‘L—fF»qs
(cÚ¡ 
Lšk
* 
äom
, ** 
xäeq
);

97 
G‘L—fD©a
(
Sequ’ûAlignm’t
* 
d©a
);

98 
RecursiveG‘L—fD©a
(cÚ¡ 
Lšk
* 
äom
, 
Sequ’ûAlignm’t
* 
d©a
);

100 
	$CÏmpD©a
(è{
şampd©a
 = 
Œue
;
	}
}

101 
	$UnşampD©a
(è{
şampd©a
 = 
çl£
;
	}
}

105 
B¿nchS™eSub¡™utiÚProûss
* 
	$G‘B¿nchS™eSub¡™utiÚProûss
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

106 ià(
	`isMissšg
(
b¿nch
,
s™e
)) {

107 
û¼
 << "as bssub\n";

108 
	`ex™
(1);

110  (
B¿nchS™eSub¡™utiÚProûss
*è
	`G‘P©h
(
b¿nch
,
s™e
);

111 
	}
}

113 
	gpublic
:

115 & 
G‘S‹
(cÚ¡ 
Node
* 
node
, 
s™e
);

116 
G‘D©a
(
xÚ
, 
s™e
);

117 
boŞ
 
	$isD©aCom·tibË
(
xÚ
, 
s™e
, 
¡©e
) {

118  
	`G‘S‹S·û
()->
	`isCom·tibË
(
	`G‘D©a
(
xÚ
,
s™e
),
¡©e
);

119 
	}
}

121 
T»e
* 
G‘T»e
();

122 
Lšk
* 
G‘RoÙ
();

123 
TaxÚS‘
* 
G‘TaxÚS‘
();

125 
S‘D©a
(
Sequ’ûAlignm’t
* 
d©a
);

126 
vœtu®
 
UnfŞd
();

128 
S‘Name
(
¡ršg
 
šÇme
);

129 
RecursiveS‘Name
(cÚ¡ 
Lšk
* 
äom
, 
¡ršg
 
šÇme
);

131 
	$G‘TÙMissšg
(cÚ¡ 
Node
* 
node
) {

132  
tÙmissšgm­
[
node
];

133 
	}
}

135 
boŞ
 
	$isMissšg
(cÚ¡ 
Node
* 
node
, 
s™e
) {

136  
missšgm­
[
node
][
s™e
];

137 
	}
}

139 
boŞ
 
	$isMissšg
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
) {

140 ià((! 
missšgm­
[
lšk
->
	`G‘Node
()][
s™e
]è&& (! missšgm­[lšk->
	`Out
()->G‘Node()][s™e]è&& (
·thm­
[lšk->
	`G‘B¿nch
()]) && (!…athmap[link->GetBranch()][site])) {

141 
û¼
 << "error in is missing\n";

142 
	`ex™
(1);

144  (
missšgm­
[
lšk
->
	`G‘Node
()][
s™e
] || missšgm­[lšk->
	`Out
()->GetNode()][site]);

145 
	}
}

147 
boŞ
 
	$isMissšg
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

148  (! 
·thm­
[
b¿nch
][
s™e
]);

149 
	}
}

151 
C»©eMissšgM­
();

152 
RecursiveC»©eMissšgM­
(cÚ¡ 
Lšk
* 
äom
);

153 
boŞ
 
FlMissšgM­
(cÚ¡ 
Lšk
* 
äom
, 
s™e
);

154 
Compu‹TÙ®MissšgP”S™e
(cÚ¡ 
Lšk
* 
äom
);

156 * 
	$G‘CÚdLik–ihood
(cÚ¡ 
Lšk
* 
äom
) {

157  
cÚdlm­
[
äom
];

158 
	}
}

166 
	$G‘PrunšgTime
() {

167  
´unšgchrÚo
.
	`G‘Time
();

168 
	}
}

177 
	$G‘Re§m¶eTime
() {

178  
»§m¶echrÚo
.
	`G‘Time
();

179 
	}
}

181 
	g´Ùeùed
:

184 
RªdomB¿nchS™eP©h
** 
C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
lšk
);

185 
D–‘eP©h
(cÚ¡ 
Lšk
* 
lšk
);

187 
CËªup
();

189 
RecursiveC»©e
(cÚ¡ 
Lšk
* 
lšk
);

190 
RecursiveD–‘e
(cÚ¡ 
Lšk
* 
lšk
);

192 
RecursiveC»©eTBL
(cÚ¡ 
Lšk
* 
lšk
, 
šn¡©e
);

193 
RecursiveD–‘eTBL
(cÚ¡ 
Lšk
* 
lšk
);

195 
Prunšg
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
);

196 
Re§m¶eSub
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
);

197 
Re§m¶eS‹
();

198 
Re§m¶eS‹
(
s™e
);

199 
PrunšgAnû¡¿l
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
);

200 
RecÜdPrunšgAnû¡¿lLogProb
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
);

201 
PriÜSam¶e
(cÚ¡ 
Lšk
* 
lšk
, 
s™e
, 
boŞ
 
roÙ´iÜ
);

202 
PriÜSam¶e
();

203 
RoÙPo¡”iÜD¿w
(
s™e
);

205 
	gpublic
:

207 şas 
	cPhyloProûssS™eM­pšg
 : 
public
 
S™eM­pšg
 {

209 
public
:

210 
PhyloProûssS™eM­pšg
(
PhyloProûss
* 
š´oûss
, 
i
);

211 
T»e
* 
G‘T»e
();

212 
B¿nchS™eP©h
* 
G‘P©h
(cÚ¡ 
B¿nch
* 
b¿nch
);

214 
	g´iv©e
:

215 
PhyloProûss
* 
my´oûss
;

216 
	gs™e
;

220 
PhyloProûssS™eM­pšg
* 
G‘S™eM­pšg
(
s™e
);

222 
boŞ
 
	$Sam¶eB¿nchM­pšg
() {

223  
b¿nchm­
;

224 
	}
}

229 
L’gthT»e
* 
	gŒ“
;

230 
Sequ’ûAlignm’t
* 
	gd©a
;

232 * 
	gs™—¼ay
;

233 * 
	gs™–nL
;

234 
	gm­
<cÚ¡ 
	gLšk
* , *> 
	gcÚdlm­
;

236 
	gMaxN¡©e
;

238 
boŞ
 
	gşampd©a
;

240 
MHMove
(
Ä•
, 
s01
, 
s10
);

241 
S‘Prİo§lM©riûs
();

243 
RªdomB¿nchS™eP©h
* 
G‘P©h
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
);

245 
	g´iv©e
:

246 
m­
<cÚ¡ 
B¿nch
*,
	gRªdomB¿nchS™eP©h
**> 
	g·thm­
;

247 
	gm­
<cÚ¡ 
	gNode
*,*> 
	g¡©em­
;

248 
	gm­
<cÚ¡ 
	gNode
*, > 
	gbk¡©em­
;

249 
	gm­
<cÚ¡ 
	gNode
*,
	gboŞ
*> 
	gmissšgm­
;

250 
	gm­
<cÚ¡ 
	gNode
*,> 
	gtÙmissšgm­
;

252 
RecursiveS‘Prİo§lM©riûs
(cÚ¡ 
Lšk
* 
äom
);

256 
vœtu®
 
SubM©rix
* 
	$G‘Prİo§lM©rix
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

258 
	}
}

260 
BackupNodeS‹s
(cÚ¡ 
Lšk
* 
äom
, 
s™e
);

261 
Re¡ÜeNodeS‹s
(cÚ¡ 
Lšk
* 
äom
, 
s™e
);

263 
Prİo£Re§m¶eSub
(cÚ¡ 
Lšk
* 
äom
, 
s™e
);

264 
Sw­M©riûs
(cÚ¡ 
Lšk
* 
äom
, 
s™e
);

265 
RecursiveRegi¡”
(cÚ¡ 
Lšk
* 
äom
, 
s™e
, 
Mnode
* 
mnode
);

266 
Re£tFÏgM­
(cÚ¡ 
Lšk
* 
äom
, 
boŞ
 
š
);

267 cÚ¡ 
Lšk
* 
Choo£NodeS‘
(cÚ¡ Lšk* 
äom
, 
s01
, 
s10
, 
sw
);

268 
	gm­
<cÚ¡ 
	gNode
*,
	gboŞ
> 
	gæagm­
;

270 
	gmaxŒŸl
;

271 
PhyloProûssS™eM­pšg
** 
	gs™em­pšg
;

272 cÚ¡ 
	gunknown
 = -1;

274 cÚ¡ 
	gDEFAULTMAXTRIAL
 = 100;

277 
ChrÚo
 
	g´unšgchrÚo
;

279 
ChrÚo
 
	g»§m¶echrÚo
;

281 
boŞ
 
	gb¿nchm­
;

295 
šlše
 
	gPhyloProûss
::
PhyloProûssS™eM­pšg
::
	$PhyloProûssS™eM­pšg
(
PhyloProûss
* 
š´oûss
, 
i
è: 
	`my´oûss
(š´oûss), 
	$s™e
(
i
è{
	}
}

296 
šlše
 
T»e
* 
	gPhyloProûss
::
PhyloProûssS™eM­pšg
::
	$G‘T»e
(è{ 
my´oûss
->
	`G‘T»e
();
	}
}

297 
šlše
 
B¿nchS™eP©h
* 
	gPhyloProûss
::
PhyloProûssS™eM­pšg
::
	$G‘P©h
(cÚ¡ 
B¿nch
* 
b¿nch
) {

298 ià(
my´oûss
->
	`isMissšg
(
b¿nch
,
s™e
)) {

299 
û¼
 << "PhyloProcessSiteMapping::GetPath called on‚ull…ath\n";

300 
	`ex™
(1);

302  
my´oûss
->
	`G‘P©h
(
b¿nch
,
s™e
);

303 
	}
}

309 
šlše
 
	gPhyloProûss
::
	$G‘Ns™e
(è{ 
d©a
->
	`G‘Ns™e
();
	}
}

310 
šlše
 
	gPhyloProûss
::
	$G‘Nxa
(è{ 
d©a
->
	`G‘Nxa
();
	}
}

311 
šlše
 
	gPhyloProûss
::
	$G‘N¡©e
(
s™e
) {

312 ià(
	`isMissšg
(
	`G‘RoÙ
(),
s™e
)) {

315  
	`G‘B¿nchS™eSub¡™utiÚProûss
(0,
s™e
)->
	`G‘N¡©e
();

316 
	}
}

318 
šlše
 
RªdomB¿nchS™eP©h
* 
	gPhyloProûss
::
	$G‘P©h
(cÚ¡ 
B¿nch
* 
b¿nch
, 
s™e
) {

319 ià(! 
·thm­
[
b¿nch
][
s™e
]) {

320 
û¼
 << "error in…hyloprocess::getpath:‚ull…ath\n";

321 
	`ex™
(1);

323  
·thm­
[
b¿nch
][
s™e
];

324 
	}
}

332 
šlše
 & 
	gPhyloProûss
::
	$G‘S‹
(cÚ¡ 
Node
* 
node
, 
s™e
è{ 
¡©em­
[node][s™e];
	}
}

333 
šlše
 
	gPhyloProûss
::
	$G‘D©a
(
xÚ
, 
s™e
è{ 
d©a
->
	`G‘S‹
ÑaxÚ,s™e);
	}
}

334 
šlše
 
T»e
* 
	gPhyloProûss
::
	$G‘T»e
(è{ 
Œ“
->
	`G‘T»e
();
	}
}

335 
šlše
 
Lšk
* 
	gPhyloProûss
::
	$G‘RoÙ
(è{ 
	`G‘T»e
()->
	`G‘RoÙ
();
	}
}

336 
šlše
 
TaxÚS‘
* 
	gPhyloProûss
::
	$G‘TaxÚS‘
(è{ 
d©a
->
	`G‘TaxÚS‘
();
	}
}

338 
šlše
 
	gPhyloProûss
::
PhyloProûssS™eM­pšg
* 
PhyloProûss
::
	$G‘S™eM­pšg
(
s™e
è{ 
s™em­pšg
[s™e];
	}
}

	@PhyloProcessMHMove.h

2 #iâdeà
PHYLOMHMOVE_H


3 
	#PHYLOMHMOVE_H


	)

5 
	~"Move.h
"

6 
	~"PhyloProûss.h
"

8 şas 
	cPhyloProûssMHMove
 : 
public
 
MCUpd©e
 {

10 
public
:

12 
	$PhyloProûssMHMove
(
PhyloProûss
* 
š´oûss
, 
šÄ•
, 
šs01
, 
šs10
) {

13 
´oûss
 = 
š´oûss
;

14 
Ä•
 = 
šÄ•
;

15 
s01
 = 
šs01
;

16 
s10
 = 
šs10
;

19 
	$Move
(
tunšg_moduÏtÜ
){

20  
´oûss
->
	`MHMove
(
Ä•
,
s01
,
s10
);

21 
	}
}

23 
	g´Ùeùed
:

25 
PhyloProûss
* 
´oûss
;

26 
	gÄ•
;

27 
	gs01
;

28 
	gs10
;

	@PoissonGamma.cpp

2 
	~"ProbMod–.h
"

3 
	~"RªdomTy³s.h
"

5 şas 
	cPoissÚGammaMod–
 : 
public
 
ProbMod–
 {

7 
N
;

8 * 
	md©a
;

10 
	mCÚ¡
<
	mPosR—l
>* 
	mOÃ
;

12 
ExpÚ’tŸl
* 
	mth‘a
;

13 
ExpÚ’tŸl
* 
	msigma
;

16 
Gamma
** 
	momega
;

17 
Produù
** 
	m¿‹
;

18 
PoissÚ
** 
	mX
;

20 
	mpublic
:

22 
	$PoissÚGammaMod–
(
šN
, * 
šd©a
) {

24 
N
 = 
šN
;

25 
d©a
 = 
šd©a
;

26 
OÃ
 = 
Ãw
 
CÚ¡
<
PosR—l
>(1);

28 
sigma
 = 
Ãw
 
	`ExpÚ’tŸl
(
OÃ
,
ExpÚ’tŸl
::
MEAN
);

29 
th‘a
 = 
Ãw
 
	`ExpÚ’tŸl
(
OÃ
,
ExpÚ’tŸl
::
MEAN
);

31 
omega
 = 
Ãw
 
Gamma
*[
N
];

32 
¿‹
 = 
Ãw
 
Produù
*[
N
];

33 
X
 = 
Ãw
 
PoissÚ
*[
N
];

35 
i
=0; i<
N
; i++) {

36 
omega
[
i
] = 
Ãw
 
	`Gamma
(
th‘a
,theta);

37 
¿‹
[
i
] = 
Ãw
 
	`Produù
(
omega
[i],
sigma
);

38 
X
[
i
] = 
Ãw
 
	`PoissÚ
(
¿‹
[i]);

39 
X
[
i
]->
	`CÏmpAt
(
d©a
[i]);

42 
	`RoÙRegi¡”
(
OÃ
);

43 
	`Regi¡”
();

44 
	`Upd©e
();

45 
	`MakeScheduËr
();

49 ~
	$PoissÚGammaMod–
(è{
	}
}

52 
vœtu®
 
	$MakeScheduËr
() {

54 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
sigma
,0.1),1,"sigma");

55 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
sigma
,0.01),1,"sigma");

57 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
th‘a
,0.1),1,"theta");

58 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
th‘a
,0.01),1,"theta");

60 
i
=0; i<
N
; i++) {

61 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
omega
[
i
],1),1,"omega");

62 
scheduËr
.
	`Regi¡”
(
Ãw
 
	`Sim¶eMove
(
omega
[
i
],0.1),1,"omega");

64 
	}
}

66 
	$G‘M—nOmega
() {

68 
m—n
 = 0;

69 
i
=0; i<
N
; i++) {

70 
m—n
 +ğ
omega
[
i
]->
	`v®
();

73 
m—n
 /ğ
N
;

74  
m—n
;

75 
	}
}

77 
	$T¿ûH—d”
(
o¡»am
& 
os
) {

78 
os
 << "logprob\ttheta\tsigma\tmeeanomega\n";

79 
	}
}

81 
	$T¿û
(
o¡»am
& 
os
) {

82 
os
 << 
	`G‘LogProb
(è<< '\t' << 
th‘a
->
	`v®
(è<< '\t' << 
sigma
->v®(è<< '\t' << 
	`G‘M—nOmega
() << '\n';

83 
	}
}

85 
	$G‘LogProb
() {

87 
tÙ
 = 0;

88 
tÙ
 +ğ
sigma
->
	`G‘LogProb
();

89 
tÙ
 +ğ
th‘a
->
	`G‘LogProb
();

90  
tÙ
;

91 
	}
}

93 
	$d¿wSam¶e
() {

95 
sigma
->
	`Sam¶e
();

96 
th‘a
->
	`Sam¶e
();

97 
i
=0; i<
N
; i++) {

98 
omega
[
i
]->
	`Sam¶e
();

100 
	}
}

102 
	$ToSŒ—m
(
o¡»am
& 
os
è{
	}
}

103 
	$FromSŒ—m
(
i¡»am
& 
is
è{
	}
}

108 
	$maš
(
¬gc
, * 
¬gv
[]) {

110 
if¡»am
 
	`is
(
¬gv
[1]);

111 
¡ršg
 
Çme
 = 
¬gv
[2];

113 
N
;

114 
is
 >> 
N
;

115 * 
d©a
 = 
Ãw
 [
N
];

116 
i
=0; i<
N
; i++) {

117 
is
 >> 
d©a
[
i
];

120 
PoissÚGammaMod–
* 
mod–
 = 
Ãw
 
	`PoissÚGammaMod–
(
N
,
d©a
);

121 
of¡»am
 
	`os
((
Çme
 + ".Œaû").
	`c_¡r
());

122 
mod–
->
	`T¿ûH—d”
(
os
);

125 
mod–
->
	`Move
(1.0);

126 
mod–
->
	`T¿û
(
os
);

128 
	}
}

	@ProbModel.cpp

2 
	~<c¡dlib
>

4 
	~"ProbMod–.h
"

6 
	gProbMod–
::
	$ProbMod–
(è: 
	$scheduËr
(
this
è{
	}
}

8 
ProbMod–
::~
	$ProbMod–
(è{
	}
}

10 
boŞ
 
ProbMod–
::
	$CheckUpd©eFÏgs
() {

11 
boŞ
 
»t
 = 
Œue
;

12 
ş™
 
i
=
roÙ
.
	`begš
(); i!ôoÙ.
	`’d
(); ++i) {

13 
»t
 &ğ(*
i
)->
	`CheckUpd©eFÏgs
();

15  
»t
;

16 
	}
}

18 
	gProbMod–
::
	$Regi¡”
(
DAGnode
* 
v¬
) {

19 
¡©e
.
	`š£¹
(
v¬
);

20 
	}
}

22 
	gProbMod–
::
	$RoÙRegi¡”
(
DAGnode
* 
v¬
) {

23 
roÙ
.
	`š£¹
(
v¬
);

24 
	}
}

26 
	gProbMod–
::
	$CÜru±
() {

27 
m­
<
DAGnode
*,> 
m
;

28 
ş™
 
i
=
roÙ
.
	`begš
(); i!ôoÙ.
	`’d
(); ++i) {

29 (*
i
)->
	`FuÎCÜru±
(
m
);

31 
	}
}

33 
	gProbMod–
::
	$Upd©e
(
boŞ
 
check
) {

34 
	`CÜru±
();

35 
tÙ®
 = 0;

36 
ş™
 
i
=
roÙ
.
	`begš
(); i!ôoÙ.
	`’d
(); ++i) {

37 
tÙ®
 +ğ(*
i
)->
	`FuÎUpd©e
(
check
);

39 
DAGnode
::
š™mode
 = 
çl£
;

40  
tÙ®
;

41 
	}
}

43 
	gProbMod–
::
	$Regi¡”
() {

56 
	}
}

59 
ProbMod–
::
	$Move
(
tunšg_moduÏtÜ
, 
ncyşe
, 
boŞ
 
v”bo£
, boŞ 
check
) {

60 
scheduËr
.
	`Cyşe
(
tunšg_moduÏtÜ
,
ncyşe
,
v”bo£
,
check
);

62 
	}
}

64 
	gProbMod–
::
	$MÚ™Ü
(
o¡»am
& 
os
, o¡»am& 
osd‘a
) {

65 
scheduËr
.
	`ToSŒ—m
(
os
, 
osd‘a
);

66 
	`D‘as
(
osd‘a
);

67 
	}
}

	@ProbModel.h

1 #iâdeà
PROBMODEL_H


2 
	#PROBMODEL_H


	)

4 
	~<£t
>

5 
	~<io¡»am
>

6 
	~"DAGnode.h
"

7 
	~"Move.h
"

24 
şass
 
	gMCScheduËr
;

26 şas 
	cProbMod–
 : 
public
 
MCMC
 {

28 
public
:

30 
ProbMod–
();

32 
	mvœtu®
 ~
ProbMod–
();

35 
Regi¡”
();

36 
Regi¡”
(
DAGnode
* 
v¬
);

39 
RoÙRegi¡”
(
DAGnode
* 
v¬
);

42 
vœtu®
 
G‘LogProb
() = 0;

44 
vœtu®
 
MakeScheduËr
() = 0;

48 
vœtu®
 
	$Move
(
tunšg_moduÏtÜ
 = 1è{  
	`Move
Ñunšg_moduÏtÜ, 1, 
çl£
, false);}

50 
vœtu®
 
	`Move
(
tunšg_moduÏtÜ
, 
ncyşe
, 
boŞ
 
v”bo£
, boŞ 
check
);

52 
	`CÜru±
();

53 
vœtu®
 
	`Upd©e
(
boŞ
 
check
 = 
çl£
);

55 
boŞ
 
	`CheckUpd©eFÏgs
();

58 
vœtu®
 
	`ToSŒ—m
(
o¡»am
& 
os
) = 0;

60 
vœtu®
 
	`FromSŒ—m
(
i¡»am
& 
is
) = 0;

63 
vœtu®
 
	$T¿û
(
o¡»am
& 
os
è{
	}
};

64 
vœtu®
 
	$T¿ûH—d”
(
o¡»am
& 
os
è{
	}
};

65 
vœtu®
 
MÚ™Ü
(
o¡»am
& 
os
, o¡»am& 
osd‘a
);

68 
vœtu®
 
	$D‘as
(
o¡»am
& 
os
è{
	}
};

69 
vœtu®
 
	$‹¡
(è{
	}
}

71 
	g£t
<
	gDAGnode
*> 
	g¡©e
;

72 
	g£t
<
	gDAGnode
*> 
	groÙ
;

74 
MCScheduËr
 
	gscheduËr
;

	@PureBrownianProcess.cpp

1 
	~"Pu»BrownŸnProûss.h
"

3 
	gPu»BrownŸnProûss
::
Pu»BrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
V¬
<
CovM©rix
> *
šsigma
, V¬<
PosR—l
>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
)

5 
S‘W™hRoÙ
(
çl£
);

6 
	gŒ“
 = 
šŒ“
;

7 
	gsigma
 = 
šsigma
;

8 
	gagesÿË
 = 
šagesÿË
;

9 
	gsÿËfunùiÚ
 = 
šsÿËfunùiÚ
;

12 
RecursiveC»©e
(
G‘RoÙ
());

16 
	gPu»BrownŸnProûss
::~
	$Pu»BrownŸnProûss
()

18 
	`RecursiveD–‘e
(
	`G‘RoÙ
());

19 
	}
}

23 
	gRv¬
<
	gBrownŸnBridge
> * 
	gPu»BrownŸnProûss
::
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

25 ià(
lšk
->
	`isRoÙ
()) {

26 
û¼
 << "error : create branch val called on„oot\n";

27 
	`ex™
(1);

34 
V¬
<
PosR—l
>* 
up
 = 
	`G‘L’gthT»e
()->
	`G‘NodeD©e
(
lšk
->
	`G‘Node
());

35 
V¬
<
PosR—l
>* 
down
 = 
	`G‘L’gthT»e
()->
	`G‘NodeD©e
(
lšk
->
	`Out
()->
	`G‘Node
());

39  
Ãw
 
	`RªdomBrownŸnP©h
(
up
, 
down
, 
sigma
);

41 
	}
}

44 
	gPu»BrownŸnProûss
::
	$Move
(
tunšg
) {

45 
n
 = 0;

46 
tÙ
 = 
	`Move
(
this
->
	`G‘RoÙ
(),
tunšg
,
n
);

47  
tÙ
 / 
n
;

48 
	}
}

50 
	gPu»BrownŸnProûss
::
	$Move
(
Lšk
* 
äom
, 
tunšg
, & 
couÁ
) {

51 
tÙ®
 = 0;

52 if(!
äom
->
	`isRoÙ
()) {

53 
tÙ®
 = 
this
->
	`G‘B¿nchV®
(
äom
->
	`G‘B¿nch
())->
	`Move
(
tunšg
);

54 
couÁ
++;

56 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

57 
tÙ®
 +ğ
	`Move
(
lšk
->
	`Out
(),
tunšg
,
couÁ
);

59  
tÙ®
;

60 
	}
}

62 
	gPu»BrownŸnProûss
::
	$G‘LogProb
() {

63  
	`G‘LogProb
(
this
->
	`G‘RoÙ
());

64 
	}
}

66 
	gPu»BrownŸnProûss
::
	$G‘LogProb
(
Lšk
* 
äom
) {

67 
tÙ®
 = 0;

68 if(!
äom
->
	`isRoÙ
())

69 
tÙ®
 = 
this
->
	`G‘B¿nchV®
(
äom
->
	`G‘B¿nch
())->
	`G‘LogProb
();

71 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

72 
tÙ®
 +ğ
	`G‘LogProb
(
lšk
->
	`Out
());

74  
tÙ®
;

75 
	}
}

77 
	gPu»BrownŸnProûss
::
	$CÏmp
() {

78 
	`CÏmp
(
	`G‘RoÙ
());

79 
	}
}

81 
	gPu»BrownŸnProûss
::
	$CÏmp
(
Lšk
* 
äom
) {

82 if(!
äom
->
	`isRoÙ
())

83 
this
->
	`G‘B¿nchV®
(
äom
->
	`G‘B¿nch
())->
	`CÏmp
();

84 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

85 
	`CÏmp
(
lšk
->
	`Out
());

87 
	}
}

89 
	gPu»BrownŸnProûss
::
	$d¿wSam¶e
() {

90 
	`Sam¶eB¿nch
(
this
->
	`G‘RoÙ
());

91 
	}
}

93 
	gPu»BrownŸnProûss
::
	$Sam¶eB¿nch
(
Lšk
* 
äom
) {

95 if(!
äom
->
	`isRoÙ
())

96 
this
->
	`G‘B¿nchV®
(
äom
->
	`G‘B¿nch
())->
	`Sam¶e
();

97 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

98 
	`Sam¶eB¿nch
(
lšk
->
	`Out
());

100 
	}
}

103 
	gCÚjug©ePu»BrownŸnProûss
::
CÚjug©ePu»BrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
CÚjug©eInv”£Wish¬t
 *
šsigma
, 
V¬
<
PosR—l
>* 
šagesÿË
, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
) {

105 
S‘W™hRoÙ
(
çl£
);

106 
	gŒ“
 = 
šŒ“
;

107 
	gsigma
 = 
šsigma
;

108 
	gagesÿË
 = 
šagesÿË
;

109 
	gsÿËfunùiÚ
 = 
šsÿËfunùiÚ
;

110 
	gPu»BrownŸnProûss
::
sigma
 = 
šsigma
;

112 
RecursiveC»©e
(
G‘RoÙ
());

117 
	gRv¬
<
	gBrownŸnBridge
> * 
	gCÚjug©ePu»BrownŸnProûss
::
	$C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

119 ià(
lšk
->
	`isRoÙ
()) {

120 
û¼
 << "error : create branch val called on„oot\n";

121 
	`ex™
(1);

128 
V¬
<
PosR—l
>* 
up
 = 
	`G‘L’gthT»e
()->
	`G‘NodeD©e
(
lšk
->
	`G‘Node
());

129 
V¬
<
PosR—l
>* 
down
 = 
	`G‘L’gthT»e
()->
	`G‘NodeD©e
(
lšk
->
	`Out
()->
	`G‘Node
());

133  
Ãw
 
	`CÚjug©eRªdomBrownŸnP©h
(
up
, 
down
, 
sigma
);

134 
	}
}

	@PureBrownianProcess.h

2 #iâdeà
PUREBROWNIANPROCESS_H


3 
	#PUREBROWNIANPROCESS_H


	)

5 
	~"V®T»e.h
"

6 
	~"RªdomBrownŸnP©h.h
"

7 
	~"ChrÚog¿m.h
"

9 
şass
 
	gPu»BrownŸnProûss
 : 
public
 
B¿nchV®PŒT»e
<
Rv¬
<
BrownŸnBridge
> >,…ubliø
	gMCMC


11 
	gpublic
:

12 
Pu»BrownŸnProûss
() {}

13 
Pu»BrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
V¬
<
CovM©rix
> *
šsigma
, V¬<
PosR—l
>* 
šagesÿË
 = 0, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
 = 0);

14 
	gvœtu®
 ~
Pu»BrownŸnProûss
();

16 
vœtu®
 
	gRv¬
<
	gBrownŸnBridge
> * 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
);

18 
vœtu®
 
Move
(
tunšg
);

19 
vœtu®
 
Move
(
Lšk
* 
äom
, 
tunšg
, & 
couÁ
);

21 
vœtu®
 
G‘LogProb
();

22 
vœtu®
 
G‘LogProb
(
Lšk
* 
äom
);

24 
vœtu®
 
CÏmp
();

25 
vœtu®
 
CÏmp
(
Lšk
* 
äom
);

27 
vœtu®
 
d¿wSam¶e
();

28 
vœtu®
 
Sam¶eB¿nch
(
Lšk
* 
äom
);

30 
RebudSegm’ts
();

31 
RebudSegm’ts
(cÚ¡ 
Lšk
* 
äom
);

34 
vœtu®
 
T»e
* 
G‘T»e
() {

35  
G‘L’gthT»e
()->
G‘T»e
();

38 
ChrÚog¿m
* 
G‘L’gthT»e
() {

39  
	gŒ“
;

42 
RªdomBrownŸnP©h
* 
G‘RªdomBrownŸnP©h
(cÚ¡ 
Lšk
 *
äom
è{ 
	gdyÇmic_ÿ¡
<
	gRªdomBrownŸnP©h
*>(
G‘B¿nchV®
(äom->
G‘B¿nch
()));}

44 
CheckL’gth
() {

45 
CheckL’gth
(
G‘RoÙ
());

48 
RecursivePrİo£Move
(cÚ¡ 
Lšk
* 
äom
, 
tunšg
, 
CovM©rix
& 
cov
) {

49 ià(! 
	gäom
->
isRoÙ
()) {

50 
G‘RªdomBrownŸnP©h
(
äom
)->
Prİo£MoveCov
(
cov
,
tunšg
);

52 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

53 
RecursivePrİo£Move
(
lšk
->
Out
(),
tunšg
,
cov
);

57 
CheckL’gth
(cÚ¡ 
Lšk
* 
äom
) {

58 cÚ¡ 
Lšk
* 
	glšk
 = 
äom
->
Next
();†šk!=äom;†šk = 
lšk
->Next()) {

59 
CheckL’gth
(
lšk
->
Out
());

60 
G‘B¿nchV®
(
lšk
->
G‘B¿nch
())->
checkL’gth
(
Œ“
->
G‘NodeV®
Öšk->
G‘Node
())->
v®
(),»e->G‘NodeV®Öšk->
Out
()->GetNode())->val(),ree->GetBranchVal(link->GetBranch())->val());

64 
	g´Ùeùed
:

66 
ChrÚog¿m
 *
Œ“
;

67 
	gV¬
<
	gCovM©rix
> *
	gsigma
;

68 
	gV¬
<
	gPosR—l
>* 
	gagesÿË
;

69 
Glob®SÿlšgFunùiÚ
* 
	gsÿËfunùiÚ
;

73 şas 
	cCÚjug©ePu»BrownŸnProûss
 : 
public
 
vœtu®
 
Pu»BrownŸnProûss
 {

75 
public
:

77 
CÚjug©ePu»BrownŸnProûss
(
ChrÚog¿m
 *
šŒ“
, 
CÚjug©eInv”£Wish¬t
 *
šsigma
, 
V¬
<
PosR—l
>* 
šagesÿË
 = 0, 
Glob®SÿlšgFunùiÚ
* 
šsÿËfunùiÚ
 = 0);

79 
CÚjug©eRªdomBrownŸnP©h
* 
	$G‘CÚjug©eRªdomBrownŸnP©h
(cÚ¡ 
Lšk
* 
lšk
) {

80 
CÚjug©eRªdomBrownŸnP©h
* 
m
 = 
dyÇmic_ÿ¡
<CÚjug©eRªdomBrownŸnP©h*> (
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()));

81  
m
;

85 
´Ùeùed
:

87 
vœtu®
 
Rv¬
<
BrownŸnBridge
> * 
	`C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
);

89 
CÚjug©eInv”£Wish¬t
* 
sigma
;

91 
V¬
<
PosR—l
>* 
agesÿË
;

92 
Glob®SÿlšgFunùiÚ
* 
sÿËfunùiÚ
;

93 
	}
};

	@Random.cpp

1 
	~"Rªdom.h
"

2 
	~<sys/time.h
>

9 şas 
	c¿ndom_š™
 {

11 
	mpublic
:

12 
	$¿ndom_š™
() {

13 
û¼
 << '\n';

14 
Rªdom
::
	`In™Rªdom
();

19 
û¼
 << "¿ndom s“d : " << 
Rªdom
::
	`G‘S“d
() << '\n';

20 
û¼
 << '\n';

23 
	}
};

25 
¿ndom_š™
 
	gš™
;

27 
	gRªdom
::
S“d
 = 0;

28 
	gRªdom
::
mt_šdex
 = 0;

29 
	gRªdom
::
mt_bufãr
[
MT_LEN
];

31 cÚ¡ 
	gRªdom
::
INFPROB
 = 250;

37 
	gRªdom
::
	$In™Rªdom
(
£ed
) {

39 ià(
£ed
 == -1) {

40 
timev®
 
tod
;

41 
	`g‘timeofday
(&
tod
, 
NULL
);

42 
£ed
 = 
tod
.
tv_u£c
;

44 
S“d
 = 
£ed
;

45 
	`¤ªd
(
£ed
);

46 
i
;

48 ià(
RAND_MAX
 == 32767) {

49 
i
 = 0; i < 
MT_LEN
; i++){

50 
mt_bufãr
[
i
] = 
	`¿nd
() * 32768 +„and();

54 
i
 = 0; i < 
MT_LEN
; i++){

55 
mt_bufãr
[
i
] = 
	`¿nd
();

58 
mt_šdex
 = 0;

59 
	}
}

62 
	gRªdom
::
	$Rªdom
(
£ed
) {

63 
	`In™Rªdom
(
£ed
);

64 
	}
}

66 
	gRªdom
::
	$G‘S“d
() {

67  
S“d
;

68 
	}
}

75 
	gRªdom
::
	$UnifÜm
() {

87 
»t
 = 0;

88 (
»t
 == 0) || (ret == 1)) {

89 * 
b
 = 
mt_bufãr
;

90 
idx
 = 
mt_šdex
;

91 
s
;

92 
i
;

94 ià(
idx
 =ğ
MT_LEN
*())

96 
idx
 = 0;

97 
i
 = 0;

98 ; 
i
 < 
MT_IB
; i++) {

99 
s
 = 
	`TWIST
(
b
, 
i
, i+1);

100 
b
[
i
] = b[˜+ 
MT_IA
] ^ (
s
 >> 1è^ 
	`MAGIC
(s);

102 ; 
i
 < 
MT_LEN
-1; i++) {

103 
s
 = 
	`TWIST
(
b
, 
i
, i+1);

104 
b
[
i
] = b[˜- 
MT_IB
] ^ (
s
 >> 1è^ 
	`MAGIC
(s);

107 
s
 = 
	`TWIST
(
b
, 
MT_LEN
-1, 0);

108 
b
[
MT_LEN
-1] = b[
MT_IA
-1] ^ (
s
 >> 1è^ 
	`MAGIC
(s);

110 
mt_šdex
 = 
idx
 + ();

111 
r
 = *(*)((*)
b
 + 
idx
);

116 
r
 ^= (r >> 11);

117 
r
 ^= (r << 7) & 0x9D2C5680;

118 
r
 ^= (r << 15) & 0xEFC60000;

119 
r
 ^= (r >> 18);

121 
»t
 = ((è
r
) / 65536;

122 
»t
 /= 65536;

124  
»t
;

135 
	}
}

143 
	gRªdom
::
	$PoissÚ
(
mu
) {

145 
n
 = 0;

146 
tÙtime
 = 
Rªdom
::
	`sExpo
();

147 
tÙtime
 < 
mu
) {

148 
n
++;

149 
tÙtime
 +ğ
Rªdom
::
	`sExpo
();

151  
n
;

152 
	}
}

160 
	gRªdom
::
	$AµroxBšomŸl
(
N
, 
p
) {

161  
	`PoissÚ
(
N
 * 
p
);

162 
	}
}

169 
	gRªdom
::
	$Gamma
(
®pha
, 
b‘a
) {

171  
	`sGamma
(
®pha
è/
b‘a
;

172 
	}
}

180 
	gRªdom
::
	$D¿wFromDisü‘eDi¡ributiÚ
(cÚ¡ * 
´ob
, 
n¡©e
) {

181 
Œy
 {

182 
tÙ®
 = 0;

183 
k
=0; k<
n¡©e
; k++) {

184 
tÙ®
 +ğ
´ob
[
k
];

186 
p
 = 
tÙ®
 * 
Rªdom
::
	`UnifÜm
();

187 
tÙ
 = 0;

188 
k
 = -1;

190 
k
++;

191 
tÙ
 +ğ
´ob
[
k
];

192 } (
k
<
n¡©e
è&& (
tÙ
<
p
));

193 ià(
k
==
n¡©e
) {

194 
û¼
 << "finite discrete overflow\n";

195 
k
=0; k<
n¡©e
; k++) {

196 
û¼
 << 
´ob
[
k
] << '\n';

198 
throw
;

200  
k
;

202 
	`ÿtch
(...) {

203 
û¼
 << "error in draw from \n";

204 
throw
;

206 
	}
}

212 
	gRªdom
::
	$D¿wFromUº
 (* 
b
 , 
n
, 
N
) {

215 
i
=0; i<
n
; i++) {

216 
b
[
i
] =0;

218 * 
šdex
 = 
Ãw
 [
N
];

219 
i
=0; i<
N
; i++) {

220 
šdex
[
i
] = 0;

222 
i
=0; i<
n
; i++) {

223 
ŒŸl
 = (è(
Rªdom
::
	`UnifÜm
(è* (
N
-
i
));

224 
k
=0; k<
N
; k++) {

225 ià(
šdex
[
k
]) {

226 ià(
ŒŸl
 >ğ
k
)rial++;

229 ià(
ŒŸl
 =ğ
N
) {

230 
û¼
 << "error in draw from urn: overflow\n";

231 
	`ex™
(1);

233 
b
[
i
] = 
ŒŸl
;

234 ià(
šdex
[
ŒŸl
]) {

235 
û¼
 << "error in draw from urn: chosewicehe same\n";

236 
	`ex™
(1);

238 
šdex
[
ŒŸl
] = 1;

240 
d–‘e
[] 
šdex
;

241 
	}
}

248 
	gRªdom
::
	$Choo£
(
sÿË
) {

249  (è(
Rªdom
::
	`UnifÜm
(è* 
sÿË
);

250 
	}
}

253 
	gRªdom
::
	$Fš™eDisü‘e
(
n
, cÚ¡ * 
´ob¬¿y
) {

255 
tÙ®
 = 0;

256 * 
cumul
 = 
Ãw
 [
n
];

257 
k
=0; k<
n
; k++) {

258 
tÙ®
 +ğ
´ob¬¿y
[
k
];

259 
cumul
[
k
] = 
tÙ®
;

261 
u
 = 
tÙ®
 * 
Rªdom
::
	`UnifÜm
();

262 
k
 = 0;

263 (
k
<
n
è&& (
u
 > 
cumul
[k])) k++;

264 ià(
k
 =ğ
n
) {

265 
û¼
 << "error in Random::FiniteDiscrete\n";

266 
	`ex™
(1);

268 
d–‘e
[] 
cumul
;

269  
k
;

270 
	}
}

277 
	gRªdom
::
	$sNÜm®
() {

279 
u
 = 
Rªdom
::
	`UnifÜm
();

280 ià(
u
 <= 0.8638) {

281 
v
 = 2 * 
Rªdom
::
	`UnifÜm
() - 1;

282 
w
 = 2 * 
Rªdom
::
	`UnifÜm
() - 1;

283  2.3153508 * 
u
 - 1 + 
v
 + 
w
;

285 ià((0.8638 < 
u
) && (u <= 0.9745)) {

286 
v
 = 
Rªdom
::
	`UnifÜm
();

287  1.5 * (
v
 - 1 + 9.0334237 * (
u
 - 0.8638));

289 ià((0.9973002 < 
u
) && (u <= 1)) {

290 
x
,
v
;

292 
v
 = 
Rªdom
::
	`UnifÜm
();

293 
w
 = 
Rªdom
::
	`UnifÜm
();

294 
x
 = 4.5 - 
	`log
(
w
);

295 } 
x
 * 
v
 * v > 4.5);

297 
»t
 = 
	`sq¹
(2*
x
);

298 ià(
u
-0.9986501 > 0) {

299 
»t
 = -ret;

301  
»t
;

303 
x
,
v
,
w
,
tÙ
;

305 
x
 = 6 * 
Rªdom
::
	`UnifÜm
() - 3;

306 
u
 = 
Rªdom
::
	`UnifÜm
();

307 
v
 = (
x
>0) ? x : -x;

308 
w
 = 6.6313339 * (3 - 
v
) * (3 - v);

309 
tÙ
 = 0;

310 ià(
v
<1.5) {

311 
tÙ
 +ğ6.0432809 * (1.5 - 
v
);

313 ià(
v
 <1) {

314 
tÙ
 +ğ13.2626678 * (3 - 
v
*vè- 
w
;

316 } 
u
 > 49.0024445 * 
	`SAFE_EXP
(-0.5 *
v
*vè- 
tÙ
 - 
w
);

317  
x
;

318 
	}
}

325 
	gRªdom
::
	$sExpo
() {

326  -
	`log
(
Rªdom
::
	`UnifÜm
());

327 
	}
}

330 
	$fsign
Ğ
num
, 
sign
 )

333 iàĞĞ
sign
>0.0à&& 
num
<0.0f ) || ( sign<0.0f &&‚um>0.0f ) )

334  -
num
;

335  
num
;

336 
	}
}

343 
	gRªdom
::
	$sGamma
(
a
) {

345 ià(
a
 > 1) {

347 
a1
 = 0;

348 
a2
 = 0;

350 
s2
,
s
,
d
,
t
,
x
,
u
,
q0
,
b
,
sigma
,
c
,
v
,
q
,
e
;

353 ià(
a
 !ğ
a1
) {

354 
a1
 = 
a
;

355 
s2
 = 
a
 - 0.5;

356 
s
 = 
	`sq¹
(
s2
);

357 
d
 = 4 * 
	`sq¹
(2.0è- 12 * 
s
;

361 
t
 = 
	`sNÜm®
();

362 
x
 = 
s
 + 0.5 * 
t
;

363 ià(
t
>0) {

364 ià(!
x
) {

365 
û¼
 << "1\n";

367  
x
 * x;

371 
u
 = 
	`UnifÜm
();

372 ià(
d
*
u
 < 
t
*t*t) {

373 ià(!
x
) {

374 
û¼
 << "2\n";

376  
x
 * x;

380 ià(
a
 !ğ
a2
) {

381 
a2
 = 
a
;

382 
q0
 = 
	`log
(
	`sq¹
(2 * 
Pi
)è- 
	`logGamma
(
a
è- 
s2
 + s2 *†og(s2);

383 ià(
a
<3.686) {

384 
b
 = 0.463 + 
s
 + 0.178*
s2
;

385 
sigma
 = 1.235;

386 
c
 = 0.195 / 
s
 - 0.079 + 0.16 * s;

388 ià(
a
<13.022) {

389 
b
 = 1.654 + 0.0076 * 
s2
;

390 
sigma
 = 1.68 / 
s
 + 0.275;

391 
c
 = 0.062 /
s
 + 0.024;

394 
b
 = 1.77;

395 
sigma
 = 0.75;

396 
c
 = 0.1515/
s
;

401 ià(
x
>0) {

402 
v
 = 0.5 * 
t
 / 
s
;

403 
q
 = 
q0
 - 
s
*
t
+ 0.25*t*ˆ+ 2*
s2
*
	`log
(1.0 + 
v
);

404 ià(
	`log
(1-
u
è< 
q
) {

405 ià(!
x
) {

406 
û¼
 << "3\n";

408  
x
 * x;

414 
e
 = 
	`sExpo
();

415 
u
 = 
	`UnifÜm
();

416 
u
 = u+u-1;

417 
t
 = 
	`çbs
(
e
 * 
sigma
);

418 ià(
u
<0) {

419 
t
 = -t;

421 
t
 +ğ
b
;

423 
t
 <= -0.71874483771719);

425 
v
 = 0.5 * 
t
 / 
s
;

426 
q
 = 
q0
 - 
s
*
t
+ 0.25*t*ˆ+ 2*
s2
*
	`log
(1.0 + 
v
);

429 (
q
<0è|| (
c
 * 
	`çbs
(
u
è> (
	`exp
(q)-1è*ƒxp(
e
 - 0.5 * 
t
*t)));

431 
x
 = 
s
 + 0.5 * 
t
;

440  
x
 * x;

446 
x
,
y
;

448 
u
 = 
Rªdom
::
	`UnifÜm
();

449 
v
 = 
Rªdom
::
	`UnifÜm
();

450 
x
 = 
	`SAFE_EXP
(
	`log
(
u
)/
a
);

451 
y
 = 
	`SAFE_EXP
(
	`log
(
v
è/ (1-
a
));

452 } 
x
+
y
 > 1);

454 
e
 = -
	`log
(
Rªdom
::
	`UnifÜm
());

456  
e
*
x
/(x+
y
);

459 
	}
}

466 
	gRªdom
::
	$logGamma
(
®pha
) {

469 ià(
®pha
 < 0) {

470 
û¼
 << "error in†oggamma: only…ositive‡rgument\n";

471 
	`ex™
(1);

474 
tÙ
ğ
gammacÛfs
[0];

475 
f
 = 
®pha
;

476 
i
=1; i<8; i++) {

477 
tÙ
 +ğ
gammacÛfs
[
i
] / (
f
++);

479  
	`log
(
tÙ
 * 
	`sq¹
(2 * 
Pi
)è- 
®pha
 - 6.5 + (alpha-0.5) *†og(alpha + 6.5);

480 
	}
}

482 
	gRªdom
::
	$logMuÉiv¬Ÿ‹Gamma
(
a
, 
p
) {

484 ià(2*
a
 <ğ(
p
-1)) {

485 
û¼
 << "error in Random::logMultivariateGamma\n";

486 
û¼
 << "·¿m‘” ouˆoàbound: " << 
a
 << '\t' << 
p
 << '\n';

487 
	`ex™
(1);

489 
»t
 = 
p
 * (p-1è/ 4 * 
	`log
(
Pi
);

490 
j
=1; j<=
p
; j++) {

491 
»t
 +ğ
	`logGamma
(
a
 + (1-
j
)/2);

493  
»t
;

494 
	}
}

	@Random.h

1 #iâdeà
RANDOM_H


2 
	#RANDOM_H


	)

4 
	~<cm©h
>

5 
	~<c¡dlib
>

6 
	~<io¡»am
>

7 
	~<s¡»am
>

8 
	~<iomª
>

9 
	~<f¡»am
>

11 
	#MT_LEN
 624

	)

13 
	#MT_IA
 397

	)

14 
	#MT_IB
 (
MT_LEN
 - 
MT_IA
)

	)

15 
	#UPPER_MASK
 0x80000000

	)

16 
	#LOWER_MASK
 0x7FFFFFFF

	)

17 
	#MATRIX_A
 0x9908B0DF

	)

18 
	#TWIST
(
b
,
i
,
j
è((b)[i] & 
UPPER_MASK
è| ((b)[j] & 
LOWER_MASK
)

	)

19 
	#MAGIC
(
s
è(((s)&1)*
MATRIX_A
)

	)

22 
	#SAFE_EXP
(
x
è
	`exp
(x)

	)

25 
usšg
 
Çme¥aû
 
	g¡d
;

27 cÚ¡ 
	ggammacÛfs
[] = {0.9999999999995183,676.5203681218835,-1259.139216722289,771.3234287757674,-176.6150291498386,12.50734324009056,-0.1385710331296526,0.9934937113930748e-05,0.1659470187408462e-06};

28 cÚ¡ 
	gPi
 = 3.1415926535897932384626;

29 cÚ¡ 
	gLogroÙ2pi
 =0.918938533204673;

31 şas 
	cRªdom
 {

33 
	mpublic
:

35 cÚ¡ 
INFPROB
;

37 
Rªdom
(
£ed
 = -1);

39 
In™Rªdom
(
£ed
 = -1);

41 
G‘S“d
();

43 
UnifÜm
();

44 
AµroxBšomŸl
(
N
, 
p
);

45 
PoissÚ
(
mu
);

46 
Gamma
(
®pha
,
b‘a
);

47 
sNÜm®
();

48 
sExpo
();

49 
sGamma
();

50 
sGammªew
();

52 
Choo£
();

53 
Fš™eDisü‘e
(
n
, cÚ¡ * 
´ob¬¿y
);

54 
D¿wFromUº
(*, 
n
, 
N
);

55 
D¿wFromDisü‘eDi¡ributiÚ
(cÚ¡ * 
p
, 
n
);

57 
logGamma
(
a
);

59 
logMuÉiv¬Ÿ‹Gamma
(
a
, 
p
);

60 
	m´iv©e
:

62 
S“d
;

63 
	mmt_šdex
;

64 
	mmt_bufãr
[
MT_LEN
];

	@RandomBranchSitePath.cpp

1 
	~<veùÜ
>

2 
	~<®gÜ™hm
>

3 
	~<ut™y
>

5 
	~"RªdomB¿nchS™eP©h.h
"

6 
	~"PhyloProûss.h
"

12 
S‹S·û
* 
	gRªdomB¿nchS™eP©h
::
	$G‘S‹S·û
(è{ 
	`G‘PhyloProûss
()->
	`G‘S‹S·û
();
	}
}

14 
boŞ
 
	gRªdomB¿nchS™eP©h
::
	$Sam¶eB¿nchM­pšg
() {

15  
my´oûss
->
	`Sam¶eB¿nchM­pšg
();

16 
	}
}

18 
	gRªdomB¿nchS™eP©h
::
	$S‘Up
(
RªdomB¿nchS™eP©h
* 
šup
) {

21 
	}
}

23 
boŞ
 
RªdomB¿nchS™eP©h
::
	$Re§m¶eAcû±Rejeù
(
maxŒŸl
) {

25 
ÁrŸl
 = 0;

27 
ÁrŸl
++;

28 
	`Re£t
(
¡©eup
);

29 
t
 = 0;

30 
tÙ®time
 = 
	`G‘Time
();

31 
¡©e
 = 
¡©eup
;

33 ià(
¡©e
 !ğ
¡©edown
) {

34 
u
 = 
	`D¿wWa™šgTimeGiv’AtL—¡OÃ
(
¡©e
,
tÙ®time
);

35 
t
 +ğ
u
;

36 
Ãw¡©e
 = 
	`D¿wOÃS‹p
(
¡©e
);

37 
	`Aµ’d
(
Ãw¡©e
,
u
/
tÙ®time
);

38 
¡©e
 = 
Ãw¡©e
;

40 
t
 < 
tÙ®time
) {

41 
u
 = 
	`D¿wWa™šgTime
(
¡©e
);

42 
t
 +ğ
u
;

43 ià(
t
 < 
tÙ®time
) {

44 
Ãw¡©e
 = 
	`D¿wOÃS‹p
(
¡©e
);

45 
	`Aµ’d
(
Ãw¡©e
,
u
/
tÙ®time
);

46 
¡©e
 = 
Ãw¡©e
;

49 
t
 -ğ
u
;

50 
u
 = 
tÙ®time
 - 
t
;

51 
Ï¡
->
	`S‘R–©iveTime
(
u
/
tÙ®time
);

52 
t
 = 
tÙ®time
;

55 } (
ÁrŸl
 < 
maxŒŸl
è&& (
Ï¡
->
	`G‘S‹
(è!ğ
¡©edown
));

56  (
Ï¡
->
	`G‘S‹
(è=ğ
¡©edown
);

57 
	}
}

59 
	gRªdomB¿nchS™eP©h
::
	$Re§m¶eUnifÜmized
() {

62 
m
 = 
	`D¿wUnifÜmizedSub¡™utiÚNumb”
(
¡©eup
, 
¡©edown
);

64 
veùÜ
<> 
	`y
(
m
+1);

65 
r
=0;„<
m
;„++) {

66 
y
[
r
] = 
Rªdom
::
	`UnifÜm
();

68 
y
[
m
] = 1;

69 
	`sÜt
(
y
.
	`begš
(),y.
	`’d
());

71 
¡©e
 = 
¡©eup
;

73 
	`Re£t
(
¡©eup
);

75 
t
 = 
y
[0];

76 
r
=0;„<
m
;„++) {

77 
k
 = (
r
=ğ
m
-1è? 
¡©edown
 : 
	`D¿wUnifÜmizedT¿ns™iÚ
(
¡©e
,statedown,m-r-1);

78 ià(
k
 !ğ
¡©e
) {

79 
	`Aµ’d
(
k
,
t
);

80 
t
 = 0;

82 
¡©e
 = 
k
;

83 
t
 +ğ
y
[
r
+1] - y[r];

85 
Ï¡
->
	`S‘R–©iveTime
(
t
);

86 
	}
}

137 
	gRªdomB¿nchS™eP©h
::
	$logProb
() {

139 ià(
	`Sam¶eB¿nchM­pšg
()) {

140  
	`P©hLogProb
();

142  
	`NoP©hLogProb
();

143 
	}
}

145 
	gRªdomB¿nchS™eP©h
::
	$NoP©hLogProb
() {

146 ià(
	`isRoÙ
()) {

147  
	`log
((
	`G‘StiÚ¬y
())[
¡©eup
]);

149  
	`log
((*
	`G‘T¿ns™iÚM©rix
())(
¡©eup
,
¡©edown
));

150 
	}
}

152 
	gRªdomB¿nchS™eP©h
::
	$P©hLogProb
() {

153 ià(! 
	`isAùiv©ed
()) {

156 ià(
	`isRoÙ
()) {

157  
	`StiÚ¬yLogProb
(
š™
->
	`G‘S‹
());

159 
tÙ®
 = 0;

160 
Plšk
* 
lšk
 = 
š™
;

161 
lšk
) {

162 ià(
lšk
 !ğ
Ï¡
) {

163 
tÙ®
 +ğ
	`ReduûdWa™šgTimeLogProb
(
lšk
->
	`G‘S‹
(), 
	`G‘AbsŞu‹Time
(link));

164 
tÙ®
 +ğ
	`ReduûdOÃS‹pLogProb
(
lšk
->
	`G‘S‹
(),lšk->
Ãxt
->GetState());

174 
tÙ®
 +ğ
	`ReduûdWa™šgTimeLogProb
(
lšk
->
	`G‘S‹
(), 
	`G‘AbsŞu‹Time
(link));

176 
lšk
 =†šk->
Ãxt
;

178 ià(
	`G‘Time
() > 0) {

179 
tÙ®
 +ğ
	`G‘Nsub
(è* 
	`log
(
	`G‘R©e
(è* 
	`G‘Time
());

182 
û¼
 << "error in RandomBranchSitePath::logProb :‚ull branch†ength\n";

183 
û¼
 << 
Ëngth
 << '\n';

184 
û¼
 << 
Ëngth
->
	`v®
() << '\n';

185 
	`ex™
(1);

187  
tÙ®
;

188 
	}
}

191 
	gRªdomB¿nchS™eP©h
::
	$G‘MaxTrŸl
() {

192  
my´oûss
->
	`G‘MaxTrŸl
();

193 
	}
}

	@RandomBranchSitePath.h

2 #iâdeà
BRANCHSITESUBPROCESS_H


3 
	#BRANCHSITESUBPROCESS_H


	)

5 
	~"B¿nchS™eP©h.h
"

6 
	~"V¬.h
"

7 
	~"B¿nchS™eSub¡™utiÚProûss.h
"

8 
	~"RªdomSubM©rix.h
"

10 
	~"EmpœiÿlSubM©rix.h
"

21 
şass
 
	gPhyloProûss
;

23 
şass
 
	gRªdomB¿nchS™eP©h
 : 
public
 
vœtu®
 
Rnode
,…ubliø
	gB¿nchS™eP©h
,…ubliø
	gB¿nchS™eSub¡™utiÚProûss
 {

26 
	gpublic
:

28 
RªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
è: 
¿‹
(0), 
Ëngth
(0), 
m©rix
(0), 
¡©iÚ¬y
(0), 
my´oûss
(š´oûss), 
´İm©rix
(0), 
m©sw­
(
çl£
) {

29 
S‘Name
("path");

32 
RªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
, 
V¬
<
PosR—l
>* 
šËngth
, V¬<PosR—l>* 
š¿‹
, 
RªdomSubM©rix
* 
šm©rix
, V¬<
Profe
>* 
š¡©iÚ¬y
è: 
my´oûss
(š´oûss), 
´İm©rix
(0), 
m©sw­
(
çl£
) {

33 
S‘Name
("path");

34 
	gËngth
 = 
šËngth
;

35 
	g¿‹
 = 
š¿‹
;

36 
	gm©rix
 = 
šm©rix
;

37 
	g¡©iÚ¬y
 = 
š¡©iÚ¬y
;

38 
	gaùive_æag
 = 
Œue
;

39 ià(
	g¡©iÚ¬y
) {

40 
	gû¼
 << "in„andom branch site…ath: stat is‚on‚ull\n";

41 
ex™
(1);

44 ià((! 
	gm©rix
è&& (! 
	g¡©iÚ¬y
)) {

45 
	gû¼
 << "error in RandomBranchSitePath: should specify‡ matrix or‡ stationary\n";

46 
ex™
(1);

49 
Regi¡”
(
Ëngth
);

50 
Regi¡”
(
¿‹
);

51 
Regi¡”
(
m©rix
);

52 
Regi¡”
(
¡©iÚ¬y
);

56 
RªdomB¿nchS™eP©h
(
PhyloProûss
* 
š´oûss
, 
RªdomT¿ns™iÚM©rix
* 
šm©rix
, 
V¬
<
Profe
>* 
š¡©iÚ¬y
, V¬<
PosR—l
>* 
šËngth
è: 
my´oûss
(inprocess){

57 
S‘Name
("path");

58 
	g´İm©rix
 = 0;

59 
	gm©rix
 = 0;

60 
	gËngth
 = 
šËngth
;

61 
	g¿‹
 = 0;

62 
	gm©sw­
 = 
çl£
;

63 
	gŒªs™iÚm©rix
 = 
šm©rix
;

64 
	g¡©iÚ¬y
 = 
š¡©iÚ¬y
;

65 
Regi¡”
(
Œªs™iÚm©rix
);

66 ià(
	g¡©iÚ¬y
) {

67 
	gû¼
 << "non‚ull stat in„andom branch site…ath\n";

68 
ex™
(1);

74 
PhyloProûss
* 
G‘PhyloProûss
(è{ 
	gmy´oûss
;}

76 
boŞ
 
Sam¶eB¿nchM­pšg
();

78 
vœtu®
 
Ab¡¿ùT¿ns™iÚM©rix
* 
G‘T¿ns™iÚM©rix
() {

79  
	gŒªs™iÚm©rix
;

82 
vœtu®
 
SubM©rix
* 
G‘SubM©rix
() {

83 ià(
	gm©sw­
) {

84 ià(! 
	g´İm©rix
) {

85 
	gû¼
 << "error in„andom branch site…ath:‚ull…rop matrix\n";

86 
ex™
(1);

88  
	g´İm©rix
;

90 ià(! 
	gm©rix
) {

91 
	gû¼
 << "error in„andom branch site…ath: getsubmatrix\n";

92 
ex™
(1);

94  
	gm©rix
;

97 
vœtu®
 
Sw­M©riûs
() {

98 ià((! 
	gm©sw­
è&& (! 
	g´İm©rix
)) {

99 
	gû¼
 << "error in„andom branch site…ath swap matrix:‚ull…rop matrix\n";

100 
ex™
(1);

102 
	gm©sw­
 = ! 
m©sw­
;

111 
S‘Prİo§lM©rix
(
SubM©rix
* 
šm©rix
) {

112 
	g´İm©rix
 = 
šm©rix
;

115 
Backw¬dPrİag©e
(cÚ¡ * 
down
, * 
up
) {

116 ià(
Sam¶eB¿nchM­pšg
()) {

117 
	gB¿nchS™eSub¡™utiÚProûss
::
Backw¬dPrİag©e
(
down
,
up
);

120 
	gŒªs™iÚm©rix
->
Backw¬dPrİag©e
(
down
,
up
,0);

124 
FÜw¬dPrİag©e
(cÚ¡ * 
up
, * 
down
) {

125 ià(
Sam¶eB¿nchM­pšg
()) {

126 
	gB¿nchS™eSub¡™utiÚProûss
::
FÜw¬dPrİag©e
(
up
,
down
);

129 
	gŒªs™iÚm©rix
->
FÜw¬dPrİag©e
(
up
,
down
,0);

133 
G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
, * 
aux
) {

134 ià(
Sam¶eB¿nchM­pšg
()) {

135 
	gB¿nchS™eSub¡™utiÚProûss
::
G‘Fš™eTimeT¿ns™iÚProb
(
¡©e
,
aux
);

138 
T¿ns™iÚG‘Fš™eTimeT¿ns™iÚProb
(
¡©e
,
aux
);

142 
D¿wStiÚ¬y
() {

143 ià(
Sam¶eB¿nchM­pšg
()) {

144  
	gB¿nchS™eSub¡™utiÚProûss
::
D¿wStiÚ¬y
();

146  
T¿ns™iÚD¿wStiÚ¬y
();

149 
D¿wFš™eTime
(
¡©e
) {

150 ià(
Sam¶eB¿nchM­pšg
()) {

151  
	gB¿nchS™eSub¡™utiÚProûss
::
D¿wFš™eTime
(
¡©e
);

153  
T¿ns™iÚD¿wFš™eTime
(
¡©e
);

156 
T¿ns™iÚG‘Fš™eTimeT¿ns™iÚProb
(
¡©e
, * 
aux
) {

157 cÚ¡ * 
	gp
 = 
Œªs™iÚm©rix
->
G‘Row
(
¡©e
);

158 
	gi
=0; i<
G‘N¡©e
(); i++) {

159 
	gaux
[
i
] = 
p
[i];

163 
T¿ns™iÚD¿wStiÚ¬y
() {

164 cÚ¡ * 
	gp
 = 
Œªs™iÚm©rix
->
G‘StiÚ¬y
();

165 
	gÃw¡©e
 = 
Rªdom
::
D¿wFromDisü‘eDi¡ributiÚ
(
p
,
G‘N¡©e
());

166  
	gÃw¡©e
;

169 
T¿ns™iÚD¿wFš™eTime
(
¡©e
) {

170 cÚ¡ * 
	gp
 = 
Œªs™iÚm©rix
->
G‘Row
(
¡©e
);

171 
	gÃw¡©e
 = 
Rªdom
::
D¿wFromDisü‘eDi¡ributiÚ
(
p
,
G‘N¡©e
());

172  
	gÃw¡©e
;

175 
vœtu®
 
G‘N¡©e
() {

176 ià(
	gm©rix
) {

177  
G‘SubM©rix
()->
G‘N¡©e
();

179 ià(
	gŒªs™iÚm©rix
) {

180  
	gŒªs™iÚm©rix
->
G‘N¡©e
();

183 
	gû¼
 << "error in RandomBranchSitePath: GetNstate\n";

184 
ex™
(1);

188 
vœtu®
 
G‘R©e
(è{ 
	g¿‹
 ?((è¿‹->
v®
()) : 1;}

189 
vœtu®
 cÚ¡ * 
G‘StiÚ¬y
() {

190 ià(
	g¡©iÚ¬y
) {

191 
	gû¼
 << "error :‚on‚ull stationary in†og…rob…ath\n";

192 
ex™
(1);

193  
	g¡©iÚ¬y
->
G‘A¼ay
();

195 ià(
Sam¶eB¿nchM­pšg
()) {

196  
G‘SubM©rix
()->
G‘StiÚ¬y
();

198  
	gŒªs™iÚm©rix
->
G‘StiÚ¬y
();

202 
vœtu®
 
G‘Time
() {

204 ià(
	gËngth
) {

205 ià(
i¢ª
(((è(
Ëngth
->
v®
())))) {

206 
	gû¼
 << "length is‚an\n";

208  
	gËngth
->
v®
();

214 
boŞ
 
isRoÙ
(è{ (
	gËngth
 == 0);}

216 
boŞ
 
isAùiv©ed
(è{ 
	gaùive_æag
;}

218 
S‘Aùiv©ed
(
boŞ
 
šæag
è{
	gaùive_æag
 = inflag;}

220 
S‹S·û
* 
G‘S‹S·û
();

222 
S‘Up
(
RªdomB¿nchS™eP©h
* 
šup
);

224 
G‘TÙ®Time
(è{ 
G‘Time
();}

225 
S‘TÙ®Time
(
štime
) {

227 ià(! 
	gËngth
) {

228 
	gû¼
 << "error in RandomBranchSitePath::SetTotalTime\n";

229 
ex™
(1);

231 
	gËngth
->
£tv®
(
štime
);

234 
G‘MaxTrŸl
();

236 
vœtu®
 
Re§m¶e
() {

237 ià(! 
Sam¶eB¿nchM­pšg
()) {

238 
	gû¼
 << "error in„andom branch site…ath :„esample map called\n";

239 
ex™
(1);

241 ià(
isRoÙ
()) {

242 
	gû¼
 << "error in RandomBranchSitePath::Resample : called on„oot\n";

243 
ex™
(1);

246 ià(
G‘Time
() == 0) {

247 
û¼
 << "error in„esample :‚ull bl\n";

248 
ex™
(1);

250 
boŞ
 
	gok
 = 
Re§m¶eAcû±Rejeù
(
G‘MaxTrŸl
());

251 ià(! 
	gok
) {

252 
Re§m¶eUnifÜmized
();

268 
Move
(
tunšg
) {

269 ià(!
	g´İm©rix
) {

270 
Re§m¶e
();

273  
	gRnode
::
Move
(
tunšg
);

276 
vœtu®
 
loÿlRe¡Üe
() {

277 ià(
	g´İm©rix
) {

278 
	g¡©eup
 = 
bk¡©eup
;

279 
	g¡©edown
 = 
bk¡©edown
;

280 
Re¡ÜeP©h
();

281 
	glog´ob
 = 
bklog´ob
;

289 
	gæag
 = 
Œue
;

292 
	gRnode
::
loÿlRe¡Üe
();

296 
vœtu®
 
loÿlCÜru±
(
boŞ
 
bk
) {

297 ià(
	g´İm©rix
) {

298 ià(
	gbk
) {

299 
	gbk¡©eup
 = 
¡©eup
;

300 
	gbk¡©edown
 = 
¡©edown
;

301 
BackupP©h
();

302 
	gbklog´ob
 = 
log´ob
;

304 
	gæag
 = 
çl£
;

307 
	gRnode
::
loÿlCÜru±
(
bk
);

311 
d¿wSam¶e
() {

312 
	gû¼
 << "in„andom branch site…ath drawsample\n";

313 
ex™
(1);

314 
Re§m¶e
();

317 
logProb
();

318 
P©hLogProb
();

319 
NoP©hLogProb
();

321 
Re§m¶eRoÙ
(
¡©e
) {

322 
	g¡©eup
 = 
¡©edown
 = 
¡©e
;

323 
Re£t
(
¡©e
);

324 
loÿlUpd©e
();

327 
Re§m¶e
(
š¡©eup
, 
š¡©edown
) {

328 
	g¡©eup
 = 
š¡©eup
;

329 
	g¡©edown
 = 
š¡©edown
;

330 ià(
Sam¶eB¿nchM­pšg
()) {

331 ià(
	g´İm©rix
) {

332 
Sw­M©riûs
();

333 
Re§m¶e
();

334 
Sw­M©riûs
();

337 
Re§m¶e
();

341 
Re£t
(
¡©eup
);

343 
loÿlUpd©e
();

346 
S‘M©rix
(
RªdomSubM©rix
* 
šm©rix
è{
	gm©rix
 = inmatrix;}

348 
Prİo£Move
(
tunšg
) {

349 
	gû¼
 << "error : in„andom branch site…ath…ropose move(tuning)\n";

350 
ex™
(1);

353 
Prİo£Move
(
š¡©eup
, 
š¡©edown
) {

354 
	glogbefÜe
 = 
logProb
();

355 
	g¡©eup
 = 
š¡©eup
;

356 
	g¡©edown
 = 
š¡©edown
;

357 
Re§m¶e
();

358 
	glogaá”
 = 
logProb
();

359  
	glogbefÜe
-
	glogaá”
;

362 
Prİo£MoveRoÙ
(
š¡©e
) {

363 
	glogbefÜe
 = 
logProb
();

364 
	g¡©eup
 = 
¡©edown
 = 
š¡©e
;

365 
Re£t
(
š¡©e
);

366 
	glogaá”
 = 
logProb
();

367  
	glogbefÜe
-
	glogaá”
;

370 
	g´Ùeùed
:

372 
boŞ
 
Re§m¶eAcû±Rejeù
(
maxŒŸl
);

373 
Re§m¶eUnifÜmized
();

377 
	gV¬
<
	gPosR—l
>* 
	g¿‹
;

378 
	gV¬
<
	gPosR—l
>* 
	gËngth
;

380 
RªdomSubM©rix
* 
	gm©rix
;

381 
RªdomT¿ns™iÚM©rix
* 
	gŒªs™iÚm©rix
;

383 
	g´Ùeùed
:

385 
V¬
<
Profe
>* 
¡©iÚ¬y
;

387 
	g¡©eup
;

388 
	g¡©edown
;

389 
	gbk¡©eup
;

390 
	gbk¡©edown
;

391 
PhyloProûss
* 
	gmy´oûss
;

392 
SubM©rix
* 
	g´İm©rix
;

394 
boŞ
 
	gaùive_æag
;

396 
boŞ
 
	gm©sw­
;

	@RandomBrownianPath.h

2 #iâdeà
RANDOMBROWNIANPATH_H


3 
	#RANDOMBROWNIANPATH_H


	)

6 
	~"BrownŸnBridge.h
"

7 
	~"V¬.h
"

9 
	~"CÚjug©eInv”£Wish¬t.h
"

11 
şass
 
	gRªdomBrownŸnP©h
 : 
vœtu®
 
public
 
Rv¬
<
BrownŸnBridge
> {

13 
public
:

14 
RªdomBrownŸnP©h
(
V¬
<
PosR—l
> *
šup
, V¬<PosR—l> *
šdown
, V¬<
CovM©rix
> *
šsigma
) :

15 
Up
(
šup
), 
Down
(
šdown
), 
Sigma
(
šsigma
) {

17 
£tAges
(
šup
->
v®
(), 
šdown
->v®(), 
Œue
);

19 
Regi¡”
(
Up
);

20 
Regi¡”
(
Down
);

21 
Regi¡”
(
Sigma
);

22 
S‘Name
("Random multi-variate brownian…ath");

24 
Sam¶e
();

27 
vœtu®
 
d¿wSam¶e
() {

28 
upd©eBrownŸnBridgeP¬am‘”s
();

29 
g’”©eBridge
();

33 
vœtu®
 
logProb
() {

34 
upd©eBrownŸnBridgeP¬am‘”s
();

35  
	gBrownŸnBridge
::
g‘LogProb
();

38 
Prİo£MoveCov
(
CovM©rix
& 
cov
, 
tunšg
=1) {

39  
BrownŸnBridge
::
Prİo£Move
(
tunšg
,
cov
);

42 
upd©eBrownŸnBridgeP¬am‘”s
() {

43 
£tUn™V¬Ÿnû
(
Sigma
->
v®
());

45 if(
	gBrownŸnBridge
::
g‘Segm’tiÚ
(è=ğ
SEGM_REGULAR
) {

46 
£tAges
(
Up
->
v®
(), 
Down
->v®(), 
çl£
);

58 
	gV¬
<
	gPosR—l
> *
g‘Up
(è{ 
	gUp
;}

59 
	gV¬
<
	gPosR—l
> *
g‘Down
(è{ 
	gDown
;}

60 
vœtu®
 
g‘IÁeg¿l
(
·¿m
, 
š™V®ue
, 
fš®V®ue
) {

61 
upd©eBrownŸnBridgeP¬am‘”s
();

62  
	gBrownŸnBridge
::
g‘IÁeg¿l
(
·¿m
, 
š™V®ue
, 
fš®V®ue
);

65 
	gvœtu®
 ~
RªdomBrownŸnP©h
() {

68 
	g´Ùeùed
:

70 
V¬
<
PosR—l
> *
Up
;

71 
	gV¬
<
	gPosR—l
> *
	gDown
;

72 
	gV¬
<
	gCovM©rix
> *
	gSigma
;

77 
şass
 
	gCÚjug©eRªdomBrownŸnP©h
 : 
public
 
vœtu®
 
CÚjug©eSam¶šg
<
BrownŸnBridge
>,…ubliøvœtu® 
	gRªdomBrownŸnP©h
 {

79 
	gpublic
:

81 
CÚjug©eRªdomBrownŸnP©h
(
V¬
<
PosR—l
> *
šup
, V¬<PosR—l> *
šdown
, 
CÚjug©eInv”£Wish¬t
 *
šsigma
) :

82 
RªdomBrownŸnP©h
(
šup
,
šdown
,
šsigma
) {

84 
	gcÚjug©e_up
.
š£¹
(
šsigma
);

86 
	gcÚŒa¡
 = 
Ãw
 *[
dim
];

87 
	gi
=0; i<
	gdim
; i++) {

88 
	gcÚŒa¡
[
i
] = 
Ãw
 [
dim
];

92 ~
CÚjug©eRªdomBrownŸnP©h
() {

94 
	gi
=0; i<
	gdim
; i++) {

95 
	gd–‘e
[] 
	gcÚŒa¡
[
i
];

97 
	gd–‘e
[] 
	gcÚŒa¡
;

100 
AddSuffic›ÁSti¡ic
(
SemiCÚjPriÜ
* 
·»Á
) {

102 
MuÉiNÜm®SemiCÚjug©e
* 
	g´iÜ
 = 
dyÇmic_ÿ¡
<MuÉiNÜm®SemiCÚjug©e*>(
·»Á
);

103 ià(! 
	g´iÜ
) {

104 
	gcout
 << "castƒrror in ConjugateMultiNormal::AddSuffStat\n";

105 
ex™
(1);

107 
	g´iÜ
->
AddToSh­e
(
nSegm’ts
-1);

108 
Compu‹CÚŒa¡
();

109 
	g´iÜ
->
AddToSÿË
(
cÚŒa¡
);

113 
Prİo£Move
(
tunšg
) {

115 ià(
isUpAùive
()) {

116  
Sim¶ePrİo£Move
(
tunšg
);

118  
	gBrownŸnBridge
::
Prİo£Move
(
tunšg
);

121 
Compu‹CÚŒa¡
() {

123 
	gi
=0; i<
	gdim
; i++) {

124 
	gj
=0; j<
	gdim
; j++) {

125 
	gcÚŒa¡
[
i
][
j
] = 0;

129 
	gN
 = 
g‘NSegm’ts
();

131 * 
	gy
 = 
Ãw
 [
dim
];

133 
	gk
=0; k<
	gN
; k++) {

134 
	g£gm’tL’gth
 = 
g‘Segm’tL’gth
(
k
);

135 
	gi
=0; i<
	gdim
; i++) {

136 
	gy
[
i
] = 
g‘V®ue
(
k
+1, i) - getValue(k, i);

138 
	gi
=0; i<
	gdim
; i++) {

139 
	gj
=0; j<
	gdim
; j++) {

140 
	gcÚŒa¡
[
i
][
j
] +ğ
y
[i]*y[j]/
£gm’tL’gth
;

160 
	gd–‘e
[] 
	gy
;

163 ** 
G‘CÚŒa¡
() {

164  
	gcÚŒa¡
;

167 
	g´iv©e
:

168 ** 
cÚŒa¡
;

	@RandomSegmentedBranchSitePath.h

1 #iâdeà
RANDOMSEGMENTEDBRANCHSITEPATH_H


2 
	#RANDOMSEGMENTEDBRANCHSITEPATH_H


	)

4 
	~"RªdomB¿nchS™eP©h.h
"

5 
	~"EvŞutiÚSegm’‹dProûss.h
"

6 
	~"ChrÚo.h
"

8 şas 
	cRªdomSegm’‹dB¿nchS™eP©h
 : 
public
 
RªdomB¿nchS™eP©h
 {

10 
´Ùeùed
 :

12 
EvŞutiÚSegm’‹dB¿nch
* 
evŞ
;

13 * 
	mš‹r¡©e
;

14 * 
	mbkš‹r¡©e
;

17 
	mpublic
 :

21 
	$RªdomSegm’‹dB¿nchS™eP©h
(
PhyloProûss
 *
phylİroûss
è: 
	$RªdomB¿nchS™eP©h
(
phylİroûss
) {

24 
	$RªdomSegm’‹dB¿nchS™eP©h
(
PhyloProûss
 *
phylİroûss
, 
EvŞutiÚSegm’‹dB¿nch
* 
ševŞ
) :

25 
	$RªdomB¿nchS™eP©h
(
phylİroûss
) {

26 
evŞ
 = 
ševŞ
;

27 if(
	`isRoÙ
())

28 
	`S‘Name
("Root Segmented Branch Site Path");

30 
	`S‘Name
("Segmented Branch Site Path");

32 
	`Regi¡”
(
evŞ
);

33 
	`Regi¡”
(
evŞ
->
	`G‘Glob®T¿nsM©rix
());

35 
š‹r¡©e
 = 
Ãw
 [
	`G‘N£gm’t
()+1];

36 
bkš‹r¡©e
 = 
Ãw
 [
	`G‘N£gm’t
()+1];

37 
Œªs™iÚm©rix
 = 
evŞ
->
	`G‘Glob®T¿nsM©rix
();

39 
	}
}

42 
vœtu®
 
Ab¡¿ùT¿ns™iÚM©rix
* 
	$G‘T¿ns™iÚM©rix
() {

43  
evŞ
->
	`G‘Glob®T¿nsM©rix
();

44 
	}
}

46 
vœtu®
 
	$G‘N¡©e
() {

47  
evŞ
->
	`G‘N¡©e
();

48 
	}
}

50 
vœtu®
 
	$G‘N£gm’t
() {

51  
evŞ
->
	`G‘N£gm’t
();

52 
	}
}

54 
vœtu®
 
boŞ
 
	$isRoÙ
() {

55  
evŞ
->
	`isRoÙ
();

56 
	}
}

58 
vœtu®
 
	$logProb
() {

59 ià(
	`isRoÙ
()) {

60  
	`log
(
evŞ
->
	`G‘StiÚ¬y
()[
¡©eup
]);

63 
p
 = 1;

65 
k
=0; k<
	`G‘N£gm’t
(); k++) {

66 
p
 *ğ
evŞ
->
	`G‘P
(
k
)->
	`G‘R
()[
š‹r¡©e
[k]][interstate[k+1]];

68 
x
 = 
	`log
(
p
);

70  
x
;

71 
	}
}

74 
vœtu®
 
	$Re§m¶e
(
š¡©eup
, 
š¡©edown
) {

75 
¡©eup
 = 
š¡©eup
;

76 
¡©edown
 = 
š¡©edown
;

78 
š‹r¡©e
[0] = 
¡©eup
;

79 
š‹r¡©e
[
	`G‘N£gm’t
()] = 
¡©edown
;

80 *
´ob
 = 
Ãw
 [
	`G‘N¡©e
()];

81 
k
=
	`G‘N£gm’t
()-1; k>0; k--) {

82 
¡©’ext
 = 
š‹r¡©e
[
k
+1];

83 
i
=0; i<
	`G‘N¡©e
(); i++)

84 
´ob
[
i
] = 
evŞ
->
	`G‘P
(
k
)->
	`G‘R
()[i][
¡©’ext
] *ƒvŞ->
	`G‘Cumul
(k)[
¡©eup
][i] /ƒvol->GetCumul(k+1)[stateup][statenext];

85 
š‹r¡©e
[
k
] = 
Rªdom
::
	`D¿wFromDisü‘eDi¡ributiÚ
(
´ob
, 
	`G‘N¡©e
());

88 
	`loÿlUpd©e
();

89 
d–‘e
[] 
´ob
;

91 
	}
}

93 
vœtu®
 
	$loÿlRe¡Üe
() {

94 
i
 = 0; i<
	`G‘N£gm’t
()+1; i++)

95 
š‹r¡©e
[
i
] = 
bkš‹r¡©e
[i];

96 
¡©eup
 = 
bk¡©eup
;

97 
¡©edown
 = 
bk¡©edown
;

98 
RªdomB¿nchS™eP©h
::
	`loÿlRe¡Üe
();

99 
	}
}

101 
vœtu®
 
	$loÿlCÜru±
(
boŞ
 
bk
) {

102 ià(
bk
) {

103 
i
 = 0; i<
	`G‘N£gm’t
()+1; i++)

104 
bkš‹r¡©e
[
i
] = 
š‹r¡©e
[i];

105 
bk¡©eup
 = 
¡©eup
;

106 
bk¡©edown
 = 
¡©edown
;

109 
RªdomB¿nchS™eP©h
::
	`loÿlCÜru±
(
bk
);

110 
	}
}

112 
vœtu®
 
	$couÁA
() {

113 
couÁ
 = 0;

114 
i
=0; i<
	`G‘N£gm’t
(); i++) {

115 if(
š‹r¡©e
[
i
] == 0)

116 
couÁ
++;

118  
couÁ
;

119 
	}
}

126 şas 
	cBrownŸnPhyloProûss
 : 
public
 
PhyloProûss
 {

128 
EvŞutiÚSegm’‹dProûss
 *
´oûss
;

130 
	mpublic
 :

131 
	$BrownŸnPhyloProûss
(
L’gthT»e
* 
šŒ“
, 
Sequ’ûAlignm’t
* 
šd©a
, 
EvŞutiÚSegm’‹dProûss
* 
š´oûss
) :

132 
	$PhyloProûss
(
šŒ“
, 
šd©a
, 
çl£
)

134 
´oûss
 = 
š´oûss
;

137 
RªdomB¿nchS™eP©h
* 
	$C»©eRªdomB¿nchS™eP©h
(cÚ¡ 
Lšk
* 
äom
, 
s™e
) {

138 
EvŞutiÚSegm’‹dB¿nch
* 
m©
 = 
´oûss
->
	`G‘B¿nchV®
(
äom
->
	`G‘B¿nch
());

140  
Ãw
 
	`RªdomSegm’‹dB¿nchS™eP©h
(
this
, 
m©
);

141 
	}
}

	@RandomSubMatrix.h

25 #iâdeà
RANDOMSUBMATRIX_H


26 
	#RANDOMSUBMATRIX_H


	)

28 
	~"SubM©rix.h
"

29 
	~"V¬.h
"

30 
	~"RªdomTy³s.h
"

38 
şass
 
	gRªdomT¿ns™iÚM©rix
 : 
public
 
vœtu®
 
Ab¡¿ùT¿ns™iÚM©rix
,…ubliøvœtu® 
	gDnode
 {

40 
	gpublic
:

42 
vœtu®
 ~
RªdomT¿ns™iÚM©rix
() {

43 
S‘Name
("transition matrix");

46 
¥ecŸlUpd©e
() {

47 
S‘P¬am‘”s
();

50 
	g´Ùeùed
:

56 
vœtu®
 
S‘P¬am‘”s
() = 0;

58 
loÿlRe¡Üe
() {

59 
S‘P¬am‘”s
();

60 
	gDnode
::
loÿlRe¡Üe
();

63 
loÿlCÜru±
(
boŞ
 
bk
) {

64 
CÜru±M©rix
();

65 
	gDnode
::
loÿlCÜru±
(
bk
);

69 
şass
 
	gRªdomSubM©rix
 : 
public
 
vœtu®
 
RªdomT¿ns™iÚM©rix
,…ubliøvœtu® 
	gSubM©rix
 {

71 
	gpublic
:

73 
RªdomSubM©rix
(
N¡©e
, 
boŞ
 
šnÜm®i£
 = 
çl£
è: 
SubM©rix
(Nstate, innormalise) {}

75 
	gvœtu®
 ~
RªdomSubM©rix
() {}

77 
G‘N¡©e
(è{ 
	gSubM©rix
::GetNstate();}

	@RandomTypes.cpp

1 
	~"RªdomTy³s.h
"

10 cÚ¡ 
	gGamma
::
GAMMAMIN
 = 1e-20;

12 
	gGamma
::
Gamma
(
V¬
<
PosR—l
>* 
šsh­e
, V¬<PosR—l>* 
šsÿË
, 
boŞ
 
šm—nv¬
) {

13 
S‘Name
("gamma");

14 
	gm—nv¬
 = 
šm—nv¬
;

15 
	gsÿË
 = 
šsÿË
;

16 
	gsh­e
 = 
šsh­e
;

17 
Regi¡”
(
sh­e
);

18 
Regi¡”
(
sÿË
);

19 
Sam¶e
();

22 
	gGamma
::
	$Gamma
(cÚ¡ 
Gamma
& 
äom
) {

23 
	`S‘Name
("gamma");

24 
m—nv¬
 = 
äom
.meanvar;

25 
sÿË
 = 
äom
.scale;

26 
sh­e
 = 
äom
.shape;

27 
	`Regi¡”
(
sh­e
);

28 
	`Regi¡”
(
sÿË
);

29 
	`Sam¶e
();

30 
	}
}

32 
šlše
 
	gGamma
::
	$d¿wSam¶e
() {

33 
v
 = 0;

34 ià(
m—nv¬
) {

35 
m—n
 = 
sh­e
->
	`v®
();

36 
v¬
 = 
sÿË
->
	`v®
();

37 
®pha
 = 
m—n
 * m—À/ 
v¬
;

38 
b‘a
 = 
m—n
 / 
v¬
;

39 
v
 = 
Rªdom
::
	`Gamma
(
®pha
,
b‘a
);

42 
v
 = 
Rªdom
::
	`Gamma
(
sh­e
->
	`v®
(),
sÿË
->val());

44 ià(
v
 < 
GAMMAMIN
) {

45 
v
 = 
GAMMAMIN
;

47 
	`£tv®
(
v
);

48 
	}
}

50 
	gGamma
::
	$logProb
() {

51 ià(
m—nv¬
) {

52 
m—n
 = 
sh­e
->
	`v®
();

53 
v¬
 = 
sÿË
->
	`v®
();

54 
®pha
 = 
m—n
 * m—À/ 
v¬
;

55 
b‘a
 = 
m—n
 / 
v¬
;

56  -
Rªdom
::
	`logGamma
(
®pha
è+ (®pha)*
	`log
(
b‘a
è- b‘¨* *
this
 - (1 -‡lpha)*log(*this);

58  -
Rªdom
::
	`logGamma
(
sh­e
->
	`v®
()è+ (sh­e->v®())*
	`log
(
sÿË
->v®()è- *
this
 * (scale->val()) - (1 - (shape->val()))*log(*this);

59 
	}
}

67 
	gB‘a
::
B‘a
(
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
) {

68 
	g®pha
 = 
š®pha
;

69 
	gb‘a
 = 
šb‘a
;

70 
Regi¡”
(
®pha
);

71 
Regi¡”
(
b‘a
);

72 
Sam¶e
();

75 
	gB‘a
::
	$B‘a
(cÚ¡ 
B‘a
& 
äom
) {

76 
®pha
 = 
äom
.alpha;

77 
b‘a
 = 
äom
.beta;

78 
	`Regi¡”
(
®pha
);

79 
	`Regi¡”
(
b‘a
);

80 
	`Sam¶e
();

81 
	}
}

83 
šlše
 
	gB‘a
::
	$d¿wSam¶e
() {

84 
v®ue
 = 0;

85 
couÁ
 = 0;

86 (!
v®ue
è&& (
couÁ
 < 10000)) {

87 
x
 = 
Rªdom
::
	`sGamma
(
®pha
->
	`v®
());

88 
y
 = 
Rªdom
::
	`sGamma
(
b‘a
->
	`v®
());

89 
v®ue
 = 
x
 / (x + 
y
);

90 
couÁ
++;

92 ià(! 
v®ue
) {

93 
û¼
 << "error : zero beta„andom variable\n";

94 
	`ex™
(1);

96 
	`£tv®
(
v®ue
);

97 
	}
}

99 
	gB‘a
::
	$logProb
() {

100  
Rªdom
::
	`logGamma
(
®pha
->
	`v®
(è+ 
b‘a
->v®()è-Rªdom::logGamma×Íha->v®()è- Rªdom::logGamma(b‘a->v®()è+ (®pha->v®(è- 1)*
	`log
(*
this
) + (beta->val() - 1) *†og(1 - *this);

101 
	}
}

110 
	gExpÚ’tŸl
::
ExpÚ’tŸl
(
V¬
<
PosR—l
>* 
šsÿË
, 
P¬’tTy³
 
šty³
) {

111 
	gsÿË
 = 
šsÿË
;

112 
	gty³
 = 
šty³
;

113 
Regi¡”
(
sÿË
);

114 
Sam¶e
();

117 
	gExpÚ’tŸl
::
	$ExpÚ’tŸl
(cÚ¡ 
ExpÚ’tŸl
& 
äom
) {

118 
sÿË
 = 
äom
.scale;

119 
	`Regi¡”
(
sÿË
);

120 
	`Sam¶e
();

121 
	}
}

123 
	gExpÚ’tŸl
::
	$d¿wSam¶e
() {

124 ià(
ty³
 =ğ
MEAN
) {

125 
	`£tv®
(
Rªdom
::
	`sExpo
(è* 
sÿË
->
	`v®
());

128 
	`£tv®
(
Rªdom
::
	`sExpo
(è/ 
sÿË
->
	`v®
());

130 
	}
}

132 
	gExpÚ’tŸl
::
	$logProb
() {

133 ià(
ty³
 =ğ
MEAN
) {

134  -*
this
 / 
sÿË
->
	`v®
(è- 
	`log
(scale->val());

136  -(
sÿË
->
	`v®
())* v®(è+ 
	`log
(scale->val());

137 
	}
}

145 
	gPosUnifÜm
::
PosUnifÜm
(
V¬
<
PosR—l
>* 
šroÙ
, 
šmax
) {

146 
	groÙ
 = 
šroÙ
;

147 
	gmax
 = 
šmax
;

148 
Regi¡”
(
roÙ
);

149 
Sam¶e
();

152 
	gPosUnifÜm
::
	$PosUnifÜm
(cÚ¡ 
PosUnifÜm
& 
äom
) {

153 
roÙ
 = 
äom
.root;

154 
max
 = 
äom
.max;

155 
	`Regi¡”
(
roÙ
);

156 
	`Sam¶e
();

157 
	}
}

159 
	gPosUnifÜm
::
	$d¿wSam¶e
() {

160 ià(
max
 > 0) {

161 
	`£tv®
(
Rªdom
::
	`UnifÜm
(è* 
max
);

164 
	`£tv®
(1.0);

166 
	}
}

168 
	gPosUnifÜm
::
	$logProb
() {

169 ià(
	`v®
(è> 
max
) {

170  
	`log
(0);

173 
	}
}

181 
	gBšomŸl
::
BšomŸl
(
šN
, 
V¬
<
Un™R—l
>* 
šth‘a
) {

182 
	gN
 = 
šN
;

183 
	gth‘a
 = 
šth‘a
;

184 
Regi¡”
(
th‘a
);

185 
Sam¶e
();

188 
	gBšomŸl
::
	$d¿wSam¶e
() {

189 
v®
 = 0;

190 
k
=0; k<
N
; k++) {

191 ià(
Rªdom
::
	`UnifÜm
(è< 
th‘a
->
	`v®
()) {

192 
v®
++;

195 
	`£tv®
(
v®
);

196 
	}
}

198 
	gBšomŸl
::
	$logProb
() {

199 
»t
 = *
this
 * 
	`log
(
th‘a
->
	`v®
()è+ (
N
 - *this) *†og(1 -heta->val());

200 
i
=1; i<=*
this
; i++) {

201 
»t
 -ğ
	`log
((è
i
);

202 
»t
 +ğ
	`log
((è(
N
+1-
i
));

204  
»t
;

205 
	}
}

207 
	gBšomŸl
::
	$Prİo£Move
(
tunšg
) {

208 
bkv®ue
 = *
this
;

209 
æag
 = 
çl£
;

210 
	`d¿wSam¶e
();

212 
	}
}

220 
	gPoissÚ
::
PoissÚ
(
V¬
<
PosR—l
>* 
šmu
) {

221 
mu
 = 
šmu
;

222 
Regi¡”
(
mu
);

223 
Sam¶e
();

226 
	gPoissÚ
::
	$d¿wSam¶e
() {

227 
p
 = 
	`exp
(
mu
->
	`v®
()è* 
Rªdom
::
	`UnifÜm
();

228 
n
 = 0;

229 
¿tio
 = 1;

230 
tÙ®
 = 1;

231 
tÙ®
<
p
) {

232 
n
++;

233 
¿tio
 *ğ
mu
->
	`v®
(è/ 
n
;

234 
tÙ®
 +ğ
¿tio
;

236 
	`£tv®
(
n
);

237 
	}
}

239 
	gPoissÚ
::
	$logProb
() {

240 ià(
this
->
	`v®
() < 0) {

243 
»t
 = -
mu
->
	`v®
(è+ *
this
 * 
	`log
(mu->val());

244 
i
=2; i<=*
this
; i++) {

245 
»t
 -ğ
	`log
((è
i
);

247  
»t
;

248 
	}
}

264 
	gDœichËt
::
	$DœichËt
(
dim’siÚ
) {

265 
	`£tv®
(
	`Profe
(
dim’siÚ
));

266 
bkv®ue
 = 
	`Profe
(
dim’siÚ
);

267 
ûÁ”
 = 0;

268 
cÚûÁ¿tiÚ
 = 0;

269 ià(
dim’siÚ
 == 1) {

270 (*
this
)[0] = 1;

271 
	`CÏmp
();

273 
	`Sam¶e
();

274 
	}
}

276 
	gDœichËt
::
DœichËt
(
V¬
<
Profe
>* 
šûÁ”
, V¬<
PosR—l
>* 
šcÚûÁ¿tiÚ
) {

277 
£tv®
(
Profe
(
šûÁ”
->
v®
()));

278 
	gbkv®ue
 = 
Profe
(
šûÁ”
->
v®
());

279 
	gûÁ”
 = 
šûÁ”
;

280 
	gcÚûÁ¿tiÚ
 = 
šcÚûÁ¿tiÚ
;

281 
Regi¡”
(
ûÁ”
);

282 
Regi¡”
(
cÚûÁ¿tiÚ
);

283 
Sam¶e
();

286 
	gDœichËt
::
	$d¿wSam¶e
() {

288 
Profe
& 
´ofe
 = *
this
;

289 
tÙ®
 = 0;

290 
k
=0; k<
	`G‘Dim
(); k++) {

291 ià(
cÚûÁ¿tiÚ
) {

292 
´ofe
[
k
] = 
Rªdom
::
	`sGamma
Ğ
cÚûÁ¿tiÚ
->
	`v®
(è* 
ûÁ”
->val()[k] );

295 
´ofe
[
k
] = 
Rªdom
::
	`sGamma
(1);

297 ià(
´ofe
[
k
] < 
Profe
::
MIN
) {

298 
´ofe
[
k
] = 
Profe
::
MIN
;

300 
tÙ®
 +ğ
´ofe
[
k
];

302 
k
=0; k<
	`G‘Dim
(); k++) {

303 
´ofe
[
k
] /ğ
tÙ®
;

305 
	}
}

307 
	gDœichËt
::
	$logProb
() {

309 
tÙ®
 = 0;

310 ià(
cÚûÁ¿tiÚ
) {

311 
tÙ®
 = 
Rªdom
::
	`logGamma
(
cÚûÁ¿tiÚ
->
	`v®
());

312 
i
=0; i<
	`G‘Dim
(); i++) {

313 
tÙ®
 +ğ-
Rªdom
::
	`logGamma
(
cÚûÁ¿tiÚ
->
	`v®
(è* 
ûÁ”
->v®()[
i
]è+ (cÚûÁ¿tiÚ->v®(è* c’‹r->v®()[i] - 1è* 
	`log
((*
this
)[i]);

317 
tÙ®
 = 
Rªdom
::
	`logGamma
(
	`G‘Dim
());

319  
tÙ®
;

320 
	}
}

322 
	gMuÉšomŸl
::
MuÉšomŸl
 (
V¬
<
Profe
>* 
š´ob¬¿y
, 
šN
) {

324 
	g´ob¬¿y
 = 
š´ob¬¿y
;

325 
	gN
 = 
šN
;

326 
£tv®
(
IÁVeùÜ
(
š´ob¬¿y
->
v®
().
G‘Dim
()));

327 
	gbkv®ue
 = 
IÁVeùÜ
(
š´ob¬¿y
->
v®
().
G‘Dim
());

328 
Regi¡”
(
´ob¬¿y
);

329 
Sam¶e
();

333 
	gMuÉšomŸl
::
	$logProb
() {

335 
»t
 = 
Rªdom
::
	`logGamma
(
N
+1);

336 
k
=0; k<
	`G‘Dim
(); k++) {

337 
»t
 -ğ
Rªdom
::
	`logGamma
((*
this
)[
k
] + 1);

338 
»t
 +ğ(*
this
)[
k
] * 
	`log
(
´ob¬¿y
->
	`v®
()[k]);

340  
»t
;

341 
	}
}

343 
	gMuÉšomŸl
::
	$d¿wSam¶e
() {

345 
k
=0; k<
	`G‘Dim
(); k++) {

346 (*
this
)[
k
] = 0;

348 
i
=0; i<
N
; i++) {

349 (*
this
)[
Rªdom
::
	`Fš™eDisü‘e
(
N
,
´ob¬¿y
->
	`v®
().
	`G‘A¼ay
())] ++;

351 
	}
}

360 
	gFš™eDisü‘e
::
Fš™eDisü‘e
(
V¬
<
Profe
>* 
š´ob¬¿y
) {

362 
´ob¬¿y
 = 
š´ob¬¿y
;

363 
Regi¡”
(
´ob¬¿y
);

364 
Sam¶e
();

367 
	gFš™eDisü‘e
::
	$logProb
() {

369  
	`log
((*
´ob¬¿y
)[*
this
]);

370 
	}
}

372 
	gFš™eDisü‘e
::
	$d¿wSam¶e
() {

374 
	`£tv®
(
Rªdom
::
	`Fš™eDisü‘e
(
´ob¬¿y
->
	`G‘Dim
(),´ob¬¿y->
	`v®
().
	`G‘A¼ay
()));

375 
	}
}

383 
	gIIDExp
::
	$IIDExp
(
dim’siÚ
) {

384 
dim
 = 
dim’siÚ
;

385 
	`£tv®
(
	`PosR—lVeùÜ
(
dim’siÚ
));

386 
bkv®ue
 = 
	`PosR—lVeùÜ
(
dim’siÚ
);

387 
m—n
 = 0;

388 
	`Sam¶e
();

389 
	}
}

391 
	gIIDExp
::
IIDExp
(
dim’siÚ
, 
V¬
<
PosR—l
>* 
šm—n
) {

392 
	gdim
 = 
dim’siÚ
;

393 
£tv®
(
PosR—lVeùÜ
(
dim’siÚ
));

394 
	gbkv®ue
 = 
PosR—lVeùÜ
(
dim’siÚ
);

395 
	gm—n
 = 
šm—n
;

396 
Regi¡”
(
m—n
);

397 
Sam¶e
();

400 
	gIIDExp
::
	$£Î
(
š
) {

402 
i
=0; i<
	`G‘Dim
(); i++) {

403 (*
this
)[
i
] = 
š
;

405 
	}
}

407 
	gIIDExp
::
	$d¿wSam¶e
() {

409 
m
 = 
m—n
 ? (èm—n->
	`v®
() : 1.0;

410 
i
=0; i<
	`G‘Dim
(); i++) {

411 (*
this
)[
i
] = 
Rªdom
::
	`sExpo
(è* 
m
;

412 ià(!(*
this
)[
i
]) {

413 
û¼
 << "error in IIDexp: 0ƒxp„andom variable\n";

414 
	`ex™
(1);

417 
	}
}

419 
	gIIDExp
::
	$logProb
() {

421 
tÙ®
 = 0;

422 
m
 = 
m—n
 ? (èm—n->
	`v®
() : 1;

423 
i
=0; i<
	`G‘Dim
(); i++) {

424 
tÙ®
 +ğ- (*
this
)[
i
] /
m
 - 
	`log
(m);

426  
tÙ®
;

427 
	}
}

437 
	gIIDGamma
::
	$IIDGamma
(
dim’siÚ
) {

438 
dim
 = 
dim’siÚ
;

439 
	`£tv®
(
	`PosR—lVeùÜ
(
dim’siÚ
));

440 
bkv®ue
 = 
	`PosR—lVeùÜ
(
dim’siÚ
);

441 
®pha
 = 0;

442 
b‘a
 = 0;

443 
	`Sam¶e
();

444 
	}
}

446 
	gIIDGamma
::
IIDGamma
(
dim’siÚ
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
) {

447 
	gdim
 = 
dim’siÚ
;

448 
£tv®
(
PosR—lVeùÜ
(
dim’siÚ
));

449 
	gbkv®ue
 = 
PosR—lVeùÜ
(
dim’siÚ
);

450 
	g®pha
 = 
š®pha
;

451 
	gb‘a
 = 
šb‘a
;

452 
Regi¡”
(
®pha
);

453 
Regi¡”
(
b‘a
);

454 
Sam¶e
();

457 
	gIIDGamma
::
	$£Î
(
š
) {

459 
i
=0; i<
	`G‘Dim
(); i++) {

460 (*
this
)[
i
] = 
š
;

462 
	}
}

464 
	gIIDGamma
::
	$d¿wSam¶e
() {

466 
a
 = 
®pha
 ? (è®pha->
	`v®
() : 1.0;

467 
b
 = 
b‘a
 ? (èb‘a->
	`v®
() : 1.0;

468 
i
=0; i<
	`G‘Dim
(); i++) {

469 (*
this
)[
i
] = 
Rªdom
::
	`Gamma
(
a
,
b
);

470 ià((*
this
)[
i
] < 
Gamma
::
GAMMAMIN
) {

471 (*
this
)[
i
] = 
Gamma
::
GAMMAMIN
;

474 
	}
}

476 
	gIIDGamma
::
	$logProb
() {

478 
a
 = 
®pha
 ? (è®pha->
	`v®
() : 1.0;

479 
b
 = 
b‘a
 ? (èb‘a->
	`v®
() : 1.0;

480 
loggamm¯
 = 
Rªdom
::
	`logGamma
(
a
);

481 
logb
 = 
	`log
(
b
);

482 
tÙ®
 = 0;

483 
i
=0; i<
	`G‘Dim
(); i++) {

484 
tÙ®
 +ğ- 
loggamm¯
 + 
a
*
logb
 - (*
this
)[
i
] * 
b
 + (¨-1)* 
	`log
((*this)[i]);

486  
tÙ®
;

487 
	}
}

	@RandomTypes.h

1 #iâdeà
RANDOMTYPES_H


2 
	#RANDOMTYPES_H


	)

4 
	~"Ba£Ty³.h
"

5 
	~"V¬.h
"

6 
	~"Move.h
"

11 
şass
 
	gNÜm®
 : 
public
 
vœtu®
 
Rv¬
<
R—l
> {

13 
public
:

15 
NÜm®
(
V¬
<
R—l
>* 
šm—n
, V¬<
PosR—l
>* 
šv¬Ÿnû
) {

17 
	gm—nvec
 = 0;

18 
	gm—n
 = 
šm—n
;

19 
	gv¬Ÿnû
 = 
šv¬Ÿnû
;

20 
Regi¡”
(
m—n
);

21 
Regi¡”
(
v¬Ÿnû
);

22 
Sam¶e
();

25 
NÜm®
(
V¬
<
R—lVeùÜ
>* 
šm—nvec
, V¬<
PosR—l
>* 
šv¬Ÿnû
, 
ššdex
) {

27 
	gm—n
 = 0;

28 
	gm—nvec
 = 
šm—nvec
;

29 
	gv¬Ÿnû
 = 
šv¬Ÿnû
;

30 
	gšdex
 = 
ššdex
;

31 
Regi¡”
(
m—nvec
);

32 
Regi¡”
(
v¬Ÿnû
);

33 
Sam¶e
();

36 
logProb
() {

37 ià((! 
	gv¬Ÿnû
è|| (!v¬Ÿnû->
v®
())) {

40 ià(
	gm—nvec
) {

41  -0.5 * 
log
(2 * 
Pi
 * 
v¬Ÿnû
->
v®
()è-0.5 * (
	gthis
->v®(è- (*
	gm—nvec
)[
šdex
]è* (this->v®(è- (*m—nvec)[šdex]è/ 
	gv¬Ÿnû
->val();

43  -0.5 * 
log
(2 * 
Pi
 * 
v¬Ÿnû
->
v®
()è-0.5 * (
	gthis
->v®(è- 
	gm—n
->v®()è* (this->v®(è- m—n->v®()è/ 
	gv¬Ÿnû
->val();

46 
	g´Ùeùed
:

48 
d¿wSam¶e
() {

49 ià(
m—nvec
) {

50 ià((! 
v¬Ÿnû
è|| (!v¬Ÿnû->
v®
())) {

52 
£tv®
((*
m—nvec
)[
šdex
] + 
Rªdom
::
sNÜm®
(è* 
sq¹
(10));

55 
£tv®
((*
m—nvec
)[
šdex
] + 
Rªdom
::
sNÜm®
(è* 
sq¹
(
v¬Ÿnû
->
v®
()));

59 ià((! 
	gv¬Ÿnû
è|| (!v¬Ÿnû->
v®
())) {

61 
£tv®
(
m—n
->
v®
(è+ 
Rªdom
::
sNÜm®
(è* 
sq¹
(10));

64 
£tv®
(
m—n
->
v®
(è+ 
Rªdom
::
sNÜm®
(è* 
sq¹
(
v¬Ÿnû
->val()));

69 
	g´iv©e
:

71 
šdex
;

72 
	gV¬
<
	gR—l
>* 
	gm—n
;

73 
	gV¬
<
	gR—lVeùÜ
>* 
	gm—nvec
;

74 
	gV¬
<
	gPosR—l
>* 
	gv¬Ÿnû
;

78 
şass
 
	gExpÚ’tŸl
 : 
public
 
Rv¬
<
PosR—l
> {

80 
public
:

82 
	eP¬’tTy³
 {
MEAN
,
	gRATE
};

84 
ExpÚ’tŸl
(
V¬
<
PosR—l
>* 
šsÿË
, 
P¬’tTy³
 
šty³
);

85 
ExpÚ’tŸl
(cÚ¡ ExpÚ’tŸl& 
äom
);

87 
	gvœtu®
 ~
ExpÚ’tŸl
(){}

89 
d¿wSam¶e
();

91 
	g´iv©e
:

93 
vœtu®
 
logProb
();

95 
	gV¬
<
	gPosR—l
>* 
	gsÿË
;

96 
P¬’tTy³
 
	gty³
;

100 
şass
 
	gGamma
 : 
public
 
vœtu®
 
Rv¬
<
PosR—l
> {

102 
public
:

104 cÚ¡ 
GAMMAMIN
;

106 
Gamma
(
V¬
<
PosR—l
>* 
šsh­e
, V¬<PosR—l>* 
šsÿË
, 
boŞ
 
šm—nv¬
 = 
çl£
);

107 
Gamma
(cÚ¡ Gamma& 
äom
);

109 
	gvœtu®
 ~
Gamma
(){}

111 
d¿wSam¶e
();

113 
	g´Ùeùed
:

115 
vœtu®
 
logProb
();

117 
	gV¬
<
	gPosR—l
>* 
	gsÿË
;

118 
	gV¬
<
	gPosR—l
>* 
	gsh­e
;

119 
boŞ
 
	gm—nv¬
;

123 
şass
 
	gB‘a
 : 
public
 
Rv¬
<
Un™R—l
> {

125 
public
:

127 
B‘a
(
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
);

128 
B‘a
(cÚ¡ B‘a& 
äom
);

130 
	gvœtu®
 ~
B‘a
() {}

132 
d¿wSam¶e
();

134 
G‘AÍha
(è{ 
	g®pha
->
v®
();}

135 
G‘B‘a
(è{ 
	gb‘a
->
v®
();}

137 
	g´iv©e
:

139 
vœtu®
 
logProb
();

141 
	gV¬
<
	gPosR—l
>* 
	g®pha
;

142 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

146 
şass
 
	gPosUnifÜm
 : 
public
 
Rv¬
<
PosR—l
> {

148 
public
:

150 
PosUnifÜm
(
V¬
<
PosR—l
>* 
šroÙ
, 
šmax
);

151 
PosUnifÜm
(cÚ¡ PosUnifÜm& 
äom
);

153 
	gvœtu®
 ~
PosUnifÜm
(){}

155 
d¿wSam¶e
();

157 
	g´iv©e
:

159 
vœtu®
 
logProb
();

161 
	gV¬
<
	gPosR—l
>* 
	groÙ
;

162 
	gmax
;

165 
şass
 
	gBšomŸl
 : 
public
 
Rv¬
<
IÁ
> {

167 
public
:

169 
BšomŸl
(
šN
, 
V¬
<
Un™R—l
>* 
šth‘a
);

170 
	gvœtu®
 ~
BšomŸl
() {}

173 
d¿wSam¶e
();

174 
Prİo£Move
(
tunšg
);

177 
	g´iv©e
:

179 
vœtu®
 
logProb
();

181 
	gN
;

182 
	gV¬
<
	gUn™R—l
>* 
	gth‘a
;

185 
şass
 
	gPoissÚ
 : 
public
 
vœtu®
 
Rv¬
<
IÁ
> {

187 
public
:

189 
PoissÚ
(
V¬
<
PosR—l
>* 
šmu
);

190 
	gvœtu®
 ~
PoissÚ
() {}

192 
d¿wSam¶e
();

196 
	g´Ùeùed
:

198 
vœtu®
 
logProb
();

201 
	gV¬
<
	gPosR—l
>* 
	gmu
;

204 
şass
 
	gDœichËt
 : 
public
 
vœtu®
 
Rv¬
<
Profe
> {

206 
public
:

208 
DœichËt
(
dim’siÚ
);

209 
DœichËt
(
V¬
<
Profe
>* 
šûÁ”
, V¬<
PosR—l
>* 
šcÚûÁ¿tiÚ
);

211 
	gvœtu®
 ~
DœichËt
() {}

213 
d¿wSam¶e
();

215 
vœtu®
 
Move
(
tunšg
, 
n
) {

216 ià(! 
isCÏm³d
()) {

218 
CÜru±
(
Œue
);

219 
	glogHa¡šgs
 = 
Profe
::
Prİo£Move
(
tunšg
, 
n
);

220 
	gd–LogProb
 = 
Upd©e
();

221 
	glogR©io
 = 
d–LogProb
 + 
logHa¡šgs
;

222 
boŞ
 
	gacû±ed
 = (
log
(
Rªdom
::
UnifÜm
()è< 
logR©io
);

223 ià(! 
	gacû±ed
) {

224 
CÜru±
(
çl£
);

225 
Re¡Üe
();

227  (è
	gacû±ed
;

232 
vœtu®
 
Move
(
tunšg
) {

233  
Move
(
tunšg
, 
G‘Dim
());

236 
vœtu®
 
Prİo£Move
(
tunšg
) {

237  
	gProfe
::
Prİo£Move
(
tunšg
, 
G‘Dim
());

240 
	g´Ùeùed
:

242 
V¬
<
Profe
>* 
ûÁ”
;

243 
	gV¬
<
	gPosR—l
>* 
	gcÚûÁ¿tiÚ
;

245 
vœtu®
 
logProb
();

249 
şass
 
	gMuÉšomŸl
 : 
public
 
vœtu®
 
Rv¬
<
IÁVeùÜ
> {

251 
public
:

253 
MuÉšomŸl
(
V¬
<
Profe
>* 
š´ob¬¿y
, 
šN
);

254 
	gvœtu®
 ~
MuÉšomŸl
() {}

256 
d¿wSam¶e
();

257 
G‘Dim
() { GetDim();}

259 
	g´iv©e
:

261 
V¬
<
Profe
>* 
´ob¬¿y
;

262 
	gN
;

264 
vœtu®
 
logProb
();

268 
şass
 
	gFš™eDisü‘e
 : 
public
 
vœtu®
 
Rv¬
<
IÁ
> {

270 
public
:

272 
Fš™eDisü‘e
(
V¬
<
Profe
>* 
š´ob¬¿y
);

273 
	gvœtu®
 ~
Fš™eDisü‘e
() {}

275 
d¿wSam¶e
();

277 
	g´iv©e
 :

279 
V¬
<
Profe
>* 
´ob¬¿y
;

281 
vœtu®
 
logProb
();

284 
şass
 
	gIIDExp
 : 
public
 
Rv¬
<
PosR—lVeùÜ
> {

286 
public
:

288 
IIDExp
(
šdim
, 
V¬
<
PosR—l
>* 
šm—n
);

289 
IIDExp
(
šdim
);

291 
	gvœtu®
 ~
IIDExp
() {}

293 
d¿wSam¶e
();

295 
£Î
(
š
);

297 
	g´iv©e
:

299 
V¬
<
PosR—l
>* 
m—n
;

300 
	gdim
;

302 
vœtu®
 
logProb
();

306 
şass
 
	gIIDGamma
 : 
public
 
vœtu®
 
Rv¬
<
PosR—lVeùÜ
> {

308 
public
:

310 
IIDGamma
(
šdim
, 
V¬
<
PosR—l
>* 
š®pha
, V¬<PosR—l>* 
šb‘a
);

311 
IIDGamma
(
šdim
);

313 
	gvœtu®
 ~
IIDGamma
() {}

315 
d¿wSam¶e
();

317 
£Î
(
š
);

319 
	g´Ùeùed
:

321 
V¬
<
PosR—l
>* 
®pha
;

322 
	gV¬
<
	gPosR—l
>* 
	gb‘a
;

323 
	gdim
;

325 
vœtu®
 
logProb
();

329 
şass
 
	gProduù
 : 
public
 
Dv¬
<
PosR—l
> {

331 
public
:

333 
Produù
(
V¬
<
PosR—l
>* 
ša
, V¬<PosR—l>* 
šb
) {

334 
	ga
 = 
ša
;

335 
	gb
 = 
šb
;

336 
Regi¡”
(
a
);

337 
Regi¡”
(
b
);

340 
¥ecŸlUpd©e
() {

341 
£tv®
(
a
->
v®
(è* 
b
->val());

344 
	g´Ùeùed
:

346 
V¬
<
PosR—l
>* 
a
;

347 
	gV¬
<
	gPosR—l
>* 
	gb
;

	@Sample.cpp

2 
	~"Sam¶e.h
"

4 
	gSam¶e
::
	$Sam¶e
(
¡ršg
 
f’ame
, 
š_buºš
, 
š_ev”y
, 
š_uÁ
) {

5 
buºš
 = 
š_buºš
;

6 
ev”y
 = 
š_ev”y
;

7 
uÁ
 = 
š_uÁ
;

8 
Çme
 = 
f’ame
;

9 
chaš_is
 = 0;

10 
	}
}

12 
	gSam¶e
::~
	$Sam¶e
() {

13 
d–‘e
 
chaš_is
;

14 
	}
}

16 
	gSam¶e
::
	$O³nChašFe
() {

18 ià(
uÁ
 == -1) {

19 
uÁ
 = 
chašsize
;

21 ià(
uÁ
 > 
chašsize
) {

22 
û¼
 << "numb” oàpošt §ved i Ës thª " << 
uÁ
 << '\n';

23 
uÁ
 = 
chašsize
;

25 ià(
buºš
 == -1) {

26 
buºš
 = 
chašsize
 / 10;

28 
size
 = (
uÁ
-
buºš
è/ 
ev”y
;

29 ià(
size
 <= 0) {

30 
û¼
 << "error : chain‚ot†ongƒnough\n";

31 
	`ex™
(1);

33 
cu¼’ošt
 = 0;

35 
chaš_is
 = 
Ãw
 
	`if¡»am
((
Çme
 + ".chaš").
	`c_¡r
());

36 ià(! 
chaš_is
) {

37 
û¼
 << "”rÜ: cªnÙ fšd f" << 
Çme
 << ".chain\n";

38 
	`ex™
(1);

40 
i
=0; i<
buºš
; i++) {

41 
mod–
->
	`FromSŒ—m
(*
chaš_is
);

43 
	}
}

45 
	gSam¶e
::
	$G‘NextPošt
() {

47 ià(
cu¼’ošt
 =ğ
size
) {

48 
û¼
 << "error in Sample::GetNextPoint: going…ast†ast…oints\n";

49 
	`ex™
(1);

51 ià(
cu¼’ošt
) {

52 
i
=0; i<
ev”y
-1; i++) {

53 
mod–
->
	`FromSŒ—m
(*
chaš_is
);

56 
mod–
->
	`FromSŒ—m
(*
chaš_is
);

57 
cu¼’ošt
++;

58 
	}
}

	@Sample.h

1 #iâdeà
SAMPLE_H


2 
	#SAMPLE_H


	)

4 
	~<f¡»am
>

5 
	~<c¡dlib
>

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	~"ProbMod–.h
"

15 şas 
	cSam¶e
 {

17 
	mpublic
:

19 
Sam¶e
(
¡ršg
 
f’ame
, 
š_buºš
 = 0, 
š_ev”y
 = 1, 
š_uÁ
 = -1);

21 
	mvœtu®
 ~
Sam¶e
();

24 
¡ršg
 
	$G‘Name
(è{ 
Çme
;}

28 
	`G‘NextPošt
();

33 
vœtu®
 
ProbMod–
* 
	$G‘Mod–
(è{ 
mod–
;
	}
}

37 
vœtu®
 
¡ršg
 
G‘Mod–Ty³
() = 0;

41 
vœtu®
 
O³n
() = 0;

48 
O³nChašFe
();

50 
	gsize
;

52 
	g´Ùeùed
:

54 
if¡»am
* 
chaš_is
;

55 
	gchašev”y
;

56 
	gchašuÁ
;

57 
	gchašsize
;

58 
	gbuºš
;

59 
	gev”y
;

60 
	guÁ
;

61 
	gcu¼’ošt
;

62 
ProbMod–
* 
	gmod–
;

63 
¡ršg
 
	gÇme
;

	@SequenceAlignment.cpp

1 
	~"Sequ’ûAlignm’t.h
"

2 
	~"SŒšgSŒ—mUts.h
"

3 
	~"BiŞogiÿlSequ’ûs.h
"

5 
	~"Rªdom.h
"

7 
	~<f¡»am
>

16 
	$IÁ
(
¡ršg
 
s
) {

17  
	`©oi
Ğ
s
.
	`c_¡r
() );

18 
	}
}

20 
	$DoubË
(
¡ršg
 
s
) {

21  
	`©of
Ğ
s
.
	`c_¡r
() );

22 
	}
}

24 
	gSequ’ûAlignm’t
::
	$G‘EmpœiÿlF»q
(* 
š
) {

25 
n
 = 
	`G‘N¡©e
();

26 
i
=0; i<
	`G‘N¡©e
(); i++) {

27 
š
[
i
] = 1;

29 
i
=0; i<
	`G‘Nxa
(); i++) {

30 
j
=0; j<
	`G‘Ns™e
(); j++) {

31 ià(
	`G‘S‹
(
i
,
j
è!ğ
unknown
) {

32 
š
[
	`G‘S‹
(
i
,
j
)]++;

33 
n
++;

37 
i
=0; i<
	`G‘N¡©e
(); i++) {

38 
š
[
i
] /ğ
n
;

40 
	}
}

43 
	gSequ’ûAlignm’t
::
	$G‘S™eEmpœiÿlF»q
(** 
š
, 
p£udocouÁ
) {

45 ià(
p£udocouÁ
 < 0) {

46 
j
=0; j<
	`G‘Ns™e
(); j++) {

47 
i
=0; i<
	`G‘N¡©e
(); i++) {

48 
š
[
j
][
i
] = -
p£udocouÁ
 * 
Rªdom
::
	`sGamma
(1.0);

53 
j
=0; j<
	`G‘Ns™e
(); j++) {

54 
i
=0; i<
	`G‘N¡©e
(); i++) {

55 
š
[
j
][
i
] = 
p£udocouÁ
;

60 
i
=0; i<
	`G‘Nxa
(); i++) {

61 
j
=0; j<
	`G‘Ns™e
(); j++) {

62 ià(
	`G‘S‹
(
i
,
j
è!ğ
unknown
) {

63 
š
[
j
][
	`G‘S‹
(
i
,j)]++;

67 
j
=0; j<
	`G‘Ns™e
(); j++) {

68 
tÙ®
 = 0;

69 
i
=0; i<
	`G‘N¡©e
(); i++) {

70 
tÙ®
 +ğ
š
[
j
][
i
];

72 
i
=0; i<
	`G‘N¡©e
(); i++) {

73 
š
[
j
][
i
] /ğ
tÙ®
;

76 
	}
}

78 
	gSequ’ûAlignm’t
::
	$ToFa¡a
(
o¡»am
& 
os
) {

80 
i
=0; i<
Nxa
; i++) {

81 
os
 << '>' << 
x£t
->
	`G‘TaxÚ
(
i
) << '\n';

82 
j
=0; j<
Ns™e
; j++) {

83 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
));

85 
os
 << '\n';

87 
	}
}

114 
	gSequ’ûAlignm’t
::
	$ToSŒ—m
(
o¡»am
& 
os
) {

117 
os
 << 
Nxa
 << '\t' << 
Ns™e
 << '\n';

118 
max
 = 0;

119 
i
=0; i<
Nxa
; i++) {

120 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

121 ià(
max
 < 
l
) {

122 
max
 = 
l
;

126 
i
=0; i<
Nxa
; i++) {

127 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

128 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

129 
os
 << ' ';

131 
j
=0; j<
Ns™e
; j++) {

132 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
));

134 
os
 << '\n';

136 
os
 << '\n';

137 
	}
}

139 
	gSequ’ûAlignm’t
::
	$G‘NÚMissšgTrËt
() {

141 
ns™e
 = 0;

142 
j
=2; j<
Ns™e
-3; j+=3) {

143 ià(
	`NoMissšgCŞumn
(
j
-1) && NoMissingColumn(j) && NoMissingColumn(j+1)) {

144 
ns™e
 ++;

147  
ns™e
;

148 
	}
}

150 
	gSequ’ûAlignm’t
::
	$ToSŒ—mTrËt
(
o¡»am
& 
os
) {

152 
ns™e
 = 0;

153 
j
=2; j<
Ns™e
-3; j+=3) {

154 ià(
	`NoMissšgCŞumn
(
j
-1) && NoMissingColumn(j) && NoMissingColumn(j+1)) {

155 
ns™e
 ++;

159 
os
 << 
Nxa
 << '\t' << 3 * 
ns™e
 << '\n';

160 
max
 = 0;

161 
i
=0; i<
Nxa
; i++) {

162 
l
 = 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
();

163 ià(
max
 < 
l
) {

164 
max
 = 
l
;

168 
i
=0; i<
Nxa
; i++) {

169 
os
 << 
x£t
->
	`G‘TaxÚ
(
i
);

170 
j
=0; j< 5 + 
max
 - 
x£t
->
	`G‘TaxÚ
(
i
).
	`Ëngth
(); j++) {

171 
os
 << ' ';

173 
j
=2; j<
Ns™e
-3; j+=3) {

174 ià(
	`NoMissšgCŞumn
(
j
-1) && NoMissingColumn(j) && NoMissingColumn(j+1)) {

175 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
-1));

176 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
));

177 
os
 << 
¡©e¥aû
->
	`G‘S‹
(G‘S‹(
i
,
j
+1));

180 
os
 << '\n';

182 
os
 << '\n';

183 
	}
}

185 
	gFeSequ’ûAlignm’t
::
	$FeSequ’ûAlignm’t
(
¡ršg
 
f’ame
, 
fuÎlše
) {

187 
S³c›sNames
 = 0;

189 
	`R—dD©aFromFe
(
f’ame
,0);

190 
x£t
 = 
Ãw
 
	`TaxÚS‘
(
S³c›sNames
,
Nxa
);

191 
d–‘e
[] 
S³c›sNames
;

198 
	}
}

200 
	gFeSequ’ûAlignm’t
::
	$R—dD©aFromFe
 (
¡ršg
 
fe¥ec
, 
fÜûš‹¾—ved
) {

202 
¡ršg
 
tmp
;

203 
if¡»am
 
	`is
((
P©h
 + 
fe¥ec
).
	`c_¡r
());

204 ià(!
is
) {

205 
û¼
 << "”rÜ : cªnÙ fšd d©¨f" << 
fe¥ec
 << '\n';

206 
û¼
 << "\n";

207 
	`ex™
(1);

209 
is
 >> 
tmp
;

210 
Œy
{

211 ià(
tmp
 == "#NEXUS") {

212 
	`R—dNexus
(
fe¥ec
);

215 ià(
tmp
 == "#SPECIALALPHABET") {

216 
	`R—dS³cŸl
(
fe¥ec
);

220 
û¼
 << "phylip\n";

221 ià(! 
fÜûš‹¾—ved
) {

222 
»tuºv®ue
 = 
	`Te¡PhylSequ’tŸl
(
fe¥ec
);

223 ià(
»tuºv®ue
) {

224 
û¼
 << "sequential\n";

225 
	`R—dPhylSequ’tŸl
(
fe¥ec
);

229 
û¼
 << "interleaved\n";

230 
»tuºv®ue
 = 
	`Te¡Phyl
(
fe¥ec
,1);

231 ià(
»tuºv®ue
) {

232 
û¼
 << "interleaved,axon‚ames„epeated\n";

233 
	`R—dPhyl
(
fe¥ec
,1);

236 
û¼
 << "interleaved,axon‚ames‚ot„epeated\n";

237 
	`Te¡Phyl
(
fe¥ec
,0);

238 
	`R—dPhyl
(
fe¥ec
,0);

242 
	`ÿtch
(...) {

243 
	`ex™
(1);

247 
	}
}

249 
	gFeSequ’ûAlignm’t
::
	$R—dNexus
(
¡ršg
 
fe¥ec
) {

251 
if¡»am
 
	`theSŒ—m
((
P©h
 + 
fe¥ec
).
	`c_¡r
());

252 
Œy
 {

254 
	`GoPa¡NextWÜd
(
theSŒ—m
, "dimensions");

255 
	`GoPa¡Next
(
theSŒ—m
, '=');

256 
theSŒ—m
 >> 
Nxa
;

257 
	`GoPa¡Next
(
theSŒ—m
, '=');

258 
theSŒ—m
 >> 
Ns™e
;

259 
	`GoPa¡NextWÜd
(
theSŒ—m
, "format");

260 
	`GoPa¡NextWÜd
(
theSŒ—m
, "datatype");

261 
	`GoPa¡Next
(
theSŒ—m
, '=');

262 
¡ršg
 
ty³
;

263 
theSŒ—m
 >> 
ty³
;

267 ià(
	`Equiv®’tSŒšgs
(
ty³
,"protein")) {

268 
¡©e¥aû
 = 
Ãw
 
	`PrÙešS‹S·û
();

270 ià(
	`Equiv®’tSŒšgs
(
ty³
,"dna")) {

271 
¡©e¥aû
 = 
Ãw
 
	`DNAS‹S·û
();

273 ià(
	`Equiv®’tSŒšgs
(
ty³
,"rna")) {

274 
¡©e¥aû
 = 
Ãw
 
	`RNAS‹S·û
();

277 
û¼
 << "error cannot„ecognise dataype\n";

278 
û¼
 << 
ty³
 << "\n";

279 
	`ex™
(1);

282 ià(
D©a
) {

283 
i
=0; i<
Nxa
; i++) {

284 
d–‘e
 
D©a
[
i
];

286 
d–‘e
[] 
D©a
;

288 
D©a
 = 
	`Ãw
 (*[
Nxa
]);

289 
i
=0; i<
Nxa
; i++) {

290 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

293 
S³c›sNames
 = 
Ãw
 
¡ršg
[
Nxa
];

295 
	`GoPa¡NextWÜd
(
theSŒ—m
, "Matrix");

297 
l
 = 0;

298 
l
<
Ns™e
) {

299 
m
 = 0;

300 
i
=0; i<
Nxa
; i++) {

302 
¡ršg
 
‹mp
;

303 
theSŒ—m
 >> 
‹mp
;

304 
‹mp
 == "[") {

305 
c
;

306 
c
 = 'i';

307 
c
 !ğ']'èøğ
theSŒ—m
.
	`g‘
();

308 
theSŒ—m
 >> 
‹mp
;

311 ià(!
l
) {

312 
S³c›sNames
[
i
] = 
‹mp
;

315 ià(
‹mp
 !ğ
S³c›sNames
[
i
]) {

316 
û¼
 << "”rÜ wh’„—dšg»ba£: " << 
‹mp
 << '\t' << 
S³c›sNames
[
i
] << '\n';

317 
	`ex™
(1);

321 
c
;

322 
k
 = 
l
;

324 
c
 = 
theSŒ—m
.
	`g‘
();

325 ià(
c
 == '[') {

326 
c
 !ğ']'èøğ
theSŒ—m
.
	`g‘
();

327 
c
 = 
theSŒ—m
.
	`g‘
();

329 ià((
c
 != ' ') && (c != '\t') && (c != '\n') && (c != 13)) {

330 ià(
c
 == '(') {

331 
D©a
[
i
][
k
] = 
unknown
;

332 
c
 != ')') {

333 
theSŒ—m
 >> 
c
;

336 ià(
c
 == '{') {

337 
D©a
[
i
][
k
] = 
unknown
;

338 
c
 != '}') {

339 
theSŒ—m
 >> 
c
;

343 
o¡ršg¡»am
 
s
;

344 
s
 << 
c
;

345 
D©a
[
i
][
k
] = 
¡©e¥aû
->
	`G‘S‹
(
s
.
	`¡r
());

347 
k
++;

350 (!
theSŒ—m
.
	`eof
()è&& (
c
 != '\n') && (c != 13));

351 ià(
theSŒ—m
.
	`eof
()) {

352 ià(
i
 < 
Nxa
-1) {

353 
û¼
 << "”rÜ : found " << 
i
 << "ax¨š¡—d oà" << 
Nxa
 << " in datafile\n";

354 
	`ex™
(1);

357 ià(!
m
) {

358 
m
 = 
k
;

361 ià(
m
 !ğ
k
) {

362 
û¼
 << "”rÜ wh’„—dšg‚exu : " << 
m
 << '\t' << 
k
 << '\n';

363 
û¼
 << "x¨: " << 
i
 << '\t' << 
S³c›sNames
[i] << '\n';

364 ià(
m
 > 
k
) {

365 
k
 !ğ
m
) {

366 
D©a
[
i
][
k
] = 
unknown
;

367 
k
++;

373 
l
ğ
m
;

376 
	`ÿtch
(...) {

377 
û¼
 << "error while„eading data file\n";

381 
	}
}

388 
	gFeSequ’ûAlignm’t
::
	$R—dS³cŸl
(
¡ršg
 
f’ame
) {

390 
»tuºv®ue
 = 0;

391 
Œy
 {

393 
if¡»am
 
	`theSŒ—m
(
f’ame
.
	`c_¡r
());

395 
¡ršg
 
tmp
;

396 
theSŒ—m
 >> 
tmp
;

397 
theSŒ—m
 >> 
Nxa
;

398 
theSŒ—m
 >> 
Ns™e
;

399 
theSŒ—m
 >> 
tmp
;

400 
û¼
 << 
tmp
 << '\n';

401 
N¡©e
 = 
tmp
.
	`Ëngth
();

402 * 
AÍhab‘
 = 
Ãw
 [
N¡©e
];

403 
NAÍhab‘S‘
 = 
N¡©e
+5;

404 * 
AÍhab‘S‘
 = 
Ãw
 [
NAÍhab‘S‘
];

405 
û¼
 << "®phab‘ siz: " << 
N¡©e
 << '\n';

406 
û¼
 << "alphabet : ";

407 
i
=0; i<
N¡©e
; i++) {

408 
AÍhab‘
[
i
] = 
tmp
[i];

409 
AÍhab‘S‘
[
i
] = 
tmp
[i];

410 
û¼
 << 
AÍhab‘
[
i
] << ' ';

412 
û¼
 << '\n';

414 
AÍhab‘S‘
[
N¡©e
] = '?';

415 
AÍhab‘S‘
[
N¡©e
+1] = '-';

416 
AÍhab‘S‘
[
N¡©e
+2] = '*';

417 
AÍhab‘S‘
[
N¡©e
+3] = 'X';

418 
AÍhab‘S‘
[
N¡©e
+4] = 'x';

420 
¡©e¥aû
 = 
Ãw
 
	`G’”icS‹S·û
(
N¡©e
,
AÍhab‘
,
NAÍhab‘S‘
,
AÍhab‘S‘
);

422 ià(
D©a
) {

423 
i
=0; i<
Nxa
; i++) {

424 
d–‘e
 
D©a
[
i
];

426 
d–‘e
[] 
D©a
;

428 
D©a
 = 
	`Ãw
 (*[
Nxa
]);

429 
i
=0; i<
Nxa
; i++) {

430 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

433 
d–‘e
[] 
S³c›sNames
;

434 
S³c›sNames
 = 
Ãw
 
¡ršg
[
Nxa
];

436 
Áaxa
 = 0;

437 
¡ršg
 
‹mp
;

438 (!
theSŒ—m
.
	`eof
()è&& (
Áaxa
<
Nxa
)) {

439 
theSŒ—m
 >> 
‹mp
;

440 
S³c›sNames
[
Áaxa
] = 
‹mp
;

441 
ns™e
 = 0;

443 
c
;

445 
c
 = 
theSŒ—m
.
	`g‘
();

446 ià((!
theSŒ—m
.
	`eof
()è&& (
c
 != ' ') && (c != '\n') && (c != '\t') && (c!=13)) {

447 ià(
c
 == '(') {

448 
D©a
[
Áaxa
][
ns™e
] = 
unknown
;

449 
c
 != ')') {

450 
theSŒ—m
 >> 
c
;

453 ià(
c
 == '{') {

454 
D©a
[
Áaxa
][
ns™e
] = 
unknown
;

455 
c
 != '}') {

456 
theSŒ—m
 >> 
c
;

460 
p
 =0;

461 (
p
 < 
NAÍhab‘S‘
è&& (
c
 !ğ
AÍhab‘S‘
[p]))…++;

462 ià(
p
 =ğ
NAÍhab‘S‘
) {

463 
cout
 << "”rÜ: dÛ nÙ„ecogni£ ch¬aù”.axÚ " << 
Áaxa
 << '\t' << 
S³c›sNames
[Áaxa] << " s™ " << 
ns™e
 << '\t' << 
c
 << '\n';

464 
	`ex™
(1);

466 ià(
p
 >ğ
N¡©e
) {

467 
D©a
[
Áaxa
][
ns™e
] = 
unknown
;

470 
l
=0;†<
N¡©e
;†++) {

471 ià(
c
 =ğ
AÍhab‘
[
l
]) {

472 
D©a
[
Áaxa
][
ns™e
] = 
l
;

477 
ns™e
++;

480 (!
theSŒ—m
.
	`eof
()è&& (
ns™e
 < 
Ns™e
));

481 
Áaxa
++;

484 
	`ÿtch
(...) {

485 
û¼
 << "error while„eading data file\n";

488  
»tuºv®ue
;

489 
	}
}

495 
	gFeSequ’ûAlignm’t
::
	$Te¡PhylSequ’tŸl
 (
¡ršg
 
fe¥ec
) {

497 
if¡»am
 
	`theSŒ—m
((
P©h
 + 
fe¥ec
).
	`c_¡r
());

498 
Œy
 {

500 
¡ršg
 
‹mp
;

501 
theSŒ—m
 >> 
‹mp
;

502 ià(!
	`IsIÁ
(
‹mp
)) {

503 
û¼
 << "error when„eading data\n";

504 
û¼
 << "data should be formatted‡s follows:\n";

505 
û¼
 << "#taxa #sites\n";

506 
û¼
 << "name1 seq1.....\n";

507 
û¼
 << "name2 seq2.....\n";

508 
û¼
 << "...\n";

509 
û¼
 << '\n';

510 
	`ex™
(1);

512 
Nxa
 = 
	`©oi
(
‹mp
.
	`c_¡r
());

513 
theSŒ—m
 >> 
‹mp
;

514 ià(!
	`IsIÁ
(
‹mp
)) {

515 
û¼
 << "error when„eading data\n";

516 
û¼
 << "data should be formatted‡s follows:\n";

517 
û¼
 << "#taxa #sites\n";

518 
û¼
 << "name1 seq1.....\n";

519 
û¼
 << "name2 seq2.....\n";

520 
û¼
 << "...\n";

521 
û¼
 << '\n';

522 
	`ex™
(1);

524 
Ns™e
 = 
	`©oi
(
‹mp
.
	`c_¡r
());

526 
d–‘e
[] 
S³c›sNames
;

527 
S³c›sNames
 = 
Ãw
 
¡ršg
[
Nxa
];

529 
AAcomp
 = 1;

530 
DNAcomp
 = 1;

531 
RNAcomp
 = 1;

533 
Áaxa
 = 0;

534 (!
theSŒ—m
.
	`eof
()è&& (
Áaxa
<
Nxa
)) {

535 
theSŒ—m
 >> 
‹mp
;

536 
S³c›sNames
[
Áaxa
] = 
‹mp
;

537 
ns™e
 = 0;

539 
c
 = ' ';

541 
c
 = 
theSŒ—m
.
	`g‘
();

542 ià((!
theSŒ—m
.
	`eof
()è&& (
c
 != ' ') && (c != '\n') && (c!='\t') && (c != 13)) {

543 ià(
c
 == '(') {

544 
c
 != ')') {

545 
theSŒ—m
 >> 
c
;

548 ià(
c
 == '{') {

549 
c
 != '}') {

550 
theSŒ—m
 >> 
c
;

554 
p
 =0;

555 ià(
DNAcomp
) {

556 (
p
 < 
DNAN
è&& (
c
 !ğ
DNA£t
[p]))…++;

557 ià(
p
 =ğ
DNAN
) {

558 
DNAcomp
 = 0;

561 
p
 =0;

562 ià(
RNAcomp
) {

563 (
p
 < 
RNAN
è&& (
c
 !ğ
RNA£t
[p]))…++;

564 ià(
p
 =ğ
RNAN
è
RNAcomp
 = 0;

566 
p
 =0;

567 ià(
AAcomp
) {

568 (
p
 < 
AAN
è&& (
c
 !ğ
AA£t
[p]))…++;

569 ià(
p
 =ğ
AAN
) {

570 
AAcomp
 = 0;

574 
ns™e
++;

577 (!
theSŒ—m
.
	`eof
()è&& (
ns™e
 < 
Ns™e
));

578 ià(
theSŒ—m
.
	`eof
()) {

579 ià(
ns™e
 < 
Ns™e
) {

583 
Áaxa
++;

585 ià(
theSŒ—m
.
	`eof
()) {

586 ià(
Áaxa
 < 
Nxa
) {

590 ià(
DNAcomp
) {

591 
¡©e¥aû
 = 
Ãw
 
DNAS‹S·û
;

593 ià(
RNAcomp
) {

594 
¡©e¥aû
 = 
Ãw
 
RNAS‹S·û
;

596 ià(
AAcomp
) {

597 
¡©e¥aû
 = 
Ãw
 
PrÙešS‹S·û
;

603 
	`ÿtch
(...) {

607 
	}
}

610 
	gFeSequ’ûAlignm’t
::
	$R—dPhylSequ’tŸl
 (
¡ršg
 
fe¥ec
) {

612 
if¡»am
 
	`theSŒ—m
((
P©h
 + 
fe¥ec
).
	`c_¡r
());

613 
Œy
 {

615 
¡ršg
 
‹mp
;

616 
theSŒ—m
 >> 
‹mp
;

617 ià(!
	`IsIÁ
(
‹mp
)) {

618 
û¼
 << "error when„eading data\n";

619 
û¼
 << "data should be formatted‡s follows:\n";

620 
û¼
 << "#taxa #sites\n";

621 
û¼
 << "name1 seq1.....\n";

622 
û¼
 << "name2 seq2.....\n";

623 
û¼
 << "...\n";

624 
û¼
 << '\n';

625 
	`ex™
(1);

627 
Nxa
 = 
	`IÁ
(
‹mp
);

628 
theSŒ—m
 >> 
‹mp
;

629 ià(!
	`IsIÁ
(
‹mp
)) {

630 
û¼
 << "error when„eading data\n";

631 
û¼
 << "data should be formatted‡s follows:\n";

632 
û¼
 << "#taxa #sites\n";

633 
û¼
 << "name1 seq1.....\n";

634 
û¼
 << "name2 seq2.....\n";

635 
û¼
 << "...\n";

636 
û¼
 << '\n';

637 
	`ex™
(1);

639 
Ns™e
 = 
	`IÁ
(
‹mp
);

641 
D©a
 = 
	`Ãw
 (*[
Nxa
]);

642 
i
=0; i<
Nxa
; i++) {

643 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

645 
S³c›sNames
 = 
Ãw
 
¡ršg
[
Nxa
];

647 
Áaxa
 = 0;

648 (!
theSŒ—m
.
	`eof
()è&& (
Áaxa
<
Nxa
)) {

649 
theSŒ—m
 >> 
‹mp
;

650 
S³c›sNames
[
Áaxa
] = 
‹mp
;

651 
ns™e
 = 0;

653 
c
;

655 
c
 = 
theSŒ—m
.
	`g‘
();

656 ià((!
theSŒ—m
.
	`eof
()è&& (
c
 != ' ') && (c != '\n') && (c != '\t') && (c!=13)) {

657 ià(
c
 == '(') {

658 
D©a
[
Áaxa
][
ns™e
] = 
unknown
;

659 
c
 != ')') {

660 
theSŒ—m
 >> 
c
;

663 ià(
c
 == '{') {

664 
D©a
[
Áaxa
][
ns™e
] = 
unknown
;

665 
c
 != '}') {

666 
theSŒ—m
 >> 
c
;

670 
o¡ršg¡»am
 
s
;

671 
s
 << 
c
;

672 
D©a
[
Áaxa
][
ns™e
] = 
¡©e¥aû
->
	`G‘S‹
(
s
.
	`¡r
());

674 
ns™e
++;

677 (!
theSŒ—m
.
	`eof
()è&& (
ns™e
 < 
Ns™e
));

678 
Áaxa
++;

681 
	`ÿtch
(...) {

682 
û¼
 << "error while„eading data file\n";

683 
	`ex™
(1);

685 
	}
}

687 
	gFeSequ’ûAlignm’t
::
	$Te¡Phyl
 (
¡ršg
 
fe¥ec
, 
»³©xa
) {

689 
if¡»am
 
	`theSŒ—m
((
P©h
 + 
fe¥ec
).
	`c_¡r
());

690 
Œy
 {

692 
¡ršg
 
‹mp
;

693 
theSŒ—m
 >> 
‹mp
;

694 ià(!
	`IsIÁ
(
‹mp
)) {

695 
û¼
 << "error when„eading data\n";

696 
û¼
 << "data should be formatted‡s follows:\n";

697 
û¼
 << "#taxa #sites\n";

698 
û¼
 << "name1 seq1.....\n";

699 
û¼
 << "name2 seq2.....\n";

700 
û¼
 << "...\n";

701 
û¼
 << '\n';

702 
	`ex™
(1);

704 
Nxa
 = 
	`IÁ
(
‹mp
);

705 
theSŒ—m
 >> 
‹mp
;

706 ià(!
	`IsIÁ
(
‹mp
)) {

707 
û¼
 << "error when„eading data\n";

708 
û¼
 << "data should be formatted‡s follows:\n";

709 
û¼
 << "#taxa #sites\n";

710 
û¼
 << "name1 seq1.....\n";

711 
û¼
 << "name2 seq2.....\n";

712 
û¼
 << "...\n";

713 
û¼
 << '\n';

714 
	`ex™
(1);

716 
Ns™e
 = 
	`IÁ
(
‹mp
);

718 
d–‘e
[] 
S³c›sNames
;

719 
S³c›sNames
 = 
Ãw
 
¡ršg
[
Nxa
];

721 
AAcomp
 = 1;

722 
DNAcomp
 = 1;

723 
RNAcomp
 = 1;

725 
l
 = 0;

726 
block
 = 0;

727 
l
<
Ns™e
) {

728 
block
++;

729 
m
 = 0;

730 
i
=0; i<
Nxa
; i++) {

732 ià((!
l
è|| 
»³©xa
) {

733 
¡ršg
 
‹mp
;

734 
theSŒ—m
 >> 
‹mp
;

735 ià(!
l
) {

736 
S³c›sNames
[
i
] = 
‹mp
;

739 ià(
‹mp
 !ğ
S³c›sNames
[
i
]) {

745 
c
;

746 
k
 = 
l
;

748 
c
 = 
theSŒ—m
.
	`g‘
();

749 ià((!
theSŒ—m
.
	`eof
()è&& (
c
 != ' ') && (c != '\n') && (c!='\t') && (c != 13)) {

750 ià(
c
 == '(') {

751 
c
 != ')') {

752 
theSŒ—m
 >> 
c
;

755 ià(
c
 == '{') {

756 
c
 != '}') {

757 
theSŒ—m
 >> 
c
;

761 
p
 =0;

762 ià(
DNAcomp
) {

763 (
p
 < 
DNAN
è&& (
c
 !ğ
DNA£t
[p]))…++;

764 ià(
p
 =ğ
DNAN
è
DNAcomp
 = 0;

766 
p
 =0;

767 ià(
RNAcomp
) {

768 (
p
 < 
RNAN
è&& (
c
 !ğ
RNA£t
[p]))…++;

769 ià(
p
 =ğ
RNAN
è
RNAcomp
 = 0;

771 
p
 =0;

772 ià(
AAcomp
) {

773 (
p
 < 
AAN
è&& (
c
 !ğ
AA£t
[p]))…++;

774 ià(
p
 =ğ
AAN
) {

775 
AAcomp
 = 0;

779 
k
++;

782 (!
theSŒ—m
.
	`eof
()è&& (
c
 != '\n') && (c != 13) && (c != 10));

783 ià(
theSŒ—m
.
	`eof
()) {

784 ià(
i
 < 
Nxa
-1) {

785 
û¼
 << "”rÜ : found " << 
i
 << "ax¨š¡—d oà" << 
Nxa
 << " in datafile\n";

786 
	`ex™
(1);

789 
c
 = 
theSŒ—m
.
	`³ek
();

790 (!
theSŒ—m
.
	`eof
()è&& ((
c
 == '\n') || (c == 13))) {

791 
c
 = 
theSŒ—m
.
	`g‘
();

792 
c
 = 
theSŒ—m
.
	`³ek
();

794 ià(!
m
) {

795 
m
 = 
k
;

798 ià(
m
 !ğ
k
) {

799 
û¼
 << "inest…hylip\n";

800 
û¼
 << "”rÜ wh’„—dšg d©¨nÚ m©chšg‚umb” oà£qu’û š block‚umb” " << 
block
 << " fÜaxÚ " << 
i
+1 << " " << 
S³c›sNames
[i] << '\n';

801 
û¼
 << "x¨: " << 
i
 << '\t' << 
S³c›sNames
[i] << '\n';

802 
û¼
 << "»ad " << 
k
 << " in¡—d oà" << 
m
 << "characters\n";

803 
	`ex™
(1);

807 
l
ğ
m
;

809 ià(
l
<
Ns™e
) {

810 
û¼
 << "error :„eachedƒnd of stream \n";

811 
û¼
 << "data should be formatted‡s follows:\n";

812 
û¼
 << "#taxa #sites\n";

813 
û¼
 << "name1 seq1.....\n";

814 
û¼
 << "name2 seq2.....\n";

815 
û¼
 << "...\n";

816 
û¼
 << '\n';

817 
	`ex™
(1);

819 ià(
DNAcomp
) {

820 
¡©e¥aû
 = 
Ãw
 
DNAS‹S·û
;

823 ià(
RNAcomp
) {

824 
¡©e¥aû
 = 
Ãw
 
DNAS‹S·û
;

827 ià(
AAcomp
) {

828 
¡©e¥aû
 = 
Ãw
 
PrÙešS‹S·û
;

836 
	`ÿtch
(...) {

837 
û¼
 << "error while„eading data file\n";

841 
	}
}

844 
	gFeSequ’ûAlignm’t
::
	$R—dPhyl
 (
¡ršg
 
fe¥ec
, 
»³©xa
) {

846 
if¡»am
 
	`theSŒ—m
((
P©h
 + 
fe¥ec
).
	`c_¡r
());

847 
Œy
 {

849 
¡ršg
 
‹mp
;

850 
theSŒ—m
 >> 
‹mp
;

851 ià(!
	`IsIÁ
(
‹mp
)) {

852 
û¼
 << "error when„eading data\n";

853 
û¼
 << "data should be formatted‡s follows:\n";

854 
û¼
 << "#taxa #sites\n";

855 
û¼
 << "name1 seq1.....\n";

856 
û¼
 << "name2 seq2.....\n";

857 
û¼
 << "...\n";

858 
û¼
 << '\n';

859 
	`ex™
(1);

861 
Nxa
 = 
	`IÁ
(
‹mp
);

862 
theSŒ—m
 >> 
‹mp
;

863 ià(!
	`IsIÁ
(
‹mp
)) {

864 
û¼
 << "error when„eading data\n";

865 
û¼
 << "data should be formatted‡s follows:\n";

866 
û¼
 << "#taxa #sites\n";

867 
û¼
 << "name1 seq1.....\n";

868 
û¼
 << "name2 seq2.....\n";

869 
û¼
 << "...\n";

870 
û¼
 << '\n';

871 
	`ex™
(1);

873 
Ns™e
 = 
	`IÁ
(
‹mp
);

876 
D©a
 = 
	`Ãw
 (*[
Nxa
]);

877 
i
=0; i<
Nxa
; i++) {

878 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

880 
S³c›sNames
 = 
Ãw
 
¡ršg
[
Nxa
];

882 
l
 = 0;

883 
block
 = 0;

884 
l
<
Ns™e
) {

885 
block
++;

886 
m
 = 0;

887 
i
=0; i<
Nxa
; i++) {

889 ià((!
l
è|| 
»³©xa
) {

890 
¡ršg
 
‹mp
;

891 
theSŒ—m
 >> 
‹mp
;

892 ià(!
l
) {

893 
S³c›sNames
[
i
] = 
‹mp
;

896 ià(
‹mp
 !ğ
S³c›sNames
[
i
]) {

897 
û¼
 << "”rÜ wh’„—dšg d©a:„—d " << 
‹mp
 << " in¡—d oà" << 
S³c›sNames
[
i
] << '\n';

898 
	`ex™
(1);

903 
c
;

904 
k
 = 
l
;

907 
c
 = 
theSŒ—m
.
	`g‘
();

908 ià((!
theSŒ—m
.
	`eof
()è&& (
c
 != ' ') && (c != '\n') && (c != '\t') && (c!=13)) {

909 ià(
c
 == '(') {

910 
D©a
[
i
][
k
] = 
unknown
;

911 
c
 != ')') {

912 
theSŒ—m
 >> 
c
;

915 ià(
c
 == '{') {

916 
D©a
[
i
][
k
] = 
unknown
;

917 
c
 != '}') {

918 
theSŒ—m
 >> 
c
;

922 
o¡ršg¡»am
 
s
;

923 
s
 << 
c
;

924 
D©a
[
i
][
k
] = 
¡©e¥aû
->
	`G‘S‹
(
s
.
	`¡r
());

926 
k
++;

929 (!
theSŒ—m
.
	`eof
()è&& (
c
 != '\n') && (c != 13));

930 ià(
theSŒ—m
.
	`eof
()) {

931 ià(
i
 < 
Nxa
-1) {

932 
û¼
 << "”rÜ : found " << 
i
 << "ax¨š¡—d oà" << 
Nxa
 << " in datafile\n";

933 
	`ex™
(1);

936 
c
 = 
theSŒ—m
.
	`³ek
();

937 (!
theSŒ—m
.
	`eof
()è&& ((
c
 == '\n') || (c == 13))) {

938 
c
 = 
theSŒ—m
.
	`g‘
();

939 
c
 = 
theSŒ—m
.
	`³ek
();

942 ià(!
m
) {

943 
m
 = 
k
;

946 ià(
m
 !ğ
k
) {

947 
û¼
 << "”rÜ wh’„—dšg d©¨nÚ m©chšg‚umb” oà£qu’û š block‚umb” " << 
block
 << " fÜaxÚ " << 
i
 << " " << 
S³c›sNames
[i] << '\n';

948 
û¼
 << "x¨: " << 
i
 << '\t' << 
S³c›sNames
[i] << '\n';

949 
û¼
 << "»ad " << 
k
 << " in¡—d oà" << 
m
 << "characters\n";

950 
	`ex™
(1);

954 
l
ğ
m
;

956 ià(
l
<
Ns™e
) {

957 
û¼
 << "error :„eachedƒnd of stream \n";

958 
û¼
 << "data should be formatted‡s follows:\n";

959 
û¼
 << "#taxa #sites\n";

960 
û¼
 << "name1 seq1.....\n";

961 
û¼
 << "name2 seq2.....\n";

962 
û¼
 << "...\n";

963 
û¼
 << '\n';

964 
	`ex™
(1);

967 
	`ÿtch
(...) {

968 
û¼
 << "error while„eading data file\n";

970 
	}
}

	@SequenceAlignment.h

1 #iâdeà
SEQUENCEALIGNMENT_H


2 
	#SEQUENCEALIGNMENT_H


	)

4 
	~"S‹S·û.h
"

5 
	~"TaxÚS‘.h
"

9 şas 
	cSequ’ûAlignm’t
 {

11 
	mpublic
:

13 
	$Sequ’ûAlignm’t
(è: 
	$D©a
(0) {}

15 
	$Sequ’ûAlignm’t
(
Sequ’ûAlignm’t
* 
äom
) {

17 
Nxa
 = 
äom
->Ntaxa;

18 
Ns™e
 = 
äom
->Nsite;

19 
x£t
 = 
äom
->taxset;

20 
¡©e¥aû
 = 
äom
->statespace;

22 
D©a
 = 
Ãw
 *[
Nxa
];

23 
i
=0; i<
Nxa
; i++) {

24 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

25 
j
=0; j<
Ns™e
; j++) {

26 
D©a
[
i
][
j
] = 
äom
->Data[i][j];

29 
	}
}

31 
	$Sequ’ûAlignm’t
(
Sequ’ûAlignm’t
* 
äom
, 
¡¬t
, 
Ëngth
) {

33 
Nxa
 = 
äom
->Ntaxa;

34 ià((
¡¬t
 < 0è|| (
Ëngth
 < 0è|| (¡¬ˆ+†’gth > 
äom
->
Ns™e
)) {

35 
û¼
 << "error in sequence‡lignment: overflow\n";

36 
	`ex™
(1);

39 
Ns™e
 = 
Ëngth
;

40 
x£t
 = 
äom
->taxset;

41 
¡©e¥aû
 = 
äom
->statespace;

42 
D©a
 = 
Ãw
 *[
Nxa
];

43 
i
=0; i<
Nxa
; i++) {

44 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

45 
j
=0; j<
Ns™e
; j++) {

46 
D©a
[
i
][
j
] = 
äom
->D©a[i][j+
¡¬t
];

49 
	}
}

51 
	$SubS–eù
(
s™emš
, 
s™emax
) {

53 ** 
D©a2
 = 
Ãw
 *[
Nxa
];

54 
i
=0; i<
Nxa
; i++) {

55 
D©a2
[
i
] = 
Ãw
 [
s™emax
-
s™emš
];

56 
j
=
s™emš
; j<
s™emax
; j++) {

57 
D©a2
[
i
][
j
-
s™emš
] = 
D©a
[i][j];

60 
i
=0; i<
Nxa
; i++) {

61 
d–‘e
[] 
D©a
[
i
];

63 
d–‘e
[] 
D©a
;

64 
D©a
 = 
D©a2
;

65 
Ns™e
 = 
s™emax
 - 
s™emš
;

66 
	}
}

68 
	$Sequ’ûAlignm’t
(
Sequ’ûAlignm’t
* 
äom
, 
TaxÚS‘
* 
sub£t
) {

70 
Nxa
 = 
sub£t
->
	`G‘Nxa
();

71 
Ns™e
 = 
äom
->
	`G‘Ns™e
();

72 
¡©e¥aû
 = 
äom
->statespace;

73 
x£t
 = 
sub£t
;

74 
D©a
 = 
Ãw
 *[
Nxa
];

75 
k
=0; k<
Nxa
; k++) {

76 
D©a
[
k
] = 
Ãw
 [
Ns™e
];

78 
i
=0; i<
äom
->
	`G‘Nxa
(); i++) {

79 
k
 = 
sub£t
->
	`G‘TaxÚIndex
(
äom
->
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
i
));

80 ià(
k
 != -1) {

81 
j
=0; j<
Ns™e
; j++) {

82 
D©a
[
k
][
j
] = 
äom
->D©a[
i
][j];

84 ià(
k
 >ğ
Nxa
) {

85 
û¼
 << "error in sequence‡lignment subset\n";

86 
û¼
 << 
Nxa
 << '\n';

87 
	`ex™
(1);

91 
	}
}

93 
Sequ’ûAlignm’t
(Sequ’ûAlignm’t* 
äom
, 
m­
<
¡ršg
,>& 
group
, 
ngroup
) {

95 
	gn
 = 0;

96 
	gi
=0; i<
	gäom
->
G‘Ns™e
(); i++) {

97 ià(
	gäom
->
GroupCom·tibË
(
i
,
group
,
ngroup
)) {

98 
	gn
++;

101 
	g¡©e¥aû
 = 
äom
->
¡©e¥aû
;

102 
	gx£t
 = 
äom
->
x£t
;

103 
	gNxa
 = 
äom
->
G‘Nxa
();

104 
	gNs™e
 = 
n
;

105 
	gD©a
 = 
Ãw
 *[
Nxa
];

106 
	gk
=0; k<
	gNxa
; k++) {

107 
	gD©a
[
k
] = 
Ãw
 [
Ns™e
];

109 
	gj
 = 0;

110 
	gi
=0; i<
	gäom
->
G‘Ns™e
(); i++) {

111 ià(
	gäom
->
GroupCom·tibË
(
i
,
group
,
ngroup
)) {

112 
	gk
=0; k<
	gNxa
; k++) {

113 
	gD©a
[
k
][
j
] = 
äom
->
D©a
[k][
i
];

115 
	gj
++;

120 
	$MaskOutgroup
(
¡ršg
* 
group1
, sŒšg* 
group2
, 
n1
, 
n2
) {

121 
Äem
 = 0;

122 
Åos
 = 0;

123 
n
 = 0;

124 
i
=0; i<
	`G‘Ns™e
(); i++) {

125 
ok
 = 0;

126 
j
=0; j<
n1
; j++) {

127 ià(
D©a
[
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
group1
[
j
])][
i
] !ğ
unknown
) {

128 
ok
 = 1;

131 ià(! 
ok
) {

132 
Åos
 ++;

133 
j
=0; j<
n2
; j++) {

134 ià(
D©a
[
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
group2
[
j
])][
i
] !ğ
unknown
) {

135 
D©a
[
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
group2
[
j
])][
i
] = 
unknown
;

136 
Äem
++;

141 
û¼
 << "numb” oàpos™iÚ masked : " << 
Åos
 << '\n';

142 
û¼
 << "tÙ®‚umb” oàûÎ masked : " << 
Äem
 << '\n';

143 
	}
}

145 
	$MaskDiv”s™y
(
¡ršg
* 
group
, 
n
) {

146 
Äem
 = 0;

147 
Åos
 = 0;

148 
´e£Á
[
	`G‘S‹S·û
()->
	`G‘N¡©e
()];

149 
i
=0; i<
	`G‘Ns™e
(); i++) {

150 
k
=0; k<
	`G‘S‹S·û
()->
	`G‘N¡©e
(); k++) {

151 
´e£Á
[
k
] = 0;

153 
j
=0; j<
	`G‘Nxa
(); j++) {

154 
äomgroup
 = 0;

155 
k
=0; k<
n
; k++) {

156 ià(
	`G‘TaxÚS‘
()->
	`G‘TaxÚ
(
j
è=ğ
group
[
k
]) {

157 
äomgroup
 = 1;

160 ià(!
äomgroup
) {

161 ià(
D©a
[
j
][
i
] !ğ
unknown
) {

162 
´e£Á
[
D©a
[
j
][
i
]] = 1;

167 
pos
 = 0;

168 
j
=0; j<
n
; j++) {

169 ià(
D©a
[
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
group
[
j
])][
i
] !ğ
unknown
) {

170 ià(! 
´e£Á
[
D©a
[
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
group
[
j
])][
i
]]) {

171 
D©a
[
	`G‘TaxÚS‘
()->
	`G‘TaxÚIndex
(
group
[
j
])][
i
] = 
unknown
;

172 
Äem
++;

173 
pos
 = 1;

177 ià(
pos
) {

178 
Åos
++;

181 
û¼
 << "numb” oàpos™iÚ masked : " << 
Åos
 << '\n';

182 
û¼
 << "tÙ®‚umb” oàûÎ masked : " << 
Äem
 << '\n';

183 
	}
}

185 
	$Sequ’ûAlignm’t
(
Sequ’ûAlignm’t
* 
äom
, 
missšgäac
) {

187 
n
 = 0;

188 
i
=0; i<
äom
->
	`G‘Ns™e
(); i++) {

189 ià(
äom
->
	`MissšgF¿c
(
i
è< 
missšgäac
) {

190 
n
++;

193 
¡©e¥aû
 = 
äom
->statespace;

194 
x£t
 = 
äom
->taxset;

195 
Nxa
 = 
äom
->
	`G‘Nxa
();

196 
Ns™e
 = 
n
;

197 
D©a
 = 
Ãw
 *[
Nxa
];

198 
k
=0; k<
Nxa
; k++) {

199 
D©a
[
k
] = 
Ãw
 [
Ns™e
];

201 
j
 = 0;

202 
i
=0; i<
äom
->
	`G‘Ns™e
(); i++) {

203 ià(
äom
->
	`MissšgF¿c
(
i
è< 
missšgäac
) {

204 
k
=0; k<
Nxa
; k++) {

205 
D©a
[
k
][
j
] = 
äom
->D©a[k][
i
];

207 
j
++;

210 
	}
}

212 
	$Mask
(
Sequ’ûAlignm’t
* 
äom
) {

213 
i
=0; i<
äom
->
	`G‘Ns™e
(); i++) {

214 
j
=0; j<
Nxa
; j++) {

215 ià(
äom
->
D©a
[
j
][
i
] =ğ
unknown
) {

216 
D©a
[
j
][
i
] = 
unknown
;

220 
	}
}

222 
boŞ
 
GroupCom·tibË
(
i
, 
m­
<
¡ršg
,>& 
group
, 
ngroup
) {

224 
	g´e£nû
[
ngroup
];

225 
	gn
=0;‚<
	gngroup
;‚++) {

226 
	g´e£nû
[
n
] = 0;

228 
	gk
=0; k<
G‘Nxa
(); k++) {

229 ià(
	gD©a
[
k
][
i
] !ğ
unknown
) {

231 
´e£nû
[
group
[
G‘TaxÚS‘
()->
G‘TaxÚ
(
k
)]] = 1;

234 
	gok
 = 1;

235 
	gn
=1;‚<
	gngroup
;‚++) {

236 
	gok
 *ğ
´e£nû
[
n
];

238  
	gok
;

241 
	$MissšgF¿c
(
i
) {

242 
n
 = 0;

243 
k
=0; k<
	`G‘Nxa
(); k++) {

244 ià(
D©a
[
k
][
i
] !ğ
unknown
) {

245 
n
++;

248  
n
/
	`G‘Nxa
();

249 
	}
}

251 
	$Sequ’ûAlignm’t
(** 
šD©a
, 
¡ršg
* 
Çmes
, 
šNs™e
, 
S‹S·û
* 
š¡©e¥aû
, 
TaxÚS‘
* 
šx£t
) {

253 
Ns™e
 = 
šNs™e
;

254 
x£t
 = 
šx£t
;

255 
Nxa
 = 
x£t
->
	`G‘Nxa
();

256 
¡©e¥aû
 = 
š¡©e¥aû
;

258 
D©a
 = 
Ãw
 *[
Nxa
];

259 
i
=0; i<
Nxa
; i++) {

260 
D©a
[
i
] = 
Ãw
 [
Ns™e
];

262 
i
=0; i<
Nxa
; i++) {

263 
m­i
 = 
x£t
->
	`G‘TaxÚIndex
(
Çmes
[
i
]);

264 
j
=0; j<
Ns™e
; j++) {

265 
D©a
[
m­i
][
j
] = 
šD©a
[
i
][j];

268 
	}
}

270 
	gvœtu®
 ~
	$Sequ’ûAlignm’t
(è{
	}
}

273 
S‹S·û
* 
	$G‘S‹S·û
() {

274  
¡©e¥aû
;

275 
	}
}

277 
	$Regi¡”W™h
(
TaxÚS‘
* 
šx£t
) {

278 
û¼
 << "register\n";

279 ià(
x£t
->
	`G‘Nxa
(è!ğ
šx£t
->GetNtaxa()) {

280 
û¼
 << "error in„egister seq\n";

281 
	`ex™
(1);

283 ** 
tmp
 = 
Ãw
 *[
	`G‘Nxa
()];

284 
i
=0; i<
	`G‘Nxa
(); i++) {

285 
k
 = 0;

286 (
k
 < 
	`G‘Nxa
()è&& (
x£t
->
	`G‘TaxÚ
(kè!ğ
šx£t
->G‘TaxÚ(
i
))) {

287 
k
++;

289 ià(
k
 =ğ
	`G‘Nxa
()) {

290 
û¼
 << "error in„egister seq : overflow\n";

291 
	`ex™
(1);

293 
tmp
[
i
] = 
D©a
[
k
];

295 
i
=0; i<
	`G‘Nxa
(); i++) {

296 
D©a
[
i
] = 
tmp
[i];

298 
d–‘e
 
x£t
;

299 
x£t
 = 
šx£t
;

300 
d–‘e
[] 
tmp
;

301 
û¼
 << "register ok\n";

302 
	}
}

304 
	$Unşamp
() {

305 
i
=0; i<
Nxa
; i++) {

306 
j
=0; j<
Ns™e
; j++) {

307 
D©a
[
i
][
j
] = 
unknown
;

310 
	}
}

312 
	$G‘N¡©e
() {

313  
¡©e¥aû
->
	`G‘N¡©e
();

314 
	}
}

317 
TaxÚS‘
* 
	$G‘TaxÚS‘
() {

318  
x£t
;

319 
	}
}

321 
	$G‘Ns™e
() {

322  
Ns™e
;

323 
	}
}

325 
	$G‘Nxa
() {

326  
x£t
->
	`G‘Nxa
();

327 
	}
}

329 
boŞ
 
	$isMissšg
(
xÚ
, 
s™e
) {

330  
D©a
[
xÚ
][
s™e
] == -1;

331 
	}
}

333 
boŞ
 
	$AÎMissšgTaxÚ
(
x
) {

334 
boŞ
 
»t
 = 
Œue
;

335 
s™e
 = 0;

336 (
s™e
 < 
	`G‘Ns™e
()è&& 
»t
) {

337 
»t
 &ğ(
D©a
[
x
][
s™e
] =ğ
unknown
);

338 
s™e
++;

340  
»t
;

341 
	}
}

343 
boŞ
 
	$AÎMissšgTaxÚ
(
¡ršg
 
xÇme
) {

344 
šdex
 = 
x£t
->
	`G‘TaxÚIndex
(
xÇme
);

345 ià(
šdex
 == -1) {

346 
û¼
 << "”rÜ iÀ®ÈmissšgaxÚ: did‚Ù„ecogniz" << 
xÇme
 << '\n';

347 
	`ex™
(1);

349  
	`AÎMissšgTaxÚ
(
šdex
);

350 
	}
}

352 
boŞ
 
	$AÎMissšgCŞumn
(
s™e
) {

353 
boŞ
 
»t
 = 
Œue
;

354 
x
 = 0;

355 (
x
 < 
	`G‘Nxa
()è&& 
»t
) {

356 
»t
 &ğ(
D©a
[
x
][
s™e
] =ğ
unknown
);

357 
x
++;

359  
»t
;

360 
	}
}

362 
boŞ
 
	$NoMissšgCŞumn
(
s™e
) {

363 
boŞ
 
»t
 = 
Œue
;

364 
x
 = 0;

365 (
x
 < 
	`G‘Nxa
()è&& 
»t
) {

366 
»t
 &ğ(
D©a
[
x
][
s™e
] !ğ
unknown
);

367 
x
++;

369  
»t
;

370 
	}
}

372 
boŞ
 
	$CÚ¡ªtCŞumn
(
s™e
) {

373 
boŞ
 
»t
 = 
Œue
;

374 
x
 = 0;

375 (
x
 < 
	`G‘Nxa
()è&& (
D©a
[x][
s™e
] =ğ
unknown
)) {

376 
x
++;

379 ià(
x
 < 
	`G‘Nxa
()) {

380 
»f¡©e
 = 
D©a
[
x
][
s™e
];

382 (
x
 < 
	`G‘Nxa
()è&& 
»t
) {

383 ià(
D©a
[
x
][
s™e
] != -1) {

384 
»t
 &ğ(
D©a
[
x
][
s™e
] =ğ
»f¡©e
);

386 
x
++;

389  
»t
;

390 
	}
}

392 
	$S‘S‹
(
xÚ
, 
s™e
, 
¡©e
) {

393 
D©a
[
xÚ
][
s™e
] = 
¡©e
;

394 
	}
}

396 
	$G‘S‹
(
xÚ
, 
s™e
) {

397  
D©a
[
xÚ
][
s™e
];

398 
	}
}

400 
G‘EmpœiÿlF»q
(* 
š
);

402 
G‘S™eEmpœiÿlF»q
(** 
š
, 
p£udocouÁ
 = 0);

404 
ToSŒ—m
(
o¡»am
& 
os
);

405 
ToSŒ—mTrËt
(
o¡»am
& 
os
);

406 
G‘NÚMissšgTrËt
();

407 
ToFa¡a
(
o¡»am
& 
os
);

409 
	$D–‘eCÚ¡ªtS™es
() {

410 
i
=0;

411 
j
=0;

412 
Elimš©ed
 = 0;

413 
i
<
Ns™e
) {

414 
k
 = 0;

415 (
k
<
Nxa
è&& (
D©a
[k][
i
] =ğ
unknown
)) k++;

416 ià(
k
<
Nxa
) {

417 
a
 = 
D©a
[
k
][
i
];

418 
k
++;

419 (
k
<
Nxa
è&& ((
D©a
[k][
i
] =ğ
unknown
è|| (D©a[k][i] =ğ
a
))) k++;

420 ià(
k
==
Nxa
) {

421 
Elimš©ed
 ++;

424 
k
=0; k<
Nxa
; k++) {

425 
D©a
[
k
][
j
] = D©a[k][
i
];

427 
j
++;

430 
i
++;

432 
Ns™e
 -ğ
Elimš©ed
;

433 
cout
 << "numb” oàpos™iÚ –imš©ed : " << 
Elimš©ed
 << '\n';

434 
	}
}

436 
	$G‘MissšgC–lsFromTem¶©e
(
Sequ’ûAlignm’t
* 
äom
) {

438 
äomns™e
 = 
äom
->
	`G‘Ns™e
();

440 
i
=0; i<
Ns™e
; i++) {

441 
j
=0; j<
Nxa
; j++) {

442 
ii
 = 
i
 % 
äomns™e
;

443 
¡©e
 = 
äom
->
	`G‘S‹
(
j
,
ii
);

444 ià(
¡©e
 =ğ
unknown
) {

445 
D©a
[
j
][
i
] = 
unknown
;

449 
	}
}

451 
	$G‘M—nDiv”s™y
() {

453 
N¡©e
 = 
	`G‘N¡©e
();

454 
found
[
N¡©e
];

456 
m—n
 = 0;

457 
i
=0; i<
Ns™e
; i++) {

458 
k
=0; k<
N¡©e
; k++) {

459 
found
[
k
] = 0;

461 
j
=0; j<
Nxa
; j++) {

462 
¡©e
 = 
	`G‘S‹
(
j
,
i
);

463 ià(
¡©e
 !ğ
unknown
) {

464 
found
[
¡©e
]= 1;

467 
div
 = 0;

468 
k
=0; k<
N¡©e
; k++) {

469 
div
 +ğ
found
[
k
];

471 
m—n
 +ğ
div
;

473 
m—n
 /ğ
Ns™e
;

474  
m—n
;

475 
	}
}

477 
	$G‘TaxEmpœiÿlF»q
(** 
xäeq
) {

479 
N¡©e
 = 
	`G‘N¡©e
();

480 
j
=0; j<
Nxa
; j++) {

481 
k
=0; k<
N¡©e
; k++) {

482 
xäeq
[
j
][
k
] = 0;

486 
i
=0; i<
Ns™e
; i++) {

487 
j
=0; j<
Nxa
; j++) {

488 
¡©e
 = 
	`G‘S‹
(
j
,
i
);

489 ià(
¡©e
 !ğ
unknown
) {

490 
xäeq
[
j
][
¡©e
]++;

495 
j
=0; j<
Nxa
; j++) {

496 
tÙ®
 = 0;

497 
k
=0; k<
N¡©e
; k++) {

498 
tÙ®
 +ğ
xäeq
[
j
][
k
];

500 
k
=0; k<
N¡©e
; k++) {

501 
xäeq
[
j
][
k
] /ğ
tÙ®
;

504 
	}
}

506 
	$Compos™iÚ®H‘”og’e™y
(
o¡»am
* 
os
) {

508 
N¡©e
 = 
	`G‘N¡©e
();

509 ** 
xäeq
 = 
Ãw
 *[
Nxa
];

510 
j
=0; j<
Nxa
; j++) {

511 
xäeq
[
j
] = 
Ãw
 [
N¡©e
];

512 
k
=0; k<
N¡©e
; k++) {

513 
xäeq
[
j
][
k
] = 0;

517 
i
=0; i<
Ns™e
; i++) {

518 
j
=0; j<
Nxa
; j++) {

519 
¡©e
 = 
	`G‘S‹
(
j
,
i
);

520 ià(
¡©e
 !ğ
unknown
) {

521 
xäeq
[
j
][
¡©e
]++;

527 * 
glob®äeq
 = 
Ãw
 [
N¡©e
];

528 
k
=0; k<
N¡©e
; k++) {

529 
glob®äeq
[
k
] = 0;

530 
j
=0; j<
Nxa
; j++) {

531 
glob®äeq
[
k
] +ğ
xäeq
[
j
][k];

536 
tÙ®
 = 0;

537 
k
=0; k<
N¡©e
; k++) {

538 
tÙ®
 +ğ
glob®äeq
[
k
];

540 
k
=0; k<
N¡©e
; k++) {

541 
glob®äeq
[
k
] /ğ
tÙ®
;

543 
j
=0; j<
Nxa
; j++) {

544 
tÙ®
 = 0;

545 
k
=0; k<
N¡©e
; k++) {

546 
tÙ®
 +ğ
xäeq
[
j
][
k
];

548 
k
=0; k<
N¡©e
; k++) {

549 
xäeq
[
j
][
k
] /ğ
tÙ®
;

550 ià(
os
) {

551 (*
os
è<< 
xäeq
[
j
][
k
] << '\t';

554 ià(
os
) {

555 (*
os
) << '\n';

558 ià(
os
) {

559 (*
os
) << '\n';

563 
maxdi¡
 = 0;

564 
j
=0; j<
Nxa
; j++) {

565 
di¡
 = 0;

566 
k
=0; k<
N¡©e
; k++) {

567 
tmp
 = (
xäeq
[
j
][
k
] - 
glob®äeq
[k]);

568 
di¡
 +ğ
tmp
 *mp;

570 ià(
maxdi¡
 < 
di¡
) {

571 
maxdi¡
 = 
di¡
;

575 
d–‘e
[] 
glob®äeq
;

576 
j
=0; j<
Nxa
; j++) {

577 
d–‘e
[] 
xäeq
[
j
];

579 
d–‘e
[] 
xäeq
;

581  
maxdi¡
;

582 
	}
}

586 
	gNxa
;

587 
	gNs™e
;

588 
TaxÚS‘
* 
	gx£t
;

589 
S‹S·û
* 
	g¡©e¥aû
;

590 ** 
	gD©a
;

594 şas 
	cFeSequ’ûAlignm’t
 : 
public
 
Sequ’ûAlignm’t
 {

597 
public
:

598 
FeSequ’ûAlignm’t
(
i¡»am
& 
is
);

599 
FeSequ’ûAlignm’t
(
¡ršg
 
f’ame
, 
fuÎlše
 = 0);

601 
	m´iv©e
:

603 
R—dD©aFromFe
(
¡ršg
 
f’ame
, 
fÜûš‹¾—ved
 = 0);

604 
R—dNexus
(
¡ršg
 
f’ame
);

605 
R—dS³cŸl
(
¡ršg
 
f’ame
);

606 
Te¡PhylSequ’tŸl
(
¡ršg
 
f’ame
);

607 
R—dPhylSequ’tŸl
(
¡ršg
 
f’ame
);

608 
Te¡Phyl
(
¡ršg
 
f’ame
, 
»³©xa
);

609 
R—dPhyl
(
¡ršg
 
f’ame
, 
»³©xa
);

611 
¡ršg
* 
	mS³c›sNames
;

	@SimilarityMatrix.cpp

2 
	~"Sim¬™yM©rix.h
"

3 
	~"BiŞogiÿlSequ’ûs.h
"

4 
	~<io¡»am
>

5 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	gSim¬™yM©rix
 :: 
	$Sim¬™yM©rix
(){

12 
omegaM©rix
 = 
Ãw
 
boŞ
*[
N¯
];

13 
Groups
ğ
Ãw
 [
N¯
];

14 
i
=0; i< 
N¯
; i++){

15 
omegaM©rix
[
i
] = 
Ãw
 
boŞ
[
N¯
];

16 
Groups
[
i
] = 0;

18 
i
=0 ; i<
N¯
; i++){

19 
j
=0; j<
N¯
; j++){

20 
omegaM©rix
[
i
][
j
] = 
çl£
;

23 
	}
}

24 
	gSim¬™yM©rix
 :: 
	$Affiche
 (){

25 
i
=0; i<
N¯
; i++){

26 
cout
 << 
AmšoAcids
[
i
] << " ";

27 
j
=0; j<
N¯
; j++){

28 
cout
 << "|" << 
omegaM©rix
[
i
][
j
] <<"|";

30 
cout
<< "\n";

32 
	}
}

34 
	gSim¬™yM©rix
 :: 
	$š™Groups
(cÚ¡ 
N1
,cÚ¡ * 
group1
, cÚ¡ 
N2
,cÚ¡ * 
group2
, cÚ¡ 
N3
, cÚ¡ * 
group3
, cÚ¡ 
N4
, cÚ¡ * 
group4
){

35 if(
group1
){

36 
i
=0; i< 
N1
; i++)

37 
Groups
[
group1
[
i
]] = 1;

39 if(
group2
){

40 
i
=0; i< 
N2
; i++)

41 
Groups
[
group2
[
i
]] = 2;

43 if(
group3
){

44 
i
=0; i< 
N3
; i++)

45 
Groups
[
group3
[
i
]] = 3;

47 if(
group4
){

48 
i
=0; i< 
N4
; i++)

49 
Groups
[
group1
[
i
]] = 4;

51 
	}
}

53 
	gSim¬™yM©rix
 :: 
	$š™OmegaM©rix
(){

54 
i
=0; i<
N¯
; i++){

55 
j
=0; j<
N¯
; j++){

56 if(!
	`isCÚ£rv©ive
(
i
,
j
))

57 
omegaM©rix
[
i
][
j
] = 
Œue
;

60 
	}
}

62 
boŞ
 
	gSim¬™yM©rix
 :: 
	$isCÚ£rv©ive
 (
i
, 
j
){

63  (
Groups
[
i
]==Groups[
j
]);

64 
	}
}

72 
	gPŞ¬™yBa£dM©rix
 :: 
	$PŞ¬™yBa£dM©rix
(){

73 
	`š™Groups
(
NNÚpŞ¬S‘
, 
NÚpŞ¬S‘
, 0,0,0,0,0,0);

74 
	`š™OmegaM©rix
();

75 
	}
}

82 
	gVŞumeBa£dM©rix
 :: 
	$VŞumeBa£dM©rix
(){

83 
	`š™Groups
(
NSm®lS‘
, 
Sm®lS‘
,0,0,0,0,0,0);

84 
	`š™OmegaM©rix
();

85 
	}
}

93 
	gCh¬geBa£dM©rix
 :: 
	$Ch¬geBa£dM©rix
(){

94 
	`š™Groups
(
NPos™iv–yCh¬gedS‘
,
Pos™iv–yCh¬gedS‘
,
NNeg©iv–yCh¬gedS‘
,
Neg©iv–yCh¬gedS‘
,0,0,0,0);

95 
	`š™OmegaM©rix
();

96 
	}
}

104 
	gPŞ¬™yAndVŞumeBa£dM©rix
 :: 
	$PŞ¬™yAndVŞumeBa£dM©rix
(){

105 
	`š™Groups
(
NSm®lPŞ¬S‘
,
Sm®lPŞ¬S‘
,
NSm®lNÚpŞ¬S‘
,
Sm®lNÚpŞ¬S‘
,
NL¬geNÚpŞ¬S‘
,
L¬geNÚpŞ¬S‘
, 0,0);

106 
	`š™OmegaM©rix
();

107 
	}
}

	@SimilarityMatrix.h

1 #iâdeà
SIMILARITYMATRIX_H


2 
	#SIMILARITYMATRIX_H


	)

4 
	~<c¡dlib
>

5 
	~<io¡»am
>

6 
	~<¡ršg
>

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	eAmšoAcidMod–Ty³
 {
	mPOLARITY
=0, 
	mVOLUME
=1, 
	mCHARGE
=2, 
	mPOLARITYVOLUME
=3, 
	mNONE
 = 4};

11 cÚ¡ 
	gNSm®lS‘
 = 9;

12 cÚ¡ 
	gSm®lS‘
 [] = {0,1,2,5,11,12,15,16,17};

13 cÚ¡ 
	gNNÚpŞ¬S‘
 = 8;

14 cÚ¡ 
	gNÚpŞ¬S‘
 [] = {0,4,5,7,9,10,12,17};

15 cÚ¡ 
	gNPos™iv–yCh¬gedS‘
 = 3;

16 cÚ¡ 
	gPos™iv–yCh¬gedS‘
 [] = {6,8,14};

17 cÚ¡ 
	gNNeg©iv–yCh¬gedS‘
 = 2;

18 cÚ¡ 
	gNeg©iv–yCh¬gedS‘
 [] = {2,3};

19 cÚ¡ 
	gNL¬gePŞ¬S‘
 = 7;

20 cÚ¡ 
	gL¬gePŞ¬S‘
 [] = {3,6,8,13,14,18,19};

21 cÚ¡ 
	gNSm®lPŞ¬S‘
 = 5;

22 cÚ¡ 
	gSm®lPŞ¬S‘
 [] = {1,2,11,15,16};

23 cÚ¡ 
	gNSm®lNÚpŞ¬S‘
 = 4;

24 cÚ¡ 
	gSm®lNÚpŞ¬S‘
 [] = {0,5,12,17};

25 cÚ¡ 
	gNL¬geNÚpŞ¬S‘
 = 4;

26 cÚ¡ 
	gL¬geNÚpŞ¬S‘
 [] = {4,7,9,10};

28 şas 
	cSim¬™yM©rix
{

30 
	mpublic
 :

31 
Sim¬™yM©rix
();

33 
boŞ
 
	$isRadiÿl
(
i
, 
j
){  
omegaM©rix
[i][j];}

35 
	$G‘Dim
() {

37 
	}
}

40 
Affiche
();

42 
	g´Ùeùed
 :

48 * 
Groups
;

49 
š™Groups
(cÚ¡ 
n1
,cÚ¡ 
group1
[], cÚ¡ 
n2
, cÚ¡ 
group2
[], cÚ¡ 
n3
, cÚ¡ 
group3
[], cÚ¡ 
n4
, cÚ¡ 
goup4
[]);

52 
boŞ
 
isCÚ£rv©ive
(
i
,
j
);

58 
boŞ
** 
	gomegaM©rix
;

59 
š™OmegaM©rix
();

62 şas 
	cPŞ¬™yBa£dM©rix
 : 
public
 
Sim¬™yM©rix
{

63 
public
:

64 
PŞ¬™yBa£dM©rix
();

66 şas 
	cVŞumeBa£dM©rix
 : 
public
 
Sim¬™yM©rix
{

67 
public
 :

68 
VŞumeBa£dM©rix
();

70 şas 
	cCh¬geBa£dM©rix
 : 
public
 
Sim¬™yM©rix
 {

71 
public
:

72 
Ch¬geBa£dM©rix
 ();

74 şas 
	cPŞ¬™yAndVŞumeBa£dM©rix
 : 
public
 
Sim¬™yM©rix
{

75 
public
:

76 
PŞ¬™yAndVŞumeBa£dM©rix
();

80 
šlše
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gAmšoAcidMod–Ty³
 & 
	gty³
) {

81 
¡ršg
 
	gt
;

82 
	gis
 >> 
	gt
;

83 ià(
	gt
 == "NONE") {

84 
ty³
 = 
NONE
;

86 ià(
	gt
 == "POLARITY") {

87 
ty³
 = 
POLARITY
;

89 ià(
	gt
 == "CHARGE") {

90 
ty³
 = 
CHARGE
;

92 ià(
	gt
 == "VOLUME") {

93 
ty³
 = 
VOLUME
;

95 ià(
	gt
 == "POLARITYVOLUME") {

96 
ty³
 = 
POLARITYVOLUME
;

99 
	gû¼
 << "error in istream‡mino‡cid modelype\n";

100 
	gû¼
 << 
	gty³
 << '\n';

101 
ex™
(1);

103  
	gis
;

105 
šlše
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
AmšoAcidMod–Ty³
 
	gty³
) {

106 ià(
	gty³
 =ğ
NONE
) {

107 
os
 << "NONE\n";

109 ià(
	gty³
 =ğ
POLARITY
) {

110 
os
 << "POLARITY\n";

112 ià(
	gty³
 =ğ
CHARGE
) {

113 
os
 << "CHARGE\n";

115 ià(
	gty³
 =ğ
VOLUME
) {

116 
os
 << "VOLUME\n";

118 ià(
	gty³
 =ğ
POLARITYVOLUME
) {

119 
os
 << "POLARITYVOLUME\n";

122 
	gû¼
 << "error in ostream genetic codeype\n";

123 
	gû¼
 << (è
	gty³
 << '\n';

124 
ex™
(1);

126  
	gos
;

	@SiteMapping.cpp

1 
	~"S™eM­pšg.h
"

7 
	gS™eM­pšg
::
	$Pršt
(
o¡»am
& 
os
, 
boŞ
 
»dundªt
) {

9 
	`Pršt
(
os
,
	`G‘RoÙ
(), 
»dundªt
);

10 
os
 << ";\n";

11 
	}
}

14 
	gS™eM­pšg
::
	$Pršt
(
o¡»am
& 
os
, 
Lšk
* 
äom
, 
boŞ
 
»dundªt
) {

16 ià(
äom
->
	`isL—f
()) {

17 
os
 << 
	`G‘T»e
()->
	`G‘NodeName
(
äom
);

18 ià(
»dundªt
) {

19 
os
 << '_';

22 
os
 << ':';

26 
os
 << '(';

27 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

28 
	`Pršt
(
os
,
lšk
->
	`Out
(), 
»dundªt
);

29 ià(
lšk
->
	`Next
(è!ğ
äom
) {

30 
os
 << ',';

33 
os
 << ')';

35 ià(
äom
->
	`isRoÙ
()) {

36 
os
 << 
	`G‘P©h
(
äom
->
	`G‘B¿nch
())->
	`G‘Ch¬In™S‹
();

39 
os
 << 
	`G‘P©h
(
äom
->
	`G‘B¿nch
())->
	`ToSŒšg
(
»dundªt
);

41 
	}
}

	@SiteMapping.h

2 #iâdeà
SITEMAPPING_H


3 
	#SITEMAPPING_H


	)

5 
	~<io¡»am
>

6 
	~"B¿nchS™eP©h.h
"

8 şas 
	cS™eM­pšg
 {

10 
	mpublic
:

12 
vœtu®
 ~
	$S™eM­pšg
() {}

14 
vœtu®
 
B¿nchS™eP©h
* 
	`G‘P©h
(cÚ¡ 
B¿nch
* 
b¿nch
) = 0;

15 
vœtu®
 
T»e
* 
	`G‘T»e
() = 0;

16 
Lšk
* 
	`G‘RoÙ
();

18 
vœtu®
 
	`Pršt
(
o¡»am
& 
os
, 
boŞ
 
»dundªt
);

19 
	`Pršt
(
o¡»am
& 
os
, 
Lšk
* 
äom
, 
boŞ
 
»dundªt
);

21 
	}
};

23 
šlše
 
Lšk
* 
	gS™eM­pšg
::
	$G‘RoÙ
(è{ 
	`G‘T»e
()->
	`G‘RoÙ
();
	}
}

	@SplitAAMatrix.h

2 #iâdeà
SPLITAAMAT


3 
	#SPLITAAMAT


	)

5 
	~"Sim¬™yM©rix.h
"

7 şas 
	cS¶™AAM©rix
 {

9 
	mpublic
:

11 
	$S¶™AAM©rix
(
CodÚS‹S·û
* 
š¡©e¥aû
) {

12 
¡©e¥aû
 = 
š¡©e¥aû
;

13 
NÚCTN—»¡
 = 
Ãw
 *[
N¯
];

16 
i
=0; i<
N¯
; i++) {

18 
NÚCTN—»¡
[
i
] = 
Ãw
 [
N¯
];

22 
	`MakeA¼ays
();

25 
boŞ
 
	$IsNÚCTN—»¡
(
a
, 
b
) {

26  
NÚCTN—»¡
[
a
][
b
];

27 
	}
}

29 
	$Pršt
(
o¡»am
& 
os
, 
Sim¬™yM©rix
* 
m©
) {

30 
i
=0; i<
N¯
; i++) {

31 
j
=0; j<
N¯
; j++) {

32 ià(
i
 !ğ
j
) {

33 ià(
NÚCTN—»¡
[
i
][
j
] != -1) {

34 
os
 << 
¡©e¥aû
->
	`G‘PrÙešS‹S·û
()->
	`G‘S‹
(
i
è<< '\t' << s‹¥aû->G‘PrÙešS‹S·û()->G‘S‹(
j
è<< '\t' << 
m©
->
	`isRadiÿl
(i,jè<< '\t' << 
NÚCTN—»¡
[i][j] << '\n';

39 
	}
}

41 
	g´iv©e
:

43 
	$MakeA¼ays
() {

48 
i
=0; i<
N¯
; i++) {

49 
j
=0; j<
N¯
; j++) {

50 ià(
i
 !ğ
j
) {

51 
NÚCTN—»¡
[
i
][
j
] = 
¡©e¥aû
->
	`IsNÚCTN—»¡
(i,j);

54 
NÚCTN—»¡
[
i
][
j
] = -1;

58 
	}
}

60 ** 
	gNÚCTN—»¡
;

61 
CodÚS‹S·û
* 
	g¡©e¥aû
;

	@StateSpace.cpp

2 
	~<io¡»am
>

3 
	~<c¡dlib
>

4 
usšg
 
Çme¥aû
 
	g¡d
;

6 
	~<s¡»am
>

7 
	~"BiŞogiÿlSequ’ûs.h
"

8 
	~"S‹S·û.h
"

17 
šlše
 
	$Equiv®’tSŒšgs
(
¡ršg
 
a
, sŒšg 
b
) {

19 ià(
a
.
	`Ëngth
(è!ğ
b
.length()) {

22 
k
 = 0;

23 
cÚt
 = 1;

24 (
k
 < 
a
.
	`Ëngth
()è&& (
cÚt
)) {

25 
ÿ
 = 
a
[
k
];

26 
cb
 = 
b
[
k
];

27 ià((
ÿ
 >=65) && (ca <= 90)) {

28 
ÿ
 += 32;

30 ià((
cb
 >=65) && (cb <= 90)) {

31 
cb
 += 32;

33 ià(
ÿ
 !ğ
cb
) {

34 
cÚt
 = 0;

36 
k
++;

38  
cÚt
;

39 
	}
}

41 
¡ršg
 
	gSim¶eS‹S·û
::
	$G‘S‹
(
¡©e
) {

42 
o¡ršg¡»am
 
s
;

43 ià(
¡©e
 =ğ
unknown
) {

44 
s
 << "-";

47 
s
 << 
AÍhab‘
[
¡©e
];

49  
s
.
	`¡r
();

50 
	}
}

52 
	gSim¶eS‹S·û
::
	$G‘S‹
(
¡ršg
 
äom
) {

53 ià(
äom
.
	`Ëngth
() != 1) {

54 
û¼
 << "error in SingleLetterStateSpace\n";

55 
	`ex™
(1);

57 
c
 = 
äom
[0];

58 
p
 = 0;

59 (
p
 < 
NAÍhab‘S‘
è&& (
c
 !ğ
AÍhab‘S‘
[p]))…++;

60 ià(
p
 =ğ
NAÍhab‘S‘
) {

61 
cout
 << "”rÜ: dÛ nÙ„ecogni£ ch¬aù” " << 
c
 << '\n';

62 
	`ex™
(1);

64 ià(
p
 >ğ2*
N¡©e
) {

65  
unknown
;

68 
k
 = 0;

69 
l
=0;†<
N¡©e
;†++) {

70 ià((
c
 =ğ
AÍhab‘
[
l
]) || (c == Alphabet[l]+32)) {

71 
k
 = 
l
;

74  
k
;

77 
	}
}

79 
	gDNAS‹S·û
::
	$DNAS‹S·û
() {

80 
N¡©e
 = 4;

81 
AÍhab‘
 = 
Ãw
 [
N¡©e
];

82 
i
=0; i<
N¡©e
; i++) {

83 
AÍhab‘
[
i
] = 
DNAË‰”s
[i];

85 
NAÍhab‘S‘
 = 
DNAN
;

86 
AÍhab‘S‘
 = 
Ãw
 [
NAÍhab‘S‘
];

87 
i
=0; i<
NAÍhab‘S‘
; i++) {

88 
AÍhab‘S‘
[
i
] = 
DNA£t
[i];

90 
	}
}

92 
	gDNAS‹S·û
::~
	$DNAS‹S·û
() {

93 
d–‘e
[] 
AÍhab‘
;

94 
d–‘e
[] 
AÍhab‘S‘
;

95 
	}
}

98 
	gRYS‹S·û
::
	$RYS‹S·û
() {

99 
N¡©e
 = 2;

100 
AÍhab‘
 = 
Ãw
 [
N¡©e
];

101 
i
=0; i<
N¡©e
; i++) {

102 
AÍhab‘
[
i
] = 
RYË‰”s
[i];

104 
NAÍhab‘S‘
 = 
N¡©e
;

105 
AÍhab‘S‘
 = 
Ãw
 [
NAÍhab‘S‘
];

106 
i
=0; i<
NAÍhab‘S‘
; i++) {

107 
AÍhab‘S‘
[
i
] = 
RYË‰”s
[i];

109 
	}
}

111 
	gRYS‹S·û
::~
	$RYS‹S·û
() {

112 
d–‘e
[] 
AÍhab‘
;

113 
d–‘e
[] 
AÍhab‘S‘
;

114 
	}
}

116 
	gRYS‹S·û
::
	$G‘RYCodšg
(
äom
) {

117 ià(
äom
 == -1) {

120 ià((
äom
 == 0) || (from == 2)) {

124 
	}
}

126 
	gRNAS‹S·û
::
	$RNAS‹S·û
() {

127 
N¡©e
 = 4;

128 
AÍhab‘
 = 
Ãw
 [
N¡©e
];

129 
i
=0; i<
N¡©e
; i++) {

130 
AÍhab‘
[
i
] = 
RNAË‰”s
[i];

132 
NAÍhab‘S‘
 = 
RNAN
;

133 
AÍhab‘S‘
 = 
Ãw
 [
NAÍhab‘S‘
];

134 
i
=0; i<
NAÍhab‘S‘
; i++) {

135 
AÍhab‘S‘
[
i
] = 
RNA£t
[i];

137 
	}
}

139 
	gRNAS‹S·û
::~
	$RNAS‹S·û
() {

140 
d–‘e
[] 
AÍhab‘
;

141 
d–‘e
[] 
AÍhab‘S‘
;

142 
	}
}

144 
	gPrÙešS‹S·û
::
	$PrÙešS‹S·û
() {

145 
N¡©e
 = 20;

146 
AÍhab‘
 = 
Ãw
 [
N¡©e
];

147 
i
=0; i<
N¡©e
; i++) {

148 
AÍhab‘
[
i
] = 
AmšoAcids
[i];

150 
NAÍhab‘S‘
 = 
AAN
;

151 
AÍhab‘S‘
 = 
Ãw
 [
NAÍhab‘S‘
];

152 
i
=0; i<
NAÍhab‘S‘
; i++) {

153 
AÍhab‘S‘
[
i
] = 
AA£t
[i];

155 
	}
}

157 
	gPrÙešS‹S·û
::~
	$PrÙešS‹S·û
() {

158 
d–‘e
[] 
AÍhab‘
;

159 
d–‘e
[] 
AÍhab‘S‘
;

160 
	}
}

	@StateSpace.h

2 #iâdeà
STATESPACE_H


3 
	#STATESPACE_H


	)

5 
	~"BiŞogiÿlSequ’ûs.h
"

9 şas 
	cS‹S·û
 {

11 
	mpublic
:

13 
vœtu®
 ~
	$S‹S·û
() {}

15 
vœtu®
 
¡ršg
 
	`G‘S‹
(
¡©e
) = 0;

16 
vœtu®
 
	`G‘N¡©e
() = 0;

18 
vœtu®
 
	`G‘S‹
(
¡ršg
 
äom
) = 0;

20 
vœtu®
 
boŞ
 
	$isCom·tibË
(
¡©e1
, 
¡©e2
) {

21  ((
¡©e1
 =ğ
unknown
è|| (
¡©e2
 == unknown) || (state1 == state2));

22 
	}
}

28 şas 
	cSim¶eS‹S·û
 : 
public
 
S‹S·û
 {

30 
public
:

33 
G‘S‹
(
¡ršg
 
äom
);

35 
	$G‘N¡©e
() {

36  
N¡©e
;

39 
¡ršg
 
	`G‘S‹
(
¡©e
);

41 
´Ùeùed
:

42 
N¡©e
;

43 * 
AÍhab‘
;

44 
NAÍhab‘S‘
;

45 * 
AÍhab‘S‘
;

46 
	}
};

48 şas 
	cDNAS‹S·û
 : 
public
 
Sim¶eS‹S·û
 {

50 
public
:

52 
DNAS‹S·û
();

53 ~
DNAS‹S·û
();

56 şas 
	cRNAS‹S·û
 : 
public
 
Sim¶eS‹S·û
 {

58 
public
:

60 
RNAS‹S·û
();

61 ~
RNAS‹S·û
();

64 şas 
	cPrÙešS‹S·û
 : 
public
 
Sim¶eS‹S·û
 {

66 
public
:

68 
PrÙešS‹S·û
();

69 ~
PrÙešS‹S·û
();

72 şas 
	cRYS‹S·û
 : 
public
 
Sim¶eS‹S·û
 {

74 
public
:

76 
RYS‹S·û
();

77 ~
RYS‹S·û
();

79 
G‘RYCodšg
(
äom
);

82 şas 
	cG’”icS‹S·û
 : 
public
 
Sim¶eS‹S·û
 {

84 
public
:

86 
	$G’”icS‹S·û
(
šN¡©e
, * 
šAÍhab‘
, 
šNAÍhab‘S‘
, * 
šAÍhab‘S‘
) {

87 
N¡©e
 = 
šN¡©e
;

88 
AÍhab‘
 = 
Ãw
 [
N¡©e
];

89 
i
=0; i<
N¡©e
; i++) {

90 
AÍhab‘
[
i
] = 
šAÍhab‘
[i];

92 
NAÍhab‘S‘
 = 
šNAÍhab‘S‘
;

93 
AÍhab‘S‘
 = 
Ãw
 [
NAÍhab‘S‘
];

94 
i
=0; i<
NAÍhab‘S‘
; i++) {

95 
AÍhab‘S‘
[
i
] = 
šAÍhab‘S‘
[i];

99 ~
	$G’”icS‹S·û
() {

100 
d–‘e
[] 
AÍhab‘
;

101 
d–‘e
[] 
AÍhab‘S‘
;

102 
	}
}

	@StringStreamUtils.h

2 #iâdeà
STRINGSTREAMUTILS_H


3 
	#STRINGSTREAMUTILS_H


	)

5 
	~<c¡dlib
>

6 
	~<io¡»am
>

7 
	~<s¡»am
>

8 
	~<iomª
>

9 
	~<f¡»am
>

10 
usšg
 
Çme¥aû
 
	g¡d
;

18 cÚ¡ 
	gdig™
[10] = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9'};

20 
šlše
 
	$GoPa¡Next
 (
i¡»am
& 
is
, cÚ¡ 
šCh¬
) {

21 
c
;

22 ià(! 
is
.
	`eof
()) {

24 
is
 >> 
c
;

26  
c
 !ğ
šCh¬
 && ! 
is
.
	`eof
());

28  ! 
is
.
	`eof
();

29 
	}
}

31 
šlše
 
¡ršg
 
	$R—dLše
(
i¡»am
& 
is
) {

32 
¡ršg
 
¡r
 = "";

33 
c
;

35 
is
.
	`g‘
(
c
);

36 ià(
c
 != '\n') {

37 
¡r
 +ğ
c
;

39 } 
c
 !ğ'\n' && ! 
is
.
	`eof
());

40  
¡r
;

41 
	}
}

43 
šlše
 
	$GoPa¡NextWÜd
(
i¡»am
& 
is
, cÚ¡ 
¡ršg
 
šWÜd
) {

45 
k
 = 0;

46 
c
;

47 (!
is
.
	`eof
()è&& (
k
<
šWÜd
.
	`Ëngth
())) {

48 
is
.
	`g‘
(
c
);

49 ià((
c
 >=65) && (c <= 90)) {

50 
c
 += 32;

52 
ÿ
 = 
šWÜd
[
k
];

53 ià((
ÿ
 >=65) && (ca <= 90)) {

54 
ÿ
 += 32;

56 ià(
c
 =ğ
ÿ
) {

57 
k
++;

60 
k
=0;

64 
	}
}

66 
šlše
 
	$Equiv®’tSŒšgs
(
¡ršg
 
a
, sŒšg 
b
) {

68 ià(
a
.
	`Ëngth
(è!ğ
b
.length()) {

71 
k
 = 0;

72 
cÚt
 = 1;

73 (
k
 < 
a
.
	`Ëngth
()è&& (
cÚt
)) {

74 
ÿ
 = 
a
[
k
];

75 
cb
 = 
b
[
k
];

76 ià((
ÿ
 >=65) && (ca <= 90)) {

77 
ÿ
 += 32;

79 ià((
cb
 >=65) && (cb <= 90)) {

80 
cb
 += 32;

82 ià(
ÿ
 !ğ
cb
) {

83 
cÚt
 = 0;

85 
k
++;

87  
cÚt
;

88 
	}
}

90 
šlše
 
	$GoPa¡NextLše
(
i¡»am
& 
is
, cÚ¡ 
¡ršg
 
šLše
) {

91 
¡ršg
 
theLše
;

93 
theLše
 = 
	`R—dLše
(
is
);

94 
û¼
 << 
theLše
 << "\n";

96 ! 
	`Equiv®’tSŒšgs
(
theLše
,
šLše
));

97 
	}
}

101 
šlše
 
¡ršg
 
	$SŒšgR•Ïû
(
c
, 
¡ršg
 
by
, sŒšg 
s
) {

102 
¡ršg
 
tmp
;

103 
i
=0; i<
s
.
	`Ëngth
(); i++) {

104 ià(
s
[
i
] =ğ
c
) {

105 
tmp
 +ğ
by
;

108 
tmp
 +ğ
s
[
i
];

111  
tmp
;

112 
	}
}

114 
šlše
 
	$Em±yLše
(
¡ršg
 
s
) {

116 
n
 = 0;

117  (
n
<
s
.
	`Ëngth
()) && ((s[n] == ' ') || (s[n] == '\t') || (s[n] == '\n')) ) {

118 
n
++;

120  (
n
 =ğ
s
.
	`Ëngth
()) ;

121 
	}
}

123 
šlše
 
¡ršg
 
	$F‹r
(
¡ršg
 
šput
, 
c
) {

125 
¡ršg
 
‹mp
 = "";

126 
i
=0; i<
šput
.
	`Ëngth
(); i++) {

127 ià(
šput
[
i
] !ğ
c
) {

128 
‹mp
 +ğ
šput
[
i
];

131  
‹mp
;

132 
	}
}

134 
šlše
 
	$IsIÁ
(
¡ršg
 
s
) {

135 
»tuºV®ue
 = 1;

136 
i
 = 0;

137 ià((
s
[0] =ğ'+'è|| (s[0] =ğ'-')è
i
++;

138 ià(
i
 =ğ
s
.
	`Ëngth
()è
»tuºV®ue
 = 0;

140  
»tuºV®ue
 && (
i
 < 
s
.
	`Ëngth
()) ) {

141 
j
 = 0;

142  (
j
<10è&& (
dig™
[j] !ğ
s
[
i
])) {

143 
j
++;

145 ià(
j
 == 10) {

146 
»tuºV®ue
 = 0;

148 
i
++;

150  
»tuºV®ue
;

151 
	}
}

153 
šlše
 
	$IsFlßt
(
¡ršg
 
s
) {

154 
»tuºV®ue
 = 1;

155 
i
 = 0;

157  
»tuºV®ue
 && (
i
 < 
s
.
	`Ëngth
()) ) {

158 
j
 = 0;

159 (
j
<10è&& (
dig™
[j] !ğ
s
[
i
])) {

160 
j
++;

162 ià(
j
 == 10) {

163 iàĞ! ( (
s
[
i
] == '.') || (s[i] == '-') || (s[i] == '+') || (s[i] == 'e') ) ) {

164 
»tuºV®ue
 = 0;

167 
i
++;

169  
»tuºV®ue
;

170 
	}
}

172 
šlše
 
	$IsDig™
(
c
) {

173 
»tuºV®ue
 = 0;

174 
i
=0;

175 ! 
»tuºV®ue
 && 
i
<10) {

176 
»tuºV®ue
 = (
c
 =ğ
dig™
[
i
]);

177 
i
++;

179  
»tuºV®ue
;

180 
	}
}

	@SubMatrix.cpp

1 
	~"lš®g.h
"

2 
	~"SubM©rix.h
"

4 
	~<cm©h
>

5 
	~<c¡dlib
>

6 
	~<io¡»am
>

7 
	~<f¡»am
>

8 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	gSubM©rix
::
nuni
 = 0;

11 
	gSubM©rix
::
nunimax
 = 0;

13 
	gSubM©rix
::
nz
 = 0;

14 
	gSubM©rix
::
m—nz
 = 0;

15 
	gSubM©rix
::
maxz
 = 0;

39 
	gSubM©rix
::
	$SubM©rix
(
šN¡©e
, 
boŞ
 
šnÜm®i£
è: 
	`N¡©e
(šN¡©e), 
	$nÜm®i£
(
šnÜm®i£
) {

40 
ndŸgçed
 = 0;

42 
	`C»©e
();

43 
	}
}

45 
	gSubM©rix
::
	$C»©e
() {

47 
Q
 = 
Ãw
 *[
N¡©e
];

48 
i
=0; i<
N¡©e
; i++) {

49 
Q
[
i
] = 
Ãw
 [
N¡©e
];

52 
u
 = 
Ãw
 *[
N¡©e
];

53 
i
=0; i<
N¡©e
; i++) {

54 
u
[
i
] = 
Ãw
 [
N¡©e
];

57 
švu
 = 
Ãw
 *[
N¡©e
];

58 
i
=0; i<
N¡©e
; i++) {

59 
švu
[
i
] = 
Ãw
 [
N¡©e
];

72 
v
 = 
Ãw
 [
N¡©e
];

73 
vi
 = 
Ãw
 [
N¡©e
];

75 
mStiÚ¬y
 = 
Ãw
 [
N¡©e
];

77 
UniMu
 = 1;

78 
mPow
 = 
Ãw
 **[
UniSubNmax
];

79 
n
=0;‚<
UniSubNmax
;‚++) {

80 
mPow
[
n
] = 0;

89 
æag¬¿y
 = 
Ãw
 
boŞ
[
N¡©e
];

90 
dŸgæag
 = 
çl£
;

91 
¡©æag
 = 
çl£
;

92 
i
=0; i<
N¡©e
; i++) {

93 
æag¬¿y
[
i
] = 
çl£
;

95 
powæag
 = 
çl£
;

97 
aux
 = 
Ãw
 *[
N¡©e
];

98 
i
=0; i<
N¡©e
; i++) {

99 
aux
[
i
] = 
Ãw
 [
N¡©e
];

102 
	}
}

109 
	gSubM©rix
::~
	$SubM©rix
() {

120 
i
=0; i<
N¡©e
; i++) {

121 
d–‘e
[] 
Q
[
i
];

122 
d–‘e
[] 
u
[
i
];

123 
d–‘e
[] 
švu
[
i
];

124 
d–‘e
[] 
aux
[
i
];

126 
d–‘e
[] 
Q
;

127 
d–‘e
[] 
u
;

128 
d–‘e
[] 
švu
;

130 ià(
mPow
) {

131 
n
=0;‚<
UniSubNmax
;‚++) {

132 ià(
mPow
[
n
]) {

133 
i
=0; i<
N¡©e
; i++) {

134 
d–‘e
[] 
mPow
[
n
][
i
];

136 
d–‘e
[] 
mPow
[
n
];

139 
d–‘e
[] 
mPow
;

141 
d–‘e
[] 
mStiÚ¬y
;

142 
d–‘e
[] 
æag¬¿y
;

143 
d–‘e
[] 
v
;

144 
d–‘e
[] 
vi
;

146 
d–‘e
[] 
aux
;

148 
	}
}

154 
	gSubM©rix
::
	$SÿÏrMul
(
e
) {

156 
i
=0; i< 
N¡©e
 ; i++) {

157 
v
[
i
] *ğ
e
;

158 
vi
[
i
] *ğ
e
;

160 
UniMu
 *ğ
e
;

161 
	}
}

168 
	gSubM©rix
::
	$DŸgÚ®i£
() {

170 ià(! 
	`A¼ayUpd©ed
()) {

171 
	`Upd©eM©rix
();

174 
nmax
 = 1000;

175 
•sÚ
 = 1e-20;

176 
n
 = 
LšAlg
::
	`DŸgÚ®izeR©eM©rix
(
Q
,
mStiÚ¬y
,
N¡©e
,
v
,
u
,
švu
,
nmax
,
•sÚ
);

177 
boŞ
 
çed
 = (
n
 =ğ
nmax
);

178 ià(
çed
) {

179 
û¼
 << "in submatrix: diag failed\n";

180 
û¼
 << "À: " << 
n
 << '\t' << 
nmax
 << '\n';

181 
of¡»am
 
	`os
("mat");

182 
	`ToSŒ—m
(
os
);

183 
	`ex™
(1);

224 
dŸgæag
 = 
Œue
;

226  
çed
;

227 
	}
}

234 
	gSubM©rix
::
	$G‘R©e
() {

236 ià(! 
	`A¼ayUpd©ed
()) {

237 
	`Upd©eStiÚ¬y
();

238 
k
=0; k<
N¡©e
; k++) {

239 
	`Compu‹A¼ay
(
k
);

242 
k
=0; k<
N¡©e
; k++) {

243 
æag¬¿y
[
k
] = 
Œue
;

245 
nÜm
 = 0;

246 
i
=0; i<
N¡©e
-1; i++) {

247 
j
=
i
+1; j<
N¡©e
; j++) {

248 
nÜm
 +ğ
mStiÚ¬y
[
i
] * 
Q
[i][
j
];

251  2 * 
nÜm
;

252 
	}
}

255 * 
	gSubM©rix
::
	$G‘Eig’V®
() {

256 ià(! 
dŸgæag
) {

257 
	`DŸgÚ®i£
();

259  
v
;

260 
	}
}

262 ** 
	gSubM©rix
::
	$G‘Eig’Veù
() {

263 ià(! 
dŸgæag
) {

264 
	`DŸgÚ®i£
();

266  
u
;

267 
	}
}

269 ** 
	gSubM©rix
::
	$G‘InvEig’Veù
() {

270 ià(! 
dŸgæag
è
	`DŸgÚ®i£
();

271  
švu
;

272 
	}
}

278 
	gSubM©rix
::
	$Upd©eM©rix
() {

279 
	`Upd©eStiÚ¬y
();

280 
k
=0; k<
N¡©e
; k++) {

281 
	`Compu‹A¼ay
(
k
);

283 
k
=0; k<
N¡©e
; k++) {

284 
æag¬¿y
[
k
] = 
Œue
;

286 ià(
	`isNÜm®i£d
()) {

287 
	`NÜm®i£
();

290 
	}
}

298 
	gSubM©rix
::
	$NÜm®i£
() {

300 
nÜm
 = 
	`G‘R©e
();

301 
i
=0; i<
N¡©e
; i++) {

302 
j
=0; j<
N¡©e
; j++) {

303 
Q
[
i
][
j
] /ğ
nÜm
;

306 
	}
}

314 
	gSubM©rix
::
	$Aùiv©ePow”s
() {

316 ià(! 
powæag
) {

317 ià(! 
	`A¼ayUpd©ed
()) {

318 
	`Upd©eM©rix
();

321 
UniMu
 = 0;

322 
i
=0; i<
N¡©e
; i++) {

323 ià(
UniMu
 < 
	`çbs
(
Q
[
i
][i])) {

324 
UniMu
 = 
	`çbs
(
Q
[
i
][i]);

328 
	`C»©ePow”s
(0);

329 
i
=0; i<
N¡©e
; i++) {

330 
j
=0; j<
N¡©e
; j++) {

331 
mPow
[0][
i
][
j
] = 0;

334 
i
=0; i<
N¡©e
; i++) {

335 
mPow
[0][
i
][i] = 1;

337 
i
=0; i<
N¡©e
; i++) {

338 
j
=0; j<
N¡©e
; j++) {

339 
mPow
[0][
i
][
j
] +ğ
Q
[i][j] / 
UniMu
;

340 ià(
mPow
[0][
i
][
j
] < 0) {

341 
û¼
 << "error in SubMatrix::ComputePowers:‚egative…rob : ";

342 
û¼
 << 
i
 << '\t' << 
j
 << '\t' << 
mPow
[0][i][j] << '\n';

343 
û¼
 << "N¡©: " << 
N¡©e
 << '\n';

344 
	`ex™
(1);

348 
Åow
 = 1;

349 
powæag
 = 
Œue
;

351 
	}
}

353 
	gSubM©rix
::
	$IÇùiv©ePow”s
() {

355 ià(
powæag
) {

356 
n
=0;‚<
UniSubNmax
;‚++) {

357 ià(
mPow
[
n
]) {

358 
i
=0; i<
N¡©e
; i++) {

359 
d–‘e
[] 
mPow
[
n
][
i
];

361 
d–‘e
 [] 
mPow
[
n
];

362 
mPow
[
n
] = 0;

365 
nunimax
 +ğ
Åow
;

366 
nuni
++;

368 
Åow
 = 0;

369 
powæag
 = 
çl£
;

371 
	}
}

373 
	gSubM©rix
::
	$C»©ePow”s
(
n
) {

375 ià(! 
mPow
[
n
]) {

376 
mPow
[
n
] = 
Ãw
 *[
N¡©e
];

377 
i
=0; i<
N¡©e
; i++) {

378 
mPow
[
n
][
i
] = 
Ãw
 [
N¡©e
];

381 
	}
}

384 
	gSubM©rix
::
	$G‘UnifÜmiz©iÚMu
() {

386 ià(! 
powæag
) {

387 
	`Aùiv©ePow”s
();

389  
UniMu
;

390 
	}
}

392 
	gSubM©rix
::
	$Pow”
(
n
, 
i
, 
j
) {

394 ià(! 
powæag
) {

395 
	`Aùiv©ePow”s
();

397 ià(!
n
) {

398  (
i
 =ğ
j
);

400 ià(
n
 > 
UniSubNmax
) {

401  
	`StiÚ¬y
(
j
);

403 ià(
n
 > 
Åow
) {

404 
	`Compu‹Pow”s
(
n
);

406  
mPow
[
n
-1][
i
][
j
];

407 
	}
}

410 
	gSubM©rix
::
	$Compu‹Pow”s
(
N
) {

412 ià(! 
powæag
) {

413 
	`Aùiv©ePow”s
();

415 ià(
N
>
Åow
) {

416 
n
=
Åow
;‚<
N
;‚++) {

417 
	`C»©ePow”s
(
n
);

418 
i
=0; i<
N¡©e
; i++) {

419 
j
=0; j<
N¡©e
; j++) {

420 & 
t
 = 
mPow
[
n
][
i
][
j
];

421 
t
 = 0;

422 
k
=0; k<
N¡©e
; k++) {

423 
t
 +ğ
mPow
[
n
-1][
i
][
k
] * mPow[0][k][
j
];

428 
Åow
 = 
N
;

430 
	}
}

432 
	gSubM©rix
::
	$ToSŒ—m
(
o¡»am
& 
os
) {

434 
os
 << 
	`G‘N¡©e
() << '\n';

435 
os
 << "stationaries: \n";

436 
i
=0; i<
	`G‘N¡©e
(); i++) {

437 
os
 << 
	`StiÚ¬y
(
i
) << '\t';

439 
os
 << '\n';

441 
os
 << "rate matrix\n";

442 
i
=0; i<
	`G‘N¡©e
(); i++) {

443 
j
=0; j<
	`G‘N¡©e
(); j++) {

444 
os
 << 
Q
[
i
][
j
] << '\t';

446 
os
 << '\n';

449 
os
 << '\n';

450 
i
=0; i<
	`G‘N¡©e
(); i++) {

451 
os
 << 
v
[
i
] << '\t';

453 
os
 << '\n';

455 
	}
}

457 
	gSubM©rix
::
	$CheckRev”sib™y
() {

459 
max
 = 0;

460 
imax
 = 0;

461 
jmax
 = 0;

462 
i
=0; i<
	`G‘N¡©e
(); i++) {

463 
j
=
i
+1; j<
	`G‘N¡©e
(); j++) {

464 
tmp
 = 
	`çbs
(
	`StiÚ¬y
(
i
è* 
Q
[i][
j
] - Stationary(j) * Q[j][i]);

465 ià(
max
 < 
tmp
) {

466 
max
 = 
tmp
;

467 
imax
 = 
i
;

468 
jmax
 = 
j
;

472 ià(
max
 > 1e-6) {

473 
û¼
 << "max i¼ev”sib™y: " << 
max
 << '\n';

474 
û¼
 << 
imax
 << '\t' << 
jmax
 << '\t' << 
	`StiÚ¬y
(imaxè<< '\t' << 
Q
[imax][jmax] << '\t' << Stationary(jmax) << '\t' << Q[jmax][imax] << '\n';

475 
	`ex™
(1);

477 
	}
}

480 
	gSubM©rix
::
	$Compu‹ExpÚ’tŸl
(
¿nge
, ** 
expo
) {

482 
	`DŸgÚ®i£
();

484 
i
=0; i<
N¡©e
; i++) {

485 
tÙ
 = 0;

486 
j
=0; j<
N¡©e
; j++) {

487 
tÙ
 +ğ
Q
[
i
][
j
];

489 ià(
	`çbs
(
tÙ
) > 1e-8) {

490 
û¼
 << "error :„ow does‚ot sumo 0\n";

491 
	`ex™
(1);

495 
tÙ
 = 0;

496 
j
=0; j<
N¡©e
; j++) {

497 
tmp
 = 0;

498 
k
=0; k<
N¡©e
; k++) {

499 
tmp
 +ğ
u
[
i
][
k
] * 
švu
[k][
j
] * 
	`exp
(
v
[k] * 
¿nge
);

501 
expo
[
i
][
j
] = 
tmp
;

502 
tÙ
 +ğ
tmp
;

504 ià(
	`çbs
(
tÙ
-1) > 1e-8) {

505 
û¼
 << "error :„ow does‚ot sumo 1\n";

506 
û¼
 << "¿ng: " << 
¿nge
 << 
’dl
;

508 
throw
 1;

511 
	}
}

513 
	gSubM©rix
::
	$AµrßchExpÚ’tŸl
(
¿nge
, ** 
expo
, 
´ec
) {

515 
i
=0; i<
N¡©e
; i++) {

516 ià(! 
æag¬¿y
[
i
]) {

517 
	`Upd©eRow
(
i
);

521 
i
=0; i<
	`G‘N¡©e
(); i++) {

522 
tÙ
 = 0;

523 
j
=0; j<
	`G‘N¡©e
(); j++)

524 
tÙ
+=
Q
[
i
][
j
];

525 if(
	`çbs
(
tÙ
)>10e-6) {

526 
û¼
 << "E¼Ü iÀ­´ßchEx°:„ow dÛ nÙ sumØ0 " << 
’dl
;

527 
û¼
 << "Sum : " << 
tÙ
;

528 
û¼
 << 
Q
[
i
][0] << " " << Q[i][1] << " " << Q[i][2] << " " << Q[i][3] << 
’dl
;

529 
	`ex™
(1);

534 
z
 = 1;

537 
maxdŸg
 = 0;

538 
i
=0; i<
	`G‘N¡©e
(); i++)

539 if(
maxdŸg
< 
	`çbs
(
Q
[
i
][i])*
¿nge
)

540 
maxdŸg
 = 
	`çbs
(
Q
[
i
][i])*
¿nge
;

542 ià(
maxdŸg
 > 300) {

543 cÚ¡ * 
¡©
 = 
	`G‘StiÚ¬y
();

545 
i
=0; i<
	`G‘N¡©e
(); i++) {

546 
j
=0; j<
	`G‘N¡©e
(); j++) {

547 
expo
[
i
][
j
] = 
¡©
[j];

554 
´ecisiÚ
 = 0.01;

556 
z
<1024 && 
maxdŸg
 > z*
´ecisiÚ
)

557 
z
*=2;

559 
nz
 ++;

560 
m—nz
 +ğ
z
;

561 ià(
maxz
 < 
z
) {

562 
maxz
 = 
z
;

565 
i
=0; i<
	`G‘N¡©e
(); i++)

566 
j
=0; j<
	`G‘N¡©e
(); j++)

567 
expo
[
i
][
j
] = 
¿nge
* 
Q
[i][j] / 
z
 + (i==j ? 1 : 0);

570 
this
->
	`Pow”Of2
(
expo
, 
z
);

573 
i
=0; i<
	`G‘N¡©e
(); i++) {

574 
tÙ
 = 0;

575 
j
=0; j<
	`G‘N¡©e
(); j++)

576 
tÙ
+=
expo
[
i
][
j
];

577 if(
	`çbs
(
tÙ
-1)>10e-6) {

578 
û¼
 << "E¼Ü iÀ­´ßchEx°:„ow dÛ nÙ sumØ1 " << 
’dl
;

579 
û¼
 << "Sum : " << 
tÙ
 << 
’dl
;

580 
a
=0;‡<
	`G‘N¡©e
();‡++) {

581 
b
=0; b<
	`G‘N¡©e
(); b++) {

582 
û¼
 << 
Q
[
a
][
b
] << '\t';

584 
û¼
 << '\n';

586 
û¼
 << '\n';

587 
û¼
 << 
maxdŸg
 << '\t' << 
¿nge
 << '\t' << 
z
 << '\n';

588 
û¼
 << '\n';

589 
a
=0;‡<
	`G‘N¡©e
();‡++) {

590 
b
=0; b<
	`G‘N¡©e
(); b++) {

591 
û¼
 << 
¿nge
 * 
Q
[
a
][
b
] / 
z
 << '\t';

593 
û¼
 << '\n';

595 
û¼
 << '\n';

597 
	`ex™
(1);

600 
	}
}

603 
	gSubM©rix
::
	$Pow”Of2
(** 
y
, 
z
) {

604 if(
z
 == 1)

606 
i
=0; i<
	`G‘N¡©e
(); i++) {

607 
j
=0; j<
	`G‘N¡©e
(); j++) {

608 
aux
[
i
][
j
] = 0;

609 
k
=0; k<
	`G‘N¡©e
(); k++) {

610 
aux
[
i
][
j
]+ğ
y
[i][
k
]*y[k][j];

614 
i
=0; i<
	`G‘N¡©e
(); i++) {

615 
j
=0; j<
	`G‘N¡©e
(); j++)

616 
y
[
i
][
j
] = 
aux
[i][j];

618 
	`Pow”Of2
(
y
, 
z
/2);

619 
	}
}

	@SubMatrix.h

24 #iâdeà
SUBMATRIX_H


25 
	#SUBMATRIX_H


	)

27 
	~<io¡»am
>

28 
	~<cm©h
>

29 
	~<c¡dlib
>

30 
usšg
 
Çme¥aû
 
	g¡d
;

32 şas 
	cAb¡¿ùT¿ns™iÚM©rix
 {

34 
	mpublic
:

36 
vœtu®
 ~
	$Ab¡¿ùT¿ns™iÚM©rix
() {}

38 
vœtu®
 
	`Backw¬dPrİag©e
(cÚ¡ * 
down
, * 
up
, 
Ëngth
) = 0;

39 
vœtu®
 
	`FÜw¬dPrİag©e
(cÚ¡ * 
up
, * 
down
, 
Ëngth
) = 0;

40 
vœtu®
 cÚ¡ * 
	`G‘StiÚ¬y
() = 0;

41 
vœtu®
 
	`StiÚ¬y
(
i
) = 0;

49 
vœtu®
 
	`G‘N¡©e
() = 0;

50 
vœtu®
 
	`CÜru±M©rix
() = 0;

51 
vœtu®
 
	$İ”©Ü
()(, ) = 0;

52 
vœtu®
 cÚ¡ * 
	`G‘Row
(
i
) = 0;

54 
vœtu®
 
boŞ
 
	$check
(è{ 
Œue
;
	}
}

60 şas 
	cT¿ns™iÚM©rix
 : 
public
 
vœtu®
 
Ab¡¿ùT¿ns™iÚM©rix
 {

62 
public
:

64 
	$T¿ns™iÚM©rix
(
šN¡©e
) {

65 
N¡©e
 = 
šN¡©e
;

66 
m©æag
 = 
çl£
;

67 
	`C»©e
();

70 
	$T¿ns™iÚM©rix
(
šN¡©e
, ** 
šR
, *
š¡©iÚ¬y
) {

71 
N¡©e
 = 
šN¡©e
;

72 
m©æag
 = 
çl£
;

73 
R
 = 
šR
;

74 
¡©iÚ¬y
 = 
š¡©iÚ¬y
;

75 
	}
}

77 
	gvœtu®
 ~
	$T¿ns™iÚM©rix
() {

78 
	`D–‘e
();

79 
	}
}

81 
	$G‘N¡©e
(è{ 
N¡©e
;
	}
}

83 ** 
	$G‘R
() {

84 ià(! 
m©æag
) {

85 
	`Compu‹A¼ayAndSt
();

87  
R
;

88 
	}
}

90 cÚ¡ * 
	$G‘StiÚ¬y
() {

91 ià(! 
m©æag
) {

92 
	`Compu‹A¼ayAndSt
();

94  
¡©iÚ¬y
;

95 
	}
}

97 cÚ¡ * 
	$G‘Row
(
i
) {

98 ià(! 
m©æag
) {

99 
	`Compu‹A¼ayAndSt
();

101  
R
[
i
];

102 
	}
}

104 
	$StiÚ¬y
(
i
) {

105 ià(! 
m©æag
) {

106 
	`Compu‹A¼ayAndSt
();

108  
¡©iÚ¬y
[
i
];

109 
	}
}

111 
	$İ”©Ü
()(
i
, 
j
) {

112 ià(! 
m©æag
) {

113 
	`Compu‹A¼ayAndSt
();

115  
R
[
i
][
j
];

116 
	}
}

118 
vœtu®
 
	$Backw¬dPrİag©e
(cÚ¡ * 
down
, * 
up
, 
Ëngth
) {

119 ià(! 
m©æag
) {

120 
	`Compu‹A¼ayAndSt
();

122 
i
=0; i<
N¡©e
; i++) {

123 
tmp
 = 0;

124 
j
=0; j<
N¡©e
; j++) {

125 
tmp
 +ğ
R
[
i
][
j
] * 
down
[j];

127 
up
[
i
] = 
tmp
;

129 
up
[
N¡©e
] = 
down
[Nstate];

131 
	}
}

133 
vœtu®
 
	$FÜw¬dPrİag©e
(cÚ¡ * 
up
, * 
down
, 
Ëngth
) {

134 
û¼
 << "in forward\n";

135 
	`ex™
(1);

136 ià(! 
m©æag
) {

137 
	`Compu‹A¼ayAndSt
();

139 
i
=0; i<
N¡©e
; i++) {

140 
tmp
 = 0;

141 
j
=0; j<
N¡©e
; j++) {

142 
tmp
 +ğ
up
[
j
] * 
R
[j][
i
];

144 
down
[
i
] = 
tmp
;

146 
	}
}

148 
	$CÜru±M©rix
() {

149 
m©æag
 = 
çl£
;

150 
	}
}

152 
	g´Ùeùed
:

154 
	$Compu‹A¼ayAndSt
() {

155 
	`Compu‹StiÚ¬y
();

156 
	`Compu‹A¼ay
();

157 
m©æag
 = 
Œue
;

158 
	}
}

160 
vœtu®
 
Compu‹A¼ay
() = 0;

161 
vœtu®
 
Compu‹StiÚ¬y
() = 0;

163 
vœtu®
 
boŞ
 
	$check
() {

164 
boŞ
 
ok
 = 
Œue
;

165 
i
=0; i<
N¡©e
; i++) {

166 
tÙ®
 =0;

167 
j
=0; j<
N¡©e
; j++) {

168 if(
R
[
i
][
j
]<0) {

170 
ok
 = 
çl£
;

172 
tÙ®
 +=
R
[
i
][
j
];

174 if(
tÙ®
-1>10e-6 ||otal-1<-10e-6) {

176 
ok
 = 
çl£
;

179  
ok
;

180 
	}
}

182 
	$C»©e
() {

183 
¡©iÚ¬y
 = 
Ãw
 [
N¡©e
];

185 
R
 = 
Ãw
 *[
N¡©e
];

187 
i
=0; i<
N¡©e
; i++) {

188 
R
[
i
] = 
Ãw
 [
N¡©e
];

191 
	}
}

193 
	$D–‘e
() {

194 
d–‘e
[] 
¡©iÚ¬y
;

196 
i
=0; i<
N¡©e
; i++) {

197 
d–‘e
[] 
R
[
i
];

200 
d–‘e
[] 
R
;

202 
	}
}

204 
	gN¡©e
;

205 * 
	g¡©iÚ¬y
;

206 ** 
	gR
;

207 
boŞ
 
	gm©æag
;

211 şas 
	cSubM©rix
 : 
public
 
vœtu®
 
Ab¡¿ùT¿ns™iÚM©rix
 {

214 
´Ùeùed
:

222 
vœtu®
 
Compu‹A¼ay
(
¡©e
) = 0;

226 
vœtu®
 
Compu‹StiÚ¬y
() = 0;

228 
	mpublic
:

230 cÚ¡ 
UniSubNmax
 = 500;

232 
	mnuni
;

233 
	mnunimax
;

235 
	$G‘M—nUni
(è{ ((è
nunimax
è/ 
nuni
;}

237 
	`SubM©rix
(
N¡©e
, 
boŞ
 
šnÜm®i£
 = 
çl£
);

238 
vœtu®
 ~
	`SubM©rix
();

240 
	`C»©e
();

242 
	$İ”©Ü
()(, );

243 cÚ¡ * 
	`G‘Row
(
i
);

245 
vœtu®
 cÚ¡ * 
	`G‘StiÚ¬y
();

246 
	`StiÚ¬y
(
i
);

248 
	$G‘N¡©e
(è{ 
N¡©e
;
	}
}

250 
G‘R©e
();

251 
SÿÏrMul
(
e
);

253 
boŞ
 
	$isNÜm®i£d
(è{ 
nÜm®i£
;
	}
}

254 
NÜm®i£
();

256 
vœtu®
 
CÜru±M©rix
();

257 
Upd©eM©rix
();

259 
Aùiv©ePow”s
();

260 
IÇùiv©ePow”s
();

261 
Pow”
(
n
, 
i
, 
j
);

262 
G‘UnifÜmiz©iÚMu
();

264 * 
G‘Eig’V®
();

265 ** 
G‘Eig’Veù
();

266 ** 
G‘InvEig’Veù
();

269 
vœtu®
 
ToSŒ—m
(
o¡»am
& 
os
);

270 
CheckRev”sib™y
();

272 
	$G‘DŸgSt
(è{  
ndŸgçed
;
	}
}

274 
vœtu®
 
Backw¬dPrİag©e
(cÚ¡ * 
down
, * 
up
, 
Ëngth
);

275 
vœtu®
 
FÜw¬dPrİag©e
(cÚ¡ * 
up
, * 
down
, 
Ëngth
);

278 ** 
	$G‘Q
(è{ 
Q
;
	}
}

279 
Compu‹ExpÚ’tŸl
(
¿nge
, ** 
expo
);

280 
AµrßchExpÚ’tŸl
(
¿nge
, ** 
expo
, 
´ec
 = 1024);

281 
Pow”Of2
(** 
y
, 
z
);

283 
	gm—nz
;

284 
	gmaxz
;

285 
	gnz
;

288 
	g´Ùeùed
:

290 
Upd©eRow
(
¡©e
);

291 
Upd©eStiÚ¬y
();

294 
Compu‹Pow”s
(
n
);

295 
C»©ePow”s
(
n
);

297 
boŞ
 
A¼ayUpd©ed
();

299 
DŸgÚ®i£
();

303 
boŞ
 
	gpowæag
;

304 
boŞ
 
	gdŸgæag
;

305 
boŞ
 
	g¡©æag
;

306 
boŞ
* 
	gæag¬¿y
;

308 
	gN¡©e
;

309 
	gÅow
;

310 
	gUniMu
;

312 *** 
	gmPow
;

315 ** 
	gQ
;

318 * 
	gmStiÚ¬y
;

320 
boŞ
 
	gnÜm®i£
;

323 ** 
	gaux
;

325 
	g´Ùeùed
:

333 ** 
u
;

334 ** 
	gšvu
;

335 * 
	gv
;

336 * 
	gvi
;

345 
	gndŸgçed
;

355 
šlše
 
	gSubM©rix
::
	$İ”©Ü
()(
i
, 
j
) {

356 ià(! 
æag¬¿y
[
i
]) {

357 
	`Upd©eRow
(
i
);

359  
Q
[
i
][
j
];

360 
	}
}

362 
šlše
 cÚ¡ * 
	gSubM©rix
::
	$G‘Row
(
i
) {

363 ià(! 
æag¬¿y
[
i
]) {

364 
	`Upd©eRow
(
i
);

366  
Q
[
i
];

367 
	}
}

369 
šlše
 cÚ¡ * 
	gSubM©rix
::
	$G‘StiÚ¬y
() {

370 ià(! 
¡©æag
) {

371 
	`Upd©eStiÚ¬y
();

373  
mStiÚ¬y
;

374 
	}
}

376 
šlše
 
	gSubM©rix
::
	$StiÚ¬y
(
i
) {

377 ià(! 
¡©æag
) {

378 
	`Upd©eStiÚ¬y
();

380  
mStiÚ¬y
[
i
];

381 
	}
}

384 
šlše
 
	gSubM©rix
::
	$CÜru±M©rix
() {

385 
dŸgæag
 = 
çl£
;

386 
¡©æag
 = 
çl£
;

387 
k
=0; k<
N¡©e
; k++) {

388 
æag¬¿y
[
k
] = 
çl£
;

390 
	`IÇùiv©ePow”s
();

391 
	}
}

393 
šlše
 
boŞ
 
	gSubM©rix
::
	$A¼ayUpd©ed
() {

395 
boŞ
 
qæag
 = 
Œue
;

396 
k
=0; k<
N¡©e
; k++) {

397 
qæag
 &ğ
æag¬¿y
[
k
];

399  
qæag
;

400 
	}
}

402 
šlše
 
	gSubM©rix
::
	$Upd©eStiÚ¬y
() {

403 
	`Compu‹StiÚ¬y
();

404 
¡©æag
 = 
Œue
;

405 
	}
}

407 
šlše
 
	gSubM©rix
::
	$Upd©eRow
(
¡©e
) {

409 ià(
	`isNÜm®i£d
()) {

410 
	`Upd©eM©rix
();

413 ià(! 
¡©æag
) {

414 
	`Upd©eStiÚ¬y
();

416 
	`Compu‹A¼ay
(
¡©e
);

417 
æag¬¿y
[
¡©e
] = 
Œue
;

419 
	}
}

421 
šlše
 
	gSubM©rix
::
	$Backw¬dPrİag©e
(cÚ¡ * 
up
, * 
down
, 
Ëngth
) {

423 ** 
eig’veù
 = 
	`G‘Eig’Veù
();

424 ** 
šveig’veù
ğ
	`G‘InvEig’Veù
();

425 * 
eig’v®
 = 
	`G‘Eig’V®
();

427 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
()];

429 
i
=0; i<
	`G‘N¡©e
(); i++) {

430 
aux
[
i
] = 0;

432 
i
=0; i<
	`G‘N¡©e
(); i++) {

433 
j
=0; j<
	`G‘N¡©e
(); j++) {

434 
aux
[
i
] +ğ
šveig’veù
[i][
j
] * 
up
[j];

438 
i
=0; i<
	`G‘N¡©e
(); i++) {

439 
aux
[
i
] *ğ
	`exp
(
Ëngth
 * 
eig’v®
[i]);

442 
i
=0; i<
	`G‘N¡©e
(); i++) {

443 
down
[
i
] = 0;

446 
i
=0; i<
	`G‘N¡©e
(); i++) {

447 
j
=0; j<
	`G‘N¡©e
(); j++) {

448 
down
[
i
] +ğ
eig’veù
[i][
j
] * 
aux
[j];

453 
i
=0; i<
	`G‘N¡©e
(); i++) {

454 ià(
	`i¢ª
(
down
[
i
])) {

455 
û¼
 << "error in back…rop\n";

456 
j
=0; j<
	`G‘N¡©e
(); j++) {

457 
û¼
 << 
up
[
j
] << '\t' << 
down
[j] << '\t' << 
	`StiÚ¬y
(j) << '\n';

459 
	`ex™
(1);

462 
maxup
 = 0;

463 
k
=0; k<
	`G‘N¡©e
(); k++) {

464 ià(
up
[
k
] <0) {

465 
û¼
 << "”rÜ iÀbackw¬d…rİag©e:‚eg©iv´ob : " << 
up
[
k
] << "\n";

468 ià(
maxup
 < 
up
[
k
]) {

469 
maxup
 = 
up
[
k
];

472 
max
 = 0;

473 
k
=0; k<
	`G‘N¡©e
(); k++) {

474 ià(
down
[
k
] <0) {

475 
down
[
k
] = 0;

477 ià(
max
 < 
down
[
k
]) {

478 
max
 = 
down
[
k
];

481 ià(
maxup
 == 0) {

482 
û¼
 << "error in backward…ropagate:‚ull up‡rray\n";

483 
	`ex™
(1);

485 ià(
max
 == 0) {

486 
û¼
 << "error in backward…ropagate:‚ull‡rray\n";

487 
k
=0; k<
	`G‘N¡©e
(); k++) {

488 
û¼
 << 
up
[
k
] << '\t' << 
down
[k] << '\n';

490 
û¼
 << '\n';

491 
	`ex™
(1);

493 
down
[
	`G‘N¡©e
()] = 
up
[GetNstate()];

495 
d–‘e
[] 
aux
;

496 
	}
}

498 
šlše
 
	gSubM©rix
::
	$FÜw¬dPrİag©e
(cÚ¡ * 
down
, * 
up
, 
Ëngth
) {

500 ** 
eig’veù
 = 
	`G‘Eig’Veù
();

501 ** 
šveig’veù
ğ
	`G‘InvEig’Veù
();

502 * 
eig’v®
 = 
	`G‘Eig’V®
();

504 * 
aux
 = 
Ãw
 [
	`G‘N¡©e
()];

506 
i
=0; i<
	`G‘N¡©e
(); i++) {

507 
aux
[
i
] = 0;

510 
i
=0; i<
	`G‘N¡©e
(); i++) {

511 
j
=0; j<
	`G‘N¡©e
(); j++) {

512 
aux
[
i
] +ğ
down
[
j
] * 
eig’veù
[j][i];

516 
i
=0; i<
	`G‘N¡©e
(); i++) {

517 
aux
[
i
] *ğ
	`exp
(
Ëngth
 * 
eig’v®
[i]);

520 
i
=0; i<
	`G‘N¡©e
(); i++) {

521 
up
[
i
] = 0;

524 
i
=0; i<
	`G‘N¡©e
(); i++) {

525 
j
=0; j<
	`G‘N¡©e
(); j++) {

526 
up
[
i
] +ğ
aux
[
j
] * 
šveig’veù
[j][i];

530 
d–‘e
[] 
aux
;

531 
	}
}

	@SumConstrained.h

2 #iâdeà
SUMCONS_H


3 
	#SUMCONS_H


	)

5 
	~"RªdomTy³s.h
"

6 
	~"V®T»e.h
"

8 şas 
	cSumCÚ¡¿šedM­pšg
 {

10 
	mpublic
:

12 
	$SumCÚ¡¿šedM­pšg
(
šdim
) {

14 
dim
 = 
šdim
;

15 
ba£
 = 
Ãw
 *[
dim
];

16 
i
=0; i<
dim
; i++) {

17 
ba£
[
i
] = 
Ãw
 [
dim
];

19 
	`C»©eBasis
();

22 ~
	$SumCÚ¡¿šedM­pšg
() {

23 
i
=0; i<
dim
; i++) {

24 
d–‘e
[] 
ba£
[
i
];

26 
d–‘e
[] 
ba£
;

27 
	}
}

29 
	$G‘Dim
(è{ 
dim
;
	}
}

31 
	$C»©eBasis
() {

33 
bk£ed
 = 
Rªdom
::
	`G‘S“d
();

34 
Rªdom
::
	`In™Rªdom
(101);

36 
i
=0; i<
dim
; i++) {

37 
ba£
[0][
i
] = 1.0 / 
	`sq¹
(
dim
);

39 
i
=1; i<
dim
; i++) {

40 
k
=0; k<
dim
; k++) {

41 
ba£
[
i
][
k
] = 
Rªdom
::
	`UnifÜm
() - 0.5;

43 
j
=0; j<
i
; j++) {

44 
sÿl
 = 0;

45 
k
=0; k<
dim
; k++) {

46 
sÿl
 +ğ
ba£
[
i
][
k
] * ba£[
j
][k];

48 
k
=0; k<
dim
; k++) {

49 
ba£
[
i
][
k
] -ğ
sÿl
 * ba£[
j
][k];

51 
nÜm
 = 0;

52 
k
=0; k<
dim
; k++) {

53 
nÜm
 +ğ
ba£
[
i
][
k
] * base[i][k];

55 
nÜm
 = 
	`sq¹
(norm);

56 
k
=0; k<
dim
; k++) {

57 
ba£
[
i
][
k
] /ğ
nÜm
;

63 
i
=0; i<
dim
; i++) {

64 
j
=0; j<
dim
; j++) {

65 
tmp
 = 0;

66 
k
=0; k<
dim
; k++) {

67 
tmp
 +ğ
ba£
[
i
][
k
] * ba£[
j
][k];

69 ià(
i
==
j
) {

70 ià(
	`çbs
(
tmp
-1) > 1e-8) {

71 
û¼
 << "error:‚ot‚orm\n";

72 
	`ex™
(1);

76 ià(
	`çbs
(
tmp
) > 1e-8) {

77 
û¼
 << "error:‚ot ortho\n";

78 
	`ex™
(1);

84 
Rªdom
::
	`In™Rªdom
(
bk£ed
);

85 
	}
}

87 
	$ToSŒ—m
(
o¡»am
& 
os
) {

88 
os
 << 
dim
 << '\n';

89 
i
=0; i<
dim
; i++) {

90 
j
=0; j<
dim
; j++) {

91 
os
 << 
ba£
[
i
][
j
] << '\t';

93 
os
 << '\n';

95 
	}
}

97 
	$FromSŒ—m
(
i¡»am
& 
is
) {

98 
‹mpdim
;

99 
is
 >> 
‹mpdim
;

100 ià(
‹mpdim
 !ğ
dim
) {

101 
û¼
 << "error :‚on matching dimension in sum constrained mapping\n";

102 
	`ex™
(1);

104 
i
=0; i<
dim
; i++) {

105 
j
=0; j<
dim
; j++) {

106 
is
 >> 
ba£
[
i
][
j
];

109 
	}
}

111 
	gdim
;

112 ** 
	gba£
;

116 
şass
 
	gSumCÚ¡¿šedR—lVeùÜ
 : 
public
 
Dv¬
<
R—lVeùÜ
> {

118 
public
:

120 
SumCÚ¡¿šedR—lVeùÜ
(
V¬
<
R—lVeùÜ
>* 
šsourû
, 
SumCÚ¡¿šedM­pšg
* 
šm­pšg
) {

121 
£tv®
(
R—lVeùÜ
(
šsourû
->
G‘Dim
() + 1));

122 
	gbkv®ue
 = 
R—lVeùÜ
(
šsourû
->
G‘Dim
() + 1);

123 
	gsourû
 = 
šsourû
;

124 
	gm­pšg
 = 
šm­pšg
;

125 
	g‹mp
 = 
Ãw
 [
G‘Dim
()];

126 
Regi¡”
(
sourû
);

127 
¥ecŸlUpd©e
();

130 ~
SumCÚ¡¿šedR—lVeùÜ
() {

131 
	gd–‘e
[] 
	g‹mp
;

134 
	g´Ùeùed
:

136 
¥ecŸlUpd©e
() {

137 ** 
b
 = 
m­pšg
->
ba£
;

138 
	g‹mp
[0] = 0;

139 
	gi
=0; i<
	gsourû
->
G‘Dim
(); i++) {

140 
	g‹mp
[
i
+1] = (*
sourû
)[i];

143 
	gi
=0; i<
G‘Dim
(); i++) {

144 
	gtmp
 = 0;

145 
	gj
=0; j<
G‘Dim
(); j++) {

146 
	gtmp
 +ğ
b
[
j
][
i
] * 
‹mp
[j];

148 (*
	gthis
)[
i
] = 
tmp
;

160 
	gV¬
<
	gR—lVeùÜ
>* 
	gsourû
;

161 
SumCÚ¡¿šedM­pšg
* 
	gm­pšg
;

162 * 
	g‹mp
;

165 
şass
 
	gSumCÚ¡¿šedProfe
 : 
public
 
Dv¬
<
Profe
> {

167 
public
:

169 
SumCÚ¡¿šedProfe
(
V¬
<
R—lVeùÜ
>* 
šup
, V¬<R—lVeùÜ>* 
šdown
, 
šoff£t
, 
SumCÚ¡¿šedM­pšg
* 
šm­pšg
) {

170 
£tv®
(
Profe
(
šm­pšg
->
G‘Dim
()));

171 
	gbkv®ue
 = 
Profe
(
šm­pšg
->
G‘Dim
());

172 
	gup
 = 
šup
;

173 
	gdown
 = 
šdown
;

174 
	goff£t
 = 
šoff£t
;

175 
	gm­pšg
 = 
šm­pšg
;

176 
	g‹mpup
 = 
Ãw
 [
G‘Dim
()];

177 
	g‹mpdown
 = 
Ãw
 [
G‘Dim
()];

178 
Regi¡”
(
up
);

179 
Regi¡”
(
down
);

180 
¥ecŸlUpd©e
();

183 ~
SumCÚ¡¿šedProfe
() {

184 
	gd–‘e
[] 
	g‹mpup
;

185 
	gd–‘e
[] 
	g‹mpdown
;

188 
	g´Ùeùed
:

190 
¥ecŸlUpd©e
() {

191 ** 
b
 = 
m­pšg
->
ba£
;

192 
	g‹mpup
[0] = 0;

193 
	g‹mpdown
[0] = 0;

194 
	gi
=0; i<
G‘Dim
()-1; i++) {

195 ià(
	gi
+
	goff£t
 > 
	gup
->
G‘Dim
()) {

196 
	gû¼
 << "error in sum constrained : overflow\n";

197 
ex™
(1);

199 
	g‹mpup
[
i
+1] = (*
up
)[i+
off£t
];

200 
	g‹mpdown
[
i
+1] = (*
down
)[i+
off£t
];

202 
	gtÙ®
 = 0;

203 
	gtÙup
 = 0;

204 
	gtÙdown
 = 0;

205 
	gi
=0; i<
G‘Dim
(); i++) {

206 
	gtmpup
 = 0;

207 
	gtmpdown
 = 0;

208 
	gj
=0; j<
G‘Dim
(); j++) {

209 
	gtmpup
 +ğ
b
[
j
][
i
] * 
‹mpup
[j];

210 
	gtmpdown
 +ğ
b
[
j
][
i
] * 
‹mpdown
[j];

212 
	gtÙup
 +ğ
tmpup
;

213 
	gtÙdown
 +ğ
tmpdown
;

214 (*
	gthis
)[
i
] = 
exp
(
tmpup
è+ƒxp(
tmpdown
);

215 
	gtÙ®
 +ğ(*
this
)[
i
];

217 ià(
çbs
(
tÙup
) > 1e-6) {

218 
	gû¼
 << "error :‚on matching sum\n";

219 
	gû¼
 << "u°: " << 
	gtÙup
 << '\n';

221 ià(
çbs
(
tÙdown
) > 1e-6) {

222 
	gû¼
 << "error :‚on matching sum\n";

223 
	gû¼
 << "dowÀ: " << 
	gtÙdown
 << '\n';

225 
	gi
=0; i<
G‘Dim
(); i++) {

226 (*
	gthis
)[
i
] /ğ
tÙ®
;

230 
	gV¬
<
	gR—lVeùÜ
>* 
	gup
;

231 
	gV¬
<
	gR—lVeùÜ
>* 
	gdown
;

232 
	goff£t
;

233 
SumCÚ¡¿šedM­pšg
* 
	gm­pšg
;

234 * 
	g‹mpup
;

235 * 
	g‹mpdown
;

238 
şass
 
	gSumCÚ¡¿šedStT»e
 : 
public
 
B¿nchV®PŒT»e
<
Dv¬
<
Profe
> > {

240 
public
:

242 
SumCÚ¡¿šedStT»e
(
NodeV¬T»e
<
R—lVeùÜ
>* 
š´oûss
, 
šoff£t
, 
SumCÚ¡¿šedM­pšg
* 
šm­pšg
) {

243 
	g´oûss
 = 
š´oûss
;

244 
	goff£t
 = 
šoff£t
;

245 
	gm­pšg
 = 
šm­pšg
;

246 
S‘W™hRoÙ
(
çl£
);

247 
RecursiveC»©e
(
G‘RoÙ
());

248 
	gû¼
 << "š sum cÚ Œ“ : " << 
	goff£t
 << '\t' << 
	gm­pšg
->
G‘Dim
() << '\n';

251 ~
SumCÚ¡¿šedStT»e
() {

252 
RecursiveD–‘e
(
G‘RoÙ
());

255 
T»e
* 
G‘T»e
(è{ 
	g´oûss
->GetTree();}

257 
¥ecŸlUpd©e
() {

258 
RecursiveS³cŸlUpd©e
(
G‘RoÙ
());

261 
G‘M—nEÁrİy
() {

262 
	gn
 = 0;

263 
	gtÙ®
 = 
G‘TÙ®EÁrİy
(
G‘RoÙ
(),
n
);

264  
	gtÙ®
 / 
	gn
;

267 
	g´Ùeùed
:

269 
RecursiveS³cŸlUpd©e
(cÚ¡ 
Lšk
* 
äom
) {

270 ià(! 
äom
->
isRoÙ
()) {

271 
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
¥ecŸlUpd©e
();

273 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

274 
RecursiveS³cŸlUpd©e
(
lšk
->
Out
());

278 
G‘TÙ®EÁrİy
(cÚ¡ 
Lšk
* 
äom
, & 
n
) {

279 
	gtÙ®
 = 0;

280 cÚ¡ 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

281 
tÙ®
 +ğ
G‘TÙ®EÁrİy
(
lšk
->
Out
(),
n
);

283 ià(! 
	gäom
->
isRoÙ
()) {

284 
	gtÙ®
 +ğ
G‘B¿nchV®
(
äom
->
G‘B¿nch
())->
G‘EÁrİy
();

285 
	gn
++;

287  
	gtÙ®
;

290 
	gDv¬
<
	gProfe
>* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) {

291  
Ãw
 
SumCÚ¡¿šedProfe
(
´oûss
->
G‘NodeV®
(
lšk
->
G‘Node
()),…roûss->G‘NodeV®Öšk->
Out
()->G‘Node()), 
off£t
, 
m­pšg
);

294 
	gNodeV¬T»e
<
	gR—lVeùÜ
>* 
	g´oûss
;

295 
	goff£t
;

296 
SumCÚ¡¿šedM­pšg
* 
	gm­pšg
;

	@TaxonSet.cpp

2 
	~<io¡»am
>

3 
	~<c¡dlib
>

4 
usšg
 
Çme¥aû
 
	g¡d
;

6 
	~"BiŞogiÿlSequ’ûs.h
"

7 
	~"TaxÚS‘.h
"

8 
	~"T»e.h
"

16 
	gTaxÚS‘
::
	$TaxÚS‘
(cÚ¡ 
¡ršg
* 
Çmes
, 
Áaxa
) {

18 
Nxa
 = 
Áaxa
;

19 
xli¡
 = 
Ãw
 
¡ršg
[
Áaxa
];

20 
i
=0; i<
Áaxa
; i++) {

21 ià(
xm­
[
Çmes
[
i
]]) {

22 
û¼
 << "found sev”®ax¨w™h samÇm: " << 
Çmes
[
i
] << '\n';

23 
	`ex™
(1);

25 
xli¡
[
i
] = 
Çmes
[i];

26 
xm­
[
Çmes
[
i
]] = i+1;

28 
	}
}

30 
	gTaxÚS‘
::~
	$TaxÚS‘
() {

31 
d–‘e
[] 
xli¡
;

32 
	}
}

34 
	gTaxÚS‘
::
	$TaxÚS‘
(cÚ¡ 
T»e
* 
Œ“
, cÚ¡ 
Lšk
* 
subgroup
) {

36 
Nxa
 = 
Œ“
->
	`G‘Size
(
subgroup
);

37 
xli¡
 = 
Ãw
 
¡ršg
[
Nxa
];

38 ià(!
subgroup
) {

39 
subgroup
 = 
Œ“
->
	`G‘RoÙ
();

41 
i
 = 0;

42 
	`RecursiveG‘SubS‘
(
subgroup
,
i
);

43 
	}
}

45 
	gTaxÚS‘
::
	$RecursiveG‘SubS‘
(cÚ¡ 
Lšk
* 
äom
, & 
i
) {

47 ià(
äom
->
	`isL—f
()) {

48 
xli¡
[
i
] = 
äom
->
	`G‘Node
()->
	`G‘Name
();

49 
xm­
[
äom
->
	`G‘Node
()->
	`G‘Name
()] = 
i
+1;

50 
i
++;

53 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

54 
	`RecursiveG‘SubS‘
(
lšk
->
	`Out
(),
i
);

57 
	}
}

59 
	gTaxÚS‘
::
	$ToSŒ—m
(
o¡»am
& 
os
) const {

60 
os
 << 
Nxa
 << '\n';

61 
i
=0; i<
Nxa
; i++) {

62 
os
 << 
xli¡
[
i
] << '\n';

64 
	}
}

66 
	gTaxÚS‘
::
	$G‘TaxÚIndexW™hIncom¶‘eName
(
¡ršg
 
xÇme
) const {

68 
found
 = -1;

69 
i
=0; i<
Nxa
; i++) {

70 ià(
xli¡
[
i
].
	`sub¡r
(0,
xÇme
.
	`Ëngth
()) ==axname) {

71 ià(
found
 != -1) {

72 
û¼
 << "”rÜ :axÚ foundwiû : " << 
xÇme
 << '\n';

73 
	`ex™
(1);

75 
found
 = 
i
;

78 ià(
found
 == -1) {

79 
i
=0; i<
Nxa
; i++) {

80 ià(
xÇme
.
	`sub¡r
(0,
xli¡
[
i
].
	`Ëngth
()) ==axlist[i]) {

81 ià(
found
 != -1) {

82 
û¼
 << "”rÜ :axÚ foundwiû : " << 
xÇme
 << '\n';

83 
	`ex™
(1);

85 
found
 = 
i
;

89  
found
;

90 
	}
}

	@TaxonSet.h

1 #iâdeà
TAXONSET_H


2 
	#TAXONSET_H


	)

4 
	~<m­
>

5 
	~<¡ršg
>

6 
	~<io¡»am
>

8 
usšg
 
Çme¥aû
 
	g¡d
;

11 
şass
 
	gT»e
;

12 
şass
 
	gLšk
;

14 şas 
	cTaxÚS‘
 {

16 
	mpublic
:

17 
TaxÚS‘
(cÚ¡ 
¡ršg
* 
Çmes
, 
Áaxa
);

18 
TaxÚS‘
(cÚ¡ 
T»e
* 
Œ“
, cÚ¡ 
Lšk
* 
subgroup
 = 0);

19 ~
TaxÚS‘
();

21 
	$G‘Nxa
() const;

22 
¡ršg
 
	$G‘TaxÚ
(
šdex
) const;

23 
	$G‘TaxÚIndex
(
¡ršg
 
šxÚ
) const;

24 
	$G‘TaxÚIndexW™hIncom¶‘eName
(
¡ršg
 
šxÚ
) const;

26 
	$ToSŒ—m
(
o¡»am
& 
os
) const;

27 
´iv©e
:

29 
	`RecursiveG‘SubS‘
(cÚ¡ 
Lšk
* 
äom
, & 
šdex
);

31 
Nxa
;

32 
mubË
 
m­
<
¡ršg
,> 
xm­
;

33 
¡ršg
* 
xli¡
;

44 
šlše
 
TaxÚS‘
::
	$G‘Nxa
(ècÚ¡ { 
Nxa
;
	}
}

45 
šlše
 
¡ršg
 
	gTaxÚS‘
::
	$G‘TaxÚ
(
šdex
ècÚ¡ { 
xli¡
[šdex];
	}
}

46 
šlše
 
	gTaxÚS‘
::
	$G‘TaxÚIndex
(
¡ršg
 
šxÚ
ècÚ¡ { 
xm­
[šxÚ]-1;
	}
}

	@Tree.cpp

2 
	~<li¡
>

3 
	~<s¡»am
>

4 
	~<f¡»am
>

5 
	~"T»e.h
"

7 
boŞ
 
	gNewickT»e
::
sim¶ify
 = 
çl£
;

9 
	gNewickT»e
::
	$ToSŒ—m
(
o¡»am
& 
os
) const {

10 ià(
sim¶ify
) {

11 
	`ToSŒ—mSim¶if›d
(
os
,
	`G‘RoÙ
());

14 
	`ToSŒ—m
(
os
,
	`G‘RoÙ
());

16 
os
 << ";\n";

17 
	}
}

19 
	gNewickT»e
::
	$ToSŒ—mSim¶if›d
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) const {

21 ià(!
äom
->
	`isL—f
()) {

22 ià(
äom
->
	`Next
()->Next() == from) {

23 
tÙ
 = 
	`ToSŒ—mSim¶if›d
(
os
,
äom
->
	`Next
()->
	`Out
());

24 
tÙ
 +ğ
	`©of
(
	`G‘B¿nchName
(
äom
).
	`c_¡r
());

25  
tÙ
;

28 
os
 << '(';

29 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

30 
tmp
 = 
	`ToSŒ—mSim¶if›d
(
os
,
lšk
->
	`Out
());

31 
os
 << ':' << 
tmp
;

32 ià(
lšk
->
	`Next
(è!ğ
äom
) {

33 
os
 << ',';

36 
os
 << ')';

41 
os
 << 
	`G‘NodeName
(
äom
);

50 ià(
äom
->
	`isRoÙ
()) {

53  
	`©of
(
	`G‘B¿nchName
(
äom
).
	`c_¡r
());

54 
	}
}

56 
	gNewickT»e
::
	$ToSŒ—m
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) const {

58 ià(!
äom
->
	`isL—f
()) {

59 
os
 << '(';

60 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

61 
	`ToSŒ—m
(
os
,
lšk
->
	`Out
());

62 ià(
lšk
->
	`Next
(è!ğ
äom
) {

63 
os
 << ',';

66 
os
 << ')';

69 
os
 << 
	`G‘NodeName
(
äom
);

71 ià(!
äom
->
	`isRoÙ
()) {

72 
¡ršg
 
brv®
 = 
	`G‘B¿nchName
(
äom
);

73 ià(
brv®
 != "") {

74 
os
 << ':' << 
brv®
;

77 
	}
}

79 
	gT»e
::
	$T»e
() {

80 
roÙ
 = 0;

81 
x£t
 = 0;

82 
	}
}

84 
	gT»e
::
	$T»e
(cÚ¡ 
T»e
* 
äom
) {

85 
x£t
 = 0;

86 
roÙ
 = 
Ãw
 
	`Lšk
(
äom
->root);

87 
roÙ
->
	`In£¹Out
(root);

88 
	`RecursiveClÚe
(
äom
->
roÙ
,root);

89 
	}
}

91 
	gT»e
::
	$RecursiveClÚe
(cÚ¡ 
Lšk
* 
äom
, Lšk* 
to
) {

92 
Node
* 
node
 = 
Ãw
 
	`Node
(
äom
->
	`G‘Node
());

93 
to
->
	`S‘Node
(
node
);

94 cÚ¡ 
Lšk
* 
lškäom
 = 
äom
->
	`Next
();

95 
Lšk
* 
lškto
 = 
to
;

96 
lškäom
 !ğ
äom
) {

97 
Lšk
* 
ÃwÃxt
 = 
Ãw
 
	`Lšk
(
lškäom
);

98 
ÃwÃxt
->
	`S‘Node
(
node
);

99 
lškto
->
	`In£¹
(
ÃwÃxt
);

100 
Lšk
* 
Ãwout
 = 
Ãw
 
	`Lšk
(
lškäom
->
	`Out
());

101 
Ãwout
->
	`In£¹Out
(
ÃwÃxt
);

102 
B¿nch
* 
b¿nch
 = 
Ãw
 
	`B¿nch
(
lškäom
->
	`G‘B¿nch
());

103 
ÃwÃxt
->
	`S‘B¿nch
(
b¿nch
);

104 
Ãwout
->
	`S‘B¿nch
(
b¿nch
);

105 
	`RecursiveClÚe
(
lškäom
->
	`Out
(),
Ãwout
);

106 
lškäom
 =†škäom->
	`Next
();

107 
lškto
 =†škto->
	`Next
();

109 
	}
}

112 
	gT»e
::
	$RecursiveD–‘e
(
Lšk
* 
äom
) {

113 
Lšk
* 
lšk
 = 
äom
->
	`Next
();

114 
lšk
 !ğ
äom
) {

115 
d–‘e
 
lšk
->
	`Out
()->
	`G‘Node
();

116 
d–‘e
 
lšk
->
	`G‘B¿nch
();

117 
	`RecursiveD–‘e
(
lšk
->
	`Out
());

118 
Lšk
* 
k“p
 = 
lšk
->
	`Next
();

119 
d–‘e
 
lšk
;

120 
lšk
 = 
k“p
;

122 
d–‘e
 
lšk
;

123 
	}
}

145 
	gT»e
::~
	$T»e
() {

146 ià(
roÙ
) {

147 
	`RecursiveD–‘e
(
roÙ
);

148 
roÙ
 = 0;

150 
	}
}

153 
	gT»e
::
	$D–‘eNextL—f
(
Lšk
* 
´evious
){

154 
Lšk
* 
lšk
 = 
´evious
->
	`Next
();

155 if(!
lšk
->
	`Out
()->
	`isL—f
()){

156 
cout
 << "Bad call of DeleteNextLeaf, it must be call on‡†ink…ointing on‡†eaf\n";

157 
	`ex™
(1);

159 
´evious
->
	`Next
()->Next()->
	`Aµ’dTo
(previous);

160 
d–‘e
 
lšk
->
	`Out
()->
	`G‘Node
();

161 
d–‘e
 
lšk
->
	`Out
();

162 
d–‘e
 
lšk
->
	`G‘B¿nch
();

163 
d–‘e
 
lšk
;

164 
	}
}

166 
	gT»e
::
	$D–‘eUÇryNode
(
Lšk
* 
äom
){

167 if(!
äom
->
	`isUÇry
()){

168 
cout
 << "Bad call of DeleteUnaryNode,‚ode is‚ot unary\n";

169 
	`ex™
(1);

171 if(
äom
->
	`isRoÙ
()){

172 
Lšk
* 
ÃwroÙ
 = 
äom
->
	`Next
()->
	`Out
();

173 
ÃwroÙ
->
	`S‘B¿nch
(
äom
->
	`G‘B¿nch
());

174 
d–‘e
 
äom
->
	`Next
()->
	`G‘B¿nch
();

175 
d–‘e
 
äom
->
	`G‘Node
();

176 
d–‘e
 
äom
->
	`Next
();

177 
d–‘e
 
äom
;

178 
roÙ
 = 
ÃwroÙ
;

179 
roÙ
->
	`In£¹Out
(root);

182 
o¡ršg¡»am
 
sum
;

183 
sum
 << 
	`©of
((
äom
->
	`G‘B¿nch
()->
	`G‘Name
()).
	`c_¡r
()è+‡tof((äom->
	`Next
()->GetBranch()->GetName()).c_str());

184 
äom
->
	`G‘B¿nch
()->
	`S‘Name
(
sum
.
	`¡r
());

185 
äom
->
	`Next
()->
	`Out
()->
	`S‘B¿nch
(äom->
	`G‘B¿nch
());

186 
äom
->
	`Out
()->
	`In£¹Out
(äom->
	`Next
()->Out());

187 
d–‘e
 
äom
->
	`Next
()->
	`G‘B¿nch
();

188 
d–‘e
 
äom
->
	`G‘Node
();

189 
d–‘e
 
äom
->
	`Next
();

190 
d–‘e
 
äom
;

192 
	}
}

195 
	gT»e
::
	$RoÙAt
(
Lšk
* 
äom
) {

196 
Lšk
* 
lšk
 = 
äom
->
	`Next
();

197 
roÙ
->
	`Aµ’dTo
(
äom
);

198 
lšk
->
	`Aµ’dTo
(
roÙ
);

199 
roÙ
->
	`S‘Node
(
äom
->
	`G‘Node
());

200 
	}
}

202 
	gT»e
::
	$E¿£IÁ”ÇlNodeName
() {

203 
	`E¿£IÁ”ÇlNodeName
(
	`G‘RoÙ
());

204 
	}
}

206 
	gT»e
::
	$E¿£IÁ”ÇlNodeName
(
Lšk
 * 
äom
) {

207 ià(! 
äom
->
	`isL—f
()) {

208 
äom
->
	`G‘Node
()->
	`S‘Name
("");

210 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

211 
	`E¿£IÁ”ÇlNodeName
(
lšk
->
	`Out
());

213 
	}
}

215 
	gT»e
::
	$Regi¡”W™h
(cÚ¡ 
TaxÚS‘
* 
x£t
) {

216 
tÙ
 = 0;

217 if(!
	`Regi¡”W™h
(
x£t
,
	`G‘RoÙ
(),
tÙ
)){

218 
cout
 << "There is‚o match betweenheree‡ndhe sequences.\n";

219 
	`ex™
(1);

221 ià(
tÙ
 !ğ
x£t
->
	`G‘Nxa
()) {

222 
û¼
 << "”rÜ :‚Ú m©chšg‚umb” oàx¨: " << 
tÙ
 << '\t' << 
x£t
->
	`G‘Nxa
() << '\n';

223 
û¼
 << "someaxa inhe dataset‡re‚ot…resent inheree\n";

224 
	`ex™
(1);

226 
	}
}

228 
boŞ
 
	gT»e
::
	$Regi¡”W™h
(cÚ¡ 
TaxÚS‘
* 
x£t
, 
Lšk
* 
äom
, & 
tÙ
) {

229 ià(
äom
->
	`isL—f
()) {

230 
i
 = 
x£t
->
	`G‘TaxÚIndex
(
äom
->
	`G‘Node
()->
	`G‘Name
());

231 ià(
i
 != -1) {

232 
äom
->
	`G‘Node
()->
	`S‘Index
(
i
);

233 
tÙ
++;

235 (
i
 != -1);

238 
Lšk
* 
´evious
 = 
äom
;

239 
´evious
->
	`Next
(è!ğ
äom
) {

240 if(
	`Regi¡”W™h
(
x£t
,
´evious
->
	`Next
()->
	`Out
(),
tÙ
)){

241 
´evious
 =…»vious->
	`Next
();

245 
	`D–‘eNextL—f
(
´evious
);

248 ià(! 
äom
) {

249 
û¼
 << "from is‚ull\n";

250 
	`ex™
(1);

252 if(
äom
->
	`isUÇry
()){

254 
	`D–‘eUÇryNode
(
äom
);

256  (!
äom
->
	`isL—f
());

258 
	}
}

261 
	gli¡
<
	t¡ršg
>::
	tcÚ¡_™”©Ü
 
	tcs™
;

263 
	gT»e
::
	$T»e
(
¡ršg
 
f’ame
) {

265 
if¡»am
 
	`is
(
f’ame
.
	`c_¡r
());

266 ià(!
is
) {

267 
û¼
 << "ÿÂÙ fšd f: " << 
f’ame
 << '\n';

268 
	`ex™
(1);

270 
	`R—dFromSŒ—m
(
is
);

271 
	}
}

273 
	gT»e
::
	$R—dFromSŒ—m
(
i¡»am
& 
is
) {

275 
¡ršg
 
ex´
 = "";

276 
cÚt
 = 1;

277 
cÚt
) {

278 
¡ršg
 
s
;

279 
is
 >> 
s
;

280 
k
 = 0;

281 (
k
<
s
.
	`Ëngth
()) && (s[k] != ';')) k++;

282 
ex´
 +ğ
s
.
	`sub¡r
(0,
k
);

283 
cÚt
 = (! 
is
.
	`eof
()è&& (
k
==
s
.
	`Ëngth
());

285 
	`S‘RoÙ
(
	`P¬£Group
(
ex´
,0));

286 
	}
}

288 
Lšk
* 
	gT»e
::
	$P¬£Li¡
(
¡ršg
 
šput
, 
Node
* 
node
) {

290 
Œy
 {

293 
li¡
<
¡ršg
> 
l¡
;

294 
n
 = 
šput
.
	`size
();

295 
k
 = 0;

296 
b¿ck
 = 0;

297 
b
 = 0;

298 
k
<
n
) {

299 
c
 = 
šput
[
k
];

300 ià(
c
 =ğ'('è
b¿ck
++;

301 ià(
c
 =ğ')'è
b¿ck
--;

302 ià((!
b¿ck
è&& (
c
 == ',')) {

303 
l¡
.
	`push_back
((
¡ršg
è(
šput
.
	`sub¡r
(
b
,
k
-b)));

304 
b
 = 
k
+1;

307 ià(
b¿ck
<0) {

308 
cout
 << "in…arse†ist :oo many )\n";

309 
cout
 << 
šput
.
	`sub¡r
(0,
k
) << '\n';

310 
cout
 << 
šput
 << '\n';

311 
throw
;

313 
k
++;

315 ià(
b¿ck
) {

316 
cout
 << "in…arse†ist :oo many (\n";

317 
cout
 << 
šput
 << '\n';

318 
throw
;

320 
l¡
.
	`push_back
(
šput
.
	`sub¡r
(
b
,
k
-b));

325 
Lšk
* 
fœ¡lšk
 = 
Ãw
 Link;

326 
Lšk
* 
´evlšk
 = 
fœ¡lšk
;

327 
fœ¡lšk
->
	`S‘Node
(
node
);

328 
cs™
 
i
=
l¡
.
	`begš
(); i!ö¡.
	`’d
(); i++) {

329 
Lšk
* 
lšk
 = 
Ãw
 Link;

330 
lšk
->
	`S‘Node
(
node
);

331 
lšk
->
	`Aµ’dTo
(
´evlšk
);

332 
	`P¬£Group
(*
i
,
lšk
);

333 
´evlšk
 = 
lšk
;

335 
fœ¡lšk
->
	`Aµ’dTo
(
´evlšk
);

336  
fœ¡lšk
;

338 
	`ÿtch
(...) {

339 
cout
 << "exit in…arse†ist\n";

340 
	`ex™
(1);

342 
	}
}

344 
Lšk
* 
	gT»e
::
	$P¬£Group
(
¡ršg
 
šput
, 
Lšk
* 
äom
) {

346 
Œy
 {

350 
¡ršg
 
body
 = "";

351 
k
 = 0;

352 ià(
šput
[0] == '(') {

353 
b¿ck
 = 1;

354 
k
 = 1;

355 (
k
<
šput
.
	`Ëngth
()è&& 
b¿ck
) {

356 
c
 = 
šput
[
k
];

357 ià(
c
 =ğ'('è
b¿ck
++;

358 ià(
c
 =ğ')'è
b¿ck
--;

359 
k
++;

361 ià(
b¿ck
) {

362 
cout
 << "in…arse group:oo many (\n";

363 
cout
 << 
šput
 << '\n';

364 
throw
;

366 
body
 = 
šput
.
	`sub¡r
(1,
k
-2);

369 
b
 = 
k
;

370 (
k
<
šput
.
	`Ëngth
()) && (input[k]!=':')) k++;

371 
¡ršg
 
nodev®
 = 
šput
.
	`sub¡r
(
b
,
k
-b);

373 
¡ršg
 
b¿nchv®
 = "";

374 ià(
k
<
šput
.
	`Ëngth
()) {

375 
b¿nchv®
 = 
šput
.
	`sub¡r
(
k
+1, iÅut.
	`Ëngth
() - k);

379 
Node
* 
node
 = 
Ãw
 
	`Node
(
nodev®
);

382 
Lšk
* 
lšk
 = 0;

383 ià(
body
 != "") {

384 
lšk
 = 
	`P¬£Li¡
(
body
,
node
);

387 
lšk
 = 
Ãw
 
Lšk
;

388 
lšk
->
	`S‘Node
(
node
);

390 ià(
äom
) {

391 
B¿nch
* 
b¿nch
 = 
Ãw
 
	`B¿nch
(
b¿nchv®
);

392 
lšk
->
	`S‘B¿nch
(
b¿nch
);

393 
äom
->
	`S‘B¿nch
(
b¿nch
);

394 
lšk
->
	`In£¹Out
(
äom
);

396  
lšk
;

398 
	`ÿtch
(...) {

399 
cout
 << "exit in…arse group\n";

400 
	`ex™
(1);

402 
	}
}

404 
	gT»e
::
	$Subdivide
(
Lšk
* 
äom
, 
Nš‹½Ş
) {

406 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

407 
	`Subdivide
(
lšk
->
	`Out
(),
Nš‹½Ş
);

410 ià(! 
äom
->
	`isRoÙ
()) {

411 
l
 = 
	`©of
(
äom
->
	`G‘B¿nch
()->
	`G‘Name
().
	`c_¡r
());

412 ià(
l
 <= 0) {

413 
û¼
 << "w¬nšg :‚Ú sŒiùly…os™ivb¿nch†’gth : " << 
l
 << '\n';

414 
û¼
 << "correcting‡nd settingo 0.001\n";

415 
l
 = 0.001;

418 
o¡ršg¡»am
 
s
;

419 
s
 << 
l
 / 
Nš‹½Ş
;

421 
d–‘e
 
äom
->
	`G‘B¿nch
();

423 
Lšk
* 
cu¼’t
 = 
äom
;

424 
Lšk
* 
fš®
 = 
äom
->
	`Out
();

425 
i
 = 0;

426 
i
 < 
Nš‹½Ş
-1) {

427 
Lšk
* 
lšk1
 = 
Ãw
 Link;

428 
Lšk
* 
lšk2
 = 
Ãw
 Link;

429 
B¿nch
* 
Ãwb¿nch
 = 
Ãw
 
	`B¿nch
(
s
.
	`¡r
());

430 
Node
* 
Ãwnode
 = 
Ãw
 
	`Node
();

431 
cu¼’t
->
	`S‘B¿nch
(
Ãwb¿nch
);

432 
lšk1
->
	`S‘Next
(
lšk2
);

433 
lšk2
->
	`S‘Next
(
lšk1
);

434 
lšk1
->
	`S‘B¿nch
(
Ãwb¿nch
);

435 
lšk1
->
	`S‘Node
(
Ãwnode
);

436 
lšk2
->
	`S‘Node
(
Ãwnode
);

437 
cu¼’t
->
	`S‘Out
(
lšk1
);

438 
lšk1
->
	`S‘Out
(
cu¼’t
);

439 
cu¼’t
 = 
lšk2
;

440 
i
++;

442 
cu¼’t
->
	`S‘Out
(
fš®
);

443 
fš®
->
	`S‘Out
(
cu¼’t
);

444 
B¿nch
* 
Ãwb¿nch
 = 
Ãw
 
	`B¿nch
(
s
.
	`¡r
());

445 
fš®
->
	`S‘B¿nch
(
Ãwb¿nch
);

446 
cu¼’t
->
	`S‘B¿nch
(
Ãwb¿nch
);

448 
	}
}

451 
	gT»e
::
	$CouÁIÁ”ÇlNodes
(cÚ¡ 
Lšk
* 
äom
) {

452 
tÙ®
 = 0;

453 ià(! 
äom
->
	`isL—f
()) {

455 
tÙ®
 = 1;

456 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

457 
tÙ®
 +ğ
	`CouÁIÁ”ÇlNodes
(
lšk
->
	`Out
());

460  
tÙ®
;

461 
	}
}

463 cÚ¡ 
Lšk
* 
	gT»e
::
	$Choo£IÁ”ÇlNode
(cÚ¡ 
Lšk
* 
äom
, cÚ¡ Lšk*& 
äomup
, & 
n
) {

464 ià(
äom
->
	`isL—f
()) {

467 cÚ¡ 
Lšk
* 
»t
 = 0;

468 ià(!
n
) {

469 
»t
 = 
äom
;

472 
n
--;

473 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

474 ià(!
»t
) {

475 cÚ¡ 
Lšk
* 
tmp
 = 
	`Choo£IÁ”ÇlNode
(
lšk
->
	`Out
(), 
äomup
, 
n
);

476 ià(
tmp
) {

477 
»t
 = 
tmp
;

481 ià(
»t
 && (! 
äomup
)) {

482 
äomup
 = 
äom
;

485  
»t
;

486 
	}
}

488 
	gT»e
::
	$CouÁNodes
(cÚ¡ 
Lšk
* 
äom
) {

489 
tÙ®
 = 1;

490 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

491 
tÙ®
 +ğ
	`CouÁNodes
(
lšk
->
	`Out
());

493  
tÙ®
;

494 
	}
}

496 cÚ¡ 
Lšk
* 
	gT»e
::
	$Choo£Node
(cÚ¡ 
Lšk
* 
äom
, cÚ¡ Lšk*& 
äomup
, & 
n
) {

497 cÚ¡ 
Lšk
* 
»t
 = 0;

498 ià(!
n
) {

499 
»t
 = 
äom
;

502 
n
--;

503 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
(); (!
»t
 && (link!=from));†ink=link->Next()) {

504 cÚ¡ 
Lšk
* 
tmp
 = 
	`Choo£Node
(
lšk
->
	`Out
(), 
äomup
, 
n
);

505 ià(
tmp
) {

506 
»t
 = 
tmp
;

509 ià(
»t
 && (! 
äomup
)) {

510 
äomup
 = 
äom
;

513  
»t
;

514 
	}
}

	@Tree.h

2 #iâdeà
TREE_H


3 
	#TREE_H


	)

5 
	~<c¡dlib
>

6 
	~<¡ršg
>

7 
	~<io¡»am
>

8 
	~"TaxÚS‘.h
"

9 
	~"Rªdom.h
"

11 şas 
	cNode
 {

13 
	m´iv©e
:

14 
šdex
;

15 
¡ršg
 
	mÇme
;

17 
	mpublic
:

19 
	$Node
(è: 
	`šdex
(0è, 
	`Çme
("") {}

20 
	$Node
(
¡ršg
 
s
è: 
	`šdex
(0è, 
	$Çme
(
s
è{
	}
}

21 
	$Node
(cÚ¡ 
Node
* 
äom
è: 
	`šdex
(äom->
šdex
è, 
	`Çme
(äom->
Çme
è{
	}
}

23 
	gvœtu®
 ~
	$Node
(è{
	}
}

25 
vœtu®
 
¡ršg
 
	$G‘Name
(ècÚ¡ { 
Çme
;
	}
}

26 
vœtu®
 
	$S‘Name
(
¡ršg
 
šÇme
è{
Çme
 = iÂame;
	}
}

27 
	$G‘Index
(ècÚ¡ { 
šdex
;
	}
}

28 
	$S‘Index
(
i
è{
šdex
 = i;
	}
}

31 şas 
	cB¿nch
 {

33 
	m´iv©e
:

34 
šdex
;

35 
¡ršg
 
	mÇme
;

37 
	mpublic
:

39 
	$B¿nch
(è: 
	`šdex
(0è, 
	`Çme
("") {}

40 
	$B¿nch
(
¡ršg
 
s
è: 
	`šdex
(0è, 
	$Çme
(
s
è{
	}
}

41 
	$B¿nch
(cÚ¡ 
B¿nch
* 
äom
è: 
	`šdex
(äom->
šdex
), 
	`Çme
(äom->
Çme
è{
	}
}

43 
	gvœtu®
 ~
	$B¿nch
(è{
	}
}

45 
vœtu®
 
¡ršg
 
	$G‘Name
(ècÚ¡ { 
Çme
;
	}
}

46 
vœtu®
 
	$S‘Name
(
¡ršg
 
šÇme
è{
Çme
 = iÂame;
	}
}

47 
	$G‘Index
(ècÚ¡ { 
šdex
;
	}
}

48 
	$S‘Index
(
i
è{
šdex
 = i;
	}
}

51 şas 
	cLšk
 {

53 
	m´iv©e
:

54 
Lšk
* 
Ãxt
;

55 
Lšk
* 
	mout
;

56 
B¿nch
* 
	mb¿nch
;

57 
Node
* 
	mnode
;

59 
	mpublic
:

63 
	$Lšk
() {

65 
Ãxt
 = 
out
 = 
this
;

66 
b¿nch
 = 0;

67 
node
 = 0;

70 
	$Lšk
(cÚ¡ 
Lšk
* 
äom
) {

72 
Ãxt
 = 
out
 = 
this
;

73 
node
 = 0;

74 
b¿nch
 = 0;

75 
	}
}

77 
Lšk
* 
	$Next
(ècÚ¡ { 
Ãxt
;
	}
}

78 
Lšk
* 
	$Out
(ècÚ¡ { 
out
;
	}
}

79 
B¿nch
* 
	$G‘B¿nch
(ècÚ¡ { 
b¿nch
;
	}
}

80 
Node
* 
	$G‘Node
(ècÚ¡ { 
node
;
	}
}

82 
	$S‘B¿nch
(
B¿nch
* 
šb¿nch
) {

90 
b¿nch
 = 
šb¿nch
;

91 
	}
}

92 
	$S‘Node
(
Node
* 
šnode
) {

100 
node
 = 
šnode
;

101 
	}
}

103 
	$S‘Out
(
Lšk
* 
šout
) {

104 
out
 = 
šout
;

105 
	}
}

107 
	$S‘Next
(
Lšk
* 
šÃxt
) {

108 
Ãxt
 = 
šÃxt
;

109 
	}
}

111 
	$Aµ’dTo
(
Lšk
* 
lšk
) {

112 ià(
lšk
) {

113 
lšk
->
Ãxt
 = 
this
;

115 
	}
}

117 
	$In£¹
(
Lšk
* 
lšk
) {

118 
lšk
->
Ãxt
 =‚ext;

119 
Ãxt
 = 
lšk
;

120 
	}
}

122 
	$In£¹Out
(
Lšk
* 
lšk
) {

123 
lšk
->
out
 = 
this
;

124 
out
 = 
lšk
;

125 
	}
}

127 
boŞ
 
	$isL—f
() const {

128  (
Ãxt
 =ğ
this
);

129 
	}
}

131 
boŞ
 
	$isUÇry
() const {

132  (
Ãxt
->
	`Next
(è=ğ
this
 && !
	`isL—f
());

133 
	}
}

135 
boŞ
 
	$isRoÙ
() const {

136  (
out
 =ğ
this
);

137 
	}
}

140 
	$G‘Deg»e
() const {

141 
d
 = 1;

142 cÚ¡ 
Lšk
* 
lšk
 = 
Ãxt
;

143 
lšk
!=
this
) {

144 
d
++;

145 
lšk
öšk->
Ãxt
;

147  
d
;

148 
	}
}

150 cÚ¡ 
Lšk
* 
	$G‘Up
(& 
d
) const {

151 
û¼
 << "in getup\n";

152 
	`ex™
(1);

153 
d
 = 1;

154 cÚ¡ 
Lšk
* 
lšk
 = 
	`Out
();

156 
lšk
->
	`G‘Deg»e
() == 2) {

157 
lšk
 =†šk->
	`Next
()->
	`Out
();

158 
d
++;

160  
lšk
;

162 
	}
}

166 şas 
	cNewickT»e
 {

168 
	mpublic
:

170 
vœtu®
 ~
	$NewickT»e
() {}

171 
vœtu®
 cÚ¡ 
Lšk
* 
	$G‘RoÙ
() const = 0;

173 
	$ToSŒ—m
(
o¡»am
& 
os
) const;

174 
	$ToSŒ—m
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) const;

175 
	$ToSŒ—mSim¶if›d
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) const;

177 cÚ¡ 
Lšk
* 
	$G‘LeáMo¡Lšk
(cÚ¡ 
Lšk
* 
äom
) const {

178 ià(
äom
->
	`isL—f
()) {

179  
äom
;

181  
	`G‘LeáMo¡Lšk
(
äom
->
	`Next
()->
	`Out
());

182 
	}
}

184 cÚ¡ 
Lšk
* 
	$G‘RightMo¡Lšk
(cÚ¡ 
Lšk
* 
äom
) const {

185 ià(
äom
->
	`isL—f
()) {

186  
äom
;

188 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();

189 
lšk
->
	`Next
(è!ğ
äom
) {

190 
lšk
 =†šk->
	`Next
();

192  
	`G‘RightMo¡Lšk
(
lšk
->
	`Out
());

193 
	}
}

195 
¡ršg
 
	$G‘LeáMo¡
(cÚ¡ 
Lšk
* 
äom
) const {

196 ià(
äom
->
	`isL—f
()) {

197  
	`G‘NodeName
(
äom
);

199  
	`G‘LeáMo¡
(
äom
->
	`Next
()->
	`Out
());

200 
	}
}

202 
¡ršg
 
	$G‘RightMo¡
(cÚ¡ 
Lšk
* 
äom
) const {

203 ià(
äom
->
	`isL—f
()) {

204  
	`G‘NodeName
(
äom
);

206 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();

207 
lšk
->
	`Next
(è!ğ
äom
) {

208 
lšk
 =†šk->
	`Next
();

210  
	`G‘RightMo¡
(
lšk
->
	`Out
());

211 
	}
}

213 
	$Sim¶ify
() {

214 
sim¶ify
 = 
Œue
;

215 
	}
}

217 
	$PrštTab
(
o¡»am
& 
os
) {

218 
	`RecursivePrštTab
(
os
,
	`G‘RoÙ
());

219 
	}
}

221 
	$RecursivePrštTab
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

222 
os
 << 
	`G‘LeáMo¡
(
äom
è<< '\t' << 
	`G‘RightMo¡
(äomè<< '\t' << 
	`G‘NodeName
(from) << '\n';

223 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

224 
	`RecursivePrštTab
(
os
,
lšk
->
	`Out
());

226 
	}
}

228 
	$G‘Nnode
() {

229  
	`RecursiveG‘Nnode
(
	`G‘RoÙ
());

230 
	}
}

232 
	$G‘Nš‹º®Node
() {

233  
	`RecursiveG‘Nš‹º®Node
(
	`G‘RoÙ
());

234 
	}
}

236 
	$RecursiveG‘Nš‹º®Node
(cÚ¡ 
Lšk
* 
äom
) {

237 
n
 = 0;

238 ià(! 
äom
->
	`isL—f
()) {

239 
n
++;

241 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

242 
n
 +ğ
	`RecursiveG‘Nš‹º®Node
(
lšk
->
	`Out
());

244  
n
;

245 
	}
}

247 
	$RecursiveG‘Nnode
(cÚ¡ 
Lšk
* 
äom
) {

248 
n
 = 1;

249 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

250 
n
 +ğ
	`RecursiveG‘Nnode
(
lšk
->
	`Out
());

252  
n
;

253 
	}
}

255 
	g´Ùeùed
:

257 
vœtu®
 
¡ršg
 
	$G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
) const = 0;

258 
vœtu®
 
¡ršg
 
	$G‘B¿nchName
(cÚ¡ 
Lšk
* 
lšk
) const = 0;

260 
vœtu®
 
¡ršg
 
	$G‘L—fNodeName
(cÚ¡ 
Lšk
* 
lšk
) const {

261  
	`G‘NodeName
(
lšk
);

262 
	}
}

264 
boŞ
 
	gsim¶ify
;

269 şas 
	cT»e
 : 
public
 
NewickT»e
 {

271 
public
:

273 
T»e
();

276 
T»e
(cÚ¡ T»e* 
äom
);

281 
T»e
(
¡ršg
 
f’ame
);

285 
	mvœtu®
 ~
T»e
();

290 
D–‘eNextL—f
(
Lšk
* 
´evious
);

293 
D–‘eUÇryNode
(
Lšk
* 
äom
);

295 
Lšk
* 
	$G‘RoÙ
(ècÚ¡ { 
roÙ
;}

297 cÚ¡ 
TaxÚS‘
* 
	$G‘TaxÚS‘
(ècÚ¡ { 
x£t
;
	}
}

299 
RoÙAt
(
Lšk
* 
ÃwroÙ
);

301 
Regi¡”W™h
(cÚ¡ 
TaxÚS‘
* 
x£t
);

309 
boŞ
 
Regi¡”W™h
(cÚ¡ 
TaxÚS‘
* 
x£t
, 
Lšk
* 
äom
, & 
tÙ
);

312 
	$G‘B¿nchL’gth
(cÚ¡ 
Lšk
* 
lšk
) const {

313  
	`©of
(
	`G‘B¿nchName
(
lšk
).
	`c_¡r
());

314 
	}
}

316 
	$G‘MaxHeight
(cÚ¡ 
Lšk
* 
äom
) const {

318 
max
 = 0;

319 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

320 
tmp
 = 
	`G‘MaxHeight
(
lšk
->
	`Out
());

321 ià(
max
 < 
tmp
) {

322 
max
 = 
tmp
;

325 ià(! 
äom
->
	`isRoÙ
()) {

326 
max
 +ğ
	`G‘B¿nchL’gth
(
äom
);

328  
max
;

329 
	}
}

331 
	$G‘MšHeight
(cÚ¡ 
Lšk
* 
äom
) const {

333 
mš
 = -1;

334 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

335 
tmp
 = 
	`G‘MšHeight
(
lšk
->
	`Out
());

336 ià((
mš
 =ğ-1è|| (mš > 
tmp
)) {

337 
mš
 = 
tmp
;

340 ià(! 
äom
->
	`isRoÙ
()) {

341 
mš
 +ğ
	`G‘B¿nchL’gth
(
äom
);

343  
mš
;

344 
	}
}

346 
	$ToSŒ—mR’Üm
(cÚ¡ 
Lšk
* 
äom
, 
o¡»am
& 
os
, 
nÜmçùÜ
) {

348 ià(
äom
->
	`isL—f
()) {

349 
os
 << 
	`G‘NodeName
(
äom
);

352 
os
 << "(";

353 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

354 
	`ToSŒ—mR’Üm
(
lšk
->
	`Out
(),
os
,
nÜmçùÜ
);

355 ià(
lšk
->
	`Next
(è!ğ
äom
) {

356 
os
 << ",";

359 
os
 << ")";

360 
os
 << 
	`G‘NodeName
(
äom
);

362 ià(
äom
->
	`isRoÙ
()) {

363 
os
 << ";\n";

366 
os
 << ":";

367 
os
 << 
	`G‘B¿nchL’gth
(
äom
è* 
nÜmçùÜ
;

369 
	}
}

371 
¡ršg
 
	$G‘B¿nchName
(cÚ¡ 
Lšk
* 
lšk
ècÚ¡ {†šk->
	`G‘B¿nch
()->
	`G‘Name
();
	}
}

373 
¡ršg
 
	$G‘NodeName
(cÚ¡ 
Lšk
* 
lšk
) const {

374  
lšk
->
	`G‘Node
()->
	`G‘Name
();

390 
	}
}

394 
E¿£IÁ”ÇlNodeName
();

395 
E¿£IÁ”ÇlNodeName
(
Lšk
* 
äom
);

409 
	$G‘Size
() const {

410  
	`G‘Size
(
	`G‘RoÙ
());

411 
	}
}

413 
	$G‘Size
(cÚ¡ 
Lšk
* 
äom
) const {

414 ià(
äom
->
	`isL—f
()) {

418 
tÙ®
 = 0;

419 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

420 
tÙ®
 +ğ
	`G‘Size
(
lšk
->
	`Out
());

422  
tÙ®
;

425 
	}
}

427 
	$G‘FuÎSize
(cÚ¡ 
Lšk
* 
äom
) const {

428 ià(
äom
->
	`isL—f
()) {

432 
tÙ®
 = 1;

433 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

434 
tÙ®
 +ğ
	`G‘FuÎSize
(
lšk
->
	`Out
());

436  
tÙ®
;

439 
	}
}

441 
vœtu®
 cÚ¡ 
Lšk
* 
	$G‘LCA
(
¡ršg
 
x1
, sŒšg 
x2
) {

442 
boŞ
 
found1
 = 
çl£
;

443 
boŞ
 
found2
 = 
çl£
;

444 cÚ¡ 
Lšk
* 
lšk
ğ
	`RecursiveG‘LCA
(
	`G‘RoÙ
(),
x1
,
x2
,
found1
,
found2
);

458  
lšk
;

459 
	}
}

461 
vœtu®
 cÚ¡ 
Lšk
* 
	$G‘LCA
(cÚ¡ 
Lšk
* 
äom1
, cÚ¡ Lšk* 
äom2
) {

462 
boŞ
 
found1
 = 
çl£
;

463 
boŞ
 
found2
 = 
çl£
;

464 cÚ¡ 
Lšk
* 
lšk
ğ
	`RecursiveG‘LCA
(
	`G‘RoÙ
(),
äom1
,
äom2
,
found1
,
found2
);

465  
lšk
;

466 
	}
}

468 
Subdivide
(
Lšk
* 
äom
, 
Nš‹½Ş
);

470 
¡ršg
 
	$Reduû
(
Lšk
* 
äom
 = 0) {

472 ià(! 
äom
) {

473 
äom
 = 
	`G‘RoÙ
();

475 ià(
äom
->
	`isL—f
()) {

476 
û¼
 << 
äom
->
	`G‘Node
()->
	`G‘Name
() << '\n';;

477  
äom
->
	`G‘Node
()->
	`G‘Name
();

480 
¡ršg
 
Çme
 = "None";

481 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

482 
¡ršg
 
tmp
 = 
	`Reduû
(
lšk
->
	`Out
());

483 ià(
tmp
 == "diff") {

484 
Çme
 = "diff";

486 ià(
Çme
 == "None") {

487 
Çme
 = 
tmp
;

489 ià(
Çme
 !ğ
tmp
) {

490 
Çme
 = "diff";

493 
û¼
 << '\t' << 
Çme
 << '\n';

494 
äom
->
	`G‘Node
()->
	`S‘Name
(
Çme
);

495  
Çme
;

498 
	}
}

500 
	$PrštReduûd
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
 = 0) {

501 ià(!
äom
) {

502 
äom
 = 
	`G‘RoÙ
();

504 ià(
äom
->
	`G‘Node
()->
	`G‘Name
() != "diff") {

505 
os
 << 
äom
->
	`G‘Node
()->
	`G‘Name
();

508 
os
 << '(';

509 cÚ¡ 
Lšk
* 
lšk
 = 
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

510 
	`PrštReduûd
(
os
,
lšk
->
	`Out
());

511 ià(
lšk
->
	`Next
(è!ğ
äom
) {

512 
os
 << ',';

515 
os
 << ')';

517 ià(
äom
->
	`isRoÙ
()) {

518 
os
 << ";\n";

520 
	}
}

522 cÚ¡ 
Lšk
* 
	$Choo£IÁ”ÇlNode
() {

523 
n
 = 
	`CouÁIÁ”ÇlNodes
(
	`G‘RoÙ
());

524 
m
 = (è(
n
 * 
Rªdom
::
	`UnifÜm
());

525 cÚ¡ 
Lšk
* 
tmp
;

526 cÚ¡ 
Lšk
* 
cho£n
 = 
	`Choo£IÁ”ÇlNode
(
	`G‘RoÙ
(),
tmp
,
m
);

527 ià(! 
cho£n
) {

528 
û¼
 << "error in choose internal‚ode:‚ull…ointer\n";

529 
	`ex™
(1);

531  
cho£n
;

532 
	}
}

534 
CouÁIÁ”ÇlNodes
(cÚ¡ 
Lšk
* 
äom
);

535 cÚ¡ 
Lšk
* 
Choo£IÁ”ÇlNode
(cÚ¡ Lšk* 
äom
, cÚ¡ Lšk*& 
cho£nup
, & 
n
);

536 
CouÁNodes
(cÚ¡ 
Lšk
* 
äom
);

537 cÚ¡ 
Lšk
* 
Choo£Node
(cÚ¡ Lšk* 
äom
, cÚ¡ Lšk*& 
cho£nup
, & 
n
);

539 
	g´Ùeùed
:

543 cÚ¡ 
Lšk
* 
	$RecursiveG‘LCA
(cÚ¡ 
Lšk
* 
äom
, 
¡ršg
 
x1
, sŒšg 
x2
, 
boŞ
& 
found1
, boŞ& 
found2
) {

544 cÚ¡ 
Lšk
* 
»t
= 0;

545 ià(
äom
->
	`isL—f
()) {

548 
¡ršg
 
Çme1
 = 
	`G‘L—fNodeName
(
äom
).
	`sub¡r
(0,
x1
.
	`size
());

549 
¡ršg
 
Çme2
 = 
	`G‘L—fNodeName
(
äom
).
	`sub¡r
(0,
x2
.
	`size
());

550 
found1
 |ğ(
Çme1
 =ğ
x1
);

551 
found2
 |ğ(
Çme2
 =ğ
x2
);

556 ià(! 
»t
) {

557 ià(
found1
 && 
found2
) {

558 
»t
 = 
äom
;

563 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

564 
boŞ
 
tmp1
 = 
çl£
;

565 
boŞ
 
tmp2
 = 
çl£
;

566 cÚ¡ 
Lšk
* 
»t2
 = 
	`RecursiveG‘LCA
(
lšk
->
	`Out
(),
x1
,
x2
,
tmp1
,
tmp2
);

567 
found1
 |ğ
tmp1
;

568 
found2
 |ğ
tmp2
;

569 ià(
»t2
) {

570 ià(
»t
) {

571 
û¼
 << "error : found‚odewice\n";

572 
û¼
 << 
x1
 << '\t' << 
x2
 << '\n';

573 
	`ToSŒ—m
(
û¼
,
»t2
->
	`Out
());

574 
û¼
 << '\n';

575 
	`ToSŒ—m
(
û¼
,
»t
->
	`Out
());

576 
û¼
 << '\n';

577 
	`ex™
(1);

579 
»t
 = 
»t2
;

582 ià(! 
»t
) {

583 ià(
found1
 && 
found2
) {

584 
»t
 = 
äom
;

588  
»t
;

589 
	}
}

591 cÚ¡ 
Lšk
* 
	$RecursiveG‘LCA
(cÚ¡ 
Lšk
* 
äom
, cÚ¡ Lšk* 
äom1
, cÚ¡ Lšk* 
äom2
, 
boŞ
& 
found1
, boŞ& 
found2
) {

592 cÚ¡ 
Lšk
* 
»t
= 0;

593 
found1
 |ğ(
äom
 =ğ
äom1
);

594 
found2
 |ğ(
äom
 =ğ
äom2
);

595 ià(! 
»t
) {

596 ià(
found1
 && 
found2
) {

597 
»t
 = 
äom
;

600 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

601 
boŞ
 
tmp1
 = 
çl£
;

602 
boŞ
 
tmp2
 = 
çl£
;

603 cÚ¡ 
Lšk
* 
»t2
 = 
	`RecursiveG‘LCA
(
lšk
->
	`Out
(),
äom1
,
äom2
,
tmp1
,
tmp2
);

604 
found1
 |ğ
tmp1
;

605 
found2
 |ğ
tmp2
;

606 ià(
»t2
) {

607 ià(
»t
) {

608 
û¼
 << "error : found‚odewice\n";

609 
û¼
 << 
äom1
 << '\t' << 
äom2
 << '\n';

610 
	`ToSŒ—m
(
û¼
,
»t2
->
	`Out
());

611 
û¼
 << '\n';

612 
	`ToSŒ—m
(
û¼
,
»t
->
	`Out
());

613 
û¼
 << '\n';

614 
	`ex™
(1);

616 
»t
 = 
»t2
;

619 ià(! 
»t
) {

620 ià(
found1
 && 
found2
) {

621 
»t
 = 
äom
;

624  
»t
;

625 
	}
}

627 
R—dFromSŒ—m
(
i¡»am
& 
is
);

631 
Lšk
* 
P¬£Group
(
¡ršg
 
šput
, Lšk* 
äom
);

644 
Lšk
* 
P¬£Li¡
(
¡ršg
 
šput
, 
Node
* 
node
);

648 
RecursiveClÚe
(cÚ¡ 
Lšk
* 
äom
, Lšk* 
to
);

655 
RecursiveD–‘e
(
Lšk
* 
äom
);

657 
	$S‘RoÙ
(
Lšk
* 
lšk
è{
roÙ
 =†šk;
	}
}

661 
Lšk
* 
	groÙ
;

662 cÚ¡ 
TaxÚS‘
* 
	gx£t
;

	@ValArray.h

2 #iâdeà
VALARRAY_H


3 
	#VALARRAY_H


	)

5 
	~"Ba£Ty³.h
"

7 şas 
	cAb¡¿ùA¼ay
 {

9 
	mpublic
:

11 
vœtu®
 ~
	$Ab¡¿ùA¼ay
() {}

13 
vœtu®
 
	`G‘Size
() = 0;

14 
	}
};

16 
	g‹m¶©e
 <
şass
 
	gV
> cÏs 
	cV¬A¼ay
 : 
public
 
vœtu®
 
Ab¡¿ùA¼ay
 {

18 
public
:

20 
vœtu®
 ~
	$V¬A¼ay
() {}

22 
vœtu®
 
V¬
<
V
>* 
	`G‘V®
(
s™e
) = 0;

24 
	$S‘Name
(
¡ršg
 
šÇme
) {

25 
i
=0; i<
	`G‘Size
(); i++) {

26 
	`G‘V®
(
i
)->
	`S‘Name
(
šÇme
);

28 
	}
}

30 
	$ToSŒ—m
(
o¡»am
& 
os
) {

31 
i
=0; i<
	`G‘Size
(); i++) {

32 
os
 << *(
	`G‘V®
(
i
)) << '\t';

34 
os
 << '\n';

35 
	}
}

37 
	$FromSŒ—m
(
i¡»am
& 
is
) {

38 
i
=0; i<
	`G‘Size
(); i++) {

39 
is
 >> *(
	`G‘V®
(
i
));

41 
	}
}

43 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
	gV¬A¼ay
<
	gV
>& 
	ga
) {

44 
	ga
.
ToSŒ—m
(
os
);

45  
	gos
;

48 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gV¬A¼ay
<
	gV
>& 
	ga
) {

49 
	ga
.
FromSŒ—m
(
is
);

50  
	gis
;

53 
	$Regi¡”Chd
(
DAGnode
* 
node
) {

54 
i
=0; i<
this
->
	`G‘Size
(); i++) {

55 
node
->
	`Regi¡”
(
this
->
	`G‘V®
(
i
));

57 
	}
}

59 
vœtu®
 
	$Regi¡”A¼ay
(
DAGnode
* 
š
) {

60 
i
=0; i<
	`G‘Size
(); i++) {

61 
	`G‘V®
(
i
)->
	`Regi¡”
(
š
);

63 
	}
}

67 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gRªdomV¬A¼ay
 : 
public
 
V¬A¼ay
<
V
>,…ubliø
	gMCMC
 {

69 
	gpublic
:

72 
	g‹m¶©e
<> 
şass
 
	gRªdomV¬A¼ay
<
	gPosR—l
> : 
public
 
V¬A¼ay
<
PosR—l
>,…ubliø
	gMCMC
,…ubliø
	gMuÉliÿtive
 {

74 
	gpublic
:

76 
vœtu®
 
Regi¡”
(
DAGnode
* 
š
) {

77 
Regi¡”A¼ay
(
š
);

80 
SÿÏrMuÉliÿtiÚ
(
d
) {

81 
	gi
=0; i<
G‘Size
(); i++) {

82 
G‘V®
(
i
)->
SÿÏrMuÉliÿtiÚ
(
d
);

84  
G‘Size
();

89 
	g‹m¶©e
 <
şass
 
	gT
> cÏs 
	c_V®PŒA¼ay
 : 
public
 
vœtu®
 
Ab¡¿ùA¼ay
 {

91 
public
:

93 
	$_V®PŒA¼ay
(
šsize
) {

94 
size
 = 
šsize
;

95 
¬¿y
 = 
Ãw
 
T
*[
size
];

96 
i
=0; i<
	`G‘Size
(); i++) {

97 
¬¿y
[
i
] = 0;

101 
vœtu®
 ~
	$_V®PŒA¼ay
() {

102 
i
=0; i<
	`G‘Size
(); i++) {

103 
d–‘e
 
¬¿y
[
i
];

104 
¬¿y
[
i
] = 0;

106 
d–‘e
[] 
¬¿y
;

107 
	}
}

109 
	$G‘Size
() {

110  
size
;

111 
	}
}

113 
T
* 
	$G‘V®
(
s™e
) {

114  
¬¿y
[
s™e
];

115 
	}
}

117 
T
* 
	gİ”©Ü
[](
	gs™e
) {

118  
G‘V®
(
s™e
);

120 
	$S‘V®
(
s™e
, 
T
* 
š
) {

121 
¬¿y
[
s™e
] = 
š
;

122 
	}
}

124 
	$C»©e
() {

125 
i
=0; i<
	`G‘Size
(); i++) {

126 
¬¿y
[
i
] = 
	`C»©eV®
(i);

128 
	}
}

130 
	$D–‘e
() {

131 
i
=0; i<
	`G‘Size
(); i++) {

132 
d–‘e
 
¬¿y
[
i
];

133 
¬¿y
[
i
] = 0;

135 
	}
}

162 
	g´Ùeùed
:

164 
vœtu®
 
T
* 
C»©eV®
(
s™e
) = 0;

166 
	gsize
;

167 
T
** 
	g¬¿y
;

172 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gV®PŒA¼ay
: 
public
 
_V®PŒA¼ay
<
T
> {

174 
V®PŒA¼ay
(
šsize
è: 
_V®PŒA¼ay
<
T
>(insize) {}

177 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gV®PŒA¼ay
<
	gRv¬
<V> > : 
public
 
_V®PŒA¼ay
<
Rv¬
<
V
> >,…ubliø
vœtu®
 
	gRªdomV¬A¼ay
<V> {

179 
	gpublic
:

181 
V®PŒA¼ay
<
Rv¬
<
V
> >(
šsize
è: 
_V®PŒA¼ay
<Rvar<V> >(insize) {}

183 
vœtu®
 
Rv¬
<
V
>* 
G‘V®
(
s™e
) {

184  
_V®PŒA¼ay
<
Rv¬
<
V
> >::
G‘V®
(
s™e
);

189 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gV®PŒA¼ay
<
	gDv¬
<V> > : 
public
 
_V®PŒA¼ay
<
Dv¬
<
V
> >,…ubliø
vœtu®
 
	gV¬A¼ay
<V> {

191 
	gpublic
:

193 
V®PŒA¼ay
<
Dv¬
<
V
> >(
šsize
è: 
_V®PŒA¼ay
<Dvar<V> >(insize) {}

195 
vœtu®
 
Dv¬
<
V
>* 
G‘V®
(
s™e
) {

196  
_V®PŒA¼ay
<
Dv¬
<
V
> >::
G‘V®
(
s™e
);

	@ValTree.h

2 #iâdeà
VALTREE_H


3 
	#VALTREE_H


	)

5 
	~<s¡»am
>

7 
	~"Ba£Ty³.h
"

8 
	~"V¬.h
"

9 
	~"Ab¡¿ùT»e.h
"

13 
	eB¿nchV®Ty³
 {
	mMEAN
,
	mINTEGRAL
};

15 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gB¿nchV®PŒT»e
;

17 
	g‹m¶©e
<
şass
 
	gU
> cÏs 
	gNodeV®PtT»e
;

19 
	g‹m¶©e
<
şass
 
	gU
, cÏs 
	gV
> cÏs 
	gNodeB¿nchV®PŒT»e
;

21 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	c_B¿nchV®PŒT»e
 : 
public
 
vœtu®
 
Ab¡¿ùT»e
 {

23 
public
:

25 
boŞ
 
	$W™hRoÙ
() {

26  
w™hRoÙ
;

29 
	$S‘W™hRoÙ
(
boŞ
 
š
) {

30 
w™hRoÙ
 = 
š
;

31 
	}
}

33 
V
* 
	$G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

34  
b¿nchv®
[
b¿nch
];

35 
	}
}

37 
	$S‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
, 
V
* 
š
) {

38 ià((! 
	`W™hRoÙ
()è&& (! 
b¿nch
)) {

39 
û¼
 << "error in _BranchValPtrTree:‚ull branch…ointer\n";

40 
throw
;

42 
b¿nchv®
[
b¿nch
] = 
š
;

43 
	}
}

45 
vœtu®
 
	$RecursiveC»©e
(cÚ¡ 
Lšk
* 
äom
) {

46 ià(
	`W™hRoÙ
(è&& 
äom
->
	`isRoÙ
()) {

47 
V
* 
v
ğ
	`C»©eB¿nchV®
(
äom
);

48 
b¿nchv®
[0] = 
v
;

50 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

51 
V
* 
v
ğ
	`C»©eB¿nchV®
(
lšk
);

52 
b¿nchv®
[
lšk
->
	`G‘B¿nch
()] = 
v
;

53 
	`RecursiveC»©e
(
lšk
->
	`Out
());

55 
	}
}

57 
	gvœtu®
 ~
	$_B¿nchV®PŒT»e
(è{
	}
}

59 
vœtu®
 
	$RecursiveD–‘e
(cÚ¡ 
Lšk
* 
äom
) {

60 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

61 
	`RecursiveD–‘e
(
lšk
->
	`Out
());

62 
d–‘e
 
this
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
());

63 
this
->
	`S‘B¿nchV®
(
lšk
->
	`G‘B¿nch
(),0);

65 ià(
	`W™hRoÙ
(è&& 
äom
->
	`isRoÙ
()) {

66 
d–‘e
 
this
->
	`G‘B¿nchV®
(0);

68 
	}
}

70 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
	g_B¿nchV®PŒT»e
<
	gV
>& 
	gb
) {

71 
	gb
.
ToSŒ—m
(
os
,
b
.
G‘RoÙ
());

72 
	gos
 << '\n';

73  
	gos
;

76 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	g_B¿nchV®PŒT»e
<
	gV
>& 
	gb
) {

77 
	gb
.
FromSŒ—m
(
is
,
b
.
G‘RoÙ
());

78  
	gis
;

81 
	$ToSŒ—m
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

82 ià(
	`W™hRoÙ
(è&& 
äom
->
	`isRoÙ
()) {

83 
os
 << *(
this
->
	`G‘B¿nchV®
(0)) << '\t';

85 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

86 
os
 << *(
this
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
())) << '\t';

87 
	`ToSŒ—m
(
os
, 
lšk
->
	`Out
());

89 
	}
}

91 
	$FromSŒ—m
(
i¡»am
& 
is
, 
Lšk
* 
äom
) {

92 ià(
	`W™hRoÙ
(è&& 
äom
->
	`isRoÙ
()) {

93 
is
 >> *(
this
->
	`G‘B¿nchV®
(0));

95 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

96 
is
 >> *(
this
->
	`G‘B¿nchV®
(
lšk
->
	`G‘B¿nch
()));

97 
	`FromSŒ—m
(
is
, 
lšk
->
	`Out
());

99 
	}
}

101 
	g´Ùeùed
:

103 
vœtu®
 
V
* 
C»©eB¿nchV®
(cÚ¡ 
Lšk
* 
lšk
) = 0;

105 
	gm­
<cÚ¡ 
	gB¿nch
*,
	gV
*> 
	gb¿nchv®
;

107 
boŞ
 
	gw™hRoÙ
;

110 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gB¿nchV®PŒT»e
 : 
public
 
vœtu®
 
_B¿nchV®PŒT»e
<
T
> {

114 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gB¿nchV®PŒT»e
<
	gRv¬
<V> > : 
public
 
vœtu®
 
_B¿nchV®PŒT»e
<
Rv¬
<
V
> >,…ubliøvœtu® 
	gB¿nchV¬T»e
<V> {

116 
	gpublic
:

118 
vœtu®
 
Rv¬
<
V
>* 
G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

119  
_B¿nchV®PŒT»e
<
Rv¬
<
V
> >::
G‘B¿nchV®
(
b¿nch
);

123 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gB¿nchV®PŒT»e
<
	gDv¬
<V> > : 
public
 
vœtu®
 
_B¿nchV®PŒT»e
<
Dv¬
<
V
> >,…ubliøvœtu® 
	gB¿nchV¬T»e
<V> {

125 
	gpublic
:

127 
vœtu®
 
Dv¬
<
V
>* 
G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

128  
_B¿nchV®PŒT»e
<
Dv¬
<
V
> >::
G‘B¿nchV®
(
b¿nch
);

132 
	g‹m¶©e
<> 
şass
 
	gB¿nchV®PŒT»e
< 
	gRv¬
<
	gPosR—l
> > : 
public
 
vœtu®
 
_B¿nchV®PŒT»e
<
Rv¬
<
PosR—l
> >,…ubliøvœtu® 
	gRªdomL’gthT»e
 {

134 
	gpublic
:

136 
vœtu®
 
Rv¬
<
PosR—l
>* 
G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

137  
_B¿nchV®PŒT»e
<
Rv¬
<
PosR—l
> >::
G‘B¿nchV®
(
b¿nch
);

141 
	g‹m¶©e
<> 
şass
 
	gB¿nchV®PŒT»e
< 
	gDv¬
<
	gPosR—l
> > : 
public
 
vœtu®
 
_B¿nchV®PŒT»e
<
Dv¬
<
PosR—l
> >,…ubliøvœtu® 
	gL’gthT»e
 {

143 
	gpublic
:

145 
vœtu®
 
Dv¬
<
PosR—l
>* 
G‘B¿nchV®
(cÚ¡ 
B¿nch
* 
b¿nch
) {

146  
_B¿nchV®PŒT»e
<
Dv¬
<
PosR—l
> >::
G‘B¿nchV®
(
b¿nch
);

150 
	g‹m¶©e
<
şass
 
	gU
> cÏs 
	c_NodeV®PŒT»e
 : 
public
 
vœtu®
 
Ab¡¿ùT»e
 {

152 
public
:

154 
U
* 
	$G‘NodeV®
(cÚ¡ 
Node
* 
node
) {

155  
nodev®
[
node
];

158 
	$S‘NodeV®
(cÚ¡ 
Node
* 
node
, 
U
* 
š
) {

159 
nodev®
[
node
] = 
š
;

160 
	}
}

162 
	gvœtu®
 ~
	$_NodeV®PŒT»e
(è{
	}
}

164 
vœtu®
 
	$RecursiveC»©e
(cÚ¡ 
Lšk
* 
äom
) {

165 
U
* 
u
 = 
	`C»©eNodeV®
(
äom
);

166 
nodev®
[
äom
->
	`G‘Node
()] = 
u
;

167 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

168 
	`RecursiveC»©e
(
lšk
->
	`Out
());

170 
	}
}

172 
vœtu®
 
	$RecursiveD–‘e
(
Lšk
* 
äom
) {

173 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

174 
	`RecursiveD–‘e
(
lšk
->
	`Out
());

176 
d–‘e
 
this
->
	`G‘NodeV®
(
äom
->
	`G‘Node
());

177 
this
->
	`S‘NodeV®
(
äom
->
	`G‘Node
(),0);

178 
	}
}

180 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
	g_NodeV®PŒT»e
<
	gU
>& 
	gb
) {

181 
	gb
.
ToSŒ—m
(
os
,
b
.
G‘RoÙ
());

182  
	gos
;

185 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	g_NodeV®PŒT»e
<
	gU
>& 
	gb
) {

186 
	gb
.
FromSŒ—m
(
is
,
b
.
G‘RoÙ
());

187  
	gis
;

190 
	$ToSŒ—m
(
o¡»am
& 
os
, cÚ¡ 
Lšk
* 
äom
) {

191 
os
 << *(
this
->
	`G‘NodeV®
(
äom
->
	`G‘Node
())) << '\n';

192 cÚ¡ 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

193 
	`ToSŒ—m
(
os
, 
lšk
->
	`Out
());

195 
	}
}

197 
	$FromSŒ—m
(
i¡»am
& 
is
, 
Lšk
* 
äom
) {

198 
is
 >> *(
this
->
	`G‘NodeV®
(
äom
->
	`G‘Node
()));

199 
Lšk
* 
lšk
=
äom
->
	`Next
();†ink!=from;†ink=link->Next()) {

200 
	`FromSŒ—m
(
is
, 
lšk
->
	`Out
());

202 
	}
}

205 
	g´Ùeùed
:

207 
vœtu®
 
U
* 
C»©eNodeV®
(cÚ¡ 
Lšk
* 
lšk
) = 0;

209 
	gm­
<cÚ¡ 
	gNode
*,
	gU
*> 
	gnodev®
;

213 
	g‹m¶©e
<
şass
 
	gU
> cÏs 
	gNodeV®PŒT»e
 : 
public
 
vœtu®
 
_NodeV®PŒT»e
<
U
> {

217 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gNodeV®PŒT»e
<
	gRv¬
<V> > : 
public
 
vœtu®
 
_NodeV®PŒT»e
<
Rv¬
<
V
> >,…ubliøvœtu® 
	gNodeV¬T»e
<V> {

219 
	gpublic
:

221 
vœtu®
 
Rv¬
<
V
>* 
G‘NodeV®
(cÚ¡ 
Node
* 
node
) {

222  
_NodeV®PŒT»e
<
Rv¬
<
V
> >::
G‘NodeV®
(
node
);

226 
	g‹m¶©e
<
şass
 
	gV
> cÏs 
	gNodeV®PŒT»e
<
	gDv¬
<V> > : 
public
 
vœtu®
 
_NodeV®PŒT»e
<
Dv¬
<
V
> >,…ubliøvœtu® 
	gNodeV¬T»e
<V> {

228 
	gpublic
:

230 
vœtu®
 
Dv¬
<
V
>* 
G‘NodeV®
(cÚ¡ 
Node
* 
node
) {

231  
_NodeV®PŒT»e
<
Dv¬
<
V
> >::
G‘NodeV®
(
node
);

235 
	g‹m¶©e
<
şass
 
	gU
, cÏs 
	gV
> cÏs 
	gNodeB¿nchV®PŒT»e
 : 
public
 
vœtu®
 
NodeV®PŒT»e
<
U
>,…ubliøvœtu® 
	gB¿nchV®PŒT»e
<V> {

237 
	gpublic
:

239 
vœtu®
 ~
NodeB¿nchV®PŒT»e
() {}

242 
vœtu®
 
RecursiveC»©e
(
Lšk
* 
äom
) {

243 ià(! 
äom
->
isRoÙ
()) {

244 
û¼
 << "error in NodeBranchValPtrTree::RecursiveCreate: should‚ot be called on„oot\n";

245 
ex™
(1);

247 
RecursiveC»©eNode
(
äom
);

248 
RecursiveC»©eB¿nch
(
äom
);

251 
vœtu®
 
RecursiveC»©eNode
(
Lšk
* 
äom
) {

252 
U
* 
	gu
 = 
this
->
C»©eNodeV®
(
äom
);

253 
	gthis
->
	gnodev®
[
äom
->
G‘Node
()] = 
u
;

254 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

255 
RecursiveC»©eNode
(
lšk
->
Out
());

259 
vœtu®
 
RecursiveC»©eB¿nch
(
Lšk
* 
äom
) {

260 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

261 
V
* 
v
ğ
this
->
C»©eB¿nchV®
(
lšk
);

262 
	gthis
->
	gb¿nchv®
[
lšk
->
G‘B¿nch
()] = 
v
;

263 
RecursiveC»©eB¿nch
(
lšk
->
Out
());

267 
vœtu®
 
RecursiveD–‘eNode
(
Lšk
* 
äom
) {

268 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

269 
RecursiveD–‘eNode
(
lšk
->
Out
());

271 
d–‘e
 
	gthis
->
	gnodev®
[
äom
->
G‘Node
()];

274 
vœtu®
 
RecursiveD–‘eB¿nch
(
Lšk
* 
äom
) {

275 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

276 
RecursiveD–‘eB¿nch
(
lšk
->
Out
());

277 
d–‘e
 
	gthis
->
	gb¿nchv®
[
lšk
->
G‘B¿nch
()];

281 
vœtu®
 
RecursiveD–‘e
(
Lšk
* 
äom
) {

282 ià(! 
	gäom
->
isRoÙ
()) {

283 
	gû¼
 << "error in NodeBranchValPtrTree::RecursiveDelete: should‚ot be called on„oot\n";

284 
ex™
(1);

286 
RecursiveD–‘eB¿nch
(
äom
);

287 
RecursiveD–‘eNode
(
äom
);

291 
ToSŒ—m
(
o¡»am
& 
os
) {

292 
	gNodeV®PŒT»e
<
	gU
>::
ToSŒ—m
(
os
,
this
->
G‘RoÙ
());

293 
	gos
 << '\n';

294 
	gB¿nchV®PŒT»e
<
	gV
>::
ToSŒ—m
(
os
,
this
->
G‘RoÙ
());

297 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
	gNodeB¿nchV®PŒT»e
<
	gU
,
	gV
>& 
	gb
) {

298 
	gb
.
ToSŒ—m
(
os
);

299  
	gos
;

302 
FromSŒ—m
(
i¡»am
& 
is
) {

303 
	gNodeV®PŒT»e
<
	gU
>::
FromSŒ—m
(
is
,
this
->
G‘RoÙ
());

304 
	gB¿nchV®PŒT»e
<
	gV
>::
FromSŒ—m
(
is
,
this
->
G‘RoÙ
());

307 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gNodeB¿nchV®PŒT»e
<
	gU
,
	gV
>& 
	gb
) {

308 
	gb
.
FromSŒ—m
(
is
);

309  
	gis
;

313 
	g‹m¶©e
<
şass
 
	gU
, cÏs 
	gV
> cÏs 
	gNodeB¿nchV®PŒT»e
<
	gRv¬
<U>, 
	gDv¬
<V> > : 
public
 
vœtu®
 
NodeV®PŒT»e
<
Rv¬
<
U
> >,…ubliøvœtu® 
	gB¿nchV®PŒT»e
<Dv¬<V> >,…ubliø
	gNodeB¿nchV¬T»e
<U,V> {

315 
	gpublic
:

317 
vœtu®
 ~
NodeB¿nchV®PŒT»e
() {}

320 
vœtu®
 
RecursiveC»©e
(
Lšk
* 
äom
) {

321 ià(! 
äom
->
isRoÙ
()) {

322 
û¼
 << "error in NodeBranchValPtrTree::RecursiveCreate: should‚ot be called on„oot\n";

323 
ex™
(1);

325 
RecursiveC»©eNode
(
äom
);

326 
RecursiveC»©eB¿nch
(
äom
);

329 
vœtu®
 
RecursiveC»©eNode
(
Lšk
* 
äom
) {

330 
	gRv¬
<
	gU
>* 
	gu
 = 
this
->
C»©eNodeV®
(
äom
);

331 
	gthis
->
	gnodev®
[
äom
->
G‘Node
()] = 
u
;

332 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

333 
RecursiveC»©eNode
(
lšk
->
Out
());

337 
vœtu®
 
RecursiveC»©eB¿nch
(
Lšk
* 
äom
) {

338 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

339 
Dv¬
<
V
>* 
v
ğ
this
->
C»©eB¿nchV®
(
lšk
);

340 
	gthis
->
	gb¿nchv®
[
lšk
->
G‘B¿nch
()] = 
v
;

341 
RecursiveC»©eB¿nch
(
lšk
->
Out
());

345 
vœtu®
 
RecursiveD–‘eNode
(
Lšk
* 
äom
) {

346 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

347 
RecursiveD–‘eNode
(
lšk
->
Out
());

349 
d–‘e
 
	gthis
->
	gnodev®
[
äom
->
G‘Node
()];

352 
vœtu®
 
RecursiveD–‘eB¿nch
(
Lšk
* 
äom
) {

353 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

354 
RecursiveD–‘eB¿nch
(
lšk
->
Out
());

355 
d–‘e
 
	gthis
->
	gb¿nchv®
[
lšk
->
G‘B¿nch
()];

359 
vœtu®
 
RecursiveD–‘e
(
Lšk
* 
äom
) {

360 ià(! 
	gäom
->
isRoÙ
()) {

361 
	gû¼
 << "error in NodeBranchValPtrTree::RecursiveDelete: should‚ot be called on„oot\n";

362 
ex™
(1);

364 
RecursiveD–‘eB¿nch
(
äom
);

365 
RecursiveD–‘eNode
(
äom
);

369 
ToSŒ—m
(
o¡»am
& 
os
) {

370 
	gNodeV®PŒT»e
<
	gRv¬
<
	gU
> >::
ToSŒ—m
(
os
,
this
->
G‘RoÙ
());

371 
	gos
 << '\n';

372 
	gB¿nchV®PŒT»e
<
	gDv¬
<
	gV
> >::
ToSŒ—m
(
os
,
this
->
G‘RoÙ
());

375 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
	gNodeB¿nchV®PŒT»e
<
	gRv¬
<
	gU
> ,
	gDv¬
<
	gV
> >& 
	gb
) {

376 
	gb
.
ToSŒ—m
(
os
);

377  
	gos
;

380 
FromSŒ—m
(
i¡»am
& 
is
) {

381 
	gNodeV®PŒT»e
<
	gRv¬
<
	gU
> >::
FromSŒ—m
(
is
,
this
->
G‘RoÙ
());

382 
	gB¿nchV®PŒT»e
<
	gDv¬
<
	gV
> >::
FromSŒ—m
(
is
,
this
->
G‘RoÙ
());

385 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gNodeB¿nchV®PŒT»e
<
	gRv¬
<
	gU
> ,
	gDv¬
<
	gV
> >& 
	gb
) {

386 
	gb
.
FromSŒ—m
(
is
);

387  
	gis
;

391 
	g‹m¶©e
<
şass
 
	gU
, cÏs 
	gV
> cÏs 
	gNodeB¿nchV®PŒT»e
<
	gDv¬
<U>, Dv¬<V> > : 
public
 
vœtu®
 
NodeV®PŒT»e
<
Dv¬
<
U
> >,…ubliøvœtu® 
	gB¿nchV®PŒT»e
<Dv¬<V> >,…ubliø
	gNodeB¿nchV¬T»e
<U,V> {

393 
	gpublic
:

395 
vœtu®
 ~
NodeB¿nchV®PŒT»e
() {}

398 
vœtu®
 
RecursiveC»©e
(
Lšk
* 
äom
) {

399 ià(! 
äom
->
isRoÙ
()) {

400 
û¼
 << "error in NodeBranchValPtrTree::RecursiveCreate: should‚ot be called on„oot\n";

401 
ex™
(1);

403 
RecursiveC»©eNode
(
äom
);

404 
RecursiveC»©eB¿nch
(
äom
);

407 
vœtu®
 
RecursiveC»©eNode
(
Lšk
* 
äom
) {

408 
	gDv¬
<
	gU
>* 
	gu
 = 
this
->
C»©eNodeV®
(
äom
);

409 
	gthis
->
	gnodev®
[
äom
->
G‘Node
()] = 
u
;

410 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

411 
RecursiveC»©eNode
(
lšk
->
Out
());

415 
vœtu®
 
RecursiveC»©eB¿nch
(
Lšk
* 
äom
) {

416 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

417 
Dv¬
<
V
>* 
v
ğ
this
->
C»©eB¿nchV®
(
lšk
);

418 
	gthis
->
	gb¿nchv®
[
lšk
->
G‘B¿nch
()] = 
v
;

419 
RecursiveC»©eB¿nch
(
lšk
->
Out
());

423 
vœtu®
 
RecursiveD–‘eNode
(
Lšk
* 
äom
) {

424 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

425 
RecursiveD–‘eNode
(
lšk
->
Out
());

427 
d–‘e
 
	gthis
->
	gnodev®
[
äom
->
G‘Node
()];

430 
vœtu®
 
RecursiveD–‘eB¿nch
(
Lšk
* 
äom
) {

431 
Lšk
* 
	glšk
=
äom
->
Next
();†šk!=äom;†šk=
lšk
->Next()) {

432 
RecursiveD–‘eB¿nch
(
lšk
->
Out
());

433 
d–‘e
 
	gthis
->
	gb¿nchv®
[
lšk
->
G‘B¿nch
()];

437 
vœtu®
 
RecursiveD–‘e
(
Lšk
* 
äom
) {

438 ià(! 
	gäom
->
isRoÙ
()) {

439 
	gû¼
 << "error in NodeBranchValPtrTree::RecursiveDelete: should‚ot be called on„oot\n";

440 
ex™
(1);

442 
RecursiveD–‘eB¿nch
(
äom
);

443 
RecursiveD–‘eNode
(
äom
);

447 
ToSŒ—m
(
o¡»am
& 
os
) {

448 
	gNodeV®PŒT»e
<
	gDv¬
<
	gU
> >::
ToSŒ—m
(
os
,
this
->
G‘RoÙ
());

449 
	gos
 << '\n';

450 
	gB¿nchV®PŒT»e
<
	gDv¬
<
	gV
> >::
ToSŒ—m
(
os
,
this
->
G‘RoÙ
());

453 
ä›nd
 
	go¡»am
& 
	gİ”©Ü
<<(o¡»am& 
	gos
, 
	gNodeB¿nchV®PŒT»e
<
	gDv¬
<
	gU
> ,Dv¬<
	gV
> >& 
	gb
) {

454 
	gb
.
ToSŒ—m
(
os
);

455  
	gos
;

458 
FromSŒ—m
(
i¡»am
& 
is
) {

459 
	gNodeV®PŒT»e
<
	gDv¬
<
	gU
> >::
FromSŒ—m
(
is
,
this
->
G‘RoÙ
());

460 
	gB¿nchV®PŒT»e
<
	gDv¬
<
	gV
> >::
FromSŒ—m
(
is
,
this
->
G‘RoÙ
());

463 
ä›nd
 
	gi¡»am
& 
	gİ”©Ü
>>(i¡»am& 
	gis
, 
	gNodeB¿nchV®PŒT»e
<
	gDv¬
<
	gU
> ,Dv¬<
	gV
> >& 
	gb
) {

464 
	gb
.
FromSŒ—m
(
is
);

465  
	gis
;

	@Var.h

2 #iâdeà
VAR_H


3 
	#VAR_H


	)

5 
	~"DAGnode.h
"

7 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gV¬
 : 
public
 
vœtu®
 
DAGnode
 ,…ublic T{

9 
	gpublic
:

11 
V¬
() {}

13 
V¬
(cÚ¡ 
T
& 
äom
è: T(äomè, 
bkv®ue
(from) {}

15 
	gvœtu®
 ~
V¬
() {}

17 
	gV¬
& 
	gİ”©Ü
=(cÚ¡ 
T
& 
äom
) {

18  
T
::
İ”©Ü
=(
äom
);

21 
loÿlcÜru±
(
boŞ
 
bk
) {

22 ià(
	gbk
) {

23 
	gthis
->
	gbkv®ue
 = *
this
;

27 
loÿÌe¡Üe
() {

28 
	gT
::
İ”©Ü
=(
bkv®ue
);

32 cÚ¡ 
	gT
& 
v®
(è{ *
	gthis
;}

37 
£tv®
(cÚ¡ 
T
& 
šv®
è{
	gT
::
İ”©Ü
=(inval);}

39 
vœtu®
 
Regi¡”
(
DAGnode
* 
š
) {

40 
	gDAGnode
::
Regi¡”
(
š
);

43 
	g´Ùeùed
:

45 
T
 
bkv®ue
;

48 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gRv¬
 : 
public
 
V¬
<
T
>,…ubliø
	gRnode
 {

50 
	gpublic
:

52 
Rv¬
() {}

54 
Rv¬
(cÚ¡ 
T
& 
äom
è: 
V¬
<T>(from) {}

56 
vœtu®
 
Prİo£Move
(
tunšg
) {

57  
T
::
Prİo£Move
(
tunšg
);

60 
CÏmpAt
(cÚ¡ 
T
& 
šv®
) {

61 
	gT
::
İ”©Ü
=(
šv®
);

62 
CÏmp
();

65 
vœtu®
 
CÜru±
(
boŞ
 
bk
) {

66 
	gV¬
<
	gT
>::
loÿlcÜru±
(
bk
);

67 
	gRnode
::
CÜru±
(
bk
);

70 
vœtu®
 
Re¡Üe
() {

71 
	gV¬
<
	gT
>::
loÿÌe¡Üe
();

72 
	gRnode
::
Re¡Üe
();

75 
Re¡ÜeBackup
() {

76 
	gV¬
<
	gT
>::
loÿÌe¡Üe
();

82 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gDv¬
 : 
public
 
V¬
<
T
>,…ubliø
	gDnode
 {

84 
	gpublic
:

86 
Dv¬
() {}

88 
Dv¬
(cÚ¡ 
T
& 
äom
è: 
V¬
<T>(from) {}

90 
loÿlCÜru±
(
boŞ
 
bk
) {

91 
V¬
<
T
>::
loÿlcÜru±
(
bk
);

92 
	gDnode
::
loÿlCÜru±
(
bk
);

95 
loÿlRe¡Üe
() {

96 
	gV¬
<
	gT
>::
loÿÌe¡Üe
();

97 
	gDnode
::
loÿlRe¡Üe
();

101 cÚ¡ 
	gT
& 
v®
() {

102 ià(! 
isUpd©ed
()) {

103 ià(! 
	gDAGnode
::
š™mode
) {

104 
û¼
 << "error : corrupting Dvar\n";

106 
loÿlUpd©e
();

108  (*
	gthis
);

113 
	g‹m¶©e
 <
şass
 
	gT
> cÏs 
	gCÚ¡
 : 
public
 
Dv¬
<
T
> {

115 
public
:

117 
CÚ¡
(cÚ¡ 
T
& 
äom
è: 
Dv¬
<T>(from) {}

119 
¥ecŸlUpd©e
() {}

123 
	g‹m¶©e
<> 
şass
 
	gRv¬
<> : 
public
 
vœtu®
 
Rnode
 {};

124 
	g‹m¶©e
<> 
şass
 
	gDv¬
<> : 
public
 
vœtu®
 
Dnode
 {};

	@fmath.hpp

1 #iâdeà
MIE_FMATH_HPP_


2 
	#MIE_FMATH_HPP_


	)

25 #ià
defšed
(
_MSC_VER
) && (_MSC_VER >= 1600)

26 
	#FMATH_USE_AVX


	)

29 
	~<m©h.h
>

30 
	~<as£¹.h
>

31 
	~<lim™s
>

32 
	~<¡dlib.h
>

33 
	~<æßt.h
>

34 #ià
defšed
(
_WIN32
è&& !defšed(
__GNUC__
)

35 
	~<šŒš.h
>

36 #iâdeà
MIE_ALIGN


37 
	#MIE_ALIGN
(
x
è
	`__deş¥ec
(
	`®ign
(x))

	)

40 #iâdeà
__GNUC_PREREQ


41 
	#__GNUC_PREREQ
(
majÜ
, 
mšÜ
è((((
__GNUC__
è<< 16è+ (
__GNUC_MINOR__
)è>ğ(((majÜè<< 16è+ (mšÜ)))

	)

43 #ià
__GNUC_PREREQ
(4, 4è|| !
defšed
(
__GNUC__
)

45 
	~<x86šŒš.h
>

46 #–ià
__GNUC_PREREQ
(4, 1)

48 
	~<emmšŒš.h
>

50 #iâdeà
MIE_ALIGN


51 
	#MIE_ALIGN
(
x
è
	`__©Œibu‹__
((
	`®igÃd
(x)))

	)

54 #iâdeà
MIE_PACK


55 
	#MIE_PACK
(
x
, 
y
, 
z
, 
w
è((xè* 64 + (yè* 16 + (zè* 4 + (w))

	)

57 #ifdeà
FMATH_USE_XBYAK


58 
	~"xbyak/xbyak.h
"

59 
	~"xbyak/xbyak_ut.h
"

62 #ifdeà
DEBUG


63 
šlše
 
	$put
(cÚ¡ *
p
)

65 cÚ¡ *
f
 = (cÚ¡ *)
p
;

66 
	`´štf
("{%e, %e, %e, %e}\n", 
f
[0], f[1], f[2], f[3]);

67 
	}
}

68 
šlše
 
	$puti
(cÚ¡ *
p
)

70 cÚ¡ *
i
 = (cÚ¡ *)
p
;

71 
	`´štf
("{%d, %d, %d, %d}\n", 
i
[0], i[1], i[2], i[3]);

72 
	`´štf
("{%x, %x, %x, %x}\n", 
i
[0], i[1], i[2], i[3]);

73 
	}
}

76 
Çme¥aû
 
	gfm©h
 {

78 
Çme¥aû
 
	gloÿl
 {

80 cÚ¡ 
size_t
 
	gEXP_TABLE_SIZE
 = 10;

81 cÚ¡ 
size_t
 
	gEXPD_TABLE_SIZE
 = 11;

82 cÚ¡ 
size_t
 
	gLOG_TABLE_SIZE
 = 12;

84 
	tušt64_t
;

86 
	ufi
 {

87 
	gf
;

88 
	gi
;

91 
	udi
 {

92 
	gd
;

93 
ušt64_t
 
	gi
;

96 
šlše
 
mask
(
x
)

98  (1U << 
	gx
) - 1;

101 
šlše
 
ušt64_t
 
mask64
(
x
)

103  (1ULL << 
	gx
) - 1;

106 
	g‹m¶©e
<
şass
 
	gT
, 
size_t
 
	gN
>

107 
size_t
 
NumOfA¼ay
(cÚ¡ 
T
 (&)[
N
]è{  
	gN
; }

109 
	#FMATH_OFFSET_OF
(
£lf
, 
x
è
	`size_t
((cÚ¡ *)(&£lf->xè- (cÚ¡ *)£lf)

	)

116 
	g‹m¶©e
<
size_t
 
	gN
 = 
EXP_TABLE_SIZE
>

117 
	sExpV¬
 {

119 
s
 = 
N
,

120 
	gn
 = 1 << 
s
,

121 
	gf88
 = 0x42b00000

123 
	gmšX
[4];

124 
	gmaxX
[4];

125 
	ga
[4];

126 
	gb
[4];

127 
	gf1
[4];

128 
	gi127s
[4];

129 
	gmask_s
[4];

130 
	gi7fffffff
[4];

131 
	gtbl
[
n
];

132 
ExpV¬
()

134 
	glog_2
 = ::
logf
(2.0f);

135 
	gi
 = 0; i < 4; i++) {

136 
	gmaxX
[
i
] = 88;

137 
	gmšX
[
i
] = -88;

138 
	ga
[
i
] = 
n
 / 
log_2
;

139 
	gb
[
i
] = 
log_2
 / 
n
;

140 
	gf1
[
i
] = 1.0f;

141 
	gi127s
[
i
] = 127 << 
s
;

142 
	gi7fffffff
[
i
] = 0x7fffffff;

143 
	gmask_s
[
i
] = 
mask
(
s
);

146 
	gi
 = 0; i < 
	gn
; i++) {

147 
	gy
 = 
pow
(2, ()
i
 / 
n
);

148 
fi
 
	gfi
;

149 
	gfi
.
	gf
 = 
y
;

150 
	gtbl
[
i
] = 
fi
.˜& 
mask
(23);

155 
	g‹m¶©e
<
size_t
 
	gsb™_
 = 
EXPD_TABLE_SIZE
>

156 
	sExpdV¬
 {

158 
sb™
 = 
sb™_
,

159 
	gs
 = 1UL << 
sb™
,

160 
	gadj
 = (1UL << (
sb™
 + 10)) - (1UL << sbit)

165 
	gC1
[2];

166 
	gC2
[2];

167 
	gC3
[2];

168 
ušt64_t
 
	gtbl
[
s
];

169 cÚ¡ 
	ga
;

170 cÚ¡ 
	g¿
;

171 
ExpdV¬
()

172 : 
a
(
s
 / ::
log
(2.0))

173 , 
¿
(1 / 
a
)

175 
	gi
 = 0; i < 2; i++) {

179 
	gC1
[
i
] = 0.999999999999999997071;

180 
	gC2
[
i
] = 0.166666666852278350641;

181 
	gC3
[
i
] = 3.000000002795539238619;

183 
	gC1
[
i
] = 1.0;

184 
	gC2
[
i
] = 0.16666666685227835064;

185 
	gC3
[
i
] = 3.0000000027955394;

188 
	gi
 = 0; i < 
	gs
; i++) {

189 
di
 
	gdi
;

190 
	gdi
.
	gd
 = ::
pow
(2.0, 
i
 * (1.0 / 
s
));

191 
	gtbl
[
i
] = 
di
.˜& 
mask64
(52);

196 
	g‹m¶©e
<
size_t
 
	gN
 = 
LOG_TABLE_SIZE
>

197 
	sLogV¬
 {

199 
LEN
 = 
N
 - 1

201 
	gm1
[4];

202 
	gm2
[4];

203 
	gm3
[4];

204 
	gm4
[4];

205 
	gm5
[4];

207 
	g­p
;

208 
	g»v
;

209 } 
	gtbl
[1 << 
LEN
];

210 
	gc_log2
;

211 
LogV¬
()

212 : 
c_log2
(::
logf
(2.0f) / (1 << 23))

214 cÚ¡ 
e
 = 1 / (1 << 24);

215 cÚ¡ 
	gh
 = 1 / (1 << 
LEN
);

216 cÚ¡ 
size_t
 
	gn
 = 1U << 
LEN
;

217 
size_t
 
	gi
 = 0; i < 
	gn
; i++) {

218 
	gx
 = 1 + (
i
è/ 
n
;

219 
	ga
 = ::
log
(
x
);

220 
	gtbl
[
i
].
	g­p
 = ()
a
;

221 ià(
	gi
 < 
	gn
 - 1) {

222 
	gb
 = ::
log
(
x
 + 
h
 - 
e
);

223 
	gtbl
[
i
].
	g»v
 = ()((
b
 - 
a
è/ ((
h
 - 
e
) * (1 << 23)));

225 
	gtbl
[
i
].
	g»v
 = ()(1 / (
x
 * (1 << 23)));

228 
	gi
 = 0; i < 4; i++) {

229 
	gm1
[
i
] = 
mask
(8) << 23;

230 
	gm2
[
i
] = 
mask
(
LEN
) << (23 - LEN);

231 
	gm3
[
i
] = 
mask
(23 - 
LEN
);

232 
	gm4
[
i
] = 
c_log2
;

233 
	gm5
[
i
] = 127U << 23;

238 #ifdeà
FMATH_USE_XBYAK


239 
	gExpCode
 : 
public
 
Xbyak
::
CodeG’”©Ü
 {

240 (*
exp_
)();

241 
__m128
 (*
exp_ps_
)(
	g__m128
);

242 #ifdeà
FMATH_USE_AVX


243 
__m256
 (*
exp_ps256_
)(
	g__m256
);

245 
	g‹m¶©e
<
size_t
 
	gN
>

246 
ExpCode
(cÚ¡ 
ExpV¬
<
N
> *
£lf
)

248 
	gXbyak
::
ut
::
Cpu
 
ıu
;

249 
	gŒy
 {

250 
makeExp
(
£lf
, 
ıu
);

251 
	gexp_
 = ((*)())
g‘Code
();

252 
®ign
(16);

253 
	gexp_ps_
 = (
__m128
(*)(__m128))
g‘Cu¼
();

254 
makeExpPs
(
£lf
, 
ıu
);

255 #ifdeà
FMATH_USE_AVX


256 
®ign
(16);

257 
	gexp_ps256_
 = (
__m256
(*)(__m256))
g‘Cu¼
();

258 
makeExpPs256
(
£lf
);

261 } 
ÿtch
 (
Xbyak
::
E¼Ü
 
”r
) {

262 
årštf
(
¡d”r
, "ExpCodERR:%s(%d)\n", 
Xbyak
::
CÚv”tE¼ÜToSŒšg
(
”r
),ƒrr);

263 } 
ÿtch
 (...) {

264 
årštf
(
¡d”r
, "ExpCode ERR:unknownƒrror\n");

266 ::
ex™
(1);

268 
	g‹m¶©e
<
size_t
 
	gN
>

269 
makeExp
(cÚ¡ 
ExpV¬
<
N
> *
£lf
, cÚ¡ 
Xbyak
::
ut
::
Cpu
& 
ıu
)

271 
usšg
 
Çme¥aû
 
loÿl
;

272 
usšg
 
Çme¥aû
 
	gXbyak
;

274 
šLoÿlLab–
();

275 #ifdeà
XBYAK64


276 cÚ¡ 
	gReg64
& 
	gba£
 = 
rcx
;

277 cÚ¡ 
	gReg64
& 
	ga
 = 
¿x
;

279 cÚ¡ 
	gReg32
& 
	gba£
 = 
ecx
;

280 cÚ¡ 
	gReg32
& 
	ga
 = 
—x
;

283 
mov
(
ba£
, (
size_t
)
£lf
);

285 ià(
	gıu
.
has
(
Xbyak
::
ut
::
Cpu
::
tAVX
)) {

286 #ifdeà
XBYAK32


287 
vmovss
(
xm0
, 
±r
 [
e¥
 + 4]);

289 
L
(".retry");

290 
vmovd
(
edx
, 
xm0
);

291 
vmulss
(
xm1
, 
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
a
)]);

292 
ªd
(
edx
, 0x7fffffff);

293 
vcvtss2si
(
—x
, 
xm1
);

294 
cmp
(
edx
, 
ExpV¬
<
N
>::
f88
);

295 
jg
(".overflow");

296 
Ëa
(
edx
, 
±r
 [
—x
 + (127 << 
£lf
->
s
)]);

297 
vcvtsi2ss
(
xm1
, 
—x
);

298 
ªd
(
—x
, 
mask
(
£lf
->
s
));

299 
mov
(
—x
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

300 
shr
(
edx
, 
£lf
->
s
);

301 
vmulss
(
xm1
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
b
)]);

302 
shl
(
edx
, 23);

303 
vsubss
(
xm0
, 
xm1
);

304 
Ü
(
—x
, 
edx
);

305 
vaddss
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
f1
)]);

306 
vmovd
(
xm1
, 
—x
);

307 
vmulss
(
xm0
, 
xm1
);

308 #ifdeà
XBYAK32


309 
vmovss
(
±r
[
e¥
 + 4], 
xm0
);

310 
æd
(
dwÜd
[
e¥
 + 4]);

312 
»t
();

313 
L
(".overflow");

314 
vmšss
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

315 
vmaxss
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mšX
)]);

316 
jmp
(".retry");

318 #ifdeà
XBYAK32


319 
movss
(
xm0
, 
±r
 [
e¥
 + 4]);

321 
L
(".retry");

322 
mov­s
(
xm1
, 
xm0
);

323 
movd
(
edx
, 
xm0
);

324 
mulss
(
xm1
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
a
)]);

325 
ªd
(
edx
, 0x7fffffff);

326 
cvtss2si
(
—x
, 
xm1
);

327 
cmp
(
edx
, 
ExpV¬
<
N
>::
f88
);

328 
jg
(".overflow");

329 
Ëa
(
edx
, 
±r
 [
—x
 + (127 << 
£lf
->
s
)]);

330 
cvtsi2ss
(
xm1
, 
—x
);

331 
ªd
(
—x
, 
mask
(
£lf
->
s
));

332 
mov
(
—x
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

333 
shr
(
edx
, 
£lf
->
s
);

334 
mulss
(
xm1
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
b
)]);

335 
shl
(
edx
, 23);

336 
subss
(
xm0
, 
xm1
);

337 
Ü
(
—x
, 
edx
);

338 
addss
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
f1
)]);

339 
movd
(
xm1
, 
—x
);

340 
mulss
(
xm0
, 
xm1
);

341 #ifdeà
XBYAK32


342 
movss
(
±r
[
e¥
 + 4], 
xm0
);

343 
æd
(
dwÜd
[
e¥
 + 4]);

345 
»t
();

346 
L
(".overflow");

347 
mšss
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

348 
maxss
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mšX
)]);

349 
jmp
(".retry");

351 
outLoÿlLab–
();

353 
	g‹m¶©e
<
size_t
 
	gN
>

354 
makeExpPs
(cÚ¡ 
ExpV¬
<
N
> *
£lf
, cÚ¡ 
Xbyak
::
ut
::
Cpu
& 
ıu
)

356 
usšg
 
Çme¥aû
 
loÿl
;

357 
usšg
 
Çme¥aû
 
	gXbyak
;

359 
šLoÿlLab–
();

360 #ifdeà
XBYAK64


361 cÚ¡ 
	gReg64
& 
	gba£
 = 
rcx
;

362 cÚ¡ 
	gReg64
& 
	ga
 = 
¿x
;

363 cÚ¡ 
	gReg64
& 
	gd
 = 
rdx
;

365 cÚ¡ 
	gReg32
& 
	gba£
 = 
ecx
;

366 cÚ¡ 
	gReg32
& 
	ga
 = 
—x
;

367 cÚ¡ 
	gReg32
& 
	gd
 = 
edx
;

374 ià(
	gıu
.
has
(
Xbyak
::
ut
::
Cpu
::
tAVX
)) {

375 #ià
defšed
(
XBYAK64_WIN
è&& !defšed(
__INTEL_COMPILER
)

376 
vmov­s
(
xm0
, 
±r
 [
rcx
]);

378 
mov
(
ba£
, (
size_t
)
£lf
);

379 
L
(".retry");

380 
vªdps
(
xm5
, 
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
i7fffffff
)]);

381 
vmuÍs
(
xm3
, 
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
a
)]);

382 
vpcmpgtd
(
xm5
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

383 
vcvs2dq
(
xm2
, 
xm3
);

384 
vpmovmskb
(
—x
, 
xm5
);

385 
v·nd
(
xm5
, 
xm2
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mask_s
)]);

386 
vcvtdq2ps
(
xm3
, 
xm2
);

387 
‹¡
(
—x
,ƒax);

388 
jnz
(".overflow");

389 
v·ddd
(
xm1
, 
xm2
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
i127s
)]);

390 
vmovd
(
—x
, 
xm5
);

391 
vmuÍs
(
xm4
, 
xm3
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
b
)]);

392 
v³xŒw
(
edx
, 
xm5
, 2);

393 
vsubps
(
xm0
, 
xm4
);

394 
vmovd
(
xm4
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

395 
vaddps
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
f1
)]);

396 
v³xŒw
(
—x
, 
xm5
, 4);

397 
vpš¤d
(
xm4
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 1);

398 
v³xŒw
(
edx
, 
xm5
, 6);

399 
vp¤ld
(
xm1
, 
£lf
->
s
);

400 
vp¦ld
(
xm1
, 23);

401 
vpš¤d
(
xm4
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 2);

402 
vpš¤d
(
xm4
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 3);

403 
vpÜ
(
xm1
, 
xm4
);

404 
vmuÍs
(
xm0
, 
xm1
);

405 
»t
();

406 
L
(".overflow");

407 
vmšps
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

408 
vmaxps
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mšX
)]);

409 
jmp
(".retry");

411 cÚ¡ 
boŞ
 
	gu£SSE41
 = 
ıu
.
has
(
Xbyak
::
ut
::
Cpu
::
tSSE41
);

412 #ià
defšed
(
XBYAK64_WIN
è&& !defšed(
__INTEL_COMPILER
)

413 
mov­s
(
xm0
, 
±r
 [
rcx
]);

415 
mov
(
ba£
, (
size_t
)
£lf
);

416 
L
(".retry");

417 
mov­s
(
xm5
, 
xm0
);

418 
ªdps
(
xm5
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
i7fffffff
)]);

419 
mov­s
(
xm3
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
a
)]);

420 
mov­s
(
xm4
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
b
)]);

421 
pcmpgtd
(
xm5
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

422 
muÍs
(
xm3
, 
xm0
);

423 
mov­s
(
xm1
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
i127s
)]);

424 
pmovmskb
(
—x
, 
xm5
);

425 
mov­s
(
xm5
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mask_s
)]);

426 
cvs2dq
(
xm2
, 
xm3
);

427 
·nd
(
xm5
, 
xm2
);

428 
cvtdq2ps
(
xm3
, 
xm2
);

429 
‹¡
(
—x
,ƒax);

430 
jnz
(".overflow");

431 
·ddd
(
xm1
, 
xm2
);

432 
movd
(
—x
, 
xm5
);

433 
muÍs
(
xm4
, 
xm3
);

434 
³xŒw
(
edx
, 
xm5
, 2);

435 
subps
(
xm0
, 
xm4
);

436 
movd
(
xm4
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

437 
addps
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
f1
)]);

438 
³xŒw
(
—x
, 
xm5
, 4);

439 ià(
	gu£SSE41
) {

440 
pš¤d
(
xm4
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 1);

442 
movd
(
xm3
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

443 
movlhps
(
xm4
, 
xm3
);

445 
³xŒw
(
edx
, 
xm5
, 6);

446 
p¤ld
(
xm1
, 
£lf
->
s
);

447 
p¦ld
(
xm1
, 23);

448 ià(
	gu£SSE41
) {

449 
pš¤d
(
xm4
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 2);

450 
pš¤d
(
xm4
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 3);

452 
movd
(
xm2
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

453 
movd
(
xm3
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

454 
movlhps
(
xm2
, 
xm3
);

455 
shuås
(
xm4
, 
xm2
, 
MIE_PACK
(2, 0, 2, 0));

457 
pÜ
(
xm1
, 
xm4
);

458 
muÍs
(
xm0
, 
xm1
);

459 
»t
();

460 
L
(".overflow");

461 
mšps
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

462 
maxps
(
xm0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mšX
)]);

463 
jmp
(".retry");

465 
outLoÿlLab–
();

467 
	g‹m¶©e
<
size_t
 
	gN
>

468 
makeExpPs256
(cÚ¡ 
ExpV¬
<
N
> *
£lf
)

471 
usšg
 
Çme¥aû
 
	gloÿl
;

472 
usšg
 
Çme¥aû
 
	gXbyak
;

474 
šLoÿlLab–
();

475 #ifdeà
XBYAK64


476 cÚ¡ 
	gReg64
& 
	gba£
 = 
rcx
;

477 cÚ¡ 
	gReg64
& 
	ga
 = 
¿x
;

478 cÚ¡ 
	gReg64
& 
	gd
 = 
rdx
;

479 #ià
defšed
(
XBYAK64_WIN
è&& !defšed(
__INTEL_COMPILER
)

480 
vmov­s
(
ym0
, 
±r
 [
rcx
]);

483 cÚ¡ 
	gReg32
& 
	gba£
 = 
ecx
;

484 cÚ¡ 
	gReg32
& 
	ga
 = 
—x
;

485 cÚ¡ 
	gReg32
& 
	gd
 = 
edx
;

487 
mov
(
ba£
, (
size_t
)
£lf
);

493 
L
(".retry");

494 
vªdps
(
ym5
, 
ym0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
i7fffffff
)]);

495 
vmuÍs
(
ym3
, 
ym0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
a
)]);

496 
vcmpgs
(
ym5
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

497 
vmov­s
(
ym1
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
i127s
)]);

498 
vpmovmskb
(
—x
, 
xm5
);

499 
v³rm2f128
(
ym5
, ym5, ym5, 1);

500 
vpmovmskb
(
edx
, 
xm5
);

501 
shl
(
edx
, 16);

502 
add
(
—x
, 
edx
);

503 
vcvs2dq
(
ym2
, 
ym3
);

504 
vªdps
(
ym5
, 
ym2
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mask_s
)]);

505 
‹¡
(
—x
,ƒax);

506 
jnz
(".overflow");

507 
v³rm2f128
(
ym3
, 
ym1
, ym1, 1);

508 
v³rm2f128
(
ym4
, 
ym2
, ym2, 1);

509 
v·ddd
(
xm4
, 
xm3
);

510 
v·ddd
(
xm3
, 
xm1
, 
xm2
);

511 
v³rm2f128
(
ym4
, 
ym3
, ym4, 2 << 4);

512 
vcvtdq2ps
(
ym3
, 
ym2
);

513 
vmuÍs
(
ym4
, 
ym3
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
b
)]);

515 
vmovd
(
—x
, 
xm5
);

516 
v³xŒw
(
edx
, 
ym5
, 2);

517 
vsubps
(
ym0
, 
ym4
);

518 
vmovd
(
xm4
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)]);

519 
vaddps
(
ym0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
f1
)]);

520 
v³xŒw
(
—x
, 
ym5
, 4);

521 
vpš¤d
(
ym4
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 1);

522 
v³xŒw
(
edx
, 
ym5
, 6);

523 
vp¤ld
(
xm1
, 
£lf
->
s
);

524 
vp¦ld
(
xm1
, 23);

525 
vpš¤d
(
xm4
, 
±r
 [
ba£
 + 
a
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 2);

526 
vpš¤d
(
xm4
, 
±r
 [
ba£
 + 
d
 * 4 + 
FMATH_OFFSET_OF
(
£lf
, 
tbl
)], 3);

527 
vpÜ
(
ym1
, 
ym4
);

528 
vmuÍs
(
ym0
, 
ym1
);

529 
»t
();

530 
L
(".overflow");

531 
vmšps
(
ym0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
maxX
)]);

532 
vmaxps
(
ym0
, 
±r
 [
ba£
 + 
FMATH_OFFSET_OF
(
£lf
, 
mšX
)]);

533 
jmp
(".retry");

534 
outLoÿlLab–
();

541 
	g‹m¶©e
<
size_t
 
	gEXP_N
 = 
EXP_TABLE_SIZE
, size_ˆ
	gLOG_N
 = 
LOG_TABLE_SIZE
, size_ˆ
	gEXPD_N
 = 
EXPD_TABLE_SIZE
>

542 
	sC
 {

543 cÚ¡ 
ExpV¬
<
EXP_N
> 
expV¬
;

544 cÚ¡ 
	gLogV¬
<
	gLOG_N
> 
	glogV¬
;

545 cÚ¡ 
	gExpdV¬
<
	gEXPD_N
> 
	gexpdV¬
;

546 #ifdeà
FMATH_USE_XBYAK


547 cÚ¡ 
	gExpCode
& 
g‘In¡ªû
() {

548 cÚ¡ 
ExpCode
 
expCode
(&
expV¬
);

549  
	gexpCode
;

554 
	g‹m¶©e
<
size_t
 
	gEXP_N
, size_ˆ
	gLOG_N
, size_ˆ
	gEXPD_N
>

555 
MIE_ALIGN
(16ècÚ¡ 
	gExpV¬
<
	gEXP_N
> 
	gC
<EXP_N, 
	gLOG_N
, 
	gEXPD_N
>::
expV¬
;

557 
	g‹m¶©e
<
size_t
 
	gEXP_N
, size_ˆ
	gLOG_N
, size_ˆ
	gEXPD_N
>

558 
MIE_ALIGN
(16ècÚ¡ 
	gLogV¬
<
	gLOG_N
> 
	gC
<
	gEXP_N
, LOG_N, 
	gEXPD_N
>::
logV¬
;

560 
	g‹m¶©e
<
size_t
 
	gEXP_N
, size_ˆ
	gLOG_N
, size_ˆ
	gEXPD_N
>

561 
MIE_ALIGN
(16ècÚ¡ 
	gExpdV¬
<
	gEXPD_N
> 
	gC
<
	gEXP_N
, 
	gLOG_N
, EXPD_N>::
expdV¬
;

565 #ifdeà
FMATH_USE_XBYAK


566 
šlše
 
expC
(
x
)

568 
šlše
 
exp
(
x
)

571 
usšg
 
Çme¥aû
 
	gloÿl
;

572 cÚ¡ 
	gExpV¬
<>& 
	gexpV¬
 = 
C
<>::
expV¬
;

575 
__m128
 
	gx1
 = 
_mm_£t_ss
(
x
);

577 
	glim™
 = 
_mm_cvtss_si32
(
x1
) & 0x7fffffff;

578 ià(
	glim™
 > 
	gExpV¬
<>::
f88
) {

579 
x1
 = 
_mm_mš_ss
(x1, 
_mm_lßd_ss
(
expV¬
.
maxX
));

580 
	gx1
 = 
_mm_max_ss
(
x1
, 
_mm_lßd_ss
(
expV¬
.
mšX
));

583 
	gr
 = 
_mm_cvtss_si32
(
_mm_mul_ss
(
x1
, 
_mm_lßd_ss
(
expV¬
.
a
)));

584 
	gv
 = 
r
 & 
mask
(
expV¬
.
s
);

585 
	gt
 = 
_mm_cvtss_f32
(
x1
è- 
r
 * 
expV¬
.
b
[0];

586 
	gu
 = 
r
 >> 
expV¬
.
s
;

587 
fi
 
	gfi
;

588 
	gfi
.
	gi
 = ((
u
 + 127è<< 23è| 
expV¬
.
tbl
[
v
];

589  (1 + 
	gt
è* 
	gfi
.
	gf
;

591 
	gx
 = 
¡d
::
mš
(
x
, 
expV¬
.
maxX
[0]);

592 
	gx
 = 
¡d
::
max
(
x
, 
expV¬
.
mšX
[0]);

593 
	gt
 = 
x
 * 
expV¬
.
a
[0];

594 cÚ¡ 
	gmagic
 = (1 << 23) + (1 << 22);

595 
	gt
 +ğ
magic
;

596 
fi
 
	gfi
;

597 
	gfi
.
	gf
 = 
t
;

598 
	gt
 = 
x
 - (
t
 - 
magic
è* 
expV¬
.
b
[0];

599 
	gu
 = ((
fi
.
i
 + (127 << 
expV¬
.
s
)) >>ƒxpVar.s) << 23;

600 
	gv
 = 
fi
.
i
 & 
mask
(
expV¬
.
s
);

601 
	gfi
.
	gi
 = 
u
 | 
expV¬
.
tbl
[
v
];

602  (1 + 
	gt
è* 
	gfi
.
	gf
;

610 
šlše
 
expd
(
x
)

612 
usšg
 
Çme¥aû
 
	gloÿl
;

613 cÚ¡ 
	gExpdV¬
<>& 
	gc
 = 
C
<>::
expdV¬
;

614 cÚ¡ 
ušt64_t
 
	gb
 = 3ULL << 51;

615 
di
 
	gdi
;

616 
	gdi
.
	gd
 = 
x
 * 
c
.
a
 + 
b
;

617 
ušt64_t
 
	gŸx
 = 
c
.
tbl
[
di
.
i
 & 
mask
(c.
sb™
)];

619 
	gt
 = (
di
.
d
 - 
b
è* 
c
.
¿
 - 
x
;

620 
ušt64_t
 
	gu
 = ((
di
.
i
 + 
c
.
adj
è>> c.
sb™
) << 52;

621 
	gy
 = (
c
.
C3
[0] - 
t
è* (ˆ*è* c.
C2
[0] - + c.
C1
[0];

624 
	gdi
.
	gi
 = 
u
 | 
Ÿx
;

625  
y
 * 
	gdi
.
	gd
;

628 
šlše
 
expd_v
(*
px
, 
n
)

630 
usšg
 
Çme¥aû
 
	gloÿl
;

631 cÚ¡ 
	gExpdV¬
<>& 
	gc
 = 
C
<>::
expdV¬
;

632 cÚ¡ 
ušt64_t
 
	gb
 = 3ULL << 51;

633 
as£¹
((
n
 % 2) == 0);

634 cÚ¡ 
__m128d
 
	gmC1
 = *(cÚ¡ __m128d*)
c
.
C1
;

635 cÚ¡ 
__m128d
 
	gmC2
 = *(cÚ¡ __m128d*)
c
.
C2
;

636 cÚ¡ 
__m128d
 
	gmC3
 = *(cÚ¡ __m128d*)
c
.
C3
;

637 cÚ¡ 
__m128d
 
	gma
 = 
_mm_£t1_pd
(
c
.
a
);

638 cÚ¡ 
__m128d
 
	gm¿
 = 
_mm_£t1_pd
(
c
.
¿
);

639 cÚ¡ 
__m128i
 
	gmadj
 = 
_mm_£t1_•i32
(
c
.
adj
);

640 
	gi
 = 0; i < ()
	gn
; i += 2) {

641 
__m128d
 
x
 = 
_mm_lßd_pd
(
px
);

643 
__m128d
 
	gd
 = 
_mm_mul_pd
(
x
, 
ma
);

644 
	gd
 = 
_mm_add_pd
(
d
, 
_mm_£t1_pd
(
b
));

645 
	gadr0
 = 
_mm_cvtsi128_si32
(
_mm_ÿ¡pd_si128
(
d
)è& 
mask
(
c
.
sb™
);

646 
	gadr1
 = 
_mm_cvtsi128_si32
(
_mm_¤li_si128
(
_mm_ÿ¡pd_si128
(
d
), 8)è& 
mask
(
c
.
sb™
);

648 
__m128i
 
	gŸxL
 = 
_mm_ÿ¡pd_si128
(
_mm_lßd_sd
((cÚ¡ *)&
c
.
tbl
[
adr0
]));

649 
__m128i
 
	gŸx
 = 
_mm_ÿ¡pd_si128
(
_mm_lßd_sd
((cÚ¡ *)&
c
.
tbl
[
adr1
]));

650 
	gŸx
 = 
_mm_uÅacklo_•i64
(
ŸxL
, 
Ÿx
);

652 
__m128d
 
	gt
 = 
_mm_sub_pd
(
_mm_mul_pd
(_mm_sub_pd(
d
, 
_mm_£t1_pd
(
b
)), 
m¿
), 
x
);

653 
__m128i
 
	gu
 = 
_mm_ÿ¡pd_si128
(
d
);

654 
	gu
 = 
_mm_add_•i64
(
u
, 
madj
);

655 
	gu
 = 
_mm_¤li_•i64
(
u
, 
c
.
sb™
);

656 
	gu
 = 
_mm_¦li_•i64
(
u
, 52);

657 
	gu
 = 
_mm_Ü_si128
(
u
, 
Ÿx
);

658 
__m128d
 
	gy
 = 
_mm_mul_pd
(
_mm_sub_pd
(
mC3
, 
t
), _mm_mul_pd(t,));

659 
	gy
 = 
_mm_mul_pd
(
y
, 
mC2
);

660 
	gy
 = 
_mm_add_pd
(
_mm_sub_pd
(
y
, 
t
), 
mC1
);

661 
_mm_¡Üe_pd
(
px
, 
_mm_mul_pd
(
y
, 
_mm_ÿ¡si128_pd
(
u
)));

662 
	gpx
 += 2;

666 #ifdeà
FMATH_USE_XBYAK


667 
šlše
 
__m128
 
exp_psC
(__m128 
x
)

669 
šlše
 
__m128
 
exp_ps
(__m128 
x
)

672 
usšg
 
Çme¥aû
 
	gloÿl
;

673 cÚ¡ 
	gExpV¬
<>& 
	gexpV¬
 = 
C
<>::
expV¬
;

675 
__m128i
 
	glim™
 = 
_mm_ÿ¡ps_si128
(
_mm_ªd_ps
(
x
, *(cÚ¡ 
__m128
*)
expV¬
.
i7fffffff
));

676 
	gov”
 = 
_mm_movemask_•i8
(
_mm_cmpgt_•i32
(
lim™
, *(cÚ¡ 
__m128i
*)
expV¬
.
maxX
));

677 ià(
	gov”
) {

678 
	gx
 = 
_mm_mš_ps
(
x
, 
_mm_lßd_ps
(
expV¬
.
maxX
));

679 
	gx
 = 
_mm_max_ps
(
x
, 
_mm_lßd_ps
(
expV¬
.
mšX
));

682 
__m128i
 
	gr
 = 
_mm_cvs_•i32
(
_mm_mul_ps
(
x
, *(cÚ¡ 
__m128
*)
expV¬
.
a
));

683 
__m128
 
	gt
 = 
_mm_sub_ps
(
x
, 
_mm_mul_ps
(
_mm_cv‹pi32_ps
(
r
), *(cÚ¡ __m128*)
expV¬
.
b
));

684 
	gt
 = 
_mm_add_ps
(
t
, *(cÚ¡ 
__m128
*)
expV¬
.
f1
);

686 
__m128i
 
	gv4
 = 
_mm_ªd_si128
(
r
, *(cÚ¡ __m128i*)
expV¬
.
mask_s
);

687 
__m128i
 
	gu4
 = 
_mm_add_•i32
(
r
, *(cÚ¡ __m128i*)
expV¬
.
i127s
);

688 
	gu4
 = 
_mm_¤li_•i32
(
u4
, 
expV¬
.
s
);

689 
	gu4
 = 
_mm_¦li_•i32
(
u4
, 23);

691 
	gv0
, 
	gv1
, 
	gv2
, 
	gv3
;

692 
	gv0
 = 
_mm_cvtsi128_si32
(
v4
);

693 
	gv1
 = 
_mm_exŒaù_•i16
(
v4
, 2);

694 
	gv2
 = 
_mm_exŒaù_•i16
(
v4
, 4);

695 
	gv3
 = 
_mm_exŒaù_•i16
(
v4
, 6);

697 
__m128
 
	gt0
, 
	gt1
, 
	gt2
, 
	gt3
;

700 
	gt0
 = 
_mm_ÿ¡si128_ps
(
_mm_£t1_•i32
(
expV¬
.
tbl
[
v0
]));

701 
	gt1
 = 
_mm_ÿ¡si128_ps
(
_mm_£t1_•i32
(
expV¬
.
tbl
[
v1
]));

702 
	gt2
 = 
_mm_ÿ¡si128_ps
(
_mm_£t1_•i32
(
expV¬
.
tbl
[
v2
]));

703 
	gt3
 = 
_mm_ÿ¡si128_ps
(
_mm_£t1_•i32
(
expV¬
.
tbl
[
v3
]));

705 
	gt0
 = 
_mm_£t_ss
(*(cÚ¡ *)&
expV¬
.
tbl
[
v0
]);

706 
	gt1
 = 
_mm_£t_ss
(*(cÚ¡ *)&
expV¬
.
tbl
[
v1
]);

707 
	gt2
 = 
_mm_£t_ss
(*(cÚ¡ *)&
expV¬
.
tbl
[
v2
]);

708 
	gt3
 = 
_mm_£t_ss
(*(cÚ¡ *)&
expV¬
.
tbl
[
v3
]);

711 
	gt1
 = 
_mm_mov–h_ps
(
t1
, 
t3
);

712 
	gt1
 = 
_mm_ÿ¡si128_ps
(
_mm_¦li_•i64
(
_mm_ÿ¡ps_si128
(
t1
), 32));

713 
	gt0
 = 
_mm_mov–h_ps
(
t0
, 
t2
);

714 
	gt0
 = 
_mm_Ü_ps
(
t0
, 
t1
);

716 
__m128i
 
	gti
 = 
_mm_ÿ¡ps_si128
(
_mm_lßd_ss
((cÚ¡ *)&
expV¬
.
tbl
[
v0
]));

717 
	gti
 = 
_mm_š£¹_•i32
(
ti
, 
expV¬
.
tbl
[
v1
], 1);

718 
	gti
 = 
_mm_š£¹_•i32
(
ti
, 
expV¬
.
tbl
[
v2
], 2);

719 
	gti
 = 
_mm_š£¹_•i32
(
ti
, 
expV¬
.
tbl
[
v3
], 3);

720 
__m128
 
	gt0
 = 
_mm_ÿ¡si128_ps
(
ti
);

722 
	gt0
 = 
_mm_Ü_ps
(
t0
, 
_mm_ÿ¡si128_ps
(
u4
));

724 
	gt
 = 
_mm_mul_ps
(
t
, 
t0
);

726  
	gt
;

729 
šlše
 
log
(
x
)

731 
usšg
 
Çme¥aû
 
	gloÿl
;

732 cÚ¡ 
	gLogV¬
<>& 
	glogV¬
 = 
C
<>::
logV¬
;

733 cÚ¡ 
size_t
 
	glogL’
 = 
logV¬
.
LEN
;

735 
fi
 
	gfi
;

736 
	gfi
.
	gf
 = 
x
;

737 
	ga
 = 
fi
.
i
 & (
mask
(8) << 23);

738 
	gb1
 = 
fi
.
i
 & (
mask
(
logL’
) << (23 -†ogLen));

739 
	gb2
 = 
fi
.
i
 & 
mask
(23 - 
logL’
);

740 
	gidx
 = 
b1
 >> (23 - 
logL’
);

741 
	gf
 = (
a
 - (127 << 23)è* 
logV¬
.
c_log2
 +†ogV¬.
tbl
[
idx
].
­p
 + (
b2
è*†ogV¬.tbl[idx].
»v
;

742  
	gf
;

745 
šlše
 
__m128
 
log_ps
(__m128 
x
)

747 
usšg
 
Çme¥aû
 
	gloÿl
;

748 cÚ¡ 
	gLogV¬
<>& 
	glogV¬
 = 
C
<>::
logV¬
;

750 
__m128i
 
	gxi
 = 
_mm_ÿ¡ps_si128
(
x
);

751 
__m128i
 
	gidx
 = 
_mm_¤li_•i32
(
_mm_ªd_si128
(
xi
, *(cÚ¡ __m128i*)
logV¬
.
m2
), (23 -†ogV¬.
LEN
));

752 
__m128
 
	ga
 = 
_mm_cv‹pi32_ps
(
_mm_sub_•i32
(
_mm_ªd_si128
(
xi
, *(cÚ¡ 
__m128i
*)
logV¬
.
m1
), *(cÚ¡ __m128i*îogV¬.
m5
));

753 
__m128
 
	gb2
 = 
_mm_cv‹pi32_ps
(
_mm_ªd_si128
(
xi
, *(cÚ¡ 
__m128i
*)
logV¬
.
m3
));

755 
	ga
 = 
_mm_mul_ps
(
a
, *(cÚ¡ 
__m128
*)
logV¬
.
m4
);

757 
	gi0
 = 
_mm_cvtsi128_si32
(
idx
);

760 
	gi1
 = 
_mm_exŒaù_•i16
(
idx
, 2);

761 
	gi2
 = 
_mm_exŒaù_•i16
(
idx
, 4);

762 
	gi3
 = 
_mm_exŒaù_•i16
(
idx
, 6);

764 
	gidx
 = 
_mm_¤li_si128
(
idx
, 4);

765 
	gi1
 = 
_mm_cvtsi128_si32
(
idx
);

767 
	gidx
 = 
_mm_¤li_si128
(
idx
, 4);

768 
	gi2
 = 
_mm_cvtsi128_si32
(
idx
);

770 
	gidx
 = 
_mm_¤li_si128
(
idx
, 4);

771 
	gi3
 = 
_mm_cvtsi128_si32
(
idx
);

774 
__m128
 
	g­p
, 
	g»v
;

775 
__m128i
 
	gL
 = 
_mm_lßdl_•i64
((cÚ¡ __m128˜*)&
logV¬
.
tbl
[
i0
].
­p
);

776 
__m128i
 
	gH
 = 
_mm_lßdl_•i64
((cÚ¡ __m128˜*)&
logV¬
.
tbl
[
i1
].
­p
);

777 
__m128
 
	gt
 = 
_mm_ÿ¡si128_ps
(
_mm_uÅacklo_•i64
(
L
, 
H
));

778 
	gL
 = 
_mm_lßdl_•i64
((cÚ¡ 
__m128i
 *)&
logV¬
.
tbl
[
i2
].
­p
);

779 
	gH
 = 
_mm_lßdl_•i64
((cÚ¡ 
__m128i
 *)&
logV¬
.
tbl
[
i3
].
­p
);

780 
	g»v
 = 
_mm_ÿ¡si128_ps
(
_mm_uÅacklo_•i64
(
L
, 
H
));

781 
	g­p
 = 
_mm_shufæe_ps
(
t
, 
»v
, 
MIE_PACK
(2, 0, 2, 0));

782 
	g»v
 = 
_mm_shufæe_ps
(
t
, 
»v
, 
MIE_PACK
(3, 1, 3, 1));

784 
	ga
 = 
_mm_add_ps
(
a
, 
­p
);

785 
	g»v
 = 
_mm_mul_ps
(
b2
, 
»v
);

786  
_mm_add_ps
(
a
, 
»v
);

789 #iâdeà
__CYGWIN__


792 
šlše
 
log2
(
x
è{  
	gfm©h
::
log
(x) * 1.442695f; }

799 şas 
	cPowG’”©Ü
 {

801 
	gN
 = 11

803 
	gtbl0_
[256];

805 
	g­p
;

806 
	g»v
;

807 } 
	gtbl1_
[1 << 
N
];

808 
	gpublic
:

809 
PowG’”©Ü
(
y
)

811 
i
 = 0; 
	gi
 < 256; i++) {

812 
	gtbl0_
[
i
] = ::
powf
(2, (˜- 127è* 
y
);

814 cÚ¡ 
	ge
 = 1 / (1 << 24);

815 cÚ¡ 
	gh
 = 1 / (1 << 
N
);

816 cÚ¡ 
size_t
 
	gn
 = 1U << 
N
;

817 
size_t
 
	gi
 = 0; i < 
	gn
; i++) {

818 
	gx
 = 1 + (
i
è/ 
n
;

819 
	ga
 = ::
pow
(
x
, ()
y
);

820 
	gtbl1_
[
i
].
	g­p
 = ()
a
;

821 
	gb
 = ::
pow
(
x
 + 
h
 - 
e
, ()
y
);

822 
	gtbl1_
[
i
].
	g»v
 = ()((
b
 - 
a
è/ (
h
 - 
e
) / (1 << 23));

825 
g‘
(
x
) const

827 
usšg
 
Çme¥aû
 
	gloÿl
;

828 
fi
 
	gfi
;

829 
	gfi
.
	gf
 = 
x
;

830 
	ga
 = (
fi
.
i
 >> 23è& 
mask
(8);

831 
	gb
 = 
fi
.
i
 & 
mask
(23);

832 
	gb1
 = 
b
 & (
mask
(
N
) << (23 - N));

833 
	gb2
 = 
b
 & 
mask
(23 - 
N
);

834 
	gf
;

835 
	gidx
 = 
b1
 >> (23 - 
N
);

836 
	gf
 = 
tbl0_
[
a
] * (
tbl1_
[
idx
].
­p
 + (
b2
è*bl1_[idx].
»v
);

837  
	gf
;

842 #ifdeà
FMATH_USE_XBYAK


843 (*cÚ¡ 
exp
)(èğ
loÿl
::
C
<>::
	`g‘In¡ªû
().
exp_
;

844 
	$__m128
 (*cÚ¡ 
exp_ps
)(
__m128
èğ
loÿl
::
C
<>::
	`g‘In¡ªû
().
exp_ps_
;

845 #ifdeà
FMATH_USE_AVX


851 
šlše
 
	$exp2
(
x
è{  
fm©h
::
	`exp
(x * 0.6931472f); 
	}
}

	@global.h

1 #iâdeà
GLOBAL_H


2 
	#GLOBAL_H


	)

4 
	~"fm©h.hµ
"

6 
	#MULTITHREADED


7 

	)

8 
	#SQRT2PI
 2.5066282746310002

	)

9 
	#SQRT2
 1.4142135623730951

	)

11 
šlše
 
	$ç¡Pow
(
a
, 
b
) {

13 
d
;

14 
x
[2];

15 } 
u
 = { 
a
 };

16 
u
.
x
[1] = ()(
b
 * (u.x[1] - 1072632447) + 1072632447);

17 
u
.
x
[0] = 0;

18  
u
.
d
;

19 
	}
}

21 
šlše
 
	$ç¡Log
(
a
) {

22  
fm©h
::
	`log
(
a
);

23 
	}
}

26 
	#LINEAR_INTERPOLATION


	)

30 
	#POW
(
a
,
b
è
	`ç¡Pow
×,b)

	)

34 
	#LOG
(
a
è
	`ç¡Log
×)

	)

	@linalg.cpp

2 
	~"lš®g.h
"

4 
	~<f¡»am
>

5 
	~<c¡dlib
>

6 
	~<cm©h
>

7 
	~<io¡»am
>

9 
usšg
 
Çme¥aû
 
	g¡d
;

11 
	gLšAlg
::
	$QR
(** 
u
, 
dim
, ** 
ql
, ** 
r
) {

13 * 
v
 = 
Ãw
 [
dim
];

14 * 
c
 = 
Ãw
 [
dim
];

16 ** 
a
 = 
r
;

17 
i
=0; i<
dim
; i++) {

18 
j
=0; j<
dim
; j++) {

19 
a
[
i
][
j
] = 
u
[i][j];

23 
i
=0; i<
dim
; i++) {

24 
j
=0; j<
dim
; j++) {

25 
ql
[
i
][
j
] = 0;

28 
i
=0; i<
dim
; i++) {

29 
ql
[
i
][i] = 1;

32 
k
=0; k<
dim
-1; k++) {

34 
®pha2
 = 0;

35 
j
=
k
; j<
dim
; j++) {

36 
®pha2
 +ğ
a
[
j
][
k
] *‡[j][k];

39 
®pha
 = 
	`sq¹
(
®pha2
);

40 ià(
a
[
k
][k] > 0) {

41 
®pha
 = -alpha;

44 
j
=0; j<
k
; j++) {

45 
v
[
j
] = 0;

48 
v
[
k
] = (
a
[k][k] - 
®pha
);

49 
j
=
k
+1; j<
dim
; j++) {

50 
v
[
j
] = 
a
[j][
k
];

52 
r
 = 0;

53 
j
=
k
; j<
dim
; j++) {

54 
r
 +ğ
v
[
j
] * v[j];

56 
r
 = 
	`sq¹
(r);

57 
j
=
k
; j<
dim
; j++) {

58 
v
[
j
] /ğ
r
;

61 
i
=0; i<
dim
; i++) {

62 
tÙ
 = 0;

63 
j
=0; j<
dim
; j++) {

64 
tÙ
 +ğ
a
[
j
][
i
] * 
v
[j];

66 
c
[
i
] = 
tÙ
;

69 
i
=0; i<
dim
; i++) {

70 
j
=0; j<
dim
; j++) {

71 
a
[
i
][
j
] -ğ2 * 
v
[i] * 
c
[j];

75 
i
=0; i<
dim
; i++) {

76 
tÙ
 = 0;

77 
j
=0; j<
dim
; j++) {

78 
tÙ
 +ğ
ql
[
j
][
i
] * 
v
[j];

80 
c
[
i
] = 
tÙ
;

83 
i
=0; i<
dim
; i++) {

84 
j
=0; j<
dim
; j++) {

85 
ql
[
i
][
j
] -ğ2 * 
v
[i] * 
c
[j];

91 
d–‘e
[] 
v
;

92 
d–‘e
[] 
c
;

93 
	}
}

96 
	gLšAlg
::
	$Hou£HŞd”
(** 
u
, 
dim
, ** 
a
, ** 
ql
) {

98 * 
v
 = 
Ãw
 [
dim
];

99 * 
c
 = 
Ãw
 [
dim
];

101 
i
=0; i<
dim
; i++) {

102 
j
=0; j<
dim
; j++) {

103 
a
[
i
][
j
] = 
u
[i][j];

107 
i
=0; i<
dim
; i++) {

108 
j
=0; j<
dim
; j++) {

109 
ql
[
i
][
j
] = 0;

112 
i
=0; i<
dim
; i++) {

113 
ql
[
i
][i] = 1;

116 
k
=0; k<
dim
-2; k++) {

118 
®pha2
 = 0;

119 
j
=
k
+1; j<
dim
; j++) {

120 
®pha2
 +ğ
a
[
j
][
k
] *‡[j][k];

123 
®pha
 = 
	`sq¹
(
®pha2
);

124 ià(
a
[
k
+1][k] > 0) {

125 
®pha
 = -alpha;

128 
r
 = 
	`sq¹
(0.5 * (
®pha2
 - 
®pha
 * 
a
[
k
+1][k]));

130 
j
=0; j<=
k
; j++) {

131 
v
[
j
] = 0;

134 
v
[
k
+1] = (
a
[k+1][k] - 
®pha
è/ 2 / 
r
;

135 
j
=
k
+2; j<
dim
; j++) {

136 
v
[
j
] = 
a
[j][
k
] / 2 / 
r
;

139 
i
=0; i<
dim
; i++) {

140 
tÙ
 = 0;

141 
j
=
k
+1; j<
dim
; j++) {

142 
tÙ
 +ğ
a
[
i
][
j
] * 
v
[j];

144 
c
[
i
] = 
tÙ
;

147 
tÙ
 = 0;

148 
j
=
k
+1; j<
dim
; j++) {

149 
tÙ
 +ğ
v
[
j
] * 
c
[j];

152 
i
=0; i<
dim
; i++) {

153 
j
=0; j<
dim
; j++) {

154 
a
[
i
][
j
] +ğ- 2 * 
c
[i] * 
v
[j] - 2 * c[j] * v[i] + 4 * 
tÙ
 * v[i] * v[j];

158 
i
=0; i<
dim
; i++) {

159 
tÙ
 = 0;

160 
j
=
k
+1; j<
dim
; j++) {

161 
tÙ
 +ğ
ql
[
j
][
i
] * 
v
[j];

163 
c
[
i
] = 
tÙ
;

166 
i
=
k
+1; i<
dim
; i++) {

167 
j
=0; j<
dim
; j++) {

168 
ql
[
i
][
j
] -ğ2 * 
v
[i] * 
c
[j];

173 
d–‘e
[] 
v
;

174 
d–‘e
[] 
c
;

175 
	}
}

177 
	gLšAlg
::
	$DŸgÚ®izeSymm‘ricM©rix
(** 
u
, 
dim
, 
nmax
, 
•sÚ
, * 
eig’v®
, ** 
eig’veù
) {

179 
i
=0; i<
dim
; i++) {

180 
j
=0; j<
dim
; j++) {

181 
eig’veù
[
i
][
j
] = 0;

184 
i
=0; i<
dim
; i++) {

185 
eig’veù
[
i
][i] = 1;

188 
´emax
 = 0;

189 
i
=0; i<
dim
; i++) {

190 
j
=0; j<
dim
; j++) {

191 ià(
i
!=
j
) {

192 
tmp
 = 
	`çbs
(
u
[
i
][
j
]);

193 ià(
´emax
 < 
tmp
) {

194 
´emax
 = 
tmp
;

199 ià(
´emax
 < 
•sÚ
) {

200 
i
=0; i<
dim
; i++) {

201 
eig’v®
[
i
] = 
u
[i][i];

206 ** 
a
 = 
Ãw
 *[
dim
];

207 ** 
q
 = 
Ãw
 *[
dim
];

208 ** 
r
 = 
Ãw
 *[
dim
];

209 
i
=0; i<
dim
; i++) {

210 
a
[
i
] = 
Ãw
 [
dim
];

211 
q
[
i
] = 
Ãw
 [
dim
];

212 
r
[
i
] = 
Ãw
 [
dim
];

213 
j
=0; j<
dim
; j++) {

214 
a
[
i
][
j
] = 
u
[i][j];

218 
	`Hou£HŞd”
(
u
,
dim
,
a
,
r
);

220 
i
=0; i<
dim
; i++) {

221 
j
=0; j<
dim
; j++) {

222 
eig’veù
[
i
][
j
] = 
r
[j][i];

226 
n
 = 0;

227 
max
 = 0;

228 
s
 = 
dim
-1;

230 
max
 = 0;

231 
shiá
 = 0;

232 ià(
s
>0) {

233 
shiá
 = 
a
[
s
][s];

234 
i
=0; i<
s
+1; i++) {

235 
a
[
i
][i] -ğ
shiá
;

238 
i
=0; i<
dim
; i++) {

239 
j
=0; j<
dim
; j++) {

240 
q
[
i
][
j
] = 0;

241 
r
[
i
][
j
] = 0;

244 
i
=0; i<
dim
; i++) {

245 
q
[
i
][i] = 1;

248 
	`QR
(
a
,
s
+1,
q
,
r
);

250 
n
++;

251 
i
=0; i<
s
+1; i++) {

252 
j
=0; j<
s
+1; j++) {

253 
tÙ®
 = 0;

254 
k
=0; k<
s
+1; k++) {

255 
tÙ®
 +ğ
r
[
i
][
k
] * 
q
[
j
][k];

257 
a
[
i
][
j
] = 
tÙ®
;

258 ià(
i
!=
j
) {

259 ià(
max
 < 
	`çbs
(
tÙ®
)) {

260 
max
 = 
	`çbs
(
tÙ®
);

265 ià(
s
>0) {

266 
i
=0; i<
s
+1; i++) {

267 
a
[
i
][i] +ğ
shiá
;

269 ià(
	`çbs
(
a
[
s
][s-1]è< 
•sÚ
) {

270 
s
--;

274 
s
--;

276 
i
=0; i<
dim
; i++) {

277 
j
=0; j<
dim
; j++) {

278 
tÙ®
 = 0;

279 
k
=0; k<
dim
; k++) {

280 
tÙ®
 +ğ
eig’veù
[
i
][
k
] * 
q
[
j
][k];

282 
r
[
i
][
j
] = 
tÙ®
;

285 
i
=0; i<
dim
; i++) {

286 
j
=0; j<
dim
; j++) {

287 
eig’veù
[
i
][
j
] = 
r
[i][j];

291 (
s
 >ğ0è&& (
n
 < 
nmax
));

294 
i
=0; i<
dim
; i++) {

295 
eig’v®
[
i
] = 
a
[i][i];

298 
i
=0; i<
dim
; i++) {

299 
d–‘e
[] 
a
[
i
];

300 
d–‘e
[] 
q
[
i
];

301 
d–‘e
[] 
r
[
i
];

303 
d–‘e
[] 
a
;

304 
d–‘e
[] 
q
;

305 
d–‘e
[] 
r
;

306  
n
;

307 
	}
};

313 
	gLšAlg
::
	$DŸgÚ®izeR©eM©rix
(** 
u
, * 
pi
, 
dim
, * 
eig’v®
, ** 
eig’veù
, ** 
šveig’veù
, 
nmax
, 
•sÚ
) {

315 ** 
a
 = 
Ãw
 *[
dim
];

316 
i
=0; i<
dim
; i++) {

317 
a
[
i
] = 
Ãw
 [
dim
];

318 
j
=0; j<
dim
; j++) {

319 
a
[
i
][
j
] = 
u
[i][j] * 
	`sq¹
(
pi
[i] /…i[j]);

323 
n
 = 
	`DŸgÚ®izeSymm‘ricM©rix
(
a
,
dim
,
nmax
,
•sÚ
,
eig’v®
,
eig’veù
);

325 
i
=0; i<
dim
; i++) {

326 
j
=0; j<
dim
; j++) {

327 
tÙ®
 = 0;

328 
k
=0; k<
dim
; k++) {

329 
tÙ®
 +ğ
a
[
i
][
k
] * 
eig’veù
[k][
j
];

334 
i
=0; i<
dim
; i++) {

335 
j
=0; j<
dim
; j++) {

336 
šveig’veù
[
i
][
j
] = 
eig’veù
[j][i] * 
	`sq¹
(
pi
[j]);

339 
i
=0; i<
dim
; i++) {

340 
j
=0; j<
dim
; j++) {

341 
eig’veù
[
i
][
j
] /ğ
	`sq¹
(
pi
[i]);

345 
i
=0; i<
dim
; i++) {

346 
d–‘e
[] 
a
[
i
];

348 
d–‘e
[] 
a
;

350  
n
;

351 
	}
}

356 
	gLšAlg
::
	$Gauss
(** 
a
, 
dim
, ** 
švu
) {

359 
boŞ
 
d–‘ešvu
 = 
çl£
;

360 ià(! 
švu
) {

361 
d–‘ešvu
 = 
Œue
;

362 
švu
 = 
Ãw
 *[
dim
];

363 
i
=0; i<
dim
; i++) {

364 
švu
[
i
] = 
Ãw
 [
dim
];

367 ** 
u
 = 
Ãw
 *[
dim
];

368 
i
=0; i<
dim
; i++) {

369 
u
[
i
] = 
Ãw
 [
dim
];

370 
j
=0; j<
dim
; j++) {

371 
u
[
i
][
j
] = 
a
[i][j];

375 
logd‘
 = 0;

376 
i
=0; i<
dim
; i++) {

377 
j
=0; j<
dim
; j++) {

378 
švu
[
i
][
j
] = 0;

381 
i
=0; i<
dim
; i++) {

382 
švu
[
i
][i] = 1;

385 
i
=0; i<
dim
; i++) {

387 
max
 = 0;

388 
imax
 = 0;

389 
j
=
i
; j<
dim
; j++) {

390 
tmp
 = 
	`çbs
(
u
[
j
][
i
]);

391 ià(
max
 < 
tmp
) {

392 
max
 = 
tmp
;

393 
imax
 = 
j
;

397 ià(
max
 < 1e-10) {

398 
û¼
 << "error in Gauss:‚on invertible matrix\n";

399 
û¼
 << "dim : " << 
dim
 << '\n';

400 
j
=0; j<
dim
; j++) {

401 
k
=0; k<
dim
; k++) {

402 
û¼
 << 
a
[
j
][
k
] << '\t';

404 
û¼
 << '\n';

407 
	`ex™
(1);

411 ià(
imax
 !ğ
i
) {

412 
j
=0; j<
dim
; j++) {

413 
tmp
 = 
u
[
i
][
j
];

414 
u
[
i
][
j
] = u[
imax
][j];

415 
u
[
imax
][
j
] = 
tmp
;

416 
tmp
 = 
švu
[
i
][
j
];

417 
švu
[
i
][
j
] = invu[
imax
][j];

418 
švu
[
imax
][
j
] = 
tmp
;

423 
j
=
i
+1; j<
dim
; j++) {

424 
f
 = 
u
[
j
][
i
] / u[i][i];

425 
k
=0; k<
dim
; k++) {

426 
u
[
j
][
k
] -ğu[
i
][k] * 
f
;

427 
švu
[
j
][
k
] -ğšvu[
i
][k] * 
f
;

431 
f
 = 
u
[
i
][i];

432 
k
=0; k<
dim
; k++) {

433 
u
[
i
][
k
] /ğ
f
;

434 
švu
[
i
][
k
] /ğ
f
;

436 
logd‘
 -ğ
	`log
(
	`çbs
(
f
));

440 
i
=
dim
-1; i>=0; i--) {

442 
j
=0; j<
i
; j++) {

443 
f
 = 
u
[
j
][
i
];

444 
k
=0; k<
dim
; k++) {

445 
švu
[
j
][
k
] -ğ
f
 * invu[
i
][k];

446 
u
[
j
][
k
] -ğ
f
 * u[
i
][k];

451 
i
=0; i<
dim
; i++) {

452 
d–‘e
[] 
u
[
i
];

454 
d–‘e
[] 
u
;

455 ià(
d–‘ešvu
) {

456 
i
=0; i<
dim
; i++) {

457 
d–‘e
[] 
švu
[
i
];

459 
d–‘e
[] 
švu
;

462  
logd‘
;

463 
	}
}

	@linalg.h

2 #iâdeà
LINALG_H


3 
	#LINALG_H


	)

5 şas 
	cLšAlg
 {

7 
	mpublic
:

12 
DŸgÚ®izeR©eM©rix
(** 
u
, * 
pi
, 
dim
, * 
eig’v®
, ** 
eig’veù
, ** 
šveig’veù
, 
nmax
=1000, 
•sÚ
 = 1e-10);

22 
DŸgÚ®izeSymm‘ricM©rix
(** 
u
, 
dim
, 
nmax
, 
•sÚ
, * 
eig’v®
, ** 
eig’veù
);

29 
Gauss
(** 
a
, 
dim
, ** 
švu
 = 0);

31 
	m´iv©e
:

33 
QR
(** 
u
, 
dim
, ** 
ql
, ** 
r
);

34 
Hou£HŞd”
(** 
u
, 
dim
, ** 
a
, ** 
ql
);

	@stabledistribution.cpp

1 
	~"¡abËdi¡ributiÚ.h
"

2 
	~<cm©h
>

3 
	~<io¡»am
>

4 
	~"glob®.h
"

6 cÚ¡ 
	gSbËDi¡ributiÚ
::
grid
[40][10000] = {{41.19088657490408,2.161293596225226,1.479765824554203,1.080151795682783,

100218 
	gSbËDi¡ributiÚ
::
	$SbËDi¡ributiÚ
(
®pha
, 
sÿË
)

100220 
	`£tAÍha
(
®pha
);

100221 
	`£tSÿË
(
sÿË
);

100222 
	}
}

100224 
	gSbËDi¡ributiÚ
::
	$£tAÍha
(
®pha
)

100226 
a
 = 
®pha
;

100227 
s_a
 = 
®pha
*20 - 1;

100228 
ıowa
 = 
	`POW
(
c
,
a
);

100229 
	}
}

100231 
	gSbËDi¡ributiÚ
::
	$£tSÿË
(
sÿË
)

100233 
c
 = 
sÿË
;

100234 
ıowa
 = 
	`POW
(
c
,
a
);

100235 
	}
}

100237 
	gSbËDi¡ributiÚ
::
	$logPDF
(
X
) const

100239  
	`logPDF
(
X
,1);

100240 
	}
}

100242 
	gSbËDi¡ributiÚ
::
	$cubicIÁ”pŞ©e
 (
p
[4], 
x
) const {

100244  
p
[1] + 0.5 * 
x
 *(p[2] -…[0] + x*(2.0*p[0] - 5.0*p[1] + 4.0*p[2] -…[3] + x*(3.0*(p[1] -…[2]) +…[3] -…[0])));

100245 
	}
}

100247 
	gSbËDi¡ributiÚ
::
	$bicubicIÁ”pŞ©e
 (
p
[4][4], 
x
, 
y
) const {

100249 
¬r
[4];

100250 
¬r
[0] = 
	`cubicIÁ”pŞ©e
(
p
[0], 
y
);

100251 
¬r
[1] = 
	`cubicIÁ”pŞ©e
(
p
[1], 
y
);

100252 
¬r
[2] = 
	`cubicIÁ”pŞ©e
(
p
[2], 
y
);

100253 
¬r
[3] = 
	`cubicIÁ”pŞ©e
(
p
[3], 
y
);

100254  
	`cubicIÁ”pŞ©e
(
¬r
, 
x
);

100255 
	}
}

100257 
	gSbËDi¡ributiÚ
::
	$logPDF
(
X
, 
t
) const

100259 ià(
s_a
 >= 39) {

100260 
s
 = 
	`sq¹
(
t
 * 
c
 * c)*
SQRT2
;

100261  -(
X
*X)/(2*
s
*s)-
	`LOG
(
SQRT2PI
*s);

100264 
C
 = 
	`POW
(
t
 * 
ıowa
, 1.0/
a
);

100266 
y
 = (1000 * 
	`LOG
(1.0 + 
	`çbs
(
X
)/
C
));

100267 
Y
 = 
y
;

100268 
x
 = 
s_a
;

100269 ià(
Y
 >= 9997)

100270  
grid
[
x
][9996] + ((
Y
 - 9996) * (grid[x][9999]-grid[x][9996]))/3;

100272 #ifdeà
LINEAR_INTERPOLATION


100274  
grid
[
x
][
Y
] * (1.0-
s_a
+xè* (1.0-
y
+Y)

100275 + 
grid
[
x
+1][
Y
] * (
s_a
-xè* (1.0-
y
+Y)

100276 + 
grid
[
x
][
Y
+1] * (1.0-
s_a
+xè* (
y
-Y)

100277 + 
grid
[
x
+1][
Y
+1] * (
s_a
-xè* (
y
-Y)

100278 - 
	`LOG
(
C
);

100283 ià(
s_a
 >= 38) {

100285 
p
[4][4] = {{
grid
[
x
-1][
Y
-1],grid[x-1][Y],grid[x-1][Y+1],grid[x-1][Y+2]},

100286 {
grid
[
x
][
Y
-1],grid[x][Y],grid[x][Y+1],grid[x][Y+2]},

100287 {
grid
[
x
+1][
Y
-1],grid[x+1][Y],grid[x+1][Y+1],grid[x+1][Y+2]},

100288 {
grid
[
x
+1][
Y
-1],grid[x+1][Y],grid[x+1][Y+1],grid[x+1][Y+2]}};

100289  
	`bicubicIÁ”pŞ©e
(
p
, 
s_a
-
x
, 
y
-
Y
è- 
	`LOG
(
C
);

100292 
p
[4][4] = {{
grid
[
x
-1][
Y
-1],grid[x-1][Y],grid[x-1][Y+1],grid[x-1][Y+2]},

100293 {
grid
[
x
][
Y
-1],grid[x][Y],grid[x][Y+1],grid[x][Y+2]},

100294 {
grid
[
x
+1][
Y
-1],grid[x+1][Y],grid[x+1][Y+1],grid[x+1][Y+2]},

100295 {
grid
[
x
+2][
Y
-1],grid[x+2][Y],grid[x+2][Y+1],grid[x+2][Y+2]}};

100296  
	`bicubicIÁ”pŞ©e
(
p
, 
s_a
-
x
, 
y
-
Y
è- 
	`LOG
(
C
);

100299 
	}
}

	@stabledistribution.h

1 #iâdeà
STABLEDISTRIBUTION_H


2 
	#STABLEDISTRIBUTION_H


	)

4 şas 
	cSbËDi¡ributiÚ


6 
	mpublic
:

8 
SbËDi¡ributiÚ
(
®pha
 = 2, 
sÿË
 = 1);

10 
	$®pha
(ècÚ¡ { 
a
;}

11 
	$sÿË
(ècÚ¡ { 
c
;
	}
}

13 
	$logPDF
(
x
) const;

14 
	$logPDF
(
X
, 
t
) const;

16 
	`£tAÍha
(
®pha
);

17 
	`£tSÿË
(
sÿË
);

19 
	$cubicIÁ”pŞ©e
 (
p
[4], 
x
) const;

21 
	$bicubicIÁ”pŞ©e
 (
p
[4][4], 
x
, 
y
) const;

23 
´iv©e
:

25 cÚ¡ 
grid
[40][10000];

26 
c
;

27 
a
;

28 
s_a
;

29 
ıowa
;

30 
	}
};

	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #iâdeà
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£¹_ç
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
,

70 
__lše
, cÚ¡ *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, cÚ¡ *
__fe
,

75 
__lše
, cÚ¡ *
__funùiÚ
)

76 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

81 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

82 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

85 
__END_DECLS


88 
	#as£¹
(
ex´
) \

89 ((
ex´
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£¹_³¼Ü
(
”ºum
) \

95 (!(
”ºum
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

118 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ılu¥lus


119 #undeà
¡©ic_as£¹


120 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/m©h-veùÜ.h
>

35 
	~<b™s/huge_v®.h
>

36 #ifdeà
__USE_ISOC99


37 
	~<b™s/huge_v®f.h
>

38 
	~<b™s/huge_v®l.h
>

41 
	~<b™s/šf.h
>

44 
	~<b™s/Çn.h
>

48 
	~<b™s/m©hdef.h
>

55 
	#__SIMD_DECL
(
funùiÚ
è
	`__CONCAT
 (
__DECL_SIMD_
, funùiÚ)

	)

57 
	#__MATHCALL_VEC
(
funùiÚ
, 
suffix
, 
¬gs
) \

58 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

59 
	`__MATHCALL
 (
funùiÚ
, 
suffix
, 
¬gs
)

	)

61 
	#__MATHDECL_VEC
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

62 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

63 
	`__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
)

	)

65 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

66 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

67 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

68 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

69 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

70 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

71 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

72 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

73 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

74 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

75 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

76 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

78 
	#_MdoubË_
 

	)

79 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

80 
	#__MATH_DECLARING_DOUBLE
 1

	)

81 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

82 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

83 
	~<b™s/m©hÿÎs.h
>

84 #undeà
_MdoubË_


85 #undeà
_MdoubË_BEGIN_NAMESPACE


86 #undeà
_MdoubË_END_NAMESPACE


87 #undeà
__MATH_PRECNAME


88 #undeà
__MATH_DECLARING_DOUBLE


90 #ifdeà
__USE_ISOC99


96 #iâdeà
_Mæßt_


97 
	#_Mæßt_
 

	)

99 
	#_MdoubË_
 
_Mæßt_


	)

100 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

101 
	#__MATH_DECLARING_DOUBLE
 0

	)

102 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

103 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

104 
	~<b™s/m©hÿÎs.h
>

105 #undeà
_MdoubË_


106 #undeà
_MdoubË_BEGIN_NAMESPACE


107 #undeà
_MdoubË_END_NAMESPACE


108 #undeà
__MATH_PRECNAME


109 #undeà
__MATH_DECLARING_DOUBLE


111 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

112 || 
defšed
 
__LDBL_COMPAT
 \

113 || 
defšed
 
_LIBC_TEST


114 #ifdeà
__LDBL_COMPAT


116 #ifdeà
__USE_ISOC99


117 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

118 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

119 #ifdeà
__REDIRECT_NTH


120 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

121 
__Ædbl_Ãx‰ow¬df
)

122 
	`__©Œibu‹__
 ((
__cÚ¡__
));

123 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

124 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

125 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

126 (
__x
, 
__y
),

127 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

131 #undeà
__MATHDECL_1


132 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

133 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

134 
¬gs
, 
®Ÿs
)

	)

135 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

136 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

142 #iâdeà
_MlÚg_doubË_


143 
	#_MlÚg_doubË_
 

	)

145 
	#_MdoubË_
 
_MlÚg_doubË_


	)

146 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

147 
	#__MATH_DECLARING_DOUBLE
 0

	)

148 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

149 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

150 
	#__MATH_DECLARE_LDOUBLE
 1

	)

151 
	~<b™s/m©hÿÎs.h
>

152 #undeà
_MdoubË_


153 #undeà
_MdoubË_BEGIN_NAMESPACE


154 #undeà
_MdoubË_END_NAMESPACE


155 #undeà
__MATH_PRECNAME


156 #undeà
__MATH_DECLARING_DOUBLE


161 #undeà
__MATHDECL_1


162 #undeà
__MATHDECL


163 #undeà
__MATHCALL


166 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


168 
signgam
;

173 #ifdeà
__USE_ISOC99


211 
FP_NAN
 =

212 
	#FP_NAN
 0

	)

213 
FP_NAN
,

214 
FP_INFINITE
 =

215 
	#FP_INFINITE
 1

	)

216 
FP_INFINITE
,

217 
FP_ZERO
 =

218 
	#FP_ZERO
 2

	)

219 
FP_ZERO
,

220 
FP_SUBNORMAL
 =

221 
	#FP_SUBNORMAL
 3

	)

222 
FP_SUBNORMAL
,

223 
FP_NORMAL
 =

224 
	#FP_NORMAL
 4

	)

225 
FP_NORMAL


233 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__
 \

234 && !
defšed
 
__OPTIMIZE_SIZE__


235 
	#åşassify
(
x
è
	`__butš_åşassify
 (
FP_NAN
, 
FP_INFINITE
, \

236 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

237 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


238 
	#åşassify
(
x
) \

239 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

241 
	#åşassify
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__åşassifyf
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

249 #ià
	`__GNUC_PREREQ
 (4,0)

250 
	#signb™
(
x
) \

251 ( (
x
) ==  () \

252 ? 
	`__butš_signb™f
 (
x
) \

253 :  (
x
) ==  () \

254 ? 
	`__butš_signb™
 (
x
è: 
	`__butš_signb™l
 (x))

	)

256 #ifdeà
__NO_LONG_DOUBLE_MATH


257 
	#signb™
(
x
) \

258 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

260 
	#signb™
(
x
) \

261 ( (
x
) ==  () \

262 ? 
	`__signb™f
 (
x
) \

263 :  (
x
) ==  () \

264 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

269 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


270 
	#isfš™e
(
x
è
	`__butš_isfš™e
 (x)

	)

271 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


272 
	#isfš™e
(
x
) \

273 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

275 
	#isfš™e
(
x
) \

276 ( (
x
) ==  () \

277 ? 
	`__fš™ef
 (
x
) \

278 :  (
x
) ==  () \

279 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

283 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


284 
	#i¢Üm®
(
x
è
	`__butš_i¢Üm®
 (x)

	)

286 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

291 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


292 
	#i¢ª
(
x
è
	`__butš_i¢ª
 (x)

	)

293 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


294 
	#i¢ª
(
x
) \

295 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

297 
	#i¢ª
(
x
) \

298 ( (
x
) ==  () \

299 ? 
	`__i¢ªf
 (
x
) \

300 :  (
x
) ==  () \

301 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

305 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


306 
	#isšf
(
x
è
	`__butš_isšf_sign
 (x)

	)

307 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


308 
	#isšf
(
x
) \

309 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

311 
	#isšf
(
x
) \

312 ( (
x
) ==  () \

313 ? 
	`__isšff
 (
x
) \

314 :  (
x
) ==  () \

315 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

319 
	#MATH_ERRNO
 1

	)

320 
	#MATH_ERREXCEPT
 2

	)

325 #iâdeà
__FAST_MATH__


326 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

331 #ifdeà
__USE_GNU


333 #ifdeà
__NO_LONG_DOUBLE_MATH


334 
	#issigÇlšg
(
x
) \

335 ( (
x
è=ğ (è? 
	`__issigÇlšgf
 (xè: 
	`__issigÇlšg
 (x))

	)

337 
	#issigÇlšg
(
x
) \

338 ( (
x
) ==  () \

339 ? 
	`__issigÇlšgf
 (
x
) \

340 :  (
x
) ==  () \

341 ? 
	`__issigÇlšg
 (
x
è: 
	`__issigÇlšgl
 (x))

	)

345 #ifdef 
__USE_MISC


349 
_IEEE_
 = -1,

350 
_SVID_
,

351 
_XOPEN_
,

352 
_POSIX_
,

353 
_ISOC_


354 } 
	t_LIB_VERSION_TYPE
;

359 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

363 #ifdeà
__USE_MISC


369 #ifdeà
__ılu¥lus


370 
__exû±iÚ


372 
exû±iÚ


375 
ty³
;

376 *
Çme
;

377 
¬g1
;

378 
¬g2
;

379 
»tv®
;

380 
	}
};

382 #ifdeà
__ılu¥lus


383 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

385 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

388 
	#X_TLOSS
 1.41484755040568800000e+16

	)

391 
	#DOMAIN
 1

	)

392 
	#SING
 2

	)

393 
	#OVERFLOW
 3

	)

394 
	#UNDERFLOW
 4

	)

395 
	#TLOSS
 5

	)

396 
	#PLOSS
 6

	)

399 
	#HUGE
 3.40282347e+38F

	)

403 #ifdeà
__USE_XOPEN


405 
	#MAXFLOAT
 3.40282347e+38F

	)

412 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


413 
	#M_E
 2.7182818284590452354

	)

414 
	#M_LOG2E
 1.4426950408889634074

	)

415 
	#M_LOG10E
 0.43429448190325182765

	)

416 
	#M_LN2
 0.69314718055994530942

	)

417 
	#M_LN10
 2.30258509299404568402

	)

418 
	#M_PI
 3.14159265358979323846

	)

419 
	#M_PI_2
 1.57079632679489661923

	)

420 
	#M_PI_4
 0.78539816339744830962

	)

421 
	#M_1_PI
 0.31830988618379067154

	)

422 
	#M_2_PI
 0.63661977236758134308

	)

423 
	#M_2_SQRTPI
 1.12837916709551257390

	)

424 
	#M_SQRT2
 1.41421356237309504880

	)

425 
	#M_SQRT1_2
 0.70710678118654752440

	)

431 #ifdeà
__USE_GNU


432 
	#M_El
 2.718281828459045235360287471352662498L

	)

433 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

434 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

435 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

436 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

437 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

438 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

439 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

440 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

441 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

442 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

443 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

444 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

451 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


452 
	#__NO_MATH_INLINES
 1

	)

455 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

462 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

463 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

464 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

465 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

466 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

467 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

471 #ifdeà
__USE_EXTERN_INLINES


472 
	~<b™s/m©hšlše.h
>

477 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

478 
	~<b™s/m©h-fš™e.h
>

481 #ifdeà
__USE_ISOC99


485 #iâdeà
isg»©”


486 
	#isg»©”
(
x
, 
y
) \

487 (
__ex‹nsiÚ__
 \

488 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

489 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

493 #iâdeà
isg»©”equ®


494 
	#isg»©”equ®
(
x
, 
y
) \

495 (
__ex‹nsiÚ__
 \

496 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

497 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

501 #iâdeà
i¦ess


502 
	#i¦ess
(
x
, 
y
) \

503 (
__ex‹nsiÚ__
 \

504 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

505 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

509 #iâdeà
i¦es£qu®


510 
	#i¦es£qu®
(
x
, 
y
) \

511 (
__ex‹nsiÚ__
 \

512 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

513 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

517 #iâdeà
i¦essg»©”


518 
	#i¦essg»©”
(
x
, 
y
) \

519 (
__ex‹nsiÚ__
 \

520 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

521 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

525 #iâdeà
isunÜd”ed


526 
	#isunÜd”ed
(
u
, 
v
) \

527 (
__ex‹nsiÚ__
 \

528 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

529 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

534 
	g__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

45 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (¡©us)

	)

46 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (¡©us)

	)

47 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (¡©us)

	)

48 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (¡©us)

	)

49 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (¡©us)

	)

50 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (¡©us)

	)

51 #ifdeà
__WIFCONTINUED


52 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (¡©us)

	)

56 
__BEGIN_NAMESPACE_STD


60 
	mquÙ
;

61 
	m»m
;

62 } 
	tdiv_t
;

65 #iâdeà
__ldiv_t_defšed


68 
	mquÙ
;

69 
	m»m
;

70 } 
	tldiv_t
;

71 
	#__ldiv_t_defšed
 1

	)

73 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


76 
__BEGIN_NAMESPACE_C99


78 
__ex‹nsiÚ__
 struct

80 
	mquÙ
;

81 
	m»m
;

82 } 
	tÎdiv_t
;

83 
	#__Îdiv_t_defšed
 1

	)

84 
	g__END_NAMESPACE_C99


89 
	#RAND_MAX
 2147483647

	)

94 
	#EXIT_FAILURE
 1

	)

95 
	#EXIT_SUCCESS
 0

	)

99 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

100 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

103 
__BEGIN_NAMESPACE_STD


105 
	$©of
 (cÚ¡ *
__ÅŒ
)

106 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

108 
	$©oi
 (cÚ¡ *
__ÅŒ
)

109 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

111 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

112 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

113 
__END_NAMESPACE_STD


115 #ifdeà
__USE_ISOC99


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

119 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

120 
__END_NAMESPACE_C99


123 
__BEGIN_NAMESPACE_STD


125 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

126 **
__»¡riù
 
__’d±r
)

127 
__THROW
 
	`__nÚnuÎ
 ((1));

128 
__END_NAMESPACE_STD


130 #ifdef 
__USE_ISOC99


131 
__BEGIN_NAMESPACE_C99


133 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

134 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

136 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

137 **
__»¡riù
 
__’d±r
)

138 
__THROW
 
	`__nÚnuÎ
 ((1));

139 
__END_NAMESPACE_C99


142 
__BEGIN_NAMESPACE_STD


144 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

145 **
__»¡riù
 
__’d±r
, 
__ba£
)

146 
__THROW
 
	`__nÚnuÎ
 ((1));

148 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

149 **
__»¡riù
 
__’d±r
, 
__ba£
)

150 
__THROW
 
	`__nÚnuÎ
 ((1));

151 
__END_NAMESPACE_STD


153 #ifdeà
__USE_MISC


155 
__ex‹nsiÚ__


156 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

157 **
__»¡riù
 
__’d±r
, 
__ba£
)

158 
__THROW
 
	`__nÚnuÎ
 ((1));

160 
__ex‹nsiÚ__


161 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

162 **
__»¡riù
 
__’d±r
, 
__ba£
)

163 
__THROW
 
	`__nÚnuÎ
 ((1));

166 #ifdeà
__USE_ISOC99


167 
__BEGIN_NAMESPACE_C99


169 
__ex‹nsiÚ__


170 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

171 **
__»¡riù
 
__’d±r
, 
__ba£
)

172 
__THROW
 
	`__nÚnuÎ
 ((1));

174 
__ex‹nsiÚ__


175 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
, 
__ba£
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


182 #ifdeà
__USE_GNU


196 
	~<xloÿË.h
>

200 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
,

202 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

204 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

205 **
__»¡riù
 
__’d±r
,

206 
__ba£
, 
__loÿË_t
 
__loc
)

207 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

209 
__ex‹nsiÚ__


210 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
,

212 
__loÿË_t
 
__loc
)

213 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

215 
__ex‹nsiÚ__


216 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

217 **
__»¡riù
 
__’d±r
,

218 
__ba£
, 
__loÿË_t
 
__loc
)

219 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

221 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

222 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

223 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

225 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

226 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

227 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

229 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

230 **
__»¡riù
 
__’d±r
,

231 
__loÿË_t
 
__loc
)

232 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

236 #ifdeà
__USE_EXTERN_INLINES


237 
__BEGIN_NAMESPACE_STD


238 
__ex‹º_šlše
 

239 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

241  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

242 
	}
}

243 
__ex‹º_šlše
 

244 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

246  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

247 
	}
}

248 
	g__END_NAMESPACE_STD


250 #ifdeà
__USE_ISOC99


251 
__BEGIN_NAMESPACE_C99


252 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

253 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

255  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

256 
	}
}

257 
	g__END_NAMESPACE_C99


262 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


266 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

269 
	$a64l
 (cÚ¡ *
__s
)

270 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

274 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


275 
	~<sys/ty³s.h
>

282 
	$¿ndom
 (è
__THROW
;

285 
	$¤ªdom
 (
__£ed
è
__THROW
;

291 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

292 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

296 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

299 #ifdeà
__USE_MISC


304 
	s¿ndom_d©a


306 
št32_t
 *
åŒ
;

307 
št32_t
 *
½Œ
;

308 
št32_t
 *
¡©e
;

309 
¿nd_ty³
;

310 
¿nd_deg
;

311 
¿nd_£p
;

312 
št32_t
 *
’d_±r
;

315 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

316 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

318 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

319 
__THROW
 
	`__nÚnuÎ
 ((2));

321 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

322 
size_t
 
__¡©–’
,

323 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

324 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

326 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

327 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

328 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

333 
__BEGIN_NAMESPACE_STD


335 
	$¿nd
 (è
__THROW
;

337 
	$¤ªd
 (
__£ed
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdeà
__USE_POSIX199506


342 
	$¿nd_r
 (*
__£ed
è
__THROW
;

346 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


350 
	$d¿nd48
 (è
__THROW
;

351 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

354 
	$Ìªd48
 (è
__THROW
;

355 
	$Äªd48
 (
__xsubi
[3])

356 
__THROW
 
	`__nÚnuÎ
 ((1));

359 
	$m¿nd48
 (è
__THROW
;

360 
	$j¿nd48
 (
__xsubi
[3])

361 
__THROW
 
	`__nÚnuÎ
 ((1));

364 
	$¤ªd48
 (
__£edv®
è
__THROW
;

365 *
	$£ed48
 (
__£ed16v
[3])

366 
__THROW
 
	`__nÚnuÎ
 ((1));

367 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

369 #ifdeà
__USE_MISC


373 
	sd¿nd48_d©a


375 
__x
[3];

376 
__Şd_x
[3];

377 
__c
;

378 
__š™
;

379 
__ex‹nsiÚ__
 
__a
;

384 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

385 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

386 
	$”ªd48_r
 (
__xsubi
[3],

387 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

388 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

392 *
__»¡riù
 
__»suÉ
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

394 
	$Äªd48_r
 (
__xsubi
[3],

395 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

396 *
__»¡riù
 
__»suÉ
)

397 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

400 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

401 *
__»¡riù
 
__»suÉ
)

402 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

403 
	$j¿nd48_r
 (
__xsubi
[3],

404 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

405 *
__»¡riù
 
__»suÉ
)

406 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

409 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

410 
__THROW
 
	`__nÚnuÎ
 ((2));

412 
	$£ed48_r
 (
__£ed16v
[3],

413 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

415 
	$lcÚg48_r
 (
__·¿m
[7],

416 
d¿nd48_d©a
 *
__bufãr
)

417 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

423 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


424 
	#__m®loc_ªd_ÿÎoc_defšed


	)

425 
__BEGIN_NAMESPACE_STD


427 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

429 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

430 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

431 
__END_NAMESPACE_STD


434 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


435 
__BEGIN_NAMESPACE_STD


441 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

442 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

444 
	$ä“
 (*
__±r
è
__THROW
;

445 
__END_NAMESPACE_STD


447 #ifdef 
__USE_MISC


449 
	$cä“
 (*
__±r
è
__THROW
;

452 #ifdeà
__USE_MISC


453 
	~<®loÿ.h
>

456 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

457 || 
defšed
 
__USE_MISC


459 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

462 #ifdeà
__USE_XOPEN2K


464 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

465 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

468 #ifdeà
__USE_ISOC11


470 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

471 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

474 
__BEGIN_NAMESPACE_STD


476 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

480 
	$©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

482 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


484 #ifdeà
__ılu¥lus


485 "C++" 
	$©_quick_ex™
 ((*
__func
) ())

486 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

488 
	$©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

491 
__END_NAMESPACE_STD


493 #ifdef 
__USE_MISC


496 
	$Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

497 
__THROW
 
	`__nÚnuÎ
 ((1));

500 
__BEGIN_NAMESPACE_STD


504 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

506 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


510 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

512 
__END_NAMESPACE_STD


514 #ifdeà
__USE_ISOC99


515 
__BEGIN_NAMESPACE_C99


518 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
__END_NAMESPACE_C99


523 
__BEGIN_NAMESPACE_STD


525 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

526 
__END_NAMESPACE_STD


528 #ifdeà
__USE_GNU


531 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

532 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

535 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


539 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

542 #ifdeà
__USE_XOPEN2K


545 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

546 
__THROW
 
	`__nÚnuÎ
 ((2));

549 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

552 #ifdef 
__USE_MISC


556 
	$ş—»nv
 (è
__THROW
;

560 #ià
defšed
 
__USE_MISC
 \

561 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

567 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

570 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


579 #iâdeà
__USE_FILE_OFFSET64


580 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

582 #ifdeà
__REDIRECT


583 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

584 
	`__nÚnuÎ
 ((1)è
__wur
;

586 
	#mk¡emp
 
mk¡emp64


	)

589 #ifdeà
__USE_LARGEFILE64


590 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

594 #ifdeà
__USE_MISC


601 #iâdeà
__USE_FILE_OFFSET64


602 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

604 #ifdeà
__REDIRECT


605 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

606 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

608 
	#mk¡emps
 
mk¡emps64


	)

611 #ifdeà
__USE_LARGEFILE64


612 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

613 
	`__nÚnuÎ
 ((1)è
__wur
;

617 #ifdeà
__USE_XOPEN2K8


623 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

626 #ifdeà
__USE_GNU


633 #iâdeà
__USE_FILE_OFFSET64


634 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

636 #ifdeà
__REDIRECT


637 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

638 
	`__nÚnuÎ
 ((1)è
__wur
;

640 
	#mko¡emp
 
mko¡emp64


	)

643 #ifdeà
__USE_LARGEFILE64


644 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

653 #iâdeà
__USE_FILE_OFFSET64


654 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

655 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ifdeà
__REDIRECT


658 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

659 
__æags
), 
mko¡emps64
)

660 
	`__nÚnuÎ
 ((1)è
__wur
;

662 
	#mko¡emps
 
mko¡emps64


	)

665 #ifdeà
__USE_LARGEFILE64


666 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

667 
	`__nÚnuÎ
 ((1)è
__wur
;

672 
__BEGIN_NAMESPACE_STD


677 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

678 
__END_NAMESPACE_STD


681 #ifdef 
__USE_GNU


684 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

685 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

688 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


694 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

695 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

700 #iâdeà
__COMPAR_FN_T


701 
	#__COMPAR_FN_T


	)

702 (*
	t__com·r_â_t
) (const *, const *);

704 #ifdef 
__USE_GNU


705 
__com·r_â_t
 
	tcom·risÚ_â_t
;

708 #ifdeà
__USE_GNU


709 (*
	t__com·r_d_â_t
) (const *, const *, *);

712 
__BEGIN_NAMESPACE_STD


715 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

716 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

717 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

719 #ifdeà
__USE_EXTERN_INLINES


720 
	~<b™s/¡dlib-b£¬ch.h
>

725 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

726 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

727 #ifdeà
__USE_GNU


728 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

729 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

730 
	`__nÚnuÎ
 ((1, 4));

735 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

736 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

737 
__END_NAMESPACE_STD


739 #ifdeà
__USE_ISOC99


740 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

741 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

745 
__BEGIN_NAMESPACE_STD


749 
div_t
 
	$div
 (
__num”
, 
__d’om
)

750 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

751 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

752 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

753 
__END_NAMESPACE_STD


755 #ifdeà
__USE_ISOC99


756 
__BEGIN_NAMESPACE_C99


757 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

758 
__d’om
)

759 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

760 
__END_NAMESPACE_C99


764 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

765 || 
defšed
 
__USE_MISC


772 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

773 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

778 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

779 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

784 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

785 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

788 #ifdeà
__USE_MISC


790 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

791 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

792 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

793 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

794 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

795 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

796 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

797 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

802 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

803 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

804 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

805 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

806 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

807 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

809 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

810 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

811 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

812 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

813 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

814 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

815 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

816 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

820 
__BEGIN_NAMESPACE_STD


823 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

826 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

827 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

830 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

834 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

835 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

837 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

838 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

839 
__THROW
;

840 
__END_NAMESPACE_STD


843 #ifdeà
__USE_MISC


848 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

852 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


859 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

860 *cÚ¡ *
__»¡riù
 
__tok’s
,

861 **
__»¡riù
 
__v®u•
)

862 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

866 #ifdeà
__USE_XOPEN


868 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

874 #ifdeà
__USE_XOPEN2KXSI


876 
	$posix_İ’±
 (
__oæag
è
__wur
;

879 #ifdeà
__USE_XOPEN_EXTENDED


884 
	$g¿Á±
 (
__fd
è
__THROW
;

888 
	$uÆock±
 (
__fd
è
__THROW
;

893 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

896 #ifdeà
__USE_GNU


900 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

901 
__THROW
 
	`__nÚnuÎ
 ((2));

904 
	`g‘±
 ();

907 #ifdeà
__USE_MISC


911 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

912 
__THROW
 
	`__nÚnuÎ
 ((1));

915 #ià
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K


918 
	$‰y¦Ù
 (è
__THROW
;

921 
	~<b™s/¡dlib-æßt.h
>

924 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


925 
	~<b™s/¡dlib.h
>

927 #ifdeà
__LDBL_COMPAT


928 
	~<b™s/¡dlib-ldbl.h
>

932 #undeà
__Ãed_m®loc_ªd_ÿÎoc


934 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #undeà
__USE_ISOC11


98 #undeà
__USE_ISOC99


99 #undeà
__USE_ISOC95


100 #undeà
__USE_ISOCXX11


101 #undeà
__USE_POSIX


102 #undeà
__USE_POSIX2


103 #undeà
__USE_POSIX199309


104 #undeà
__USE_POSIX199506


105 #undeà
__USE_XOPEN


106 #undeà
__USE_XOPEN_EXTENDED


107 #undeà
__USE_UNIX98


108 #undeà
__USE_XOPEN2K


109 #undeà
__USE_XOPEN2KXSI


110 #undeà
__USE_XOPEN2K8


111 #undeà
__USE_XOPEN2K8XSI


112 #undeà
__USE_LARGEFILE


113 #undeà
__USE_LARGEFILE64


114 #undeà
__USE_FILE_OFFSET64


115 #undeà
__USE_MISC


116 #undeà
__USE_ATFILE


117 #undeà
__USE_GNU


118 #undeà
__USE_REENTRANT


119 #undeà
__USE_FORTIFY_LEVEL


120 #undeà
__KERNEL_STRICT_NAMES


124 #iâdeà
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

137 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

146 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

147 && !
defšed
 
	g_DEFAULT_SOURCE


149 #undeà
_DEFAULT_SOURCE


150 
	#_DEFAULT_SOURCE
 1

	)

154 #ifdeà
_GNU_SOURCE


155 #undeà
_ISOC95_SOURCE


156 
	#_ISOC95_SOURCE
 1

	)

157 #undeà
_ISOC99_SOURCE


158 
	#_ISOC99_SOURCE
 1

	)

159 #undeà
_ISOC11_SOURCE


160 
	#_ISOC11_SOURCE
 1

	)

161 #undeà
_POSIX_SOURCE


162 
	#_POSIX_SOURCE
 1

	)

163 #undeà
_POSIX_C_SOURCE


164 
	#_POSIX_C_SOURCE
 200809L

	)

165 #undeà
_XOPEN_SOURCE


166 
	#_XOPEN_SOURCE
 700

	)

167 #undeà
_XOPEN_SOURCE_EXTENDED


168 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

169 #undeà
_LARGEFILE64_SOURCE


170 
	#_LARGEFILE64_SOURCE
 1

	)

171 #undeà
_DEFAULT_SOURCE


172 
	#_DEFAULT_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
))

184 #undeà
_DEFAULT_SOURCE


185 
	#_DEFAULT_SOURCE
 1

	)

189 #ià(
defšed
 
_ISOC11_SOURCE
 \

190 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

191 
	#__USE_ISOC11
 1

	)

195 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

196 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

197 
	#__USE_ISOC99
 1

	)

201 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

202 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

203 
	#__USE_ISOC95
 1

	)

210 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

211 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

212 
	#__USE_ISOCXX11
 1

	)

218 #ifdeà
_DEFAULT_SOURCE


219 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


220 
	#__USE_POSIX_IMPLICITLY
 1

	)

222 #undeà
_POSIX_SOURCE


223 
	#_POSIX_SOURCE
 1

	)

224 #undeà
_POSIX_C_SOURCE


225 
	#_POSIX_C_SOURCE
 200809L

	)

227 #ià((!
defšed
 
__STRICT_ANSI__
 \

228 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

229 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

230 
	#_POSIX_SOURCE
 1

	)

231 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

232 
	#_POSIX_C_SOURCE
 2

	)

233 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

234 
	#_POSIX_C_SOURCE
 199506L

	)

235 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

236 
	#_POSIX_C_SOURCE
 200112L

	)

238 
	#_POSIX_C_SOURCE
 200809L

	)

240 
	#__USE_POSIX_IMPLICITLY
 1

	)

243 #ià(
defšed
 
_POSIX_SOURCE
 \

244 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

245 || 
defšed
 
_XOPEN_SOURCE
)

246 
	#__USE_POSIX
 1

	)

249 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


250 
	#__USE_POSIX2
 1

	)

253 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

254 
	#__USE_POSIX199309
 1

	)

257 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

258 
	#__USE_POSIX199506
 1

	)

261 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

262 
	#__USE_XOPEN2K
 1

	)

263 #undeà
__USE_ISOC95


264 
	#__USE_ISOC95
 1

	)

265 #undeà
__USE_ISOC99


266 
	#__USE_ISOC99
 1

	)

269 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

270 
	#__USE_XOPEN2K8
 1

	)

271 #undeà
_ATFILE_SOURCE


272 
	#_ATFILE_SOURCE
 1

	)

275 #ifdef 
_XOPEN_SOURCE


276 
	#__USE_XOPEN
 1

	)

277 #ià(
_XOPEN_SOURCE
 - 0) >= 500

278 
	#__USE_XOPEN_EXTENDED
 1

	)

279 
	#__USE_UNIX98
 1

	)

280 #undeà
_LARGEFILE_SOURCE


281 
	#_LARGEFILE_SOURCE
 1

	)

282 #ià(
_XOPEN_SOURCE
 - 0) >= 600

283 #ià(
_XOPEN_SOURCE
 - 0) >= 700

284 
	#__USE_XOPEN2K8
 1

	)

285 
	#__USE_XOPEN2K8XSI
 1

	)

287 
	#__USE_XOPEN2K
 1

	)

288 
	#__USE_XOPEN2KXSI
 1

	)

289 #undeà
__USE_ISOC95


290 
	#__USE_ISOC95
 1

	)

291 #undeà
__USE_ISOC99


292 
	#__USE_ISOC99
 1

	)

295 #ifdeà
_XOPEN_SOURCE_EXTENDED


296 
	#__USE_XOPEN_EXTENDED
 1

	)

301 #ifdeà
_LARGEFILE_SOURCE


302 
	#__USE_LARGEFILE
 1

	)

305 #ifdeà
_LARGEFILE64_SOURCE


306 
	#__USE_LARGEFILE64
 1

	)

309 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

310 
	#__USE_FILE_OFFSET64
 1

	)

313 #ià
defšed
 
_DEFAULT_SOURCE


314 
	#__USE_MISC
 1

	)

317 #ifdef 
_ATFILE_SOURCE


318 
	#__USE_ATFILE
 1

	)

321 #ifdef 
_GNU_SOURCE


322 
	#__USE_GNU
 1

	)

325 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


326 
	#__USE_REENTRANT
 1

	)

329 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

330 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

331 #ià
_FORTIFY_SOURCE
 > 1

332 
	#__USE_FORTIFY_LEVEL
 2

	)

334 
	#__USE_FORTIFY_LEVEL
 1

	)

337 
	#__USE_FORTIFY_LEVEL
 0

	)

342 
	~<¡dc-´edef.h
>

350 #undeà
__GNU_LIBRARY__


351 
	#__GNU_LIBRARY__
 6

	)

355 
	#__GLIBC__
 2

	)

356 
	#__GLIBC_MINOR__
 24

	)

358 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

359 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

362 #iâdeà
__ASSEMBLER__


363 #iâdeà
_SYS_CDEFS_H


364 
	~<sys/cdefs.h
>

369 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


370 
	#__USE_LARGEFILE
 1

	)

371 
	#__USE_LARGEFILE64
 1

	)

377 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

378 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

379 && 
defšed
 
	g__ex‹º_šlše


380 
	#__USE_EXTERN_INLINES
 1

	)

388 
	~<gnu/¡ubs.h
>

	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

55 
	#__STDC_ISO_10646__
 201505L

	)

58 
	#__STDC_NO_THREADS__
 1

	)

	@
1
.
1
/usr/include
140
2732
AbstractTree.h
AminoAcidOmegaSubMatrix.cpp
AminoAcidOmegaSubMatrix.h
AncestralData.h
AutoRegressiveMultiVariateTreeProcess.h
BaseType.cpp
BaseType.h
BiologicalSequences.h
BranchProcess.h
BranchSitePath.cpp
BranchSitePath.h
BranchSiteSubstitutionProcess.h
BrownianBridge.cpp
BrownianBridge.h
BrownianModel.cpp
BrownianModel.h
BrownianMove.h
BrownianProcess.cpp
BrownianProcess.h
Chain.cpp
Chain.h
Chrono.cpp
Chrono.h
Chronogram.h
CodonSequenceAlignment.cpp
CodonSequenceAlignment.h
CodonStateSpace.cpp
CodonStateSpace.h
CodonSubMatrix.cpp
CodonSubMatrix.h
CommutativeBrownianProcess.h
Conjugate.h
ConjugateGTRModel.cpp
ConjugateGTRModel.h
ConjugateGammaTree.h
ConjugateInverseWishart.h
ConjugateMultiVariateTreeProcess.h
ConjugateMultinomial.h
ConjugateOneMatrixPhyloProcess.h
ConjugatePath.h
ConjugatePoisson.h
ContinuousData.h
CovMatrix.cpp
CovMatrix.h
DAGnode.cpp
DAGnode.h
DrawTree.cpp
DrawTree.h
EmpiricalSubMatrix.h
EvolutionGCBrownianProcess.h
EvolutionNucBrownianProcess.cpp
EvolutionNucBrownianProcess.h
EvolutionOmegaBrownianProcess.h
EvolutionSegmentedCompoProcess.h
EvolutionSegmentedGCProcess.h
EvolutionSegmentedNucProcess.h
EvolutionSegmentedOmegaProcess.h
EvolutionSegmentedProcess.h
Exception.h
GTRModel.h
GTRSubMatrix.cpp
GTRSubMatrix.h
GeneralConjugatePath.h
GeneralSegmentedConjugatePath.h
GeneralTransitionConjugatePath.h
GenericTimeLine.h
GlobalScalingFunction.h
IID.h
IIDConjugate.h
InverseWishartMatrix.h
Jeffreys.h
MCMC.h
MG3OmegaCodonSubMatrix.cpp
MG3OmegaCodonSubMatrix.h
MGAAProfileMutSelCodonSubMatrix.cpp
MGAAProfileMutSelCodonSubMatrix.h
MGCodonAAProfileMutSelCodonSubMatrix.cpp
MGCodonAAProfileMutSelCodonSubMatrix.h
MGCodonProfileMutSelCodonSubMatrix.cpp
MGCodonProfileMutSelCodonSubMatrix.h
MGCodonTransitionMatrix.h
MSCodonSubMatrix.cpp
MSCodonSubMatrix.h
MatrixAlgebra.h
Move.cpp
Move.h
MultiVariateTreeProcess.h
OneMatrixPhyloProcess.h
PhyloProcess.cpp
PhyloProcess.h
PhyloProcessMHMove.h
PoissonGamma.cpp
ProbModel.cpp
ProbModel.h
PureBrownianProcess.cpp
PureBrownianProcess.h
Random.cpp
Random.h
RandomBranchSitePath.cpp
RandomBranchSitePath.h
RandomBrownianPath.h
RandomSegmentedBranchSitePath.h
RandomSubMatrix.h
RandomTypes.cpp
RandomTypes.h
Sample.cpp
Sample.h
SequenceAlignment.cpp
SequenceAlignment.h
SimilarityMatrix.cpp
SimilarityMatrix.h
SiteMapping.cpp
SiteMapping.h
SplitAAMatrix.h
StateSpace.cpp
StateSpace.h
StringStreamUtils.h
SubMatrix.cpp
SubMatrix.h
SumConstrained.h
TaxonSet.cpp
TaxonSet.h
Tree.cpp
Tree.h
ValArray.h
ValTree.h
Var.h
fmath.hpp
global.h
linalg.cpp
linalg.h
stabledistribution.cpp
stabledistribution.h
/usr/include/assert.h
/usr/include/math.h
/usr/include/stdlib.h
/usr/include/alloca.h
/usr/include/features.h
/usr/include/xlocale.h
/usr/include/stdc-predef.h
